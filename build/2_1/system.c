/* Generated by Nimrod Compiler v0.8.10 */
/*   (c) 2010 Andreas Rumpf */

typedef long int NI;
typedef unsigned long int NU;
#include "nimbase.h"

#include <sys/mman.h>
#include <pthread.h>
#include <errno.h>
#include <signal.h>
#include <dlfcn.h>
typedef struct TNimType TNimType;
typedef struct TNimNode TNimNode;
typedef struct TY11190 TY11190;
typedef struct TY10818 TY10818;
typedef struct TY10802 TY10802;
typedef struct TY10814 TY10814;
typedef struct TY10810 TY10810;
typedef struct TY11188 TY11188;
typedef struct TY8874 TY8874;
typedef struct TY8832 TY8832;
typedef struct TY8830 TY8830;
typedef struct TY8822 TY8822;
typedef struct TY8872 TY8872;
typedef struct TY8834 TY8834;
typedef struct TY8811 TY8811;
typedef struct TY8807 TY8807;
typedef struct NimStringDesc NimStringDesc;
typedef struct TGenericSeq TGenericSeq;
typedef struct TY420 TY420;
typedef struct TY418 TY418;
typedef struct TY416 TY416;
typedef struct E_Base E_Base;
typedef struct TNimObject TNimObject;
typedef struct TSafePoint TSafePoint;
typedef struct TY442 TY442;
typedef struct EAssertionFailed EAssertionFailed;
typedef struct EOverflow EOverflow;
typedef struct TY428 TY428;
typedef struct TY452 TY452;
typedef N_NIMCALL_PTR(void, TY2719) (void);
struct TNimType {
NI size;
NU8 kind;
NU8 flags;
TNimType* base;
TNimNode* node;
void* finalizer;
};
struct TY10818 {
NI Len;
NI Cap;
TY10802** D;
};
struct TY10814 {
NI Counter;
NI Max;
TY10810* Head;
TY10810** Data;
};
struct TY11188 {
NI Stackscans;
NI Cyclecollections;
NI Maxthreshold;
NI Maxstacksize;
NI Maxstackcells;
NI Cycletablesize;
};
struct TY11190 {
TY10818 Zct;
TY10818 Decstack;
TY10814 Cycleroots;
TY10818 Tempstack;
NI Cyclerootslock;
NI Zctlock;
TY11188 Stat;
};
struct TY8830 {
NI Prevsize;
NI Size;
NIM_BOOL Used;
};
struct TY8832 {
  TY8830 Sup;
TY8832* Next;
TY8832* Prev;
TY8822* Freelist;
NI Free;
NI Acc;
NF64 Data;
};
typedef TY8832* TY8881[512];
typedef TY8807* TY8809[1024];
struct TY8811 {
TY8809 Data;
};
struct TY8874 {
TY8872* Llmem;
NI Currmem;
NI Maxmem;
NI Freemem;
TY8881 Freesmallchunks;
TY8834* Freechunkslist;
TY8811 Chunkstarts;
};
struct TY8834 {
  TY8830 Sup;
TY8834* Next;
TY8834* Prev;
NI Align;
NF64 Data;
};
typedef NI TY8814[16];
struct TY8807 {
TY8807* Next;
NI Key;
TY8814 Bits;
};
struct TY8872 {
NI Size;
NI Acc;
};
struct TGenericSeq {
NI len;
NI space;
};
typedef NIM_CHAR TY239[100000001];
struct NimStringDesc {
  TGenericSeq Sup;
TY239 data;
};
struct TNimNode {
NU8 kind;
NI offset;
TNimType* typ;
NCSTRING name;
NI len;
TNimNode** sons;
};
struct TNimObject {
TNimType* m_type;
};
struct E_Base {
  TNimObject Sup;
E_Base* parent;
NCSTRING name;
NimStringDesc* message;
};
struct TY416 {
  E_Base Sup;
};
struct TY418 {
  TY416 Sup;
};
struct TY420 {
  TY418 Sup;
};
struct TY10802 {
NI Refcount;
TNimType* Typ;
};
struct TY8822 {
TY8822* Next;
NI Zerofield;
};
struct TY10810 {
TY10810* Next;
NI Key;
TY8814 Bits;
};
typedef N_NIMCALL_PTR(void, TFinalizer) (void* Self_11194);
struct TSafePoint {
TSafePoint* prev;
NI status;
E_Base* exc;
jmp_buf context;
};
struct TY442 {
  TY418 Sup;
};
typedef NimStringDesc* TY4102[5];
typedef TFrame* TY4813[128];
struct EAssertionFailed {
  TY416 Sup;
};
struct TY428 {
  TY416 Sup;
};
struct EOverflow {
  TY428 Sup;
};
struct TY452 {
  TY416 Sup;
};
typedef NIM_CHAR TY19462[60];
static N_INLINE(void, Initstackbottom_3013)(void);
N_NOINLINE(void, setStackBottom)(void* Thestackbottom_1624);
N_NIMCALL(void, Initgc_3011)(void);
N_NIMCALL(void, Init_10878)(TY10818* S_10881, NI Cap_10882);
N_NOCONV(void*, Alloc0_1953)(NI Size_1955);
N_NOCONV(void*, Alloc_1950)(NI Size_1952);
N_NIMCALL(void*, Rawalloc_9795)(TY8874* A_9798, NI Requestedsize_9799);
static N_INLINE(NI, Roundup_8856)(NI X_8858, NI V_8859);
N_NIMCALL(TY8832*, Getsmallchunk_9762)(TY8874* A_9765);
N_NIMCALL(TY8834*, Getbigchunk_9692)(TY8874* A_9695, NI Size_9696);
N_NIMCALL(void, Splitchunk_9666)(TY8874* A_9669, TY8834* C_9670, NI Size_9671);
static N_INLINE(void, Updateprevsize_9211)(TY8874* A_9214, TY8834* C_9215, NI Prevsize_9216);
static N_INLINE(NIM_BOOL, Isaccessible_9152)(void* P_9154);
N_NIMCALL(NIM_BOOL, Contains_9011)(TY8811* S_9013, NI Key_9014);
N_NIMCALL(TY8807*, Intsetget_8974)(TY8811* T_8976, NI Key_8977);
static N_INLINE(NI, Pageindex_9081)(void* P_9083);
N_NIMCALL(void, Incl_9031)(TY8811* S_9034, NI Key_9035);
N_NIMCALL(TY8807*, Intsetput_8993)(TY8811* T_8996, NI Key_8997);
N_NIMCALL(void*, Llalloc_8930)(TY8874* A_8933, NI Size_8934);
static N_INLINE(void*, Osallocpages_8413)(NI Size_8415);
N_NIMCALL(void, Raiseoutofmem_8259)(void);
N_NIMCALL(void, Quit_2822)(NimStringDesc* Errormsg_2824);
static N_INLINE(void, rawEcho)(NimStringDesc* X_4094);
N_NIMCALL(void, Write_3658)(FILE* F_3660, NimStringDesc* S_3661);
N_NIMCALL(NI, Writebuffer_3733)(FILE* F_3735, void* Buffer_3736, NI Len_3737);
N_NIMCALL(void*, newObj)(TNimType* Typ_13707, NI Size_13708);
static N_INLINE(void, Lock_11213)(TY11190* Gch_11216);
static N_INLINE(void, Checkcollection_13700)(void);
N_NIMCALL(void, Collectct_12205)(TY11190* Gch_12208);
N_NIMCALL(NI, Getoccupiedmem_2017)(void);
N_NIMCALL(NI, Gettotalmem_2021)(void);
N_NIMCALL(NI, Getfreemem_2019)(void);
N_NOINLINE(NI, Stacksize_16801)(void);
N_CDECL(void, Markstackandregisters_16815)(TY11190* Gch_16818);
static N_INLINE(void, Gcmark_16003)(void* P_16005);
static N_INLINE(TY10802*, Usrtocell_11612)(void* Usr_11614);
N_NIMCALL(NIM_BOOL, Isallocatedptr_10401)(TY8874* A_10403, void* P_10404);
static N_INLINE(TY8830*, Pageaddr_9085)(void* P_9087);
static N_INLINE(NIM_BOOL, Chunkunused_9207)(TY8830* C_9209);
static N_INLINE(NIM_BOOL, Issmallchunk_9201)(TY8830* C_9203);
static N_INLINE(void, Add_10858)(TY10818* S_10861, TY10802* C_10862);
N_NOCONV(void, Dealloc_1960)(void* P_1962);
N_NIMCALL(void, Rawdealloc_10064)(TY8874* A_10067, void* P_10068);
N_NIMCALL(void, Freebigchunk_9220)(TY8874* A_9223, TY8834* C_9224);
N_NIMCALL(void, Excl_9038)(TY8811* S_9041, NI Key_9042);
static N_INLINE(NI, Pageindex_9077)(TY8830* C_9079);
N_NIMCALL(void, Freeoschunks_9126)(TY8874* A_9129, void* P_9130, NI Size_9131);
static N_INLINE(void, Osdeallocpages_8417)(void* P_8419, NI Size_8420);
static N_INLINE(void, Deccurrmem_8903)(TY8874* A_8906, NI Bytes_8907);
N_NIMCALL(void, Markthreadstacks_16011)(TY11190* Gch_16014);
N_NIMCALL(void, Collectzct_17001)(TY11190* Gch_17004);
static N_INLINE(NIM_BOOL, Canbecycleroot_11616)(TY10802* C_11618);
N_NIMCALL(void, Excl_11081)(TY10814* S_11084, TY10802* Cell_11085);
N_NIMCALL(TY10810*, Cellsetget_10914)(TY10814 T_10916, NI Key_10917);
static N_INLINE(NI, Nexttry_10909)(NI H_10911, NI Maxhash_10912);
N_NIMCALL(void, Preparedealloc_12225)(TY10802* Cell_12227);
static N_INLINE(void*, Celltousr_11608)(TY10802* Cell_11610);
N_NIMCALL(void, Forallchildren_12212)(TY10802* Cell_12214, NU8 Op_12215);
N_NIMCALL(void, Forallchildrenaux_12220)(void* Dest_12222, TNimType* Mt_12223, NU8 Op_12224);
N_NIMCALL(void, Dooperation_12216)(void* P_12218, NU8 Op_12219);
N_NOINLINE(void, Addzct_11601)(TY10818* S_11604, TY10802* C_11605);
N_NIMCALL(void, Forallslotsaux_13601)(void* Dest_13603, TNimNode* N_13605, NU8 Op_13606);
N_NIMCALL(TNimNode*, Selectbranch_7463)(void* Aa_7465, TNimNode* N_7467);
N_NIMCALL(NI, Getdiscriminant_7443)(void* Aa_7445, TNimNode* N_7447);
N_NIMCALL(void, Collectcycles_15203)(TY11190* Gch_15206);
N_NIMCALL(void, Init_10888)(TY10814* S_10891);
N_NIMCALL(NIM_BOOL, Containsorincl_11099)(TY10814* S_11102, TY10802* Cell_11103);
N_NOINLINE(void, Incl_11074)(TY10814* S_11077, TY10802* Cell_11078);
N_NIMCALL(TY10810*, Cellsetput_10995)(TY10814* T_10998, NI Key_10999);
N_NIMCALL(void, Cellsetenlarge_10970)(TY10814* T_10973);
N_NIMCALL(void, Cellsetrawinsert_10933)(TY10814 T_10935, TY10810** Data_10936, TY10810* Desc_10937);
N_NIMCALL(NIM_BOOL, Contains_11054)(TY10814 S_11056, TY10802* Cell_11057);
N_NIMCALL(void, Deinit_10892)(TY10814* S_10895);
N_NIMCALL(void, Unmarkstackandregisters_17601)(TY11190* Gch_17604);
static N_INLINE(void, Decref_13001)(TY10802* C_13003);
static N_INLINE(NI, Atomicdec_3006)(NI* Memloc_3009, NI X_3010);
static N_INLINE(void, Rtladdzct_12601)(TY10802* C_12603);
static N_INLINE(void, Rtladdcycleroot_12252)(TY10802* C_12254);
static N_INLINE(void, Unlock_11401)(TY11190* Gch_11404);
static N_INLINE(void, asgnRefNoCycle)(void** Dest_13218, void* Src_13219);
static N_INLINE(NI, Atomicinc_3001)(NI* Memloc_3004, NI X_3005);
N_NIMCALL(NimStringDesc*, copyString)(NimStringDesc* Src_18708);
N_NIMCALL(NimStringDesc*, rawNewString)(NI Space_18687);
N_NIMCALL(void, raiseException)(E_Base* E_5404, NCSTRING Ename_5405);
N_NIMCALL(void, Gcdisable_2663)(void);
static N_INLINE(void, pushCurrentException)(E_Base* E_4641);
static N_INLINE(void, asgnRef)(void** Dest_13214, void* Src_13215);
static N_INLINE(void, Incref_13202)(TY10802* C_13204);
N_NIMCALL(NimStringDesc*, setLengthStr)(NimStringDesc* S_18825, NI Newlen_18826);
N_NIMCALL(NimStringDesc*, resizeString)(NimStringDesc* Dest_18782, NI Addlen_18783);
static N_INLINE(NI, Resize_18601)(NI Old_18603);
N_NIMCALL(void*, Growobj_14207)(void* Old_14209, NI Newsize_14210);
N_NIMCALL(void, Rawwritestacktrace_4999)(NimStringDesc** S_5002);
static N_INLINE(void, appendString)(NimStringDesc* Dest_18792, NimStringDesc* Src_18793);
N_NIMCALL(NimStringDesc*, cstrToNimstr)(NCSTRING Str_18704);
N_NIMCALL(NimStringDesc*, toNimStr)(NCSTRING Str_18699, NI Len_18700);
N_NIMCALL(void, Writetostderr_4433)(NCSTRING Msg_4435);
N_NIMCALL(void, Write_3670)(FILE* F_3672, NCSTRING C_3673);
static N_INLINE(void, Quitordebug_5201)(void);
N_NIMCALL(void, Gcenable_2665)(void);
static N_INLINE(void, rawEchoNL)(void);
static N_INLINE(void, Inccurrmem_8886)(TY8874* A_8889, NI Bytes_8890);
N_NIMCALL(TY8834*, Requestoschunks_9092)(TY8874* A_9095, NI Size_9096);
N_NOCONV(void, signalHandler)(int Sig_5478);
N_NIMCALL(void, registerSignalHandler)(void);
N_NIMCALL(NimStringDesc*, mnewString)(NI Len_1349);
N_NIMCALL(NI, getRefcount)(void* P_11637);
N_NIMCALL(NimStringDesc*, mnewString)(NI Len_18695);
N_NIMCALL(NimStringDesc*, copyStrLast)(NimStringDesc* S_18743, NI Start_18744, NI Last_18745);
N_NIMCALL(NimStringDesc*, copyStr)(NimStringDesc* S_18758, NI Start_18759);
static N_INLINE(NI, addInt)(NI A_6003, NI B_6004);
N_NOINLINE(void, raiseOverflow)(void);
N_NIMCALL(NI, mulInt)(NI A_7003, NI B_7004);
N_NOINLINE(NIM_BOOL, Isonstack_12209)(void* P_12211);
N_NIMCALL(TNimType*, extGetCellType)(void* C_11633);
N_NIMCALL(void, Objectinitaux_19664)(void* Dest_19666, TNimNode* N_19668);
N_NIMCALL(void, objectInit)(void* Dest_19662, TNimType* Typ_19663);
N_NIMCALL(void, Rawreadline_3789)(FILE* F_3791, NimStringDesc** Result_3793);
N_NIMCALL(NimStringDesc*, addChar)(NimStringDesc* S_1603, NIM_CHAR C_1604);
N_NIMCALL(NI, Ptrsize_10433)(void* P_10435);
N_NIMCALL(NimStringDesc*, nimIntToStr)(NI X_19403);
static N_INLINE(void, pushSafePoint)(TSafePoint* S_4635);
N_NIMCALL(NIM_BOOL, Open_3617)(FILE** F_3620, NimStringDesc* Filename_3621, NU8 Mode_3622, NI Bufsize_3623);
N_NIMCALL(NI64, Getfilesize_3695)(FILE* F_3697);
N_NIMCALL(NI64, Getfilepos_3742)(FILE* F_3744);
N_NIMCALL(void, Setfilepos_3738)(FILE* F_3740, NI64 Pos_3741);
N_NIMCALL(NI, Readbuffer_3714)(FILE* F_3716, void* Buffer_3717, NI Len_3718);
static N_INLINE(void, popSafePoint)(void);
static N_INLINE(E_Base*, getCurrentException)(void);
static N_INLINE(void, popCurrentException)(void);
N_NIMCALL(void, reraiseException)(void);
N_NIMCALL(void, genericAssign)(void* Dest_19565, void* Src_19566, TNimType* Mt_19567);
N_NIMCALL(void, unsureAsgnRef)(void** Dest_13226, void* Src_13227);
N_NIMCALL(void, Genericassignaux_19568)(void* Dest_19570, void* Src_19571, TNimNode* N_19573);
N_NIMCALL(void, Listremove_9246)(TY8834** Head_9250, TY8834* C_9251);
N_NIMCALL(void, Listadd_9826)(TY8832** Head_9830, TY8832* C_9831);
N_NIMCALL(void, Listremove_9968)(TY8832** Head_9972, TY8832* C_9973);
N_NIMCALL(void, Listadd_9607)(TY8834** Head_9611, TY8834* C_9612);
STRING_LITERAL(TMP21508, "cannot write string to file", 27);
STRING_LITERAL(TMP21509, "No stack traceback available", 28);
STRING_LITERAL(TMP21510, "Error: unhandled exception: ", 28);
STRING_LITERAL(TMP21511, "Error: unhandled exception", 26);
STRING_LITERAL(TMP21512, " [", 2);
STRING_LITERAL(TMP21513, "]\012", 2);
STRING_LITERAL(TMP21514, "\012", 1);
STRING_LITERAL(TMP21515, "out of memory; cannot even throw an exception", 45);
STRING_LITERAL(TMP21516, "out of memory", 13);
STRING_LITERAL(TMP21517, "rb", 2);
STRING_LITERAL(TMP21518, "wb", 2);
STRING_LITERAL(TMP21519, "w+b", 3);
STRING_LITERAL(TMP21520, "r+b", 3);
STRING_LITERAL(TMP21521, "ab", 2);
NIM_CONST TY4102 Formatopen_4101 = {((NimStringDesc*) &TMP21517),
((NimStringDesc*) &TMP21518),
((NimStringDesc*) &TMP21519),
((NimStringDesc*) &TMP21520),
((NimStringDesc*) &TMP21521)}
;
STRING_LITERAL(TMP21522, "SIGINT: Interrupted by Ctrl-C.\012", 31);
STRING_LITERAL(TMP21523, "SIGSEGV: Illegal storage access. (Attempt to read from nil?)\012", 61);
STRING_LITERAL(TMP21524, "SIGABRT: Abnormal termination.\012", 31);
STRING_LITERAL(TMP21525, "SIGFPE: Arithmetic error.\012", 26);
STRING_LITERAL(TMP21526, "SIGILL: Illegal operation.\012", 27);
STRING_LITERAL(TMP21527, "SIGBUS: Illegal storage access. (Attempt to read from nil?)\012", 60);
STRING_LITERAL(TMP21528, "unknown signal\012", 15);
STRING_LITERAL(TMP39440, "over- or underflow", 18);
STRING_LITERAL(TMP196655, "", 0);
STRING_LITERAL(TMP196666, "no exception to reraise", 23);
STRING_LITERAL(TMP196767, " (invalid data!)", 16);
STRING_LITERAL(TMP196871, "cannot retrieve file position", 29);
STRING_LITERAL(TMP196872, "cannot set file position", 24);
STRING_LITERAL(TMP198491, "[GC] total memory: ", 19);
STRING_LITERAL(TMP198492, "\012[GC] occupied memory: ", 23);
STRING_LITERAL(TMP198493, "\012[GC] stack scans: ", 19);
STRING_LITERAL(TMP198494, "\012[GC] stack cells: ", 19);
STRING_LITERAL(TMP198495, "\012[GC] cycle collections: ", 25);
STRING_LITERAL(TMP198496, "\012[GC] max threshold: ", 21);
STRING_LITERAL(TMP198497, "\012[GC] zct capacity: ", 20);
STRING_LITERAL(TMP198498, "\012[GC] max cycle table size: ", 28);
STRING_LITERAL(TMP198499, "\012[GC] max stack size: ", 22);
TY2719 Dbglinehook_2722;
TNimType Strdesc_3017;
extern TNimType* NTI4262; /* ref EIO */
extern TNimType* NTI420; /* EIO */
extern TNimType* NTI8262; /* ref EOutOfMemory */
extern TNimType* NTI442; /* EOutOfMemory */
NimStringDesc* Stacktracenewline_4432;
TSafePoint* excHandler;
E_Base* Currexception_4632;
NimStringDesc* Buf_4810;
NimStringDesc* Assertbuf_4811;
TFrame* framePtr;
TY4813 Tempframes_4815;
EAssertionFailed* Gassertionfailed_5451;
NIM_BOOL Dbgaborting_5475;
extern TNimType* NTI5450; /* ref EAssertionFailed */
extern TNimType* NTI436; /* EAssertionFailed */
NIM_BOOL Ismultithreaded_7601;
TY442* Goutofmem_8258;
TY8874 Allocator_8929;
NI Lastsize_9091;
void* Stackbottom_11209;
TY11190 Gch_11210;
NI Cyclethreshold_11211;
NI Recgclock_11212;
extern TNimType* NTI5891; /* ref EOverflow */
extern TNimType* NTI432; /* EOverflow */
extern TNimType* NTI5433; /* ref ENoExceptionToReraise */
extern TNimType* NTI452; /* ENoExceptionToReraise */
N_NOINLINE(void, setStackBottom)(void* Thestackbottom_1624) {
NI A_16404;
NI B_16405;
if (!(Stackbottom_11209 == NIM_NIL)) goto LA2;
Stackbottom_11209 = Thestackbottom_1624;
goto LA1;
LA2: ;
A_16404 = 0;
A_16404 = ((NI) (Thestackbottom_1624));
B_16405 = 0;
B_16405 = ((NI) (Stackbottom_11209));
Stackbottom_11209 = ((void*) (((A_16404 >= B_16405) ? A_16404 : B_16405)));
LA1: ;
}
static N_INLINE(void, Initstackbottom_3013)(void) {
void* volatile Locals_3015;
Locals_3015 = 0;
setStackBottom(((void*) (&Locals_3015)));
}
static N_INLINE(NI, Roundup_8856)(NI X_8858, NI V_8859) {
NI Result_8860;
Result_8860 = 0;
Result_8860 = (NI32)((NI32)(X_8858 + (NI32)(V_8859 - 1)) & (NI32)((NU32) ~((NI32)(V_8859 - 1))));
return Result_8860;
}
N_NIMCALL(TY8807*, Intsetget_8974)(TY8811* T_8976, NI Key_8977) {
TY8807* Result_8978;
TY8807* It_8979;
Result_8978 = 0;
It_8979 = 0;
It_8979 = (*T_8976).Data[((NI32)(Key_8977 & 1023))-0];
while (1) {
if (!!((It_8979 == NIM_NIL))) goto LA1;
if (!((*It_8979).Key == Key_8977)) goto LA3;
Result_8978 = It_8979;
goto BeforeRet;
LA3: ;
It_8979 = (*It_8979).Next;
} LA1: ;
Result_8978 = NIM_NIL;
BeforeRet: ;
return Result_8978;
}
N_NIMCALL(NIM_BOOL, Contains_9011)(TY8811* S_9013, NI Key_9014) {
NIM_BOOL Result_9015;
TY8807* T_9016;
NI U_9028;
Result_9015 = 0;
T_9016 = 0;
T_9016 = Intsetget_8974(S_9013, (NI32)((NU32)(Key_9014) >> (NU32)(9)));
if (!!((T_9016 == NIM_NIL))) goto LA2;
U_9028 = 0;
U_9028 = (NI32)(Key_9014 & 511);
Result_9015 = !(((NI32)((*T_9016).Bits[((NI32)((NU32)(U_9028) >> (NU32)(5)))-0] & (NI32)((NU32)(1) << (NU32)((NI32)(U_9028 & 31)))) == 0));
goto LA1;
LA2: ;
Result_9015 = NIM_FALSE;
LA1: ;
return Result_9015;
}
static N_INLINE(NI, Pageindex_9081)(void* P_9083) {
NI Result_9084;
Result_9084 = 0;
Result_9084 = (NI32)((NU32)(((NI) (P_9083))) >> (NU32)(12));
return Result_9084;
}
static N_INLINE(NIM_BOOL, Isaccessible_9152)(void* P_9154) {
NIM_BOOL Result_9155;
NI LOC1;
Result_9155 = 0;
LOC1 = Pageindex_9081(P_9154);
Result_9155 = Contains_9011(&Allocator_8929.Chunkstarts, LOC1);
return Result_9155;
}
static N_INLINE(void, Updateprevsize_9211)(TY8874* A_9214, TY8834* C_9215, NI Prevsize_9216) {
TY8830* Ri_9217;
NIM_BOOL LOC2;
Ri_9217 = 0;
Ri_9217 = ((TY8830*) ((NI32)((NU32)(((NI) (C_9215))) + (NU32)((*C_9215).Sup.Size))));
LOC2 = Isaccessible_9152(((void*) (Ri_9217)));
if (!LOC2) goto LA3;
(*Ri_9217).Prevsize = Prevsize_9216;
LA3: ;
}
N_NIMCALL(NI, Writebuffer_3733)(FILE* F_3735, void* Buffer_3736, NI Len_3737) {
NI Result_4251;
Result_4251 = 0;
Result_4251 = fwrite(Buffer_3736, 1, Len_3737, F_3735);
return Result_4251;
}
static N_INLINE(void, Lock_11213)(TY11190* Gch_11216) {
}
N_NIMCALL(NI, Gettotalmem_2021)(void) {
NI Result_10477;
Result_10477 = 0;
Result_10477 = Allocator_8929.Currmem;
goto BeforeRet;
BeforeRet: ;
return Result_10477;
}
N_NIMCALL(NI, Getfreemem_2019)(void) {
NI Result_10474;
Result_10474 = 0;
Result_10474 = Allocator_8929.Freemem;
return Result_10474;
}
N_NIMCALL(NI, Getoccupiedmem_2017)(void) {
NI Result_10480;
NI LOC1;
NI LOC2;
Result_10480 = 0;
LOC1 = Gettotalmem_2021();
LOC2 = Getfreemem_2019();
Result_10480 = (NI32)(LOC1 - LOC2);
goto BeforeRet;
BeforeRet: ;
return Result_10480;
}
N_NOINLINE(NI, Stacksize_16801)(void) {
NI Result_16803;
void* volatile Stacktop_16804;
Result_16803 = 0;
Stacktop_16804 = 0;
Result_16803 = (NI32)abs((NI32)(((NI) (&Stacktop_16804)) - ((NI) (Stackbottom_11209))));
return Result_16803;
}
static N_INLINE(TY10802*, Usrtocell_11612)(void* Usr_11614) {
TY10802* Result_11615;
Result_11615 = 0;
Result_11615 = ((TY10802*) ((NI32)((NU32)(((NI) (Usr_11614))) - (NU32)(((NI) (((NI)sizeof(TY10802))))))));
return Result_11615;
}
static N_INLINE(TY8830*, Pageaddr_9085)(void* P_9087) {
TY8830* Result_9088;
Result_9088 = 0;
Result_9088 = ((TY8830*) ((NI32)(((NI) (P_9087)) & -4096)));
return Result_9088;
}
static N_INLINE(NIM_BOOL, Chunkunused_9207)(TY8830* C_9209) {
NIM_BOOL Result_9210;
Result_9210 = 0;
Result_9210 = !((*C_9209).Used);
return Result_9210;
}
static N_INLINE(NIM_BOOL, Issmallchunk_9201)(TY8830* C_9203) {
NIM_BOOL Result_9204;
Result_9204 = 0;
Result_9204 = ((*C_9203).Size <= (NI32)(4096 - (NI32)(((NI)sizeof(TY8832)) - 8)));
goto BeforeRet;
BeforeRet: ;
return Result_9204;
}
N_NIMCALL(NIM_BOOL, Isallocatedptr_10401)(TY8874* A_10403, void* P_10404) {
NIM_BOOL Result_10405;
NIM_BOOL LOC2;
TY8830* C_10406;
NIM_BOOL LOC6;
NIM_BOOL LOC10;
TY8832* C_10407;
NI Offset_10408;
NIM_BOOL LOC13;
NIM_BOOL LOC14;
TY8834* C_10412;
NIM_BOOL LOC17;
Result_10405 = 0;
LOC2 = Isaccessible_9152(P_10404);
if (!LOC2) goto LA3;
C_10406 = 0;
C_10406 = Pageaddr_9085(P_10404);
LOC6 = Chunkunused_9207(C_10406);
if (!!(LOC6)) goto LA7;
LOC10 = Issmallchunk_9201(C_10406);
if (!LOC10) goto LA11;
C_10407 = 0;
C_10407 = ((TY8832*) (C_10406));
Offset_10408 = 0;
Offset_10408 = (NI32)((NU32)((NI32)(((NI) (P_10404)) & 4095)) - (NU32)((NI32)(((NI)sizeof(TY8832)) - 8)));
LOC14 = ((NU32)(Offset_10408) < (NU32)((*C_10407).Acc));
if (!(LOC14)) goto LA15;
LOC14 = ((NI32)((NU32)(Offset_10408) % (NU32)((*C_10407).Sup.Size)) == 0);
LA15: ;
LOC13 = LOC14;
if (!(LOC13)) goto LA16;
LOC13 = ((NU32)(1) < (NU32)((*((TY8822*) (P_10404))).Zerofield));
LA16: ;
Result_10405 = LOC13;
goto LA9;
LA11: ;
C_10412 = 0;
C_10412 = ((TY8834*) (C_10406));
LOC17 = (P_10404 == ((void*) (&(*C_10412).Data)));
if (!(LOC17)) goto LA18;
LOC17 = ((NU32)(1) < (NU32)((*((TY8822*) (P_10404))).Zerofield));
LA18: ;
Result_10405 = LOC17;
LA9: ;
LA7: ;
LA3: ;
return Result_10405;
}
N_NIMCALL(void, Excl_9038)(TY8811* S_9041, NI Key_9042) {
TY8807* T_9043;
NI U_9055;
T_9043 = 0;
T_9043 = Intsetget_8974(&(*S_9041), (NI32)((NU32)(Key_9042) >> (NU32)(9)));
if (!!((T_9043 == NIM_NIL))) goto LA2;
U_9055 = 0;
U_9055 = (NI32)(Key_9042 & 511);
(*T_9043).Bits[((NI32)((NU32)(U_9055) >> (NU32)(5)))-0] = (NI32)((*T_9043).Bits[((NI32)((NU32)(U_9055) >> (NU32)(5)))-0] & (NI32)((NU32) ~((NI32)((NU32)(1) << (NU32)((NI32)(U_9055 & 31))))));
LA2: ;
}
static N_INLINE(NI, Pageindex_9077)(TY8830* C_9079) {
NI Result_9080;
Result_9080 = 0;
Result_9080 = (NI32)((NU32)(((NI) (C_9079))) >> (NU32)(12));
return Result_9080;
}
static N_INLINE(void, Osdeallocpages_8417)(void* P_8419, NI Size_8420) {
munmap(P_8419, Size_8420);
}
static N_INLINE(void, Deccurrmem_8903)(TY8874* A_8906, NI Bytes_8907) {
(*A_8906).Maxmem = (((*A_8906).Maxmem >= (*A_8906).Currmem) ? (*A_8906).Maxmem : (*A_8906).Currmem);
(*A_8906).Currmem -= Bytes_8907;
}
N_NIMCALL(void, Freeoschunks_9126)(TY8874* A_9129, void* P_9130, NI Size_9131) {
TY8830* C_9132;
NI Nxt_9133;
TY8830* Next_9136;
NI LOC2;
NIM_BOOL LOC3;
NI LOC6;
C_9132 = 0;
C_9132 = ((TY8830*) (P_9130));
Nxt_9133 = 0;
Nxt_9133 = (NI32)((NU32)(((NI) (P_9130))) + (NU32)((*C_9132).Size));
Next_9136 = 0;
Next_9136 = ((TY8830*) (Nxt_9133));
LOC2 = Pageindex_9077(Next_9136);
LOC3 = Contains_9011(&(*A_9129).Chunkstarts, LOC2);
if (!LOC3) goto LA4;
(*Next_9136).Prevsize = 0;
LA4: ;
LOC6 = Pageindex_9081(P_9130);
Excl_9038(&(*A_9129).Chunkstarts, LOC6);
Osdeallocpages_8417(P_9130, Size_9131);
Deccurrmem_8903(A_9129, Size_9131);
(*A_9129).Freemem -= Size_9131;
}
N_NIMCALL(void, Freebigchunk_9220)(TY8874* A_9223, TY8834* C_9224) {
TY8834* C_9225;
TY8830* Ri_9240;
NIM_BOOL LOC2;
NIM_BOOL LOC7;
NI LOC10;
TY8830* Le_9403;
NIM_BOOL LOC15;
NIM_BOOL LOC20;
NI LOC23;
NI LOC27;
C_9225 = 0;
C_9225 = C_9224;
(*A_9223).Freemem += (*C_9225).Sup.Size;
Ri_9240 = 0;
Ri_9240 = ((TY8830*) ((NI32)((NU32)(((NI) (C_9225))) + (NU32)((*C_9225).Sup.Size))));
LOC2 = Isaccessible_9152(((void*) (Ri_9240)));
if (!(LOC2)) goto LA3;
LOC2 = Chunkunused_9207(Ri_9240);
LA3: ;
if (!LOC2) goto LA4;
LOC7 = Issmallchunk_9201(Ri_9240);
if (!!(LOC7)) goto LA8;
Listremove_9246(&(*A_9223).Freechunkslist, ((TY8834*) (Ri_9240)));
(*C_9225).Sup.Size += (*Ri_9240).Size;
LOC10 = Pageindex_9077(Ri_9240);
Excl_9038(&(*A_9223).Chunkstarts, LOC10);
LA8: ;
LA4: ;
if (!!(((*C_9225).Sup.Prevsize == 0))) goto LA12;
Le_9403 = 0;
Le_9403 = ((TY8830*) ((NI32)((NU32)(((NI) (C_9225))) - (NU32)((*C_9225).Sup.Prevsize))));
LOC15 = Isaccessible_9152(((void*) (Le_9403)));
if (!(LOC15)) goto LA16;
LOC15 = Chunkunused_9207(Le_9403);
LA16: ;
if (!LOC15) goto LA17;
LOC20 = Issmallchunk_9201(Le_9403);
if (!!(LOC20)) goto LA21;
Listremove_9246(&(*A_9223).Freechunkslist, ((TY8834*) (Le_9403)));
(*Le_9403).Size += (*C_9225).Sup.Size;
LOC23 = Pageindex_9077(&C_9225->Sup);
Excl_9038(&(*A_9223).Chunkstarts, LOC23);
C_9225 = ((TY8834*) (Le_9403));
LA21: ;
LA17: ;
LA12: ;
if (!((*C_9225).Sup.Size < 1048576)) goto LA25;
LOC27 = Pageindex_9077(&C_9225->Sup);
Incl_9031(&(*A_9223).Chunkstarts, LOC27);
Updateprevsize_9211(A_9223, C_9225, (*C_9225).Sup.Size);
Listadd_9607(&(*A_9223).Freechunkslist, C_9225);
(*C_9225).Sup.Used = NIM_FALSE;
goto LA24;
LA25: ;
Freeoschunks_9126(A_9223, ((void*) (C_9225)), (*C_9225).Sup.Size);
LA24: ;
}
N_NIMCALL(void, Rawdealloc_10064)(TY8874* A_10067, void* P_10068) {
TY8830* C_10069;
NIM_BOOL LOC2;
TY8832* C_10070;
NI S_10071;
TY8822* F_10073;
C_10069 = 0;
C_10069 = Pageaddr_9085(P_10068);
LOC2 = Issmallchunk_9201(C_10069);
if (!LOC2) goto LA3;
C_10070 = 0;
C_10070 = ((TY8832*) (C_10069));
S_10071 = 0;
S_10071 = (*C_10070).Sup.Size;
F_10073 = 0;
F_10073 = ((TY8822*) (P_10068));
(*F_10073).Zerofield = 0;
(*F_10073).Next = (*C_10070).Freelist;
(*C_10070).Freelist = F_10073;
if (!((*C_10070).Free < S_10071)) goto LA6;
Listadd_9826(&(*A_10067).Freesmallchunks[((NI32)(S_10071 / 8))-0], C_10070);
(*C_10070).Free += S_10071;
goto LA5;
LA6: ;
(*C_10070).Free += S_10071;
if (!((*C_10070).Free == (NI32)(4096 - (NI32)(((NI)sizeof(TY8832)) - 8)))) goto LA9;
Listremove_9968(&(*A_10067).Freesmallchunks[((NI32)(S_10071 / 8))-0], C_10070);
(*C_10070).Sup.Size = 4096;
Freebigchunk_9220(A_10067, ((TY8834*) (C_10070)));
LA9: ;
LA5: ;
goto LA1;
LA3: ;
Freebigchunk_9220(A_10067, ((TY8834*) (C_10069)));
LA1: ;
}
N_NOCONV(void, Dealloc_1960)(void* P_1962) {
void* X_10428;
X_10428 = 0;
X_10428 = ((void*) ((NI32)((NU32)(((NI) (P_1962))) - (NU32)(((NI)sizeof(TY8822))))));
Rawdealloc_10064(&Allocator_8929, X_10428);
}
static N_INLINE(void, Add_10858)(TY10818* S_10861, TY10802* C_10862) {
TY10802** D_10865;
void* LOC4;
if (!((*S_10861).Cap <= (*S_10861).Len)) goto LA2;
(*S_10861).Cap = (NI32)((NI32)((*S_10861).Cap * 3) / 2);
D_10865 = 0;
LOC4 = Alloc_1950((NI32)((*S_10861).Cap * 4));
D_10865 = ((TY10802**) (LOC4));
memcpy(((void*) (D_10865)), ((void*) ((*S_10861).D)), (NI32)((*S_10861).Len * 4));
Dealloc_1960(((void*) ((*S_10861).D)));
(*S_10861).D = D_10865;
LA2: ;
(*S_10861).D[((*S_10861).Len)-0] = C_10862;
(*S_10861).Len += 1;
}
static N_INLINE(void, Gcmark_16003)(void* P_16005) {
TY10802* Cell_16006;
NI C_16007;
NIM_BOOL LOC2;
NIM_BOOL LOC7;
Cell_16006 = 0;
Cell_16006 = Usrtocell_11612(P_16005);
C_16007 = 0;
C_16007 = ((NI) (Cell_16006));
LOC2 = ((NU32)(4096) < (NU32)(C_16007));
if (!(LOC2)) goto LA3;
LOC2 = ((NI32)(C_16007 & 7) == 0);
LA3: ;
if (!LOC2) goto LA4;
LOC7 = Isallocatedptr_10401(&Allocator_8929, ((void*) (Cell_16006)));
if (!LOC7) goto LA8;
(*Cell_16006).Refcount = (NI32)((NU32)((*Cell_16006).Refcount) + (NU32)(8));
Add_10858(&Gch_11210.Decstack, Cell_16006);
LA8: ;
LA4: ;
}
N_CDECL(void, Markstackandregisters_16815)(TY11190* Gch_16818) {
jmp_buf Registers_16819;
int LOC2;
NI Max_16823;
NI Sp_16825;
memset((void*)&Registers_16819, 0, sizeof(Registers_16819));
LOC2 = setjmp(Registers_16819);
if (!(LOC2 == ((NI32) 0))) goto LA3;
Max_16823 = 0;
Max_16823 = ((NI) (Stackbottom_11209));
Sp_16825 = 0;
Sp_16825 = ((NI) (Registers_16819));
while (1) {
if (!((NU32)(Sp_16825) <= (NU32)(Max_16823))) goto LA5;
Gcmark_16003((*((void**) (Sp_16825))));
Sp_16825 = (NI32)((NU32)(Sp_16825) + (NU32)(4));
} LA5: ;
LA3: ;
}
N_NIMCALL(void, Markthreadstacks_16011)(TY11190* Gch_16014) {
}
static N_INLINE(NIM_BOOL, Canbecycleroot_11616)(TY10802* C_11618) {
NIM_BOOL Result_11619;
Result_11619 = 0;
Result_11619 = !((((*(*C_11618).Typ).flags &(1<<((((NU8) 1))&7)))!=0));
return Result_11619;
}
static N_INLINE(NI, Nexttry_10909)(NI H_10911, NI Maxhash_10912) {
NI Result_10913;
Result_10913 = 0;
Result_10913 = (NI32)((NI32)((NI32)(5 * H_10911) + 1) & Maxhash_10912);
return Result_10913;
}
N_NIMCALL(TY10810*, Cellsetget_10914)(TY10814 T_10916, NI Key_10917) {
TY10810* Result_10918;
NI H_10919;
Result_10918 = 0;
H_10919 = 0;
H_10919 = (NI32)(((NI) (Key_10917)) & T_10916.Max);
while (1) {
if (!!((T_10916.Data[(H_10919)-0] == NIM_NIL))) goto LA1;
if (!((*T_10916.Data[(H_10919)-0]).Key == Key_10917)) goto LA3;
Result_10918 = T_10916.Data[(H_10919)-0];
goto BeforeRet;
LA3: ;
H_10919 = Nexttry_10909(H_10919, T_10916.Max);
} LA1: ;
Result_10918 = NIM_NIL;
goto BeforeRet;
BeforeRet: ;
return Result_10918;
}
N_NIMCALL(void, Excl_11081)(TY10814* S_11084, TY10802* Cell_11085) {
NI U_11086;
TY10810* T_11087;
U_11086 = 0;
U_11086 = ((NI) (Cell_11085));
T_11087 = 0;
T_11087 = Cellsetget_10914((*S_11084), (NI32)((NU32)(U_11086) >> (NU32)(12)));
if (!!((T_11087 == NIM_NIL))) goto LA2;
U_11086 = (NI32)((NU32)((NI32)((NU32)(U_11086) % (NU32)(4096))) / (NU32)(8));
(*T_11087).Bits[((NI32)((NU32)(U_11086) >> (NU32)(5)))-0] = (NI32)((*T_11087).Bits[((NI32)((NU32)(U_11086) >> (NU32)(5)))-0] & (NI32)((NU32) ~((NI32)((NU32)(1) << (NU32)((NI32)(U_11086 & 31))))));
LA2: ;
}
static N_INLINE(void*, Celltousr_11608)(TY10802* Cell_11610) {
void* Result_11611;
Result_11611 = 0;
Result_11611 = ((void*) ((NI32)((NU32)(((NI) (Cell_11610))) + (NU32)(((NI) (((NI)sizeof(TY10802))))))));
return Result_11611;
}
N_NIMCALL(void, Preparedealloc_12225)(TY10802* Cell_12227) {
void* LOC4;
if (!!(((*(*Cell_12227).Typ).finalizer == NIM_NIL))) goto LA2;
Recgclock_11212 += 1;
LOC4 = Celltousr_11608(Cell_12227);
((TFinalizer) ((*(*Cell_12227).Typ).finalizer))(LOC4);
Recgclock_11212 -= 1;
LA2: ;
}
N_NOINLINE(void, Addzct_11601)(TY10818* S_11604, TY10802* C_11605) {
if (!((NI32)((*C_11605).Refcount & 4) == 0)) goto LA2;
(*C_11605).Refcount = (NI32)((NI32)((*C_11605).Refcount & -8) | 4);
Add_10858(S_11604, C_11605);
LA2: ;
}
N_NIMCALL(void, Dooperation_12216)(void* P_12218, NU8 Op_12219) {
TY10802* C_15006;
if (!(P_12218 == NIM_NIL)) goto LA2;
goto BeforeRet;
LA2: ;
C_15006 = 0;
C_15006 = Usrtocell_11612(P_12218);
switch (Op_12219) {
case ((NU8) 0):
(*C_15006).Refcount = (NI32)((NU32)((*C_15006).Refcount) - (NU32)(8));
if (!((NU32)((*C_15006).Refcount) < (NU32)(8))) goto LA5;
Addzct_11601(&Gch_11210.Zct, C_15006);
LA5: ;
break;
case ((NU8) 1):
Add_10858(&Gch_11210.Tempstack, C_15006);
break;
case ((NU8) 2):
(*C_15006).Refcount = (NI32)((NU32)((*C_15006).Refcount) - (NU32)(8));
break;
}
BeforeRet: ;
}
N_NIMCALL(NI, Getdiscriminant_7443)(void* Aa_7445, TNimNode* N_7447) {
NI Result_7448;
NI D_7458;
NI A_7459;
Result_7448 = 0;
D_7458 = 0;
A_7459 = 0;
A_7459 = ((NI) (Aa_7445));
switch ((*(*N_7447).typ).size) {
case 1:
D_7458 = ((NI)(NU)(NU8)((*((NI8*) ((NI32)((NU32)(A_7459) + (NU32)((*N_7447).offset)))))));
break;
case 2:
D_7458 = ((NI)(NU)(NU16)((*((NI16*) ((NI32)((NU32)(A_7459) + (NU32)((*N_7447).offset)))))));
break;
case 4:
D_7458 = ((NI) ((*((int*) ((NI32)((NU32)(A_7459) + (NU32)((*N_7447).offset)))))));
break;
default:
break;
}
Result_7448 = D_7458;
goto BeforeRet;
BeforeRet: ;
return Result_7448;
}
N_NIMCALL(TNimNode*, Selectbranch_7463)(void* Aa_7465, TNimNode* N_7467) {
TNimNode* Result_7469;
NI Discr_7470;
Result_7469 = 0;
Discr_7470 = 0;
Discr_7470 = Getdiscriminant_7443(Aa_7465, N_7467);
if (!((NU32)(Discr_7470) < (NU32)((*N_7467).len))) goto LA2;
Result_7469 = (*N_7467).sons[(Discr_7470)-0];
if (!(Result_7469 == NIM_NIL)) goto LA5;
Result_7469 = (*N_7467).sons[((*N_7467).len)-0];
LA5: ;
goto LA1;
LA2: ;
Result_7469 = (*N_7467).sons[((*N_7467).len)-0];
LA1: ;
return Result_7469;
}
N_NIMCALL(void, Forallslotsaux_13601)(void* Dest_13603, TNimNode* N_13605, NU8 Op_13606) {
NI D_13607;
NI I_13615;
NI HEX3Atmp_21275;
NI Res_21277;
TNimNode* M_13616;
D_13607 = 0;
D_13607 = ((NI) (Dest_13603));
switch ((*N_13605).kind) {
case ((NU8) 0):
break;
case ((NU8) 1):
Forallchildrenaux_12220(((void*) ((NI32)((NU32)(D_13607) + (NU32)((*N_13605).offset)))), (*N_13605).typ, Op_13606);
break;
case ((NU8) 2):
I_13615 = 0;
HEX3Atmp_21275 = 0;
HEX3Atmp_21275 = (NI32)((*N_13605).len - 1);
Res_21277 = 0;
Res_21277 = 0;
while (1) {
if (!(Res_21277 <= HEX3Atmp_21275)) goto LA1;
I_13615 = Res_21277;
Forallslotsaux_13601(Dest_13603, (*N_13605).sons[(I_13615)-0], Op_13606);
Res_21277 += 1;
} LA1: ;
break;
case ((NU8) 3):
M_13616 = 0;
M_13616 = Selectbranch_7463(Dest_13603, N_13605);
if (!!((M_13616 == NIM_NIL))) goto LA3;
Forallslotsaux_13601(Dest_13603, M_13616, Op_13606);
LA3: ;
break;
}
}
N_NIMCALL(void, Forallchildrenaux_12220)(void* Dest_12222, TNimType* Mt_12223, NU8 Op_12224) {
NI D_13633;
NI I_13652;
NI HEX3Atmp_21281;
NI Res_21283;
D_13633 = 0;
D_13633 = ((NI) (Dest_12222));
if (!(Dest_12222 == NIM_NIL)) goto LA2;
goto BeforeRet;
LA2: ;
if (!!((((*Mt_12223).flags &(1<<((((NU8) 0))&7)))!=0))) goto LA5;
switch ((*Mt_12223).kind) {
case ((NU8) 16):
case ((NU8) 4):
case ((NU8) 27):
I_13652 = 0;
HEX3Atmp_21281 = 0;
HEX3Atmp_21281 = (NI32)((NI32)((*Mt_12223).size / (*(*Mt_12223).base).size) - 1);
Res_21283 = 0;
Res_21283 = 0;
while (1) {
if (!(Res_21283 <= HEX3Atmp_21281)) goto LA7;
I_13652 = Res_21283;
Forallchildrenaux_12220(((void*) ((NI32)((NU32)(D_13633) + (NU32)((NI32)((NU32)(I_13652) * (NU32)((*(*Mt_12223).base).size)))))), (*Mt_12223).base, Op_12224);
Res_21283 += 1;
} LA7: ;
break;
case ((NU8) 22):
case ((NU8) 28):
case ((NU8) 24):
Dooperation_12216((*((void**) (D_13633))), Op_12224);
break;
case ((NU8) 17):
case ((NU8) 18):
case ((NU8) 40):
Forallslotsaux_13601(Dest_12222, (*Mt_12223).node, Op_12224);
break;
default:
break;
}
LA5: ;
BeforeRet: ;
}
N_NIMCALL(void, Forallchildren_12212)(TY10802* Cell_12214, NU8 Op_12215) {
void* LOC1;
NI D_13679;
void* LOC2;
TGenericSeq* S_13680;
NI I_13699;
NI HEX3Atmp_21287;
NI Res_21289;
switch ((*(*Cell_12214).Typ).kind) {
case ((NU8) 22):
LOC1 = Celltousr_11608(Cell_12214);
Forallchildrenaux_12220(LOC1, (*(*Cell_12214).Typ).base, Op_12215);
break;
case ((NU8) 24):
D_13679 = 0;
LOC2 = Celltousr_11608(Cell_12214);
D_13679 = ((NI) (LOC2));
S_13680 = 0;
S_13680 = ((TGenericSeq*) (D_13679));
if (!!((S_13680 == NIM_NIL))) goto LA4;
I_13699 = 0;
HEX3Atmp_21287 = 0;
HEX3Atmp_21287 = (NI32)((*S_13680).len - 1);
Res_21289 = 0;
Res_21289 = 0;
while (1) {
if (!(Res_21289 <= HEX3Atmp_21287)) goto LA6;
I_13699 = Res_21289;
Forallchildrenaux_12220(((void*) ((NI32)((NU32)((NI32)((NU32)(D_13679) + (NU32)((NI32)((NU32)(I_13699) * (NU32)((*(*(*Cell_12214).Typ).base).size))))) + (NU32)(8)))), (*(*Cell_12214).Typ).base, Op_12215);
Res_21289 += 1;
} LA6: ;
LA4: ;
break;
case ((NU8) 28):
break;
default:
break;
}
}
N_NIMCALL(void, Collectzct_17001)(TY11190* Gch_17004) {
NI* L_17006;
TY10802* C_17009;
NIM_BOOL LOC6;
L_17006 = 0;
L_17006 = &(*Gch_17004).Zct.Len;
while (1) {
if (!(0 < (*L_17006))) goto LA1;
C_17009 = 0;
C_17009 = (*Gch_17004).Zct.D[(0)-0];
(*C_17009).Refcount = (NI32)((*C_17009).Refcount & -8);
(*Gch_17004).Zct.D[(0)-0] = (*Gch_17004).Zct.D[((NI32)((*L_17006) - 1))-0];
(*L_17006) -= 1;
if (!((NU32)((*C_17009).Refcount) < (NU32)(8))) goto LA3;
LOC6 = Canbecycleroot_11616(C_17009);
if (!LOC6) goto LA7;
Excl_11081(&(*Gch_17004).Cycleroots, C_17009);
LA7: ;
Preparedealloc_12225(C_17009);
Forallchildren_12212(C_17009, ((NU8) 0));
Rawdealloc_10064(&Allocator_8929, ((void*) (C_17009)));
LA3: ;
} LA1: ;
}
N_NIMCALL(void, Init_10888)(TY10814* S_10891) {
void* LOC1;
LOC1 = Alloc0_1953(4096);
(*S_10891).Data = ((TY10810**) (LOC1));
(*S_10891).Max = 1023;
(*S_10891).Counter = 0;
(*S_10891).Head = NIM_NIL;
}
N_NIMCALL(void, Cellsetrawinsert_10933)(TY10814 T_10935, TY10810** Data_10936, TY10810* Desc_10937) {
NI H_10938;
H_10938 = 0;
H_10938 = (NI32)(((NI) ((*Desc_10937).Key)) & T_10935.Max);
while (1) {
if (!!((Data_10936[(H_10938)-0] == NIM_NIL))) goto LA1;
H_10938 = Nexttry_10909(H_10938, T_10935.Max);
} LA1: ;
Data_10936[(H_10938)-0] = Desc_10937;
}
N_NIMCALL(void, Cellsetenlarge_10970)(TY10814* T_10973) {
NI Oldmax_10974;
TY10810** N_10975;
void* LOC1;
NI I_10983;
NI Res_21266;
Oldmax_10974 = 0;
Oldmax_10974 = (*T_10973).Max;
(*T_10973).Max = (NI32)((NI32)((NI32)((*T_10973).Max + 1) * 2) - 1);
N_10975 = 0;
LOC1 = Alloc0_1953((NI32)((NI32)((*T_10973).Max + 1) * 4));
N_10975 = ((TY10810**) (LOC1));
I_10983 = 0;
Res_21266 = 0;
Res_21266 = 0;
while (1) {
if (!(Res_21266 <= Oldmax_10974)) goto LA2;
I_10983 = Res_21266;
if (!!(((*T_10973).Data[(I_10983)-0] == NIM_NIL))) goto LA4;
Cellsetrawinsert_10933((*T_10973), N_10975, (*T_10973).Data[(I_10983)-0]);
LA4: ;
Res_21266 += 1;
} LA2: ;
Dealloc_1960(((void*) ((*T_10973).Data)));
(*T_10973).Data = N_10975;
}
N_NIMCALL(TY10810*, Cellsetput_10995)(TY10814* T_10998, NI Key_10999) {
TY10810* Result_11000;
NI H_11001;
TY10810* X_11002;
NIM_BOOL LOC9;
void* LOC14;
Result_11000 = 0;
H_11001 = 0;
H_11001 = (NI32)(((NI) (Key_10999)) & (*T_10998).Max);
while (1) {
X_11002 = 0;
X_11002 = (*T_10998).Data[(H_11001)-0];
if (!(X_11002 == NIM_NIL)) goto LA3;
goto LA1;
LA3: ;
if (!((*X_11002).Key == Key_10999)) goto LA6;
Result_11000 = X_11002;
goto BeforeRet;
LA6: ;
H_11001 = Nexttry_10909(H_11001, (*T_10998).Max);
} LA1: ;
LOC9 = ((NI32)((NI32)((*T_10998).Max + 1) * 2) < (NI32)((*T_10998).Counter * 3));
if (LOC9) goto LA10;
LOC9 = ((NI32)((NI32)((*T_10998).Max + 1) - (*T_10998).Counter) < 4);
LA10: ;
if (!LOC9) goto LA11;
Cellsetenlarge_10970(T_10998);
LA11: ;
(*T_10998).Counter += 1;
H_11001 = (NI32)(((NI) (Key_10999)) & (*T_10998).Max);
while (1) {
if (!!(((*T_10998).Data[(H_11001)-0] == NIM_NIL))) goto LA13;
H_11001 = Nexttry_10909(H_11001, (*T_10998).Max);
} LA13: ;
LOC14 = Alloc0_1953(((NI)sizeof(TY10810)));
Result_11000 = ((TY10810*) (LOC14));
(*Result_11000).Next = (*T_10998).Head;
(*Result_11000).Key = Key_10999;
(*T_10998).Head = Result_11000;
(*T_10998).Data[(H_11001)-0] = Result_11000;
BeforeRet: ;
return Result_11000;
}
N_NOINLINE(void, Incl_11074)(TY10814* S_11077, TY10802* Cell_11078) {
NI U_11079;
TY10810* T_11080;
U_11079 = 0;
U_11079 = ((NI) (Cell_11078));
T_11080 = 0;
T_11080 = Cellsetput_10995(S_11077, (NI32)((NU32)(U_11079) >> (NU32)(12)));
U_11079 = (NI32)((NU32)((NI32)((NU32)(U_11079) % (NU32)(4096))) / (NU32)(8));
(*T_11080).Bits[((NI32)((NU32)(U_11079) >> (NU32)(5)))-0] = (NI32)((*T_11080).Bits[((NI32)((NU32)(U_11079) >> (NU32)(5)))-0] | (NI32)((NU32)(1) << (NU32)((NI32)(U_11079 & 31))));
}
N_NIMCALL(NIM_BOOL, Containsorincl_11099)(TY10814* S_11102, TY10802* Cell_11103) {
NIM_BOOL Result_11104;
NI U_11105;
TY10810* T_11106;
Result_11104 = 0;
U_11105 = 0;
U_11105 = ((NI) (Cell_11103));
T_11106 = 0;
T_11106 = Cellsetget_10914((*S_11102), (NI32)((NU32)(U_11105) >> (NU32)(12)));
if (!!((T_11106 == NIM_NIL))) goto LA2;
U_11105 = (NI32)((NU32)((NI32)((NU32)(U_11105) % (NU32)(4096))) / (NU32)(8));
Result_11104 = !(((NI32)((*T_11106).Bits[((NI32)((NU32)(U_11105) >> (NU32)(5)))-0] & (NI32)((NU32)(1) << (NU32)((NI32)(U_11105 & 31)))) == 0));
if (!!(Result_11104)) goto LA5;
(*T_11106).Bits[((NI32)((NU32)(U_11105) >> (NU32)(5)))-0] = (NI32)((*T_11106).Bits[((NI32)((NU32)(U_11105) >> (NU32)(5)))-0] | (NI32)((NU32)(1) << (NU32)((NI32)(U_11105 & 31))));
LA5: ;
goto LA1;
LA2: ;
Incl_11074(S_11102, Cell_11103);
Result_11104 = NIM_FALSE;
LA1: ;
return Result_11104;
}
N_NIMCALL(NIM_BOOL, Contains_11054)(TY10814 S_11056, TY10802* Cell_11057) {
NIM_BOOL Result_11058;
NI U_11059;
TY10810* T_11060;
Result_11058 = 0;
U_11059 = 0;
U_11059 = ((NI) (Cell_11057));
T_11060 = 0;
T_11060 = Cellsetget_10914(S_11056, (NI32)((NU32)(U_11059) >> (NU32)(12)));
if (!!((T_11060 == NIM_NIL))) goto LA2;
U_11059 = (NI32)((NU32)((NI32)((NU32)(U_11059) % (NU32)(4096))) / (NU32)(8));
Result_11058 = !(((NI32)((*T_11060).Bits[((NI32)((NU32)(U_11059) >> (NU32)(5)))-0] & (NI32)((NU32)(1) << (NU32)((NI32)(U_11059 & 31)))) == 0));
goto LA1;
LA2: ;
Result_11058 = NIM_FALSE;
LA1: ;
return Result_11058;
}
N_NIMCALL(void, Deinit_10892)(TY10814* S_10895) {
TY10810* It_10896;
TY10810* N_10908;
It_10896 = 0;
It_10896 = (*S_10895).Head;
while (1) {
if (!!((It_10896 == NIM_NIL))) goto LA1;
N_10908 = 0;
N_10908 = (*It_10896).Next;
Dealloc_1960(((void*) (It_10896)));
It_10896 = N_10908;
} LA1: ;
(*S_10895).Head = NIM_NIL;
Dealloc_1960(((void*) ((*S_10895).Data)));
(*S_10895).Data = NIM_NIL;
(*S_10895).Counter = 0;
}
N_NIMCALL(void, Collectcycles_15203)(TY11190* Gch_15206) {
NI Tabsize_15207;
TY10802* C_15208;
TY10814 HEX3Atmp_21301;
TY10810* R_21303;
NI I_21305;
NI W_21307;
NI J_21309;
TY10814 Marker_15223;
TY10802* C_15225;
TY10814 HEX3Atmp_21324;
TY10810* R_21326;
NI I_21328;
NI W_21330;
NI J_21332;
NIM_BOOL LOC17;
TY10802* D_15241;
NIM_BOOL LOC22;
NIM_BOOL LOC24;
TY10802* C_15245;
TY10814 HEX3Atmp_21358;
TY10810* R_21360;
NI I_21362;
NI W_21364;
NI J_21366;
TY10802* D_15260;
NIM_BOOL LOC41;
Tabsize_15207 = 0;
Tabsize_15207 = 0;
C_15208 = 0;
memset((void*)&HEX3Atmp_21301, 0, sizeof(HEX3Atmp_21301));
HEX3Atmp_21301 = (*Gch_15206).Cycleroots;
R_21303 = 0;
R_21303 = HEX3Atmp_21301.Head;
while (1) {
if (!!((R_21303 == NIM_NIL))) goto LA1;
I_21305 = 0;
I_21305 = 0;
while (1) {
if (!(I_21305 <= 15)) goto LA2;
W_21307 = 0;
W_21307 = (*R_21303).Bits[(I_21305)-0];
J_21309 = 0;
J_21309 = 0;
while (1) {
if (!!((W_21307 == 0))) goto LA3;
if (!!(((NI32)(W_21307 & 1) == 0))) goto LA5;
C_15208 = ((TY10802*) ((NI32)((NI32)((NU32)((*R_21303).Key) << (NU32)(12)) | (NI32)((NU32)((NI32)((NU32)((NI32)((NU32)(I_21305) << (NU32)(5))) + (NU32)(J_21309))) * (NU32)(8)))));
Tabsize_15207 += 1;
Forallchildren_12212(C_15208, ((NU8) 2));
LA5: ;
J_21309 += 1;
W_21307 = (NI32)((NU32)(W_21307) >> (NU32)(1));
} LA3: ;
I_21305 += 1;
} LA2: ;
R_21303 = (*R_21303).Next;
} LA1: ;
(*Gch_15206).Stat.Cycletablesize = (((*Gch_15206).Stat.Cycletablesize >= Tabsize_15207) ? (*Gch_15206).Stat.Cycletablesize : Tabsize_15207);
memset((void*)&Marker_15223, 0, sizeof(Marker_15223));
Init_10888(&Marker_15223);
C_15225 = 0;
memset((void*)&HEX3Atmp_21324, 0, sizeof(HEX3Atmp_21324));
HEX3Atmp_21324 = (*Gch_15206).Cycleroots;
R_21326 = 0;
R_21326 = HEX3Atmp_21324.Head;
while (1) {
if (!!((R_21326 == NIM_NIL))) goto LA7;
I_21328 = 0;
I_21328 = 0;
while (1) {
if (!(I_21328 <= 15)) goto LA8;
W_21330 = 0;
W_21330 = (*R_21326).Bits[(I_21328)-0];
J_21332 = 0;
J_21332 = 0;
while (1) {
if (!!((W_21330 == 0))) goto LA9;
if (!!(((NI32)(W_21330 & 1) == 0))) goto LA11;
C_15225 = ((TY10802*) ((NI32)((NI32)((NU32)((*R_21326).Key) << (NU32)(12)) | (NI32)((NU32)((NI32)((NU32)((NI32)((NU32)(I_21328) << (NU32)(5))) + (NU32)(J_21332))) * (NU32)(8)))));
if (!((NU32)(8) <= (NU32)((*C_15225).Refcount))) goto LA14;
LOC17 = Containsorincl_11099(&Marker_15223, C_15225);
if (!!(LOC17)) goto LA18;
(*Gch_15206).Tempstack.Len = 0;
Forallchildren_12212(C_15225, ((NU8) 1));
while (1) {
if (!(0 < (*Gch_15206).Tempstack.Len)) goto LA20;
(*Gch_15206).Tempstack.Len -= 1;
D_15241 = 0;
D_15241 = (*Gch_15206).Tempstack.D[((*Gch_15206).Tempstack.Len)-0];
(*D_15241).Refcount = (NI32)((NU32)((*D_15241).Refcount) + (NU32)(8));
LOC22 = Contains_11054((*Gch_15206).Cycleroots, D_15241);
if (!(LOC22)) goto LA23;
LOC24 = Containsorincl_11099(&Marker_15223, D_15241);
LOC22 = !(LOC24);
LA23: ;
if (!LOC22) goto LA25;
Forallchildren_12212(D_15241, ((NU8) 1));
LA25: ;
} LA20: ;
LA18: ;
LA14: ;
LA11: ;
J_21332 += 1;
W_21330 = (NI32)((NU32)(W_21330) >> (NU32)(1));
} LA9: ;
I_21328 += 1;
} LA8: ;
R_21326 = (*R_21326).Next;
} LA7: ;
C_15245 = 0;
memset((void*)&HEX3Atmp_21358, 0, sizeof(HEX3Atmp_21358));
HEX3Atmp_21358 = (*Gch_15206).Cycleroots;
R_21360 = 0;
R_21360 = HEX3Atmp_21358.Head;
while (1) {
if (!!((R_21360 == NIM_NIL))) goto LA27;
I_21362 = 0;
I_21362 = 0;
while (1) {
if (!(I_21362 <= 15)) goto LA28;
W_21364 = 0;
W_21364 = (*R_21360).Bits[(I_21362)-0];
J_21366 = 0;
J_21366 = 0;
while (1) {
if (!!((W_21364 == 0))) goto LA29;
if (!!(((NI32)(W_21364 & 1) == 0))) goto LA31;
C_15245 = ((TY10802*) ((NI32)((NI32)((NU32)((*R_21360).Key) << (NU32)(12)) | (NI32)((NU32)((NI32)((NU32)((NI32)((NU32)(I_21362) << (NU32)(5))) + (NU32)(J_21366))) * (NU32)(8)))));
if (!((NU32)((*C_15245).Refcount) < (NU32)(8))) goto LA34;
(*Gch_15206).Tempstack.Len = 0;
Forallchildren_12212(C_15245, ((NU8) 1));
while (1) {
if (!(0 < (*Gch_15206).Tempstack.Len)) goto LA36;
(*Gch_15206).Tempstack.Len -= 1;
D_15260 = 0;
D_15260 = (*Gch_15206).Tempstack.D[((*Gch_15206).Tempstack.Len)-0];
if (!((NU32)((*D_15260).Refcount) < (NU32)(8))) goto LA38;
LOC41 = Contains_11054((*Gch_15206).Cycleroots, D_15260);
if (!!(LOC41)) goto LA42;
Addzct_11601(&(*Gch_15206).Zct, D_15260);
LA42: ;
LA38: ;
} LA36: ;
Preparedealloc_12225(C_15245);
Rawdealloc_10064(&Allocator_8929, ((void*) (C_15245)));
LA34: ;
LA31: ;
J_21366 += 1;
W_21364 = (NI32)((NU32)(W_21364) >> (NU32)(1));
} LA29: ;
I_21362 += 1;
} LA28: ;
R_21360 = (*R_21360).Next;
} LA27: ;
Deinit_10892(&(*Gch_15206).Cycleroots);
Init_10888(&(*Gch_15206).Cycleroots);
}
static N_INLINE(NI, Atomicdec_3006)(NI* Memloc_3009, NI X_3010) {
NI Result_7806;
Result_7806 = 0;
(*Memloc_3009) -= X_3010;
Result_7806 = (*Memloc_3009);
return Result_7806;
}
static N_INLINE(void, Rtladdzct_12601)(TY10802* C_12603) {
Addzct_11601(&Gch_11210.Zct, C_12603);
}
static N_INLINE(void, Rtladdcycleroot_12252)(TY10802* C_12254) {
Incl_11074(&Gch_11210.Cycleroots, C_12254);
}
static N_INLINE(void, Decref_13001)(TY10802* C_13003) {
NI LOC2;
NIM_BOOL LOC5;
LOC2 = Atomicdec_3006(&(*C_13003).Refcount, 8);
if (!((NU32)(LOC2) < (NU32)(8))) goto LA3;
Rtladdzct_12601(C_13003);
goto LA1;
LA3: ;
LOC5 = Canbecycleroot_11616(C_13003);
if (!LOC5) goto LA6;
Rtladdcycleroot_12252(C_13003);
goto LA1;
LA6: ;
LA1: ;
}
N_NIMCALL(void, Unmarkstackandregisters_17601)(TY11190* Gch_17604) {
TY10802** D_17605;
NI I_17613;
NI HEX3Atmp_21393;
NI Res_21395;
D_17605 = 0;
D_17605 = (*Gch_17604).Decstack.D;
I_17613 = 0;
HEX3Atmp_21393 = 0;
HEX3Atmp_21393 = (NI32)((*Gch_17604).Decstack.Len - 1);
Res_21395 = 0;
Res_21395 = 0;
while (1) {
if (!(Res_21395 <= HEX3Atmp_21393)) goto LA1;
I_17613 = Res_21395;
Decref_13001(D_17605[(I_17613)-0]);
Res_21395 += 1;
} LA1: ;
(*Gch_17604).Decstack.Len = 0;
}
N_NIMCALL(void, Collectct_12205)(TY11190* Gch_12208) {
NIM_BOOL LOC2;
NIM_BOOL LOC3;
NIM_BOOL LOC5;
NI LOC7;
NI LOC11;
NIM_BOOL LOC13;
NI LOC14;
NI LOC18;
LOC3 = (256 <= (*Gch_12208).Zct.Len);
if (LOC3) goto LA4;
LOC5 = NIM_TRUE;
if (!(LOC5)) goto LA6;
LOC7 = Getoccupiedmem_2017();
LOC5 = (Cyclethreshold_11211 <= LOC7);
LA6: ;
LOC3 = LOC5;
LA4: ;
LOC2 = LOC3;
if (LOC2) goto LA8;
LOC2 = NIM_FALSE;
LA8: ;
if (!LOC2) goto LA9;
LOC11 = Stacksize_16801();
(*Gch_12208).Stat.Maxstacksize = (((*Gch_12208).Stat.Maxstacksize >= LOC11) ? (*Gch_12208).Stat.Maxstacksize : LOC11);
Markstackandregisters_16815(Gch_12208);
Markthreadstacks_16011(Gch_12208);
(*Gch_12208).Stat.Maxstackcells = (((*Gch_12208).Stat.Maxstackcells >= (*Gch_12208).Decstack.Len) ? (*Gch_12208).Stat.Maxstackcells : (*Gch_12208).Decstack.Len);
(*Gch_12208).Stat.Stackscans += 1;
Collectzct_17001(Gch_12208);
LOC14 = Getoccupiedmem_2017();
LOC13 = (Cyclethreshold_11211 <= LOC14);
if (LOC13) goto LA15;
LOC13 = NIM_FALSE;
LA15: ;
if (!LOC13) goto LA16;
Collectcycles_15203(Gch_12208);
Collectzct_17001(Gch_12208);
(*Gch_12208).Stat.Cyclecollections += 1;
LOC18 = Getoccupiedmem_2017();
Cyclethreshold_11211 = ((4194304 >= (NI32)(LOC18 * 2)) ? 4194304 : (NI32)(LOC18 * 2));
(*Gch_12208).Stat.Maxthreshold = (((*Gch_12208).Stat.Maxthreshold >= Cyclethreshold_11211) ? (*Gch_12208).Stat.Maxthreshold : Cyclethreshold_11211);
LA16: ;
Unmarkstackandregisters_17601(Gch_12208);
LA9: ;
}
static N_INLINE(void, Checkcollection_13700)(void) {
if (!(Recgclock_11212 == 0)) goto LA2;
Collectct_12205(&Gch_11210);
LA2: ;
}
static N_INLINE(void, Unlock_11401)(TY11190* Gch_11404) {
}
N_NIMCALL(void*, newObj)(TNimType* Typ_13707, NI Size_13708) {
void* Result_13709;
TY10802* Res_13724;
void* LOC1;
NI L_13802;
TY10802** D_13803;
NI I_13813;
NI HEX3Atmp_21293;
NI HEX3Atmp_21294;
NI Res_21296;
TY10802* C_13814;
Result_13709 = 0;
Lock_11213(&Gch_11210);
Checkcollection_13700();
Res_13724 = 0;
LOC1 = Rawalloc_9795(&Allocator_8929, (NI32)(Size_13708 + ((NI)sizeof(TY10802))));
Res_13724 = ((TY10802*) (LOC1));
zeroMem(((void*) (Res_13724)), (NI32)(Size_13708 + ((NI)sizeof(TY10802))));
(*Res_13724).Typ = Typ_13707;
(*Res_13724).Refcount = 4;
L_13802 = 0;
L_13802 = Gch_11210.Zct.Len;
D_13803 = 0;
D_13803 = Gch_11210.Zct.D;
I_13813 = 0;
HEX3Atmp_21293 = 0;
HEX3Atmp_21294 = 0;
HEX3Atmp_21293 = (NI32)(L_13802 - 1);
HEX3Atmp_21294 = ((0 >= (NI32)(L_13802 - 8)) ? 0 : (NI32)(L_13802 - 8));
Res_21296 = 0;
Res_21296 = HEX3Atmp_21293;
while (1) {
if (!(HEX3Atmp_21294 <= Res_21296)) goto LA3;
I_13813 = Res_21296;
C_13814 = 0;
C_13814 = D_13803[(I_13813)-0];
if (!((NU32)(8) <= (NU32)((*C_13814).Refcount))) goto LA5;
(*C_13814).Refcount = (NI32)((*C_13814).Refcount & -8);
D_13803[(I_13813)-0] = Res_13724;
goto LA2;
LA5: ;
Res_21296 -= 1;
} LA3: ;
Add_10858(&Gch_11210.Zct, Res_13724);
LA2: ;
Unlock_11401(&Gch_11210);
Result_13709 = Celltousr_11608(Res_13724);
return Result_13709;
}
static N_INLINE(NI, Atomicinc_3001)(NI* Memloc_3004, NI X_3005) {
NI Result_7607;
Result_7607 = 0;
(*Memloc_3004) += X_3005;
Result_7607 = (*Memloc_3004);
return Result_7607;
}
static N_INLINE(void, asgnRefNoCycle)(void** Dest_13218, void* Src_13219) {
TY10802* C_13220;
NI LOC4;
TY10802* C_13222;
NI LOC9;
if (!!((Src_13219 == NIM_NIL))) goto LA2;
C_13220 = 0;
C_13220 = Usrtocell_11612(Src_13219);
LOC4 = Atomicinc_3001(&(*C_13220).Refcount, 8);
LA2: ;
if (!!(((*Dest_13218) == NIM_NIL))) goto LA6;
C_13222 = 0;
C_13222 = Usrtocell_11612((*Dest_13218));
LOC9 = Atomicdec_3006(&(*C_13222).Refcount, 8);
if (!((NU32)(LOC9) < (NU32)(8))) goto LA10;
Rtladdzct_12601(C_13222);
LA10: ;
LA6: ;
(*Dest_13218) = Src_13219;
}
N_NIMCALL(NimStringDesc*, rawNewString)(NI Space_18687) {
NimStringDesc* Result_18688;
NI S_18689;
void* LOC4;
Result_18688 = 0;
S_18689 = 0;
S_18689 = Space_18687;
if (!(S_18689 < 8)) goto LA2;
S_18689 = 7;
LA2: ;
LOC4 = newObj(&Strdesc_3017, (NI32)(((NI)sizeof(TGenericSeq)) + (NI32)((NI32)(S_18689 + 1) * 1)));
Result_18688 = ((NimStringDesc*) (LOC4));
(*Result_18688).Sup.space = S_18689;
return Result_18688;
}
N_NIMCALL(NimStringDesc*, copyString)(NimStringDesc* Src_18708) {
NimStringDesc* Result_18709;
Result_18709 = 0;
if (!(Src_18708 == NIM_NIL)) goto LA2;
Result_18709 = NIM_NIL;
goto BeforeRet;
LA2: ;
Result_18709 = rawNewString((*Src_18708).Sup.space);
(*Result_18709).Sup.len = (*Src_18708).Sup.len;
memcpy(((NCSTRING) ((*Result_18709).data)), ((NCSTRING) ((*Src_18708).data)), ((int) ((NI32)((NI32)((*Src_18708).Sup.len + 1) * 1))));
BeforeRet: ;
return Result_18709;
}
N_NIMCALL(void, Gcdisable_2663)(void) {
NI LOC1;
LOC1 = Atomicinc_3001(&Recgclock_11212, 1);
}
static N_INLINE(void, Incref_13202)(TY10802* C_13204) {
NI LOC1;
NIM_BOOL LOC3;
LOC1 = Atomicinc_3001(&(*C_13204).Refcount, 8);
LOC3 = Canbecycleroot_11616(C_13204);
if (!LOC3) goto LA4;
Rtladdcycleroot_12252(C_13204);
LA4: ;
}
static N_INLINE(void, asgnRef)(void** Dest_13214, void* Src_13215) {
TY10802* LOC4;
TY10802* LOC8;
if (!!((Src_13215 == NIM_NIL))) goto LA2;
LOC4 = Usrtocell_11612(Src_13215);
Incref_13202(LOC4);
LA2: ;
if (!!(((*Dest_13214) == NIM_NIL))) goto LA6;
LOC8 = Usrtocell_11612((*Dest_13214));
Decref_13001(LOC8);
LA6: ;
(*Dest_13214) = Src_13215;
}
static N_INLINE(void, pushCurrentException)(E_Base* E_4641) {
asgnRef((void**) &(*E_4641).parent, Currexception_4632);
asgnRef((void**) &Currexception_4632, E_4641);
}
static N_INLINE(NI, Resize_18601)(NI Old_18603) {
NI Result_18604;
Result_18604 = 0;
if (!(Old_18603 <= 0)) goto LA2;
Result_18604 = 4;
goto BeforeRet;
goto LA1;
LA2: ;
if (!(Old_18603 < 65536)) goto LA4;
Result_18604 = (NI32)(Old_18603 * 2);
goto BeforeRet;
goto LA1;
LA4: ;
Result_18604 = (NI32)((NI32)(Old_18603 * 3) / 2);
goto BeforeRet;
LA1: ;
BeforeRet: ;
return Result_18604;
}
N_NIMCALL(void*, Growobj_14207)(void* Old_14209, NI Newsize_14210) {
void* Result_14211;
TY10802* Ol_14213;
TY10802* Res_14238;
void* LOC1;
NI Elemsize_14239;
NI Oldsize_14249;
NI J_14254;
TY10802** D_14255;
NIM_BOOL LOC13;
Result_14211 = 0;
Lock_11213(&Gch_11210);
Checkcollection_13700();
Ol_14213 = 0;
Ol_14213 = Usrtocell_11612(Old_14209);
Res_14238 = 0;
LOC1 = Rawalloc_9795(&Allocator_8929, (NI32)(Newsize_14210 + ((NI)sizeof(TY10802))));
Res_14238 = ((TY10802*) (LOC1));
Elemsize_14239 = 0;
Elemsize_14239 = 1;
if (!!(((*(*Ol_14213).Typ).kind == ((NU8) 28)))) goto LA3;
Elemsize_14239 = (*(*(*Ol_14213).Typ).base).size;
LA3: ;
Oldsize_14249 = 0;
Oldsize_14249 = (NI32)((NI32)((*((TGenericSeq*) (Old_14209))).len * Elemsize_14239) + 8);
memcpy(((void*) (Res_14238)), ((void*) (Ol_14213)), (NI32)(Oldsize_14249 + ((NI)sizeof(TY10802))));
zeroMem(((void*) ((NI32)((NU32)((NI32)((NU32)(((NI) (Res_14238))) + (NU32)(Oldsize_14249))) + (NU32)(((NI)sizeof(TY10802)))))), (NI32)(Newsize_14210 - Oldsize_14249));
if (!((NI32)((*Ol_14213).Refcount & 7) == 4)) goto LA6;
J_14254 = 0;
J_14254 = (NI32)(Gch_11210.Zct.Len - 1);
D_14255 = 0;
D_14255 = Gch_11210.Zct.D;
while (1) {
if (!(0 <= J_14254)) goto LA8;
if (!(D_14255[(J_14254)-0] == Ol_14213)) goto LA10;
D_14255[(J_14254)-0] = Res_14238;
goto LA8;
LA10: ;
J_14254 -= 1;
} LA8: ;
LA6: ;
LOC13 = Canbecycleroot_11616(Ol_14213);
if (!LOC13) goto LA14;
Excl_11081(&Gch_11210.Cycleroots, Ol_14213);
LA14: ;
Rawdealloc_10064(&Allocator_8929, ((void*) (Ol_14213)));
Unlock_11401(&Gch_11210);
Result_14211 = Celltousr_11608(Res_14238);
return Result_14211;
}
N_NIMCALL(NimStringDesc*, resizeString)(NimStringDesc* Dest_18782, NI Addlen_18783) {
NimStringDesc* Result_18784;
NI Sp_18789;
NI LOC4;
void* LOC5;
Result_18784 = 0;
if (!((NI32)((NI32)((*Dest_18782).Sup.len + Addlen_18783) + 1) <= (*Dest_18782).Sup.space)) goto LA2;
Result_18784 = Dest_18782;
goto LA1;
LA2: ;
Sp_18789 = 0;
LOC4 = Resize_18601((*Dest_18782).Sup.space);
Sp_18789 = ((LOC4 >= (NI32)((NI32)((*Dest_18782).Sup.len + Addlen_18783) + 1)) ? LOC4 : (NI32)((NI32)((*Dest_18782).Sup.len + Addlen_18783) + 1));
LOC5 = Growobj_14207(((void*) (Dest_18782)), (NI32)(((NI)sizeof(TGenericSeq)) + (NI32)((NI32)(Sp_18789 + 1) * 1)));
Result_18784 = ((NimStringDesc*) (LOC5));
(*Result_18784).Sup.space = Sp_18789;
LA1: ;
return Result_18784;
}
N_NIMCALL(NimStringDesc*, setLengthStr)(NimStringDesc* S_18825, NI Newlen_18826) {
NimStringDesc* Result_18827;
NI N_18830;
Result_18827 = 0;
N_18830 = 0;
N_18830 = ((Newlen_18826 >= 0) ? Newlen_18826 : 0);
if (!(N_18830 <= (*S_18825).Sup.space)) goto LA2;
Result_18827 = S_18825;
goto LA1;
LA2: ;
Result_18827 = resizeString(S_18825, N_18830);
LA1: ;
(*Result_18827).Sup.len = N_18830;
(*Result_18827).data[(N_18830)-0] = 0;
return Result_18827;
}
static N_INLINE(void, appendString)(NimStringDesc* Dest_18792, NimStringDesc* Src_18793) {
memcpy(((NCSTRING) (&(*Dest_18792).data[((*Dest_18792).Sup.len)-0])), ((NCSTRING) ((*Src_18793).data)), ((int) ((NI32)((NI32)((*Src_18793).Sup.len + 1) * 1))));
(*Dest_18792).Sup.len += (*Src_18793).Sup.len;
}
N_NIMCALL(void, Rawwritestacktrace_4999)(NimStringDesc** S_5002) {
(*S_5002) = resizeString((*S_5002), 28);
appendString((*S_5002), ((NimStringDesc*) &TMP21509));
(*S_5002) = resizeString((*S_5002), Stacktracenewline_4432->Sup.len + 0);
appendString((*S_5002), Stacktracenewline_4432);
}
N_NIMCALL(NimStringDesc*, toNimStr)(NCSTRING Str_18699, NI Len_18700) {
NimStringDesc* Result_18701;
Result_18701 = 0;
Result_18701 = rawNewString(Len_18700);
(*Result_18701).Sup.len = Len_18700;
memcpy(((NCSTRING) ((*Result_18701).data)), Str_18699, ((int) ((NI32)((NI32)(Len_18700 + 1) * 1))));
(*Result_18701).data[(Len_18700)-0] = 0;
return Result_18701;
}
N_NIMCALL(NimStringDesc*, cstrToNimstr)(NCSTRING Str_18704) {
NimStringDesc* Result_18705;
NI LOC1;
Result_18705 = 0;
LOC1 = strlen(Str_18704);
Result_18705 = toNimStr(Str_18704, LOC1);
goto BeforeRet;
BeforeRet: ;
return Result_18705;
}
N_NIMCALL(void, Write_3670)(FILE* F_3672, NCSTRING C_3673) {
fputs(C_3673, F_3672);
}
N_NIMCALL(void, Writetostderr_4433)(NCSTRING Msg_4435) {
Write_3670(stdout, Msg_4435);
}
static N_INLINE(void, Quitordebug_5201)(void) {
exit(1);
}
N_NIMCALL(void, Gcenable_2665)(void) {
NI LOC4;
if (!(0 < Recgclock_11212)) goto LA2;
LOC4 = Atomicdec_3006(&Recgclock_11212, 1);
LA2: ;
}
N_NIMCALL(void, raiseException)(E_Base* E_5404, NCSTRING Ename_5405) {
NIM_BOOL LOC8;
NimStringDesc* LOC12;
Gcdisable_2663();
(*E_5404).name = Ename_5405;
if (!!((excHandler == NIM_NIL))) goto LA2;
pushCurrentException(E_5404);
longjmp((*excHandler).context, ((NI32) 1));
goto LA1;
LA2: ;
if (!!(Buf_4810 == 0)) goto LA5;
Buf_4810 = setLengthStr(Buf_4810, 0);
Rawwritestacktrace_4999(&Buf_4810);
LOC8 = !(((*E_5404).message == NIM_NIL));
if (!(LOC8)) goto LA9;
LOC8 = !(((NU8)((*E_5404).message->data[0]) == (NU8)(0)));
LA9: ;
if (!LOC8) goto LA10;
Buf_4810 = resizeString(Buf_4810, 28);
appendString(Buf_4810, ((NimStringDesc*) &TMP21510));
Buf_4810 = resizeString(Buf_4810, (*E_5404).message->Sup.len + 0);
appendString(Buf_4810, (*E_5404).message);
goto LA7;
LA10: ;
Buf_4810 = resizeString(Buf_4810, 26);
appendString(Buf_4810, ((NimStringDesc*) &TMP21511));
LA7: ;
Buf_4810 = resizeString(Buf_4810, 2);
appendString(Buf_4810, ((NimStringDesc*) &TMP21512));
LOC12 = 0;
LOC12 = cstrToNimstr(Ename_5405);
Buf_4810 = resizeString(Buf_4810, LOC12->Sup.len + 0);
appendString(Buf_4810, LOC12);
Buf_4810 = resizeString(Buf_4810, 2);
appendString(Buf_4810, ((NimStringDesc*) &TMP21513));
Writetostderr_4433(Buf_4810->data);
goto LA4;
LA5: ;
Writetostderr_4433(Ename_5405);
LA4: ;
Quitordebug_5201();
LA1: ;
Gcenable_2665();
}
N_NIMCALL(void, Write_3658)(FILE* F_3660, NimStringDesc* S_3661) {
NI LOC2;
TY420* E_4263;
LOC2 = Writebuffer_3733(F_3660, ((void*) (S_3661->data)), S_3661->Sup.len);
if (!!((LOC2 == S_3661->Sup.len))) goto LA3;
E_4263 = 0;
E_4263 = (TY420*) newObj(NTI4262, sizeof(TY420));
(*E_4263).Sup.Sup.Sup.Sup.m_type = NTI420;
asgnRefNoCycle((void**) &(*E_4263).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP21508)));
raiseException((E_Base*)E_4263, "EIO");
LA3: ;
}
static N_INLINE(void, rawEcho)(NimStringDesc* X_4094) {
Write_3658(stdout, X_4094);
}
static N_INLINE(void, rawEchoNL)(void) {
Write_3658(stdout, ((NimStringDesc*) &TMP21514));
}
N_NIMCALL(void, Quit_2822)(NimStringDesc* Errormsg_2824) {
rawEcho(Errormsg_2824);
rawEchoNL();
exit(1);
}
N_NIMCALL(void, Raiseoutofmem_8259)(void) {
if (!(Goutofmem_8258 == NIM_NIL)) goto LA2;
Quit_2822(((NimStringDesc*) &TMP21515));
LA2: ;
asgnRefNoCycle((void**) &(*Goutofmem_8258).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP21516)));
raiseException((E_Base*)Goutofmem_8258, "EOutOfMemory");
}
static N_INLINE(void*, Osallocpages_8413)(NI Size_8415) {
void* Result_8416;
NIM_BOOL LOC2;
Result_8416 = 0;
Result_8416 = mmap(NIM_NIL, Size_8415, ((NI32) 3), ((NI32) 34), ((NI32) -1), 0);
LOC2 = (Result_8416 == NIM_NIL);
if (LOC2) goto LA3;
LOC2 = (Result_8416 == ((void*) -1));
LA3: ;
if (!LOC2) goto LA4;
Raiseoutofmem_8259();
LA4: ;
return Result_8416;
}
static N_INLINE(void, Inccurrmem_8886)(TY8874* A_8889, NI Bytes_8890) {
(*A_8889).Currmem += Bytes_8890;
}
N_NIMCALL(void*, Llalloc_8930)(TY8874* A_8933, NI Size_8934) {
void* Result_8935;
NIM_BOOL LOC2;
NI Request_8949;
void* LOC6;
Result_8935 = 0;
LOC2 = ((*A_8933).Llmem == NIM_NIL);
if (LOC2) goto LA3;
LOC2 = ((*(*A_8933).Llmem).Size < Size_8934);
LA3: ;
if (!LOC2) goto LA4;
Request_8949 = 0;
Request_8949 = Roundup_8856((NI32)(Size_8934 + ((NI)sizeof(TY8872))), 4096);
LOC6 = Osallocpages_8413(Request_8949);
(*A_8933).Llmem = ((TY8872*) (LOC6));
Inccurrmem_8886(A_8933, Request_8949);
(*(*A_8933).Llmem).Size = (NI32)(Request_8949 - ((NI)sizeof(TY8872)));
(*(*A_8933).Llmem).Acc = ((NI)sizeof(TY8872));
LA4: ;
Result_8935 = ((void*) ((NI32)(((NI) ((*A_8933).Llmem)) + (*(*A_8933).Llmem).Acc)));
(*(*A_8933).Llmem).Size -= Size_8934;
(*(*A_8933).Llmem).Acc += Size_8934;
zeroMem(Result_8935, Size_8934);
return Result_8935;
}
N_NIMCALL(TY8807*, Intsetput_8993)(TY8811* T_8996, NI Key_8997) {
TY8807* Result_8998;
void* LOC4;
Result_8998 = 0;
Result_8998 = Intsetget_8974(&(*T_8996), Key_8997);
if (!(Result_8998 == NIM_NIL)) goto LA2;
LOC4 = Llalloc_8930(&Allocator_8929, ((NI)sizeof(TY8807)));
Result_8998 = ((TY8807*) (LOC4));
(*Result_8998).Next = (*T_8996).Data[((NI32)(Key_8997 & 1023))-0];
(*T_8996).Data[((NI32)(Key_8997 & 1023))-0] = Result_8998;
(*Result_8998).Key = Key_8997;
LA2: ;
return Result_8998;
}
N_NIMCALL(void, Incl_9031)(TY8811* S_9034, NI Key_9035) {
TY8807* T_9036;
NI U_9037;
T_9036 = 0;
T_9036 = Intsetput_8993(S_9034, (NI32)((NU32)(Key_9035) >> (NU32)(9)));
U_9037 = 0;
U_9037 = (NI32)(Key_9035 & 511);
(*T_9036).Bits[((NI32)((NU32)(U_9037) >> (NU32)(5)))-0] = (NI32)((*T_9036).Bits[((NI32)((NU32)(U_9037) >> (NU32)(5)))-0] | (NI32)((NU32)(1) << (NU32)((NI32)(U_9037 & 31))));
}
N_NIMCALL(void, Splitchunk_9666)(TY8874* A_9669, TY8834* C_9670, NI Size_9671) {
TY8834* Rest_9672;
NI LOC1;
Rest_9672 = 0;
Rest_9672 = ((TY8834*) ((NI32)((NU32)(((NI) (C_9670))) + (NU32)(Size_9671))));
(*Rest_9672).Sup.Size = (NI32)((*C_9670).Sup.Size - Size_9671);
(*Rest_9672).Sup.Used = NIM_FALSE;
(*Rest_9672).Next = NIM_NIL;
(*Rest_9672).Prev = NIM_NIL;
(*Rest_9672).Sup.Prevsize = Size_9671;
Updateprevsize_9211(A_9669, C_9670, (*Rest_9672).Sup.Size);
(*C_9670).Sup.Size = Size_9671;
LOC1 = Pageindex_9077(&Rest_9672->Sup);
Incl_9031(&(*A_9669).Chunkstarts, LOC1);
Listadd_9607(&(*A_9669).Freechunkslist, Rest_9672);
}
N_NIMCALL(TY8834*, Requestoschunks_9092)(TY8874* A_9095, NI Size_9096) {
TY8834* Result_9097;
void* LOC1;
NI Nxt_9112;
TY8830* Next_9115;
NI LOC3;
NIM_BOOL LOC4;
NI Prv_9118;
TY8830* Prev_9121;
NIM_BOOL LOC8;
NI LOC9;
Result_9097 = 0;
Inccurrmem_8886(A_9095, Size_9096);
(*A_9095).Freemem += Size_9096;
LOC1 = Osallocpages_8413(Size_9096);
Result_9097 = ((TY8834*) (LOC1));
(*Result_9097).Next = NIM_NIL;
(*Result_9097).Prev = NIM_NIL;
(*Result_9097).Sup.Used = NIM_FALSE;
(*Result_9097).Sup.Size = Size_9096;
Nxt_9112 = 0;
Nxt_9112 = (NI32)((NU32)(((NI) (Result_9097))) + (NU32)(Size_9096));
Next_9115 = 0;
Next_9115 = ((TY8830*) (Nxt_9112));
LOC3 = Pageindex_9077(Next_9115);
LOC4 = Contains_9011(&(*A_9095).Chunkstarts, LOC3);
if (!LOC4) goto LA5;
(*Next_9115).Prevsize = Size_9096;
LA5: ;
Prv_9118 = 0;
Prv_9118 = (NI32)((NU32)(((NI) (Result_9097))) - (NU32)(Lastsize_9091));
Prev_9121 = 0;
Prev_9121 = ((TY8830*) (Prv_9118));
LOC9 = Pageindex_9077(Prev_9121);
LOC8 = Contains_9011(&(*A_9095).Chunkstarts, LOC9);
if (!(LOC8)) goto LA10;
LOC8 = ((*Prev_9121).Size == Lastsize_9091);
LA10: ;
if (!LOC8) goto LA11;
(*Result_9097).Sup.Prevsize = Lastsize_9091;
goto LA7;
LA11: ;
(*Result_9097).Sup.Prevsize = 0;
LA7: ;
Lastsize_9091 = Size_9096;
return Result_9097;
}
N_NIMCALL(TY8834*, Getbigchunk_9692)(TY8874* A_9695, NI Size_9696) {
TY8834* Result_9697;
NI LOC11;
Result_9697 = 0;
Result_9697 = (*A_9695).Freechunkslist;
while (1) {
if (!!((Result_9697 == NIM_NIL))) goto LA2;
if (!((*Result_9697).Sup.Size == Size_9696)) goto LA4;
Listremove_9246(&(*A_9695).Freechunkslist, Result_9697);
goto LA1;
goto LA3;
LA4: ;
if (!(Size_9696 < (*Result_9697).Sup.Size)) goto LA6;
Listremove_9246(&(*A_9695).Freechunkslist, Result_9697);
Splitchunk_9666(A_9695, Result_9697, Size_9696);
goto LA1;
goto LA3;
LA6: ;
LA3: ;
Result_9697 = (*Result_9697).Next;
} LA2: ;
if (!(Size_9696 < 524288)) goto LA9;
Result_9697 = Requestoschunks_9092(A_9695, 524288);
Splitchunk_9666(A_9695, Result_9697, Size_9696);
goto LA8;
LA9: ;
Result_9697 = Requestoschunks_9092(A_9695, Size_9696);
LA8: ;
LA1: ;
(*Result_9697).Sup.Prevsize = 0;
(*Result_9697).Sup.Used = NIM_TRUE;
LOC11 = Pageindex_9077(&Result_9697->Sup);
Incl_9031(&(*A_9695).Chunkstarts, LOC11);
(*A_9695).Freemem -= Size_9696;
return Result_9697;
}
N_NIMCALL(TY8832*, Getsmallchunk_9762)(TY8874* A_9765) {
TY8832* Result_9766;
TY8834* Res_9767;
Result_9766 = 0;
Res_9767 = 0;
Res_9767 = Getbigchunk_9692(A_9765, 4096);
Result_9766 = ((TY8832*) (Res_9767));
return Result_9766;
}
N_NIMCALL(void*, Rawalloc_9795)(TY8874* A_9798, NI Requestedsize_9799) {
void* Result_9800;
NI Size_9805;
NI S_9808;
TY8832* C_9809;
TY8834* C_10036;
Result_9800 = 0;
Size_9805 = 0;
Size_9805 = Roundup_8856(Requestedsize_9799, 8);
if (!(Size_9805 <= (NI32)(4096 - (NI32)(((NI)sizeof(TY8832)) - 8)))) goto LA2;
S_9808 = 0;
S_9808 = (NI32)(Size_9805 / 8);
C_9809 = 0;
C_9809 = (*A_9798).Freesmallchunks[(S_9808)-0];
if (!(C_9809 == NIM_NIL)) goto LA5;
C_9809 = Getsmallchunk_9762(A_9798);
(*C_9809).Freelist = NIM_NIL;
(*C_9809).Sup.Size = Size_9805;
(*C_9809).Acc = Size_9805;
(*C_9809).Free = (NI32)((NI32)(4096 - (NI32)(((NI)sizeof(TY8832)) - 8)) - Size_9805);
(*C_9809).Next = NIM_NIL;
(*C_9809).Prev = NIM_NIL;
Listadd_9826(&(*A_9798).Freesmallchunks[(S_9808)-0], C_9809);
Result_9800 = ((void*) (&(*C_9809).Data));
goto LA4;
LA5: ;
if (!((*C_9809).Freelist == NIM_NIL)) goto LA8;
Result_9800 = ((void*) ((NI32)((NU32)(((NI) (&(*C_9809).Data))) + (NU32)((*C_9809).Acc))));
(*C_9809).Acc += Size_9805;
goto LA7;
LA8: ;
Result_9800 = ((void*) ((*C_9809).Freelist));
(*C_9809).Freelist = (*(*C_9809).Freelist).Next;
LA7: ;
(*C_9809).Free -= Size_9805;
LA4: ;
if (!((*C_9809).Free < Size_9805)) goto LA11;
Listremove_9968(&(*A_9798).Freesmallchunks[(S_9808)-0], C_9809);
LA11: ;
goto LA1;
LA2: ;
Size_9805 = Roundup_8856((NI32)(Requestedsize_9799 + (NI32)(((NI)sizeof(TY8834)) - 8)), 4096);
C_10036 = 0;
C_10036 = Getbigchunk_9692(A_9798, Size_9805);
Result_9800 = ((void*) (&(*C_10036).Data));
LA1: ;
return Result_9800;
}
N_NOCONV(void*, Alloc_1950)(NI Size_1952) {
void* Result_10418;
Result_10418 = 0;
Result_10418 = Rawalloc_9795(&Allocator_8929, (NI32)(Size_1952 + ((NI)sizeof(TY8822))));
(*((TY8822*) (Result_10418))).Zerofield = 1;
Result_10418 = ((void*) ((NI32)((NU32)(((NI) (Result_10418))) + (NU32)(((NI)sizeof(TY8822))))));
return Result_10418;
}
N_NOCONV(void*, Alloc0_1953)(NI Size_1955) {
void* Result_10424;
Result_10424 = 0;
Result_10424 = Alloc_1950(Size_1955);
zeroMem(Result_10424, Size_1955);
return Result_10424;
}
N_NIMCALL(void, Init_10878)(TY10818* S_10881, NI Cap_10882) {
void* LOC1;
(*S_10881).Len = 0;
(*S_10881).Cap = Cap_10882;
LOC1 = Alloc0_1953((NI32)(Cap_10882 * 4));
(*S_10881).D = ((TY10802**) (LOC1));
}
N_NIMCALL(void, Initgc_3011)(void) {
Gch_11210.Stat.Stackscans = 0;
Gch_11210.Stat.Cyclecollections = 0;
Gch_11210.Stat.Maxthreshold = 0;
Gch_11210.Stat.Maxstacksize = 0;
Gch_11210.Stat.Maxstackcells = 0;
Gch_11210.Stat.Cycletablesize = 0;
Init_10878(&Gch_11210.Zct, 1024);
Init_10878(&Gch_11210.Tempstack, 1024);
Init_10888(&Gch_11210.Cycleroots);
Init_10878(&Gch_11210.Decstack, 1024);
pthread_mutex_init(&Gch_11210.Cyclerootslock, NIM_NIL);
pthread_mutex_init(&Gch_11210.Zctlock, NIM_NIL);
asgnRefNoCycle((void**) &Goutofmem_8258, (TY442*) newObj(NTI8262, sizeof(TY442)));
(*Goutofmem_8258).Sup.Sup.Sup.Sup.m_type = NTI442;
}
N_NOCONV(void, signalHandler)(int Sig_5478) {
int S_5479;
S_5479 = 0;
S_5479 = Sig_5478;
Gcdisable_2663();
Buf_4810 = setLengthStr(Buf_4810, 0);
Rawwritestacktrace_4999(&Buf_4810);
if (!(S_5479 == SIGINT)) goto LA2;
Buf_4810 = resizeString(Buf_4810, 31);
appendString(Buf_4810, ((NimStringDesc*) &TMP21522));
goto LA1;
LA2: ;
if (!(S_5479 == SIGSEGV)) goto LA4;
Buf_4810 = resizeString(Buf_4810, 61);
appendString(Buf_4810, ((NimStringDesc*) &TMP21523));
goto LA1;
LA4: ;
if (!(S_5479 == SIGABRT)) goto LA6;
if (!Dbgaborting_5475) goto LA9;
goto BeforeRet;
LA9: ;
Buf_4810 = resizeString(Buf_4810, 31);
appendString(Buf_4810, ((NimStringDesc*) &TMP21524));
goto LA1;
LA6: ;
if (!(S_5479 == SIGFPE)) goto LA11;
Buf_4810 = resizeString(Buf_4810, 26);
appendString(Buf_4810, ((NimStringDesc*) &TMP21525));
goto LA1;
LA11: ;
if (!(S_5479 == SIGILL)) goto LA13;
Buf_4810 = resizeString(Buf_4810, 27);
appendString(Buf_4810, ((NimStringDesc*) &TMP21526));
goto LA1;
LA13: ;
if (!(S_5479 == SIGSEGV)) goto LA15;
Buf_4810 = resizeString(Buf_4810, 60);
appendString(Buf_4810, ((NimStringDesc*) &TMP21527));
goto LA1;
LA15: ;
Buf_4810 = resizeString(Buf_4810, 15);
appendString(Buf_4810, ((NimStringDesc*) &TMP21528));
LA1: ;
Writetostderr_4433(Buf_4810->data);
Dbgaborting_5475 = NIM_TRUE;
Gcenable_2665();
exit(1);
BeforeRet: ;
}
N_NIMCALL(void, registerSignalHandler)(void) {
signal(SIGINT, signalHandler);
signal(SIGSEGV, signalHandler);
signal(SIGABRT, signalHandler);
signal(SIGFPE, signalHandler);
signal(SIGILL, signalHandler);
signal(SIGSEGV, signalHandler);
}
N_NIMCALL(NI, getRefcount)(void* P_11637) {
NI Result_11638;
TY10802* LOC1;
Result_11638 = 0;
LOC1 = Usrtocell_11612(P_11637);
Result_11638 = (NI32)((NU32)(((NI) ((*LOC1).Refcount))) >> (NU32)(3));
return Result_11638;
}
N_NIMCALL(NimStringDesc*, mnewString)(NI Len_18695) {
NimStringDesc* Result_18696;
Result_18696 = 0;
Result_18696 = rawNewString(Len_18695);
(*Result_18696).Sup.len = Len_18695;
return Result_18696;
}
N_NIMCALL(NimStringDesc*, copyStrLast)(NimStringDesc* S_18743, NI Start_18744, NI Last_18745) {
NimStringDesc* Result_18746;
NI Start_18749;
NI Len_18752;
Result_18746 = 0;
Start_18749 = 0;
Start_18749 = ((Start_18744 >= 0) ? Start_18744 : 0);
Len_18752 = 0;
Len_18752 = (NI32)((NI32)(((Last_18745 <= (NI32)((*S_18743).Sup.len - 1)) ? Last_18745 : (NI32)((*S_18743).Sup.len - 1)) - Start_18749) + 1);
if (!(0 < Len_18752)) goto LA2;
Result_18746 = rawNewString(Len_18752);
(*Result_18746).Sup.len = Len_18752;
memcpy(((NCSTRING) ((*Result_18746).data)), ((NCSTRING) (&(*S_18743).data[(Start_18749)-0])), ((int) ((NI32)(Len_18752 * 1))));
(*Result_18746).data[(Len_18752)-0] = 0;
goto LA1;
LA2: ;
Result_18746 = mnewString(0);
LA1: ;
return Result_18746;
}
N_NIMCALL(NimStringDesc*, copyStr)(NimStringDesc* S_18758, NI Start_18759) {
NimStringDesc* Result_18760;
Result_18760 = 0;
Result_18760 = copyStrLast(S_18758, Start_18759, (NI32)((*S_18758).Sup.len - 1));
goto BeforeRet;
BeforeRet: ;
return Result_18760;
}
N_NOINLINE(void, raiseOverflow)(void) {
EOverflow* E_5892;
E_5892 = 0;
E_5892 = (EOverflow*) newObj(NTI5891, sizeof(EOverflow));
(*E_5892).Sup.Sup.Sup.Sup.m_type = NTI432;
asgnRefNoCycle((void**) &(*E_5892).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP39440)));
raiseException((E_Base*)E_5892, "EOverflow");
}
static N_INLINE(NI, addInt)(NI A_6003, NI B_6004) {
NI Result_6005;
NIM_BOOL LOC2;
Result_6005 = 0;
Result_6005 = (NI32)((NU32)(A_6003) + (NU32)(B_6004));
LOC2 = (0 <= (NI32)(Result_6005 ^ A_6003));
if (LOC2) goto LA3;
LOC2 = (0 <= (NI32)(Result_6005 ^ B_6004));
LA3: ;
if (!LOC2) goto LA4;
goto BeforeRet;
LA4: ;
raiseOverflow();
BeforeRet: ;
return Result_6005;
}
N_NIMCALL(NI, mulInt)(NI A_7003, NI B_7004) {
NI Result_7005;
NF Resasfloat_7006;
NF Floatprod_7007;
Result_7005 = 0;
Resasfloat_7006 = 0;
Floatprod_7007 = 0;
Result_7005 = (NI32)((NU32)(A_7003) * (NU32)(B_7004));
Floatprod_7007 = (((double) (A_7003)) * ((double) (B_7004)));
Resasfloat_7006 = ((double) (Result_7005));
if (!(Resasfloat_7006 == Floatprod_7007)) goto LA2;
goto BeforeRet;
LA2: ;
if (!((32.0000 * ((Resasfloat_7006 - Floatprod_7007) > 0? ((Resasfloat_7006 - Floatprod_7007)) : -((Resasfloat_7006 - Floatprod_7007)))) <= (Floatprod_7007 > 0? (Floatprod_7007) : -(Floatprod_7007)))) goto LA5;
goto BeforeRet;
LA5: ;
raiseOverflow();
BeforeRet: ;
return Result_7005;
}
N_NIMCALL(void*, newSeq)(TNimType* Typ_14204, NI Len_14205) {
void* Result_14206;
NI LOC1;
NI LOC2;
Result_14206 = 0;
LOC1 = mulInt(Len_14205, (*(*Typ_14204).base).size);
LOC2 = addInt(LOC1, 8);
Result_14206 = newObj(Typ_14204, LOC2);
(*((TGenericSeq*) (Result_14206))).len = Len_14205;
(*((TGenericSeq*) (Result_14206))).space = Len_14205;
return Result_14206;
}
N_NIMCALL(NI, Cmp_1321)(NimStringDesc* X_1323, NimStringDesc* Y_1324) {
NI Result_3319;
int LOC1;
Result_3319 = 0;
LOC1 = strcmp(X_1323->data, Y_1324->data);
Result_3319 = ((NI) (LOC1));
goto BeforeRet;
BeforeRet: ;
return Result_3319;
}
N_NOINLINE(NIM_BOOL, Isonstack_12209)(void* P_12211) {
NIM_BOOL Result_16809;
void* volatile Stacktop_16810;
NI B_16811;
NI A_16813;
NI X_16814;
NIM_BOOL LOC1;
Result_16809 = 0;
Stacktop_16810 = 0;
B_16811 = 0;
B_16811 = ((NI) (Stackbottom_11209));
A_16813 = 0;
A_16813 = ((NI) (&Stacktop_16810));
X_16814 = 0;
X_16814 = ((NI) (P_12211));
LOC1 = ((NU32)(A_16813) <= (NU32)(X_16814));
if (!(LOC1)) goto LA2;
LOC1 = ((NU32)(X_16814) <= (NU32)(B_16811));
LA2: ;
Result_16809 = LOC1;
return Result_16809;
}
N_NIMCALL(void, unsureAsgnRef)(void** Dest_13226, void* Src_13227) {
NIM_BOOL LOC2;
TY10802* LOC8;
TY10802* LOC12;
LOC2 = Isonstack_12209(((void*) (Dest_13226)));
if (!!(LOC2)) goto LA3;
if (!!((Src_13227 == NIM_NIL))) goto LA6;
LOC8 = Usrtocell_11612(Src_13227);
Incref_13202(LOC8);
LA6: ;
if (!!(((*Dest_13226) == NIM_NIL))) goto LA10;
LOC12 = Usrtocell_11612((*Dest_13226));
Decref_13001(LOC12);
LA10: ;
LA3: ;
(*Dest_13226) = Src_13227;
}
N_NIMCALL(TNimType*, extGetCellType)(void* C_11633) {
TNimType* Result_11634;
TY10802* LOC1;
Result_11634 = 0;
LOC1 = Usrtocell_11612(C_11633);
Result_11634 = (*LOC1).Typ;
return Result_11634;
}
N_NIMCALL(TGenericSeq*, setLengthSeq)(TGenericSeq* Seq_19003, NI Elemsize_19004, NI Newlen_19005) {
TGenericSeq* Result_19006;
NI LOC4;
void* LOC5;
NI I_19020;
NI HEX3Atmp_21405;
NI Res_21407;
TNimType* LOC9;
Result_19006 = 0;
Result_19006 = Seq_19003;
if (!((*Result_19006).space < Newlen_19005)) goto LA2;
LOC4 = Resize_18601((*Result_19006).space);
(*Result_19006).space = ((LOC4 >= Newlen_19005) ? LOC4 : Newlen_19005);
LOC5 = Growobj_14207(((void*) (Result_19006)), (NI32)((NI32)(Elemsize_19004 * (*Result_19006).space) + 8));
Result_19006 = ((TGenericSeq*) (LOC5));
goto LA1;
LA2: ;
if (!(Newlen_19005 < (*Result_19006).len)) goto LA6;
I_19020 = 0;
HEX3Atmp_21405 = 0;
HEX3Atmp_21405 = (NI32)((*Result_19006).len - 1);
Res_21407 = 0;
Res_21407 = Newlen_19005;
while (1) {
if (!(Res_21407 <= HEX3Atmp_21405)) goto LA8;
I_19020 = Res_21407;
LOC9 = extGetCellType(((void*) (Result_19006)));
Forallchildrenaux_12220(((void*) ((NI32)((NU32)((NI32)((NU32)(((NI) (Result_19006))) + (NU32)(8))) + (NU32)((NI32)((NU32)(I_19020) * (NU32)(Elemsize_19004)))))), (*LOC9).base, ((NU8) 0));
Res_21407 += 1;
} LA8: ;
zeroMem(((void*) ((NI32)((NU32)((NI32)((NU32)(((NI) (Result_19006))) + (NU32)(8))) + (NU32)((NI32)((NU32)(Newlen_19005) * (NU32)(Elemsize_19004)))))), (NI32)((NU32)((NI32)((NU32)((*Result_19006).len) - (NU32)(Newlen_19005))) * (NU32)(Elemsize_19004)));
goto LA1;
LA6: ;
LA1: ;
(*Result_19006).len = Newlen_19005;
return Result_19006;
}
N_NIMCALL(void, Objectinitaux_19664)(void* Dest_19666, TNimNode* N_19668) {
NI D_19669;
NI I_19677;
NI HEX3Atmp_21450;
NI Res_21452;
TNimNode* M_19678;
D_19669 = 0;
D_19669 = ((NI) (Dest_19666));
switch ((*N_19668).kind) {
case ((NU8) 0):
break;
case ((NU8) 1):
objectInit(((void*) ((NI32)((NU32)(D_19669) + (NU32)((*N_19668).offset)))), (*N_19668).typ);
break;
case ((NU8) 2):
I_19677 = 0;
HEX3Atmp_21450 = 0;
HEX3Atmp_21450 = (NI32)((*N_19668).len - 1);
Res_21452 = 0;
Res_21452 = 0;
while (1) {
if (!(Res_21452 <= HEX3Atmp_21450)) goto LA1;
I_19677 = Res_21452;
Objectinitaux_19664(Dest_19666, (*N_19668).sons[(I_19677)-0]);
Res_21452 += 1;
} LA1: ;
break;
case ((NU8) 3):
M_19678 = 0;
M_19678 = Selectbranch_7463(Dest_19666, N_19668);
if (!!((M_19678 == NIM_NIL))) goto LA3;
Objectinitaux_19664(Dest_19666, M_19678);
LA3: ;
break;
}
}
N_NIMCALL(void, objectInit)(void* Dest_19662, TNimType* Typ_19663) {
NI D_19694;
TNimType** Pint_19696;
NI I_19704;
NI HEX3Atmp_21456;
NI Res_21458;
D_19694 = 0;
D_19694 = ((NI) (Dest_19662));
switch ((*Typ_19663).kind) {
case ((NU8) 17):
Pint_19696 = 0;
Pint_19696 = ((TNimType**) (Dest_19662));
(*Pint_19696) = Typ_19663;
Objectinitaux_19664(Dest_19662, (*Typ_19663).node);
break;
case ((NU8) 18):
case ((NU8) 40):
Objectinitaux_19664(Dest_19662, (*Typ_19663).node);
break;
case ((NU8) 16):
case ((NU8) 4):
I_19704 = 0;
HEX3Atmp_21456 = 0;
HEX3Atmp_21456 = (NI32)((NI32)((*Typ_19663).size / (*(*Typ_19663).base).size) - 1);
Res_21458 = 0;
Res_21458 = 0;
while (1) {
if (!(Res_21458 <= HEX3Atmp_21456)) goto LA1;
I_19704 = Res_21458;
objectInit(((void*) ((NI32)((NU32)(D_19694) + (NU32)((NI32)(I_19704 * (*(*Typ_19663).base).size))))), (*Typ_19663).base);
Res_21458 += 1;
} LA1: ;
break;
default:
break;
}
}
N_NIMCALL(NimStringDesc*, addChar)(NimStringDesc* S_1603, NIM_CHAR C_1604) {
NimStringDesc* Result_18765;
void* LOC4;
Result_18765 = 0;
Result_18765 = S_1603;
if (!((*Result_18765).Sup.space <= (*Result_18765).Sup.len)) goto LA2;
(*Result_18765).Sup.space = Resize_18601((*Result_18765).Sup.space);
LOC4 = Growobj_14207(((void*) (Result_18765)), (NI32)(((NI)sizeof(TGenericSeq)) + (NI32)((NI32)((*Result_18765).Sup.space + 1) * 1)));
Result_18765 = ((NimStringDesc*) (LOC4));
LA2: ;
(*Result_18765).data[((*Result_18765).Sup.len)-0] = C_1604;
(*Result_18765).data[((NI32)((*Result_18765).Sup.len + 1))-0] = 0;
(*Result_18765).Sup.len += 1;
return Result_18765;
}
N_NIMCALL(NimStringDesc*, nimIntToStr)(NI X_19403) {
NimStringDesc* Result_19404;
NI I_19405;
NI Y_19406;
NI D_19407;
NI J_19448;
NI HEX3Atmp_21412;
NI Res_21414;
NIM_CHAR LOC9;
Result_19404 = 0;
Result_19404 = mnewString(16);
I_19405 = 0;
I_19405 = 0;
Y_19406 = 0;
Y_19406 = X_19403;
while (1) {
D_19407 = 0;
D_19407 = (NI32)(Y_19406 / 10);
Result_19404->data[I_19405] = ((NIM_CHAR) (((NI) ((NI32)((NI32)abs(((NI) ((NI32)(Y_19406 - (NI32)(D_19407 * 10))))) + 48)))));
I_19405 += 1;
Y_19406 = D_19407;
if (!(Y_19406 == 0)) goto LA3;
goto LA1;
LA3: ;
} LA1: ;
if (!(X_19403 < 0)) goto LA6;
Result_19404->data[I_19405] = 45;
I_19405 += 1;
LA6: ;
Result_19404 = setLengthStr(Result_19404, I_19405);
J_19448 = 0;
HEX3Atmp_21412 = 0;
HEX3Atmp_21412 = (NI32)((NI32)(I_19405 / 2) - 1);
Res_21414 = 0;
Res_21414 = 0;
while (1) {
if (!(Res_21414 <= HEX3Atmp_21412)) goto LA8;
J_19448 = Res_21414;
LOC9 = Result_19404->data[J_19448];
Result_19404->data[J_19448] = Result_19404->data[(NI32)((NI32)(I_19405 - J_19448) - 1)];
Result_19404->data[(NI32)((NI32)(I_19405 - J_19448) - 1)] = LOC9;
Res_21414 += 1;
} LA8: ;
return Result_19404;
}
N_NIMCALL(NIM_BOOL, Open_3617)(FILE** F_3620, NimStringDesc* Filename_3621, NU8 Mode_3622, NI Bufsize_3623) {
NIM_BOOL Result_4112;
void* P_4113;
int LOC5;
TY442* E_4119;
int LOC11;
Result_4112 = 0;
P_4113 = 0;
P_4113 = fopen(Filename_3621->data, Formatopen_4101[(Mode_3622)-0]->data);
Result_4112 = !((P_4113 == NIM_NIL));
(*F_3620) = ((FILE*) (P_4113));
if (!(0 < Bufsize_3623)) goto LA2;
LOC5 = setvbuf((*F_3620), NIM_NIL, _IOFBF, ((int) (Bufsize_3623)));
if (!!((LOC5 == ((NI32) 0)))) goto LA6;
E_4119 = 0;
E_4119 = (TY442*) newObj(NTI8262, sizeof(TY442));
(*E_4119).Sup.Sup.Sup.Sup.m_type = NTI442;
asgnRefNoCycle((void**) &(*E_4119).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP21516)));
raiseException((E_Base*)E_4119, "EOutOfMemory");
LA6: ;
goto LA1;
LA2: ;
if (!(Bufsize_3623 == 0)) goto LA9;
LOC11 = setvbuf((*F_3620), NIM_NIL, _IONBF, ((NI32) 0));
goto LA1;
LA9: ;
LA1: ;
return Result_4112;
}
N_NIMCALL(NI, Readbuffer_3714)(FILE* F_3716, void* Buffer_3717, NI Len_3718) {
NI Result_4199;
Result_4199 = 0;
Result_4199 = fread(Buffer_3717, 1, Len_3718, F_3716);
return Result_4199;
}
N_NIMCALL(void, Rawreadline_3789)(FILE* F_3791, NimStringDesc** Result_3793) {
int C_3794;
(*Result_3793) = setLengthStr((*Result_3793), 0);
while (1) {
C_3794 = 0;
C_3794 = fgetc(F_3791);
if (!(C_3794 < ((NI32) 0))) goto LA3;
goto LA1;
LA3: ;
if (!(C_3794 == ((NI32) 10))) goto LA6;
goto LA1;
LA6: ;
if (!(C_3794 == ((NI32) 13))) goto LA9;
C_3794 = fgetc(F_3791);
if (!!((C_3794 == ((NI32) 10)))) goto LA12;
ungetc(C_3794, F_3791);
LA12: ;
goto LA1;
LA9: ;
(*Result_3793) = addChar((*Result_3793), ((NIM_CHAR) (((NI) (((NI) (C_3794)))))));
} LA1: ;
}
N_NIMCALL(NimStringDesc*, Readline_3679)(FILE* F_3681) {
NimStringDesc* Result_3806;
Result_3806 = 0;
Result_3806 = copyString(((NimStringDesc*) &TMP196655));
Rawreadline_3789(F_3681, &Result_3806);
return Result_3806;
}
N_NIMCALL(NI64, mulInt64)(NI64 A_5979, NI64 B_5980) {
NI64 Result_5981;
NF64 Resasfloat_5982;
NF64 Floatprod_5983;
Result_5981 = 0;
Resasfloat_5982 = 0;
Floatprod_5983 = 0;
Result_5981 = (NI64)((NU64)(A_5979) * (NU64)(B_5980));
Floatprod_5983 = ((double) (A_5979));
Floatprod_5983 = ((NF64) ((((NF) (Floatprod_5983)) * ((NF) (((double) (B_5980)))))));
Resasfloat_5982 = ((double) (Result_5981));
if (!(((NF) (Resasfloat_5982)) == ((NF) (Floatprod_5983)))) goto LA2;
goto BeforeRet;
LA2: ;
if (!((32.0000 * ((((NF) (Resasfloat_5982)) - ((NF) (Floatprod_5983))) > 0? ((((NF) (Resasfloat_5982)) - ((NF) (Floatprod_5983)))) : -((((NF) (Resasfloat_5982)) - ((NF) (Floatprod_5983)))))) <= (((NF) (Floatprod_5983)) > 0? (((NF) (Floatprod_5983))) : -(((NF) (Floatprod_5983)))))) goto LA5;
goto BeforeRet;
LA5: ;
raiseOverflow();
BeforeRet: ;
return Result_5981;
}
N_NIMCALL(void, reraiseException)(void) {
TY452* E_5434;
if (!(Currexception_4632 == NIM_NIL)) goto LA2;
E_5434 = 0;
E_5434 = (TY452*) newObj(NTI5433, sizeof(TY452));
(*E_5434).Sup.Sup.Sup.m_type = NTI452;
asgnRefNoCycle((void**) &(*E_5434).Sup.Sup.message, copyString(((NimStringDesc*) &TMP196666)));
raiseException((E_Base*)E_5434, "ENoExceptionToReraise");
goto LA1;
LA2: ;
raiseException(Currexception_4632, (*Currexception_4632).name);
LA1: ;
}
N_NIMCALL(TGenericSeq*, incrSeq)(TGenericSeq* Seq_18835, NI Elemsize_18836) {
TGenericSeq* Result_18837;
void* LOC4;
Result_18837 = 0;
Result_18837 = Seq_18835;
if (!((*Result_18837).space <= (*Result_18837).len)) goto LA2;
(*Result_18837).space = Resize_18601((*Result_18837).space);
LOC4 = Growobj_14207(((void*) (Result_18837)), (NI32)((NI32)(Elemsize_18836 * (*Result_18837).space) + 8));
Result_18837 = ((TGenericSeq*) (LOC4));
LA2: ;
(*Result_18837).len += 1;
return Result_18837;
}
N_NIMCALL(NI, Ptrsize_10433)(void* P_10435) {
NI Result_10436;
void* X_10437;
TY8830* LOC1;
Result_10436 = 0;
X_10437 = 0;
X_10437 = ((void*) ((NI32)((NU32)(((NI) (P_10435))) - (NU32)(((NI)sizeof(TY8822))))));
LOC1 = Pageaddr_9085(X_10437);
Result_10436 = (NI32)((*LOC1).Size - ((NI)sizeof(TY8822)));
return Result_10436;
}
N_NOCONV(void*, Realloc_1956)(void* P_1958, NI Newsize_1959) {
void* Result_10442;
NI LOC7;
Result_10442 = 0;
if (!(0 < Newsize_1959)) goto LA2;
Result_10442 = Alloc_1950(Newsize_1959);
if (!!((P_1958 == NIM_NIL))) goto LA5;
LOC7 = Ptrsize_10433(P_1958);
memcpy(Result_10442, P_1958, LOC7);
Dealloc_1960(P_1958);
LA5: ;
goto LA1;
LA2: ;
if (!!((P_1958 == NIM_NIL))) goto LA8;
Dealloc_1960(P_1958);
goto LA1;
LA8: ;
LA1: ;
return Result_10442;
}
N_NIMCALL(NimStringDesc*, nimCharToStr)(NIM_CHAR X_19528) {
NimStringDesc* Result_19529;
Result_19529 = 0;
Result_19529 = mnewString(1);
Result_19529->data[0] = X_19528;
return Result_19529;
}
N_NIMCALL(NimStringDesc*, nimInt64ToStr)(NI64 X_19467) {
NimStringDesc* Result_19468;
NI I_19469;
NI64 Y_19470;
NI64 D_19471;
NI J_19512;
NI HEX3Atmp_21419;
NI Res_21421;
NIM_CHAR LOC9;
Result_19468 = 0;
Result_19468 = mnewString(32);
I_19469 = 0;
I_19469 = 0;
Y_19470 = 0;
Y_19470 = X_19467;
while (1) {
D_19471 = 0;
D_19471 = (NI64)(Y_19470 / 10);
Result_19468->data[I_19469] = ((NIM_CHAR) (((NI) ((NI32)((NI32)abs(((NI) ((NI64)(Y_19470 - (NI64)(D_19471 * 10))))) + 48)))));
I_19469 += 1;
Y_19470 = D_19471;
if (!(Y_19470 == 0)) goto LA3;
goto LA1;
LA3: ;
} LA1: ;
if (!(X_19467 < 0)) goto LA6;
Result_19468->data[I_19469] = 45;
I_19469 += 1;
LA6: ;
Result_19468 = setLengthStr(Result_19468, I_19469);
J_19512 = 0;
HEX3Atmp_21419 = 0;
HEX3Atmp_21419 = (NI32)((NI32)(I_19469 / 2) - 1);
Res_21421 = 0;
Res_21421 = 0;
while (1) {
if (!(Res_21421 <= HEX3Atmp_21419)) goto LA8;
J_19512 = Res_21421;
LOC9 = Result_19468->data[J_19512];
Result_19468->data[J_19512] = Result_19468->data[(NI32)((NI32)(I_19469 - J_19512) - 1)];
Result_19468->data[(NI32)((NI32)(I_19469 - J_19512) - 1)] = LOC9;
Res_21421 += 1;
} LA8: ;
return Result_19468;
}
N_NIMCALL(NimStringDesc*, nimFloatToStr)(NF X_19460) {
NimStringDesc* Result_19461;
TY19462 Buf_19464;
Result_19461 = 0;
memset((void*)&Buf_19464, 0, sizeof(Buf_19464));
sprintf(((NCSTRING) (Buf_19464)), "%#g", X_19460);
Result_19461 = cstrToNimstr(((NCSTRING) (Buf_19464)));
goto BeforeRet;
BeforeRet: ;
return Result_19461;
}
N_NIMCALL(NimStringDesc*, reprEnum)(NI E_19779, TNimType* Typ_19780) {
NimStringDesc* Result_19781;
NimStringDesc* LOC4;
NimStringDesc* LOC5;
Result_19781 = 0;
if (!((NU32)(E_19779) < (NU32)((*(*Typ_19780).node).len))) goto LA2;
Result_19781 = cstrToNimstr((*(*(*Typ_19780).node).sons[(E_19779)-0]).name);
goto LA1;
LA2: ;
LOC4 = 0;
LOC5 = 0;
LOC5 = nimIntToStr(E_19779);
LOC4 = rawNewString(LOC5->Sup.len + 16);
appendString(LOC4, LOC5);
appendString(LOC4, ((NimStringDesc*) &TMP196767));
Result_19781 = LOC4;
LA1: ;
return Result_19781;
}
N_NIMCALL(NIM_BOOL, Endoffile_3638)(FILE* F_3640) {
NIM_BOOL Result_4069;
int C_4070;
Result_4069 = 0;
C_4070 = 0;
C_4070 = fgetc(F_3640);
ungetc(C_4070, F_3640);
Result_4069 = (C_4070 == ((NI32) -1));
goto BeforeRet;
BeforeRet: ;
return Result_4069;
}
static N_INLINE(void, pushSafePoint)(TSafePoint* S_4635) {
(*S_4635).prev = excHandler;
excHandler = S_4635;
}
N_NIMCALL(NI64, Getfilepos_3742)(FILE* F_3744) {
NI64 Result_4305;
NI LOC1;
TY420* E_4309;
Result_4305 = 0;
LOC1 = ftell(F_3744);
Result_4305 = ((NI64) (LOC1));
if (!(Result_4305 < 0)) goto LA3;
E_4309 = 0;
E_4309 = (TY420*) newObj(NTI4262, sizeof(TY420));
(*E_4309).Sup.Sup.Sup.Sup.m_type = NTI420;
asgnRefNoCycle((void**) &(*E_4309).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP196871)));
raiseException((E_Base*)E_4309, "EIO");
LA3: ;
return Result_4305;
}
N_NIMCALL(void, Setfilepos_3738)(FILE* F_3740, NI64 Pos_3741) {
NI LOC2;
TY420* E_4286;
LOC2 = fseek(F_3740, ((NI) (Pos_3741)), 0);
if (!!((LOC2 == 0))) goto LA3;
E_4286 = 0;
E_4286 = (TY420*) newObj(NTI4262, sizeof(TY420));
(*E_4286).Sup.Sup.Sup.Sup.m_type = NTI420;
asgnRefNoCycle((void**) &(*E_4286).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP196872)));
raiseException((E_Base*)E_4286, "EIO");
LA3: ;
}
N_NIMCALL(NI64, Getfilesize_3695)(FILE* F_3697) {
NI64 Result_4328;
NI64 Oldpos_4329;
NI LOC1;
Result_4328 = 0;
Oldpos_4329 = 0;
Oldpos_4329 = Getfilepos_3742(F_3697);
LOC1 = fseek(F_3697, 0, 2);
Result_4328 = Getfilepos_3742(F_3697);
Setfilepos_3738(F_3697, Oldpos_4329);
return Result_4328;
}
static N_INLINE(void, popSafePoint)(void) {
excHandler = (*excHandler).prev;
}
static N_INLINE(E_Base*, getCurrentException)(void) {
E_Base* Result_20604;
Result_20604 = 0;
Result_20604 = Currexception_4632;
return Result_20604;
}
static N_INLINE(void, popCurrentException)(void) {
asgnRef((void**) &Currexception_4632, (*Currexception_4632).parent);
}
N_NIMCALL(NimStringDesc*, Readfile_3647)(NimStringDesc* Filename_3649) {
NimStringDesc* Result_4057;
FILE* F_4058;
TSafePoint TMP196870;
NIM_BOOL LOC2;
NI64 volatile Len_4060;
NI LOC9;
Result_4057 = 0;
F_4058 = 0;
pushSafePoint(&TMP196870);
TMP196870.status = setjmp(TMP196870.context);
if (TMP196870.status == 0) {
LOC2 = Open_3617(&F_4058, Filename_3649, ((NU8) 0), -1);
if (!LOC2) goto LA3;
Len_4060 = 0;
Len_4060 = Getfilesize_3695(F_4058);
if (!(Len_4060 < 2147483647)) goto LA6;
Result_4057 = mnewString(((NI) (Len_4060)));
LOC9 = Readbuffer_3714(F_4058, ((void*) (&Result_4057->data[0])), ((NI) (Len_4060)));
if (!!((((NI64) (LOC9)) == Len_4060))) goto LA10;
Result_4057 = copyString(NIM_NIL);
LA10: ;
LA6: ;
fclose(F_4058);
goto LA1;
LA3: ;
Result_4057 = copyString(NIM_NIL);
LA1: ;
popSafePoint();
} else {
popSafePoint();
if (getCurrentException()->Sup.m_type == NTI420) {
Result_4057 = copyString(NIM_NIL);
TMP196870.status = 0;popCurrentException();}
}
if (TMP196870.status != 0) reraiseException();
return Result_4057;
}
N_NIMCALL(void, Genericassignaux_19568)(void* Dest_19570, void* Src_19571, TNimNode* N_19573) {
NI D_19574;
NI S_19575;
NI I_19583;
NI HEX3Atmp_21426;
NI Res_21428;
TNimNode* M_19584;
D_19574 = 0;
D_19574 = ((NI) (Dest_19570));
S_19575 = 0;
S_19575 = ((NI) (Src_19571));
switch ((*N_19573).kind) {
case ((NU8) 0):
break;
case ((NU8) 1):
genericAssign(((void*) ((NI32)((NU32)(D_19574) + (NU32)((*N_19573).offset)))), ((void*) ((NI32)((NU32)(S_19575) + (NU32)((*N_19573).offset)))), (*N_19573).typ);
break;
case ((NU8) 2):
I_19583 = 0;
HEX3Atmp_21426 = 0;
HEX3Atmp_21426 = (NI32)((*N_19573).len - 1);
Res_21428 = 0;
Res_21428 = 0;
while (1) {
if (!(Res_21428 <= HEX3Atmp_21426)) goto LA1;
I_19583 = Res_21428;
Genericassignaux_19568(Dest_19570, Src_19571, (*N_19573).sons[(I_19583)-0]);
Res_21428 += 1;
} LA1: ;
break;
case ((NU8) 3):
memcpy(((void*) ((NI32)((NU32)(D_19574) + (NU32)((*N_19573).offset)))), ((void*) ((NI32)((NU32)(S_19575) + (NU32)((*N_19573).offset)))), (*(*N_19573).typ).size);
M_19584 = 0;
M_19584 = Selectbranch_7463(Src_19571, N_19573);
if (!!((M_19584 == NIM_NIL))) goto LA3;
Genericassignaux_19568(Dest_19570, Src_19571, M_19584);
LA3: ;
break;
}
}
N_NIMCALL(void, genericAssign)(void* Dest_19565, void* Src_19566, TNimType* Mt_19567) {
NI D_19601;
NI S_19602;
void* S2_19614;
TGenericSeq* Seq_19615;
void** X_19616;
void* LOC4;
NI Dst_19617;
NI I_19625;
NI HEX3Atmp_21432;
NI Res_21434;
TGenericSeq* Dstseq_19626;
NI I_19634;
NI HEX3Atmp_21438;
NI Res_21440;
void* S2_19635;
NimStringDesc* LOC10;
void** X_19636;
D_19601 = 0;
D_19601 = ((NI) (Dest_19565));
S_19602 = 0;
S_19602 = ((NI) (Src_19566));
switch ((*Mt_19567).kind) {
case ((NU8) 24):
S2_19614 = 0;
S2_19614 = (*((void**) (Src_19566)));
Seq_19615 = 0;
Seq_19615 = ((TGenericSeq*) (S2_19614));
if (!(S2_19614 == NIM_NIL)) goto LA2;
X_19616 = 0;
X_19616 = ((void**) (Dest_19565));
(*X_19616) = NIM_NIL;
goto BeforeRet;
LA2: ;
LOC4 = newObj(Mt_19567, (NI32)((NI32)((*Seq_19615).len * (*(*Mt_19567).base).size) + 8));
unsureAsgnRef(((void**) (Dest_19565)), LOC4);
Dst_19617 = 0;
Dst_19617 = ((NI) ((*((void**) (Dest_19565)))));
I_19625 = 0;
HEX3Atmp_21432 = 0;
HEX3Atmp_21432 = (NI32)((*Seq_19615).len - 1);
Res_21434 = 0;
Res_21434 = 0;
while (1) {
if (!(Res_21434 <= HEX3Atmp_21432)) goto LA5;
I_19625 = Res_21434;
genericAssign(((void*) ((NI32)((NU32)((NI32)((NU32)(Dst_19617) + (NU32)((NI32)((NU32)(I_19625) * (NU32)((*(*Mt_19567).base).size))))) + (NU32)(8)))), ((void*) ((NI32)((NU32)((NI32)((NU32)(((NI) (S2_19614))) + (NU32)((NI32)((NU32)(I_19625) * (NU32)((*(*Mt_19567).base).size))))) + (NU32)(8)))), (*Mt_19567).base);
Res_21434 += 1;
} LA5: ;
Dstseq_19626 = 0;
Dstseq_19626 = ((TGenericSeq*) (Dst_19617));
(*Dstseq_19626).len = (*Seq_19615).len;
(*Dstseq_19626).space = (*Seq_19615).len;
break;
case ((NU8) 17):
case ((NU8) 18):
case ((NU8) 40):
Genericassignaux_19568(Dest_19565, Src_19566, (*Mt_19567).node);
break;
case ((NU8) 16):
case ((NU8) 4):
I_19634 = 0;
HEX3Atmp_21438 = 0;
HEX3Atmp_21438 = (NI32)((NI32)((*Mt_19567).size / (*(*Mt_19567).base).size) - 1);
Res_21440 = 0;
Res_21440 = 0;
while (1) {
if (!(Res_21440 <= HEX3Atmp_21438)) goto LA6;
I_19634 = Res_21440;
genericAssign(((void*) ((NI32)((NU32)(D_19601) + (NU32)((NI32)((NU32)(I_19634) * (NU32)((*(*Mt_19567).base).size)))))), ((void*) ((NI32)((NU32)(S_19602) + (NU32)((NI32)((NU32)(I_19634) * (NU32)((*(*Mt_19567).base).size)))))), (*Mt_19567).base);
Res_21440 += 1;
} LA6: ;
break;
case ((NU8) 28):
S2_19635 = 0;
S2_19635 = (*((void**) (S_19602)));
if (!!((S2_19635 == NIM_NIL))) goto LA8;
LOC10 = copyString(((NimStringDesc*) (S2_19635)));
unsureAsgnRef(((void**) (Dest_19565)), ((void*) (LOC10)));
goto LA7;
LA8: ;
X_19636 = 0;
X_19636 = ((void**) (Dest_19565));
(*X_19636) = NIM_NIL;
goto BeforeRet;
LA7: ;
break;
case ((NU8) 22):
unsureAsgnRef(((void**) (Dest_19565)), (*((void**) (S_19602))));
break;
default:
memcpy(Dest_19565, Src_19566, (*Mt_19567).size);
break;
}
BeforeRet: ;
}
N_NIMCALL(void, genericSeqAssign)(void* Dest_19639, void* Src_19640, TNimType* Mt_19641) {
void* Src_19642;
Src_19642 = 0;
Src_19642 = Src_19640;
genericAssign(Dest_19639, ((void*) (&Src_19642)), Mt_19641);
}
N_NIMCALL(NimStringDesc*, Gcgetstatistics_2682)(void) {
NimStringDesc* Result_17824;
NimStringDesc* LOC1;
NI LOC2;
NimStringDesc* LOC3;
NI LOC4;
NimStringDesc* LOC5;
NimStringDesc* LOC6;
NimStringDesc* LOC7;
NimStringDesc* LOC8;
NimStringDesc* LOC9;
NimStringDesc* LOC10;
NimStringDesc* LOC11;
NimStringDesc* LOC12;
Result_17824 = 0;
Gcdisable_2663();
LOC1 = 0;
LOC2 = Gettotalmem_2021();
LOC3 = 0;
LOC3 = nimIntToStr(LOC2);
LOC4 = Getoccupiedmem_2017();
LOC5 = 0;
LOC5 = nimIntToStr(LOC4);
LOC6 = 0;
LOC6 = nimIntToStr(Gch_11210.Stat.Stackscans);
LOC7 = 0;
LOC7 = nimIntToStr(Gch_11210.Stat.Maxstackcells);
LOC8 = 0;
LOC8 = nimIntToStr(Gch_11210.Stat.Cyclecollections);
LOC9 = 0;
LOC9 = nimIntToStr(Gch_11210.Stat.Maxthreshold);
LOC10 = 0;
LOC10 = nimIntToStr(Gch_11210.Zct.Cap);
LOC11 = 0;
LOC11 = nimIntToStr(Gch_11210.Stat.Cycletablesize);
LOC12 = 0;
LOC12 = nimIntToStr(Gch_11210.Stat.Maxstacksize);
LOC1 = rawNewString(LOC3->Sup.len + LOC5->Sup.len + LOC6->Sup.len + LOC7->Sup.len + LOC8->Sup.len + LOC9->Sup.len + LOC10->Sup.len + LOC11->Sup.len + LOC12->Sup.len + 196);
appendString(LOC1, ((NimStringDesc*) &TMP198491));
appendString(LOC1, LOC3);
appendString(LOC1, ((NimStringDesc*) &TMP198492));
appendString(LOC1, LOC5);
appendString(LOC1, ((NimStringDesc*) &TMP198493));
appendString(LOC1, LOC6);
appendString(LOC1, ((NimStringDesc*) &TMP198494));
appendString(LOC1, LOC7);
appendString(LOC1, ((NimStringDesc*) &TMP198495));
appendString(LOC1, LOC8);
appendString(LOC1, ((NimStringDesc*) &TMP198496));
appendString(LOC1, LOC9);
appendString(LOC1, ((NimStringDesc*) &TMP198497));
appendString(LOC1, LOC10);
appendString(LOC1, ((NimStringDesc*) &TMP198498));
appendString(LOC1, LOC11);
appendString(LOC1, ((NimStringDesc*) &TMP198499));
appendString(LOC1, LOC12);
Result_17824 = LOC1;
Gcenable_2665();
return Result_17824;
}
N_NIMCALL(void, Listremove_9246)(TY8834** Head_9250, TY8834* C_9251) {
if (!(C_9251 == (*Head_9250))) goto LA2;
(*Head_9250) = (*C_9251).Next;
if (!!(((*Head_9250) == NIM_NIL))) goto LA5;
(*(*Head_9250)).Prev = NIM_NIL;
LA5: ;
goto LA1;
LA2: ;
(*(*C_9251).Prev).Next = (*C_9251).Next;
if (!!(((*C_9251).Next == NIM_NIL))) goto LA8;
(*(*C_9251).Next).Prev = (*C_9251).Prev;
LA8: ;
LA1: ;
(*C_9251).Next = NIM_NIL;
(*C_9251).Prev = NIM_NIL;
}
N_NIMCALL(void, Listadd_9826)(TY8832** Head_9830, TY8832* C_9831) {
(*C_9831).Next = (*Head_9830);
if (!!(((*Head_9830) == NIM_NIL))) goto LA2;
(*(*Head_9830)).Prev = C_9831;
LA2: ;
(*Head_9830) = C_9831;
}
N_NIMCALL(void, Listremove_9968)(TY8832** Head_9972, TY8832* C_9973) {
if (!(C_9973 == (*Head_9972))) goto LA2;
(*Head_9972) = (*C_9973).Next;
if (!!(((*Head_9972) == NIM_NIL))) goto LA5;
(*(*Head_9972)).Prev = NIM_NIL;
LA5: ;
goto LA1;
LA2: ;
(*(*C_9973).Prev).Next = (*C_9973).Next;
if (!!(((*C_9973).Next == NIM_NIL))) goto LA8;
(*(*C_9973).Next).Prev = (*C_9973).Prev;
LA8: ;
LA1: ;
(*C_9973).Next = NIM_NIL;
(*C_9973).Prev = NIM_NIL;
}
N_NIMCALL(void, Listadd_9607)(TY8834** Head_9611, TY8834* C_9612) {
(*C_9612).Next = (*Head_9611);
if (!!(((*Head_9611) == NIM_NIL))) goto LA2;
(*(*Head_9611)).Prev = C_9612;
LA2: ;
(*Head_9611) = C_9612;
}
N_NOINLINE(void, systemInit)(void) {
Dbglinehook_2722 = ((TY2719) (NIM_NIL));
Strdesc_3017.size = 4;
Strdesc_3017.kind = ((NU8) 28);
Strdesc_3017.flags = 2;
Initstackbottom_3013();
Initgc_3011();
asgnRefNoCycle((void**) &Stacktracenewline_4432, copyString(((NimStringDesc*) &TMP21514)));
excHandler = NIM_NIL;
registerSignalHandler();
asgnRefNoCycle((void**) &Gassertionfailed_5451, (EAssertionFailed*) newObj(NTI5450, sizeof(EAssertionFailed)));
(*Gassertionfailed_5451).Sup.Sup.Sup.m_type = NTI436;
asgnRefNoCycle((void**) &Buf_4810, mnewString(2048));
asgnRefNoCycle((void**) &Assertbuf_4811, mnewString(2048));
Buf_4810 = setLengthStr(Buf_4810, 0);
Assertbuf_4811 = setLengthStr(Assertbuf_4811, 0);
Lastsize_9091 = 4096;
Cyclethreshold_11211 = 4194304;
Recgclock_11212 = 0;
}

