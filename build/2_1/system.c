/* Generated by Nimrod Compiler v0.8.9 */
/*   (c) 2010 Andreas Rumpf */

typedef long int NI;
typedef unsigned long int NU;
#include "nimbase.h"

#include <sys/mman.h>
#include <errno.h>
#include <signal.h>
#include <dlfcn.h>
typedef struct TNimType TNimType;
typedef struct TNimNode TNimNode;
typedef struct TY10790 TY10790;
typedef struct TY10418 TY10418;
typedef struct TY10402 TY10402;
typedef struct TY10414 TY10414;
typedef struct TY10410 TY10410;
typedef struct TY10788 TY10788;
typedef struct TY8474 TY8474;
typedef struct TY8432 TY8432;
typedef struct TY8430 TY8430;
typedef struct TY8422 TY8422;
typedef struct TY8472 TY8472;
typedef struct TY8434 TY8434;
typedef struct TY8411 TY8411;
typedef struct TY8407 TY8407;
typedef struct NimStringDesc NimStringDesc;
typedef struct TGenericSeq TGenericSeq;
typedef struct TY420 TY420;
typedef struct TY418 TY418;
typedef struct TY416 TY416;
typedef struct E_Base E_Base;
typedef struct TNimObject TNimObject;
typedef struct TSafePoint TSafePoint;
typedef struct TY442 TY442;
typedef struct EAssertionFailed EAssertionFailed;
typedef struct EOverflow EOverflow;
typedef struct TY428 TY428;
typedef N_NIMCALL_PTR(void, TY2718) (void);
struct TNimType {
NI size;
NU8 kind;
NU8 flags;
TNimType* base;
TNimNode* node;
void* finalizer;
};
struct TY10418 {
NI Len;
NI Cap;
TY10402** D;
};
struct TY10414 {
NI Counter;
NI Max;
TY10410* Head;
TY10410** Data;
};
struct TY10788 {
NI Stackscans;
NI Cyclecollections;
NI Maxthreshold;
NI Maxstacksize;
NI Maxstackcells;
NI Cycletablesize;
};
struct TY10790 {
TY10418 Zct;
TY10418 Decstack;
TY10414 Cycleroots;
TY10418 Tempstack;
TY10788 Stat;
};
struct TY8430 {
NI Prevsize;
NI Size;
NIM_BOOL Used;
};
struct TY8432 {
  TY8430 Sup;
TY8432* Next;
TY8432* Prev;
TY8422* Freelist;
NI Free;
NI Acc;
NF64 Data;
};
typedef TY8432* TY8481[512];
typedef TY8407* TY8409[1024];
struct TY8411 {
TY8409 Data;
};
struct TY8474 {
TY8472* Llmem;
NI Currmem;
NI Maxmem;
NI Freemem;
TY8481 Freesmallchunks;
TY8434* Freechunkslist;
TY8411 Chunkstarts;
};
struct TY8434 {
  TY8430 Sup;
TY8434* Next;
TY8434* Prev;
NI Align;
NF64 Data;
};
typedef NI TY8414[16];
struct TY8407 {
TY8407* Next;
NI Key;
TY8414 Bits;
};
struct TY8472 {
NI Size;
NI Acc;
};
struct TGenericSeq {
NI len;
NI space;
};
typedef NIM_CHAR TY239[100000001];
struct NimStringDesc {
  TGenericSeq Sup;
TY239 data;
};
struct TNimNode {
NU8 kind;
NI offset;
TNimType* typ;
NCSTRING name;
NI len;
TNimNode** sons;
};
struct TNimObject {
TNimType* m_type;
};
struct E_Base {
  TNimObject Sup;
NCSTRING name;
NimStringDesc* message;
};
struct TY416 {
  E_Base Sup;
};
struct TY418 {
  TY416 Sup;
};
struct TY420 {
  TY418 Sup;
};
typedef void* TY15204[2];
struct TY10402 {
NI Refcount;
TNimType* Typ;
};
struct TY8422 {
TY8422* Next;
NI Zerofield;
};
struct TY10410 {
TY10410* Next;
NI Key;
TY8414 Bits;
};
typedef N_NIMCALL_PTR(void, TFinalizer) (void* Self_10794);
struct TSafePoint {
TSafePoint* prev;
E_Base* exc;
NI status;
jmp_buf context;
};
struct TY442 {
  TY418 Sup;
};
typedef NimStringDesc* TY4102[5];
typedef TFrame* TY4680[128];
struct EAssertionFailed {
  TY416 Sup;
};
struct TY428 {
  TY416 Sup;
};
struct EOverflow {
  TY428 Sup;
};
typedef NIM_CHAR TY17862[60];
static N_INLINE(void, Initstackbottom_3013)(void);
N_NOINLINE(void, setStackBottom)(void* Thestackbottom_1624);
N_NIMCALL(void, Initgc_3011)(void);
N_NIMCALL(void, Init_10478)(TY10418* S_10481, NI Cap_10482);
N_NOCONV(void*, Alloc0_1777)(NI Size_1779);
N_NOCONV(void*, Alloc_1774)(NI Size_1776);
N_NIMCALL(void*, Rawalloc_9395)(TY8474* A_9398, NI Requestedsize_9399);
static N_INLINE(NI, Roundup_8456)(NI X_8458, NI V_8459);
N_NIMCALL(TY8432*, Getsmallchunk_9362)(TY8474* A_9365);
N_NIMCALL(TY8434*, Getbigchunk_9292)(TY8474* A_9295, NI Size_9296);
N_NIMCALL(void, Splitchunk_9266)(TY8474* A_9269, TY8434* C_9270, NI Size_9271);
static N_INLINE(void, Updateprevsize_8811)(TY8474* A_8814, TY8434* C_8815, NI Prevsize_8816);
static N_INLINE(NIM_BOOL, Isaccessible_8752)(void* P_8754);
N_NIMCALL(NIM_BOOL, Contains_8611)(TY8411* S_8613, NI Key_8614);
N_NIMCALL(TY8407*, Intsetget_8574)(TY8411* T_8576, NI Key_8577);
static N_INLINE(NI, Pageindex_8681)(void* P_8683);
N_NIMCALL(void, Incl_8631)(TY8411* S_8634, NI Key_8635);
N_NIMCALL(TY8407*, Intsetput_8593)(TY8411* T_8596, NI Key_8597);
N_NIMCALL(void*, Llalloc_8530)(TY8474* A_8533, NI Size_8534);
static N_INLINE(void*, Osallocpages_8013)(NI Size_8015);
N_NIMCALL(void, Raiseoutofmem_7858)(void);
N_NIMCALL(void, Quit_2822)(NimStringDesc* Errormsg_2824);
static N_INLINE(void, rawEcho)(NimStringDesc* X_4094);
N_NIMCALL(void, Write_3658)(FILE* F_3660, NimStringDesc* S_3661);
N_NIMCALL(NI, Writebuffer_3733)(FILE* F_3735, void* Buffer_3736, NI Len_3737);
N_NIMCALL(void*, newObj)(TNimType* Typ_12107, NI Size_12108);
static N_INLINE(void, Checkcollection_12100)(void);
N_NIMCALL(void, Collectct_11405)(TY10790* Gch_11408);
N_NIMCALL(NI, Getoccupiedmem_2004)(void);
N_NIMCALL(NI, Gettotalmem_2008)(void);
N_NIMCALL(NI, Getfreemem_2006)(void);
N_NOINLINE(NI, Stacksize_15201)(void);
N_CDECL(void, Markstackandregisters_15219)(TY10790* Gch_15222);
static N_INLINE(void, Gcmark_14403)(void* P_14405);
static N_INLINE(TY10402*, Usrtocell_10822)(void* Usr_10824);
N_NIMCALL(NIM_BOOL, Isallocatedptr_10001)(TY8474* A_10003, void* P_10004);
static N_INLINE(TY8430*, Pageaddr_8685)(void* P_8687);
static N_INLINE(NIM_BOOL, Chunkunused_8807)(TY8430* C_8809);
static N_INLINE(NIM_BOOL, Issmallchunk_8801)(TY8430* C_8803);
static N_INLINE(void, Add_10458)(TY10418* S_10461, TY10402* C_10462);
N_NOCONV(void, Dealloc_1784)(void* P_1786);
N_NIMCALL(void, Rawdealloc_9664)(TY8474* A_9667, void* P_9668);
N_NIMCALL(void, Freebigchunk_8820)(TY8474* A_8823, TY8434* C_8824);
N_NIMCALL(void, Excl_8638)(TY8411* S_8641, NI Key_8642);
static N_INLINE(NI, Pageindex_8677)(TY8430* C_8679);
N_NIMCALL(void, Freeoschunks_8726)(TY8474* A_8729, void* P_8730, NI Size_8731);
static N_INLINE(void, Osdeallocpages_8017)(void* P_8019, NI Size_8020);
static N_INLINE(void, Deccurrmem_8503)(TY8474* A_8506, NI Bytes_8507);
N_NIMCALL(void, Markthreadstacks_14411)(TY10790* Gch_14414);
N_NIMCALL(void, Collectzct_15401)(TY10790* Gch_15404);
static N_INLINE(NIM_BOOL, Canbecycleroot_10826)(TY10402* C_10828);
N_NIMCALL(void, Excl_10681)(TY10414* S_10684, TY10402* Cell_10685);
N_NIMCALL(TY10410*, Cellsetget_10514)(TY10414 T_10516, NI Key_10517);
static N_INLINE(NI, Nexttry_10509)(NI H_10511, NI Maxhash_10512);
N_NIMCALL(void, Preparedealloc_11425)(TY10402* Cell_11427);
static N_INLINE(void*, Celltousr_10818)(TY10402* Cell_10820);
N_NIMCALL(void, Forallchildren_11412)(TY10402* Cell_11414, NU8 Op_11415);
N_NIMCALL(void, Forallchildrenaux_11420)(void* Dest_11422, TNimType* Mt_11423, NU8 Op_11424);
N_NIMCALL(void, Dooperation_11416)(void* P_11418, NU8 Op_11419);
N_NOINLINE(void, Addzct_10811)(TY10418* S_10814, TY10402* C_10815);
N_NIMCALL(void, Forallslotsaux_12001)(void* Dest_12003, TNimNode* N_12005, NU8 Op_12006);
N_NIMCALL(TNimNode*, Selectbranch_7063)(void* Aa_7065, TNimNode* N_7067);
N_NIMCALL(NI, Getdiscriminant_7043)(void* Aa_7045, TNimNode* N_7047);
N_NIMCALL(void, Collectcycles_13603)(TY10790* Gch_13606);
N_NIMCALL(void, Init_10488)(TY10414* S_10491);
N_NIMCALL(NIM_BOOL, Containsorincl_10699)(TY10414* S_10702, TY10402* Cell_10703);
N_NOINLINE(void, Incl_10674)(TY10414* S_10677, TY10402* Cell_10678);
N_NIMCALL(TY10410*, Cellsetput_10595)(TY10414* T_10598, NI Key_10599);
N_NIMCALL(void, Cellsetenlarge_10570)(TY10414* T_10573);
N_NIMCALL(void, Cellsetrawinsert_10533)(TY10414 T_10535, TY10410** Data_10536, TY10410* Desc_10537);
N_NIMCALL(NIM_BOOL, Contains_10654)(TY10414 S_10656, TY10402* Cell_10657);
N_NIMCALL(void, Deinit_10492)(TY10414* S_10495);
N_NIMCALL(void, Unmarkstackandregisters_16001)(TY10790* Gch_16004);
static N_INLINE(void, Decref_11460)(TY10402* C_11462);
static N_INLINE(void, Rtladdzct_11456)(TY10402* C_11458);
static N_INLINE(void, Rtladdcycleroot_11452)(TY10402* C_11454);
static N_INLINE(void, asgnRefNoCycle)(void** Dest_11616, void* Src_11617);
N_NIMCALL(NimStringDesc*, copyString)(NimStringDesc* Src_17108);
N_NIMCALL(NimStringDesc*, rawNewString)(NI Space_17087);
N_NIMCALL(void, raiseException)(E_Base* E_4604, NCSTRING Ename_4605);
N_NIMCALL(void, Gcdisable_2663)(void);
N_NIMCALL(void, unsureAsgnRef)(void** Dest_11622, void* Src_11623);
N_NOINLINE(NIM_BOOL, Isonstack_11409)(void* P_11411);
static N_INLINE(void, Incref_11601)(TY10402* C_11603);
N_NIMCALL(NimStringDesc*, setLengthStr)(NimStringDesc* S_17225, NI Newlen_17226);
N_NIMCALL(NimStringDesc*, resizeString)(NimStringDesc* Dest_17182, NI Addlen_17183);
static N_INLINE(NI, Resize_17001)(NI Old_17003);
N_NIMCALL(void*, Growobj_12606)(void* Old_12608, NI Newsize_12609);
N_NIMCALL(void, Rawwritestacktrace_4867)(NimStringDesc** S_4870);
static N_INLINE(void, appendString)(NimStringDesc* Dest_17192, NimStringDesc* Src_17193);
N_NIMCALL(void, Auxwritestacktrace_4684)(TFrame* F_4686, NimStringDesc** S_4688);
N_NIMCALL(NimStringDesc*, nimIntToStr)(NI X_17803);
N_NIMCALL(NimStringDesc*, mnewString)(NI Len_1347);
N_NIMCALL(void, Add_2722)(NimStringDesc** X_2725, NCSTRING Y_2726);
N_NIMCALL(NimStringDesc*, addChar)(NimStringDesc* S_1603, NIM_CHAR C_1604);
N_NIMCALL(NimStringDesc*, cstrToNimstr)(NCSTRING Str_17104);
N_NIMCALL(NimStringDesc*, toNimStr)(NCSTRING Str_17099, NI Len_17100);
N_NIMCALL(void, Writetostderr_4432)(NCSTRING Msg_4434);
N_NIMCALL(void, Write_3670)(FILE* F_3672, NCSTRING C_3673);
static N_INLINE(void, Quitordebug_4882)(void);
N_NIMCALL(void, Gcenable_2665)(void);
static N_INLINE(void, rawEchoNL)(void);
static N_INLINE(void, Inccurrmem_8486)(TY8474* A_8489, NI Bytes_8490);
N_NIMCALL(TY8434*, Requestoschunks_8692)(TY8474* A_8695, NI Size_8696);
N_NOCONV(void, signalHandler)(int Sig_5048);
N_NIMCALL(void, registerSignalHandler)(void);
N_NIMCALL(NI, getRefcount)(void* P_10847);
N_NIMCALL(NimStringDesc*, mnewString)(NI Len_17095);
N_NIMCALL(NimStringDesc*, copyStrLast)(NimStringDesc* S_17143, NI Start_17144, NI Last_17145);
N_NIMCALL(NimStringDesc*, copyStr)(NimStringDesc* S_17158, NI Start_17159);
N_NIMCALL(NimStringDesc*, getCurrentExceptionMsg)(void);
static N_INLINE(NI, addInt)(NI A_5603, NI B_5604);
N_NOINLINE(void, raiseOverflow)(void);
N_NIMCALL(NI, mulInt)(NI A_6603, NI B_6604);
N_NIMCALL(TNimType*, extGetCellType)(void* C_10843);
N_NIMCALL(void, Objectinitaux_18064)(void* Dest_18066, TNimNode* N_18068);
N_NIMCALL(void, objectInit)(void* Dest_18062, TNimType* Typ_18063);
N_NIMCALL(void, Rawreadline_3789)(FILE* F_3791, NimStringDesc** Result_3793);
N_NIMCALL(NI, Ptrsize_10033)(void* P_10035);
N_NIMCALL(NIM_BOOL, Open_3617)(FILE** F_3620, NimStringDesc* Filename_3621, NU8 Mode_3622, NI Bufsize_3623);
N_NIMCALL(NI64, Getfilesize_3695)(FILE* F_3697);
N_NIMCALL(NI64, Getfilepos_3742)(FILE* F_3744);
N_NIMCALL(void, Setfilepos_3738)(FILE* F_3740, NI64 Pos_3741);
N_NIMCALL(NI, Readbuffer_3714)(FILE* F_3716, void* Buffer_3717, NI Len_3718);
N_NIMCALL(void, genericAssign)(void* Dest_17965, void* Src_17966, TNimType* Mt_17967);
N_NIMCALL(void, Genericassignaux_17968)(void* Dest_17970, void* Src_17971, TNimNode* N_17973);
N_NIMCALL(void, Listremove_8846)(TY8434** Head_8850, TY8434* C_8851);
N_NIMCALL(void, Listadd_9426)(TY8432** Head_9430, TY8432* C_9431);
N_NIMCALL(void, Listremove_9568)(TY8432** Head_9572, TY8432* C_9573);
N_NIMCALL(void, Listadd_9207)(TY8434** Head_9211, TY8434* C_9212);
STRING_LITERAL(TMP19908, "cannot write string to file", 27);
STRING_LITERAL(TMP19909, "No stack traceback available", 28);
STRING_LITERAL(TMP19910, "Traceback (most recent call last)", 33);
STRING_LITERAL(TMP19911, "(", 1);
STRING_LITERAL(TMP19912, " calls omitted) ...", 19);
STRING_LITERAL(TMP19913, "Error: unhandled exception: ", 28);
STRING_LITERAL(TMP19914, "Error: unhandled exception", 26);
STRING_LITERAL(TMP19915, " [", 2);
STRING_LITERAL(TMP19916, "]\012", 2);
STRING_LITERAL(TMP19917, "\012", 1);
STRING_LITERAL(TMP19918, "out of memory; cannot even throw an exception", 45);
STRING_LITERAL(TMP19919, "out of memory", 13);
STRING_LITERAL(TMP19920, "rb", 2);
STRING_LITERAL(TMP19921, "wb", 2);
STRING_LITERAL(TMP19922, "w+b", 3);
STRING_LITERAL(TMP19923, "r+b", 3);
STRING_LITERAL(TMP19924, "ab", 2);
NIM_CONST TY4102 Formatopen_4101 = {((NimStringDesc*) &TMP19920),
((NimStringDesc*) &TMP19921),
((NimStringDesc*) &TMP19922),
((NimStringDesc*) &TMP19923),
((NimStringDesc*) &TMP19924)}
;
STRING_LITERAL(TMP19925, "SIGINT: Interrupted by Ctrl-C.\012", 31);
STRING_LITERAL(TMP19926, "SIGSEGV: Illegal storage access. (Attempt to read from nil?)\012", 61);
STRING_LITERAL(TMP19927, "SIGABRT: Abnormal termination.\012", 31);
STRING_LITERAL(TMP19928, "SIGFPE: Arithmetic error.\012", 26);
STRING_LITERAL(TMP19929, "SIGILL: Illegal operation.\012", 27);
STRING_LITERAL(TMP19930, "SIGBUS: Illegal storage access. (Attempt to read from nil?)\012", 60);
STRING_LITERAL(TMP19931, "unknown signal\012", 15);
STRING_LITERAL(TMP19932, "", 0);
STRING_LITERAL(TMP37440, "over- or underflow", 18);
STRING_LITERAL(TMP193760, " (invalid data!)", 16);
STRING_LITERAL(TMP193863, "cannot retrieve file position", 29);
STRING_LITERAL(TMP193864, "cannot set file position", 24);
STRING_LITERAL(TMP195481, "[GC] total memory: ", 19);
STRING_LITERAL(TMP195482, "\012[GC] occupied memory: ", 23);
STRING_LITERAL(TMP195483, "\012[GC] stack scans: ", 19);
STRING_LITERAL(TMP195484, "\012[GC] stack cells: ", 19);
STRING_LITERAL(TMP195485, "\012[GC] cycle collections: ", 25);
STRING_LITERAL(TMP195486, "\012[GC] max threshold: ", 21);
STRING_LITERAL(TMP195487, "\012[GC] zct capacity: ", 20);
STRING_LITERAL(TMP195488, "\012[GC] max cycle table size: ", 28);
STRING_LITERAL(TMP195489, "\012[GC] max stack size: ", 22);
TY2718 Dbglinehook_2721;
TNimType Strdesc_3017;
extern TNimType* NTI4262; /* ref EIO */
extern TNimType* NTI420; /* EIO */
extern TNimType* NTI7861; /* ref EOutOfMemory */
extern TNimType* NTI442; /* EOutOfMemory */
TSafePoint* excHandler;
NimStringDesc* Buf_4677;
NimStringDesc* Assertbuf_4678;
TFrame* framePtr;
TY4680 Tempframes_4682;
NimStringDesc* Stacktracenewline_4683;
EAssertionFailed* Gassertionfailed_5021;
NIM_BOOL Dbgaborting_5045;
extern TNimType* NTI5020; /* ref EAssertionFailed */
extern TNimType* NTI436; /* EAssertionFailed */
TY442* Goutofmem_7857;
TY8474 Allocator_8529;
NI Lastsize_8691;
void* Stackbottom_10807;
TY10790 Gch_10808;
NI Cyclethreshold_10809;
NI Recgclock_10810;
extern TNimType* NTI5491; /* ref EOverflow */
extern TNimType* NTI432; /* EOverflow */
N_NOINLINE(void, setStackBottom)(void* Thestackbottom_1624) {
NI A_14804;
NI B_14805;
if (!(Stackbottom_10807 == NIM_NIL)) goto LA2;
Stackbottom_10807 = Thestackbottom_1624;
goto LA1;
LA2: ;
A_14804 = 0;
A_14804 = ((NI) (Thestackbottom_1624));
B_14805 = 0;
B_14805 = ((NI) (Stackbottom_10807));
Stackbottom_10807 = ((void*) (((A_14804 >= B_14805) ? A_14804 : B_14805)));
LA1: ;
}
static N_INLINE(void, Initstackbottom_3013)(void) {
void* volatile Locals_3015;
Locals_3015 = 0;
setStackBottom(((void*) (&Locals_3015)));
}
static N_INLINE(NI, Roundup_8456)(NI X_8458, NI V_8459) {
NI Result_8460;
Result_8460 = 0;
Result_8460 = (NI32)((NI32)(X_8458 + (NI32)(V_8459 - 1)) & (NI32)((NU32) ~((NI32)(V_8459 - 1))));
return Result_8460;
}
N_NIMCALL(TY8407*, Intsetget_8574)(TY8411* T_8576, NI Key_8577) {
TY8407* Result_8578;
TY8407* It_8579;
Result_8578 = 0;
It_8579 = 0;
It_8579 = (*T_8576).Data[((NI32)(Key_8577 & 1023))-0];
while (1) {
if (!!((It_8579 == NIM_NIL))) goto LA1;
if (!((*It_8579).Key == Key_8577)) goto LA3;
Result_8578 = It_8579;
goto BeforeRet;
LA3: ;
It_8579 = (*It_8579).Next;
} LA1: ;
Result_8578 = NIM_NIL;
BeforeRet: ;
return Result_8578;
}
N_NIMCALL(NIM_BOOL, Contains_8611)(TY8411* S_8613, NI Key_8614) {
NIM_BOOL Result_8615;
TY8407* T_8616;
NI U_8628;
Result_8615 = 0;
T_8616 = 0;
T_8616 = Intsetget_8574(S_8613, (NI32)((NU32)(Key_8614) >> (NU32)(9)));
if (!!((T_8616 == NIM_NIL))) goto LA2;
U_8628 = 0;
U_8628 = (NI32)(Key_8614 & 511);
Result_8615 = !(((NI32)((*T_8616).Bits[((NI32)((NU32)(U_8628) >> (NU32)(5)))-0] & (NI32)((NU32)(1) << (NU32)((NI32)(U_8628 & 31)))) == 0));
goto LA1;
LA2: ;
Result_8615 = NIM_FALSE;
LA1: ;
return Result_8615;
}
static N_INLINE(NI, Pageindex_8681)(void* P_8683) {
NI Result_8684;
Result_8684 = 0;
Result_8684 = (NI32)((NU32)(((NI) (P_8683))) >> (NU32)(12));
return Result_8684;
}
static N_INLINE(NIM_BOOL, Isaccessible_8752)(void* P_8754) {
NIM_BOOL Result_8755;
NI LOC1;
Result_8755 = 0;
LOC1 = Pageindex_8681(P_8754);
Result_8755 = Contains_8611(&Allocator_8529.Chunkstarts, LOC1);
return Result_8755;
}
static N_INLINE(void, Updateprevsize_8811)(TY8474* A_8814, TY8434* C_8815, NI Prevsize_8816) {
TY8430* Ri_8817;
NIM_BOOL LOC2;
Ri_8817 = 0;
Ri_8817 = ((TY8430*) ((NI32)((NU32)(((NI) (C_8815))) + (NU32)((*C_8815).Sup.Size))));
LOC2 = Isaccessible_8752(((void*) (Ri_8817)));
if (!LOC2) goto LA3;
(*Ri_8817).Prevsize = Prevsize_8816;
LA3: ;
}
N_NIMCALL(NI, Writebuffer_3733)(FILE* F_3735, void* Buffer_3736, NI Len_3737) {
NI Result_4251;
Result_4251 = 0;
Result_4251 = fwrite(Buffer_3736, 1, Len_3737, F_3735);
return Result_4251;
}
N_NIMCALL(NI, Gettotalmem_2008)(void) {
NI Result_10077;
Result_10077 = 0;
Result_10077 = Allocator_8529.Currmem;
goto BeforeRet;
BeforeRet: ;
return Result_10077;
}
N_NIMCALL(NI, Getfreemem_2006)(void) {
NI Result_10074;
Result_10074 = 0;
Result_10074 = Allocator_8529.Freemem;
return Result_10074;
}
N_NIMCALL(NI, Getoccupiedmem_2004)(void) {
NI Result_10080;
NI LOC1;
NI LOC2;
Result_10080 = 0;
LOC1 = Gettotalmem_2008();
LOC2 = Getfreemem_2006();
Result_10080 = (NI32)(LOC1 - LOC2);
goto BeforeRet;
BeforeRet: ;
return Result_10080;
}
N_NOINLINE(NI, Stacksize_15201)(void) {
NI Result_15203;
TY15204 Stacktop_15206;
Result_15203 = 0;
memset((void*)&Stacktop_15206, 0, sizeof(Stacktop_15206));
Result_15203 = (NI32)abs((NI32)(((NI) (&Stacktop_15206[(0)-0])) - ((NI) (Stackbottom_10807))));
return Result_15203;
}
static N_INLINE(TY10402*, Usrtocell_10822)(void* Usr_10824) {
TY10402* Result_10825;
Result_10825 = 0;
Result_10825 = ((TY10402*) ((NI32)((NU32)(((NI) (Usr_10824))) - (NU32)(((NI) (((NI)sizeof(TY10402))))))));
return Result_10825;
}
static N_INLINE(TY8430*, Pageaddr_8685)(void* P_8687) {
TY8430* Result_8688;
Result_8688 = 0;
Result_8688 = ((TY8430*) ((NI32)(((NI) (P_8687)) & -4096)));
return Result_8688;
}
static N_INLINE(NIM_BOOL, Chunkunused_8807)(TY8430* C_8809) {
NIM_BOOL Result_8810;
Result_8810 = 0;
Result_8810 = !((*C_8809).Used);
return Result_8810;
}
static N_INLINE(NIM_BOOL, Issmallchunk_8801)(TY8430* C_8803) {
NIM_BOOL Result_8804;
Result_8804 = 0;
Result_8804 = ((*C_8803).Size <= (NI32)(4096 - (NI32)(((NI)sizeof(TY8432)) - 8)));
goto BeforeRet;
BeforeRet: ;
return Result_8804;
}
N_NIMCALL(NIM_BOOL, Isallocatedptr_10001)(TY8474* A_10003, void* P_10004) {
NIM_BOOL Result_10005;
NIM_BOOL LOC2;
TY8430* C_10006;
NIM_BOOL LOC6;
NIM_BOOL LOC10;
TY8432* C_10007;
NI Offset_10008;
NIM_BOOL LOC13;
NIM_BOOL LOC14;
TY8434* C_10012;
NIM_BOOL LOC17;
Result_10005 = 0;
LOC2 = Isaccessible_8752(P_10004);
if (!LOC2) goto LA3;
C_10006 = 0;
C_10006 = Pageaddr_8685(P_10004);
LOC6 = Chunkunused_8807(C_10006);
if (!!(LOC6)) goto LA7;
LOC10 = Issmallchunk_8801(C_10006);
if (!LOC10) goto LA11;
C_10007 = 0;
C_10007 = ((TY8432*) (C_10006));
Offset_10008 = 0;
Offset_10008 = (NI32)((NU32)((NI32)(((NI) (P_10004)) & 4095)) - (NU32)((NI32)(((NI)sizeof(TY8432)) - 8)));
LOC14 = ((NU32)(Offset_10008) < (NU32)((*C_10007).Acc));
if (!(LOC14)) goto LA15;
LOC14 = ((NI32)((NU32)(Offset_10008) % (NU32)((*C_10007).Sup.Size)) == 0);
LA15: ;
LOC13 = LOC14;
if (!(LOC13)) goto LA16;
LOC13 = ((NU32)(1) < (NU32)((*((TY8422*) (P_10004))).Zerofield));
LA16: ;
Result_10005 = LOC13;
goto LA9;
LA11: ;
C_10012 = 0;
C_10012 = ((TY8434*) (C_10006));
LOC17 = (P_10004 == ((void*) (&(*C_10012).Data)));
if (!(LOC17)) goto LA18;
LOC17 = ((NU32)(1) < (NU32)((*((TY8422*) (P_10004))).Zerofield));
LA18: ;
Result_10005 = LOC17;
LA9: ;
LA7: ;
LA3: ;
return Result_10005;
}
N_NIMCALL(void, Excl_8638)(TY8411* S_8641, NI Key_8642) {
TY8407* T_8643;
NI U_8655;
T_8643 = 0;
T_8643 = Intsetget_8574(&(*S_8641), (NI32)((NU32)(Key_8642) >> (NU32)(9)));
if (!!((T_8643 == NIM_NIL))) goto LA2;
U_8655 = 0;
U_8655 = (NI32)(Key_8642 & 511);
(*T_8643).Bits[((NI32)((NU32)(U_8655) >> (NU32)(5)))-0] = (NI32)((*T_8643).Bits[((NI32)((NU32)(U_8655) >> (NU32)(5)))-0] & (NI32)((NU32) ~((NI32)((NU32)(1) << (NU32)((NI32)(U_8655 & 31))))));
LA2: ;
}
static N_INLINE(NI, Pageindex_8677)(TY8430* C_8679) {
NI Result_8680;
Result_8680 = 0;
Result_8680 = (NI32)((NU32)(((NI) (C_8679))) >> (NU32)(12));
return Result_8680;
}
static N_INLINE(void, Osdeallocpages_8017)(void* P_8019, NI Size_8020) {
munmap(P_8019, Size_8020);
}
static N_INLINE(void, Deccurrmem_8503)(TY8474* A_8506, NI Bytes_8507) {
(*A_8506).Maxmem = (((*A_8506).Maxmem >= (*A_8506).Currmem) ? (*A_8506).Maxmem : (*A_8506).Currmem);
(*A_8506).Currmem -= Bytes_8507;
}
N_NIMCALL(void, Freeoschunks_8726)(TY8474* A_8729, void* P_8730, NI Size_8731) {
TY8430* C_8732;
NI Nxt_8733;
TY8430* Next_8736;
NI LOC2;
NIM_BOOL LOC3;
NI LOC6;
C_8732 = 0;
C_8732 = ((TY8430*) (P_8730));
Nxt_8733 = 0;
Nxt_8733 = (NI32)((NU32)(((NI) (P_8730))) + (NU32)((*C_8732).Size));
Next_8736 = 0;
Next_8736 = ((TY8430*) (Nxt_8733));
LOC2 = Pageindex_8677(Next_8736);
LOC3 = Contains_8611(&(*A_8729).Chunkstarts, LOC2);
if (!LOC3) goto LA4;
(*Next_8736).Prevsize = 0;
LA4: ;
LOC6 = Pageindex_8681(P_8730);
Excl_8638(&(*A_8729).Chunkstarts, LOC6);
Osdeallocpages_8017(P_8730, Size_8731);
Deccurrmem_8503(A_8729, Size_8731);
(*A_8729).Freemem -= Size_8731;
}
N_NIMCALL(void, Freebigchunk_8820)(TY8474* A_8823, TY8434* C_8824) {
TY8434* C_8825;
TY8430* Ri_8840;
NIM_BOOL LOC2;
NIM_BOOL LOC7;
NI LOC10;
TY8430* Le_9003;
NIM_BOOL LOC15;
NIM_BOOL LOC20;
NI LOC23;
NI LOC27;
C_8825 = 0;
C_8825 = C_8824;
(*A_8823).Freemem += (*C_8825).Sup.Size;
Ri_8840 = 0;
Ri_8840 = ((TY8430*) ((NI32)((NU32)(((NI) (C_8825))) + (NU32)((*C_8825).Sup.Size))));
LOC2 = Isaccessible_8752(((void*) (Ri_8840)));
if (!(LOC2)) goto LA3;
LOC2 = Chunkunused_8807(Ri_8840);
LA3: ;
if (!LOC2) goto LA4;
LOC7 = Issmallchunk_8801(Ri_8840);
if (!!(LOC7)) goto LA8;
Listremove_8846(&(*A_8823).Freechunkslist, ((TY8434*) (Ri_8840)));
(*C_8825).Sup.Size += (*Ri_8840).Size;
LOC10 = Pageindex_8677(Ri_8840);
Excl_8638(&(*A_8823).Chunkstarts, LOC10);
LA8: ;
LA4: ;
if (!!(((*C_8825).Sup.Prevsize == 0))) goto LA12;
Le_9003 = 0;
Le_9003 = ((TY8430*) ((NI32)((NU32)(((NI) (C_8825))) - (NU32)((*C_8825).Sup.Prevsize))));
LOC15 = Isaccessible_8752(((void*) (Le_9003)));
if (!(LOC15)) goto LA16;
LOC15 = Chunkunused_8807(Le_9003);
LA16: ;
if (!LOC15) goto LA17;
LOC20 = Issmallchunk_8801(Le_9003);
if (!!(LOC20)) goto LA21;
Listremove_8846(&(*A_8823).Freechunkslist, ((TY8434*) (Le_9003)));
(*Le_9003).Size += (*C_8825).Sup.Size;
LOC23 = Pageindex_8677(&C_8825->Sup);
Excl_8638(&(*A_8823).Chunkstarts, LOC23);
C_8825 = ((TY8434*) (Le_9003));
LA21: ;
LA17: ;
LA12: ;
if (!((*C_8825).Sup.Size < 1048576)) goto LA25;
LOC27 = Pageindex_8677(&C_8825->Sup);
Incl_8631(&(*A_8823).Chunkstarts, LOC27);
Updateprevsize_8811(A_8823, C_8825, (*C_8825).Sup.Size);
Listadd_9207(&(*A_8823).Freechunkslist, C_8825);
(*C_8825).Sup.Used = NIM_FALSE;
goto LA24;
LA25: ;
Freeoschunks_8726(A_8823, ((void*) (C_8825)), (*C_8825).Sup.Size);
LA24: ;
}
N_NIMCALL(void, Rawdealloc_9664)(TY8474* A_9667, void* P_9668) {
TY8430* C_9669;
NIM_BOOL LOC2;
TY8432* C_9670;
NI S_9671;
TY8422* F_9673;
C_9669 = 0;
C_9669 = Pageaddr_8685(P_9668);
LOC2 = Issmallchunk_8801(C_9669);
if (!LOC2) goto LA3;
C_9670 = 0;
C_9670 = ((TY8432*) (C_9669));
S_9671 = 0;
S_9671 = (*C_9670).Sup.Size;
F_9673 = 0;
F_9673 = ((TY8422*) (P_9668));
(*F_9673).Zerofield = 0;
(*F_9673).Next = (*C_9670).Freelist;
(*C_9670).Freelist = F_9673;
if (!((*C_9670).Free < S_9671)) goto LA6;
Listadd_9426(&(*A_9667).Freesmallchunks[((NI32)(S_9671 / 8))-0], C_9670);
(*C_9670).Free += S_9671;
goto LA5;
LA6: ;
(*C_9670).Free += S_9671;
if (!((*C_9670).Free == (NI32)(4096 - (NI32)(((NI)sizeof(TY8432)) - 8)))) goto LA9;
Listremove_9568(&(*A_9667).Freesmallchunks[((NI32)(S_9671 / 8))-0], C_9670);
(*C_9670).Sup.Size = 4096;
Freebigchunk_8820(A_9667, ((TY8434*) (C_9670)));
LA9: ;
LA5: ;
goto LA1;
LA3: ;
Freebigchunk_8820(A_9667, ((TY8434*) (C_9669)));
LA1: ;
}
N_NOCONV(void, Dealloc_1784)(void* P_1786) {
void* X_10028;
X_10028 = 0;
X_10028 = ((void*) ((NI32)((NU32)(((NI) (P_1786))) - (NU32)(((NI)sizeof(TY8422))))));
Rawdealloc_9664(&Allocator_8529, X_10028);
}
static N_INLINE(void, Add_10458)(TY10418* S_10461, TY10402* C_10462) {
TY10402** D_10465;
void* LOC4;
if (!((*S_10461).Cap <= (*S_10461).Len)) goto LA2;
(*S_10461).Cap = (NI32)((NI32)((*S_10461).Cap * 3) / 2);
D_10465 = 0;
LOC4 = Alloc_1774((NI32)((*S_10461).Cap * 4));
D_10465 = ((TY10402**) (LOC4));
memcpy(((void*) (D_10465)), ((void*) ((*S_10461).D)), (NI32)((*S_10461).Len * 4));
Dealloc_1784(((void*) ((*S_10461).D)));
(*S_10461).D = D_10465;
LA2: ;
(*S_10461).D[((*S_10461).Len)-0] = C_10462;
(*S_10461).Len += 1;
}
static N_INLINE(void, Gcmark_14403)(void* P_14405) {
TY10402* Cell_14406;
NI C_14407;
NIM_BOOL LOC2;
NIM_BOOL LOC7;
Cell_14406 = 0;
Cell_14406 = Usrtocell_10822(P_14405);
C_14407 = 0;
C_14407 = ((NI) (Cell_14406));
LOC2 = ((NU32)(4096) < (NU32)(C_14407));
if (!(LOC2)) goto LA3;
LOC2 = ((NI32)(C_14407 & 7) == 0);
LA3: ;
if (!LOC2) goto LA4;
LOC7 = Isallocatedptr_10001(&Allocator_8529, ((void*) (Cell_14406)));
if (!LOC7) goto LA8;
(*Cell_14406).Refcount = (NI32)((NU32)((*Cell_14406).Refcount) + (NU32)(8));
Add_10458(&Gch_10808.Decstack, Cell_14406);
LA8: ;
LA4: ;
}
N_CDECL(void, Markstackandregisters_15219)(TY10790* Gch_15222) {
jmp_buf Registers_15223;
int LOC2;
NI Max_15227;
NI Sp_15229;
memset((void*)&Registers_15223, 0, sizeof(Registers_15223));
LOC2 = setjmp(Registers_15223);
if (!(LOC2 == ((NI32) 0))) goto LA3;
Max_15227 = 0;
Max_15227 = ((NI) (Stackbottom_10807));
Sp_15229 = 0;
Sp_15229 = ((NI) (Registers_15223));
while (1) {
if (!((NU32)(Sp_15229) <= (NU32)(Max_15227))) goto LA5;
Gcmark_14403((*((void**) (Sp_15229))));
Sp_15229 = (NI32)((NU32)(Sp_15229) + (NU32)(4));
} LA5: ;
LA3: ;
}
N_NIMCALL(void, Markthreadstacks_14411)(TY10790* Gch_14414) {
}
static N_INLINE(NIM_BOOL, Canbecycleroot_10826)(TY10402* C_10828) {
NIM_BOOL Result_10829;
Result_10829 = 0;
Result_10829 = !((((*(*C_10828).Typ).flags &(1<<((((NU8) 1))&7)))!=0));
return Result_10829;
}
static N_INLINE(NI, Nexttry_10509)(NI H_10511, NI Maxhash_10512) {
NI Result_10513;
Result_10513 = 0;
Result_10513 = (NI32)((NI32)((NI32)(5 * H_10511) + 1) & Maxhash_10512);
return Result_10513;
}
N_NIMCALL(TY10410*, Cellsetget_10514)(TY10414 T_10516, NI Key_10517) {
TY10410* Result_10518;
NI H_10519;
Result_10518 = 0;
H_10519 = 0;
H_10519 = (NI32)(((NI) (Key_10517)) & T_10516.Max);
while (1) {
if (!!((T_10516.Data[(H_10519)-0] == NIM_NIL))) goto LA1;
if (!((*T_10516.Data[(H_10519)-0]).Key == Key_10517)) goto LA3;
Result_10518 = T_10516.Data[(H_10519)-0];
goto BeforeRet;
LA3: ;
H_10519 = Nexttry_10509(H_10519, T_10516.Max);
} LA1: ;
Result_10518 = NIM_NIL;
goto BeforeRet;
BeforeRet: ;
return Result_10518;
}
N_NIMCALL(void, Excl_10681)(TY10414* S_10684, TY10402* Cell_10685) {
NI U_10686;
TY10410* T_10687;
U_10686 = 0;
U_10686 = ((NI) (Cell_10685));
T_10687 = 0;
T_10687 = Cellsetget_10514((*S_10684), (NI32)((NU32)(U_10686) >> (NU32)(12)));
if (!!((T_10687 == NIM_NIL))) goto LA2;
U_10686 = (NI32)((NU32)((NI32)((NU32)(U_10686) % (NU32)(4096))) / (NU32)(8));
(*T_10687).Bits[((NI32)((NU32)(U_10686) >> (NU32)(5)))-0] = (NI32)((*T_10687).Bits[((NI32)((NU32)(U_10686) >> (NU32)(5)))-0] & (NI32)((NU32) ~((NI32)((NU32)(1) << (NU32)((NI32)(U_10686 & 31))))));
LA2: ;
}
static N_INLINE(void*, Celltousr_10818)(TY10402* Cell_10820) {
void* Result_10821;
Result_10821 = 0;
Result_10821 = ((void*) ((NI32)((NU32)(((NI) (Cell_10820))) + (NU32)(((NI) (((NI)sizeof(TY10402))))))));
return Result_10821;
}
N_NIMCALL(void, Preparedealloc_11425)(TY10402* Cell_11427) {
void* LOC4;
if (!!(((*(*Cell_11427).Typ).finalizer == NIM_NIL))) goto LA2;
Recgclock_10810 += 1;
LOC4 = Celltousr_10818(Cell_11427);
((TFinalizer) ((*(*Cell_11427).Typ).finalizer))(LOC4);
Recgclock_10810 -= 1;
LA2: ;
}
N_NOINLINE(void, Addzct_10811)(TY10418* S_10814, TY10402* C_10815) {
if (!((NI32)((*C_10815).Refcount & 4) == 0)) goto LA2;
(*C_10815).Refcount = (NI32)((NI32)((*C_10815).Refcount & -8) | 4);
Add_10458(S_10814, C_10815);
LA2: ;
}
N_NIMCALL(void, Dooperation_11416)(void* P_11418, NU8 Op_11419) {
TY10402* C_13405;
if (!(P_11418 == NIM_NIL)) goto LA2;
goto BeforeRet;
LA2: ;
C_13405 = 0;
C_13405 = Usrtocell_10822(P_11418);
switch (Op_11419) {
case ((NU8) 0):
(*C_13405).Refcount = (NI32)((NU32)((*C_13405).Refcount) - (NU32)(8));
if (!((NU32)((*C_13405).Refcount) < (NU32)(8))) goto LA5;
Addzct_10811(&Gch_10808.Zct, C_13405);
LA5: ;
break;
case ((NU8) 1):
Add_10458(&Gch_10808.Tempstack, C_13405);
break;
case ((NU8) 2):
(*C_13405).Refcount = (NI32)((NU32)((*C_13405).Refcount) - (NU32)(8));
break;
}
BeforeRet: ;
}
N_NIMCALL(NI, Getdiscriminant_7043)(void* Aa_7045, TNimNode* N_7047) {
NI Result_7048;
NI D_7058;
NI A_7059;
Result_7048 = 0;
D_7058 = 0;
A_7059 = 0;
A_7059 = ((NI) (Aa_7045));
switch ((*(*N_7047).typ).size) {
case 1:
D_7058 = ((NI)(NU)(NU8)((*((NI8*) ((NI32)((NU32)(A_7059) + (NU32)((*N_7047).offset)))))));
break;
case 2:
D_7058 = ((NI)(NU)(NU16)((*((NI16*) ((NI32)((NU32)(A_7059) + (NU32)((*N_7047).offset)))))));
break;
case 4:
D_7058 = ((NI) ((*((int*) ((NI32)((NU32)(A_7059) + (NU32)((*N_7047).offset)))))));
break;
default:
break;
}
Result_7048 = D_7058;
goto BeforeRet;
BeforeRet: ;
return Result_7048;
}
N_NIMCALL(TNimNode*, Selectbranch_7063)(void* Aa_7065, TNimNode* N_7067) {
TNimNode* Result_7069;
NI Discr_7070;
Result_7069 = 0;
Discr_7070 = 0;
Discr_7070 = Getdiscriminant_7043(Aa_7065, N_7067);
if (!((NU32)(Discr_7070) < (NU32)((*N_7067).len))) goto LA2;
Result_7069 = (*N_7067).sons[(Discr_7070)-0];
if (!(Result_7069 == NIM_NIL)) goto LA5;
Result_7069 = (*N_7067).sons[((*N_7067).len)-0];
LA5: ;
goto LA1;
LA2: ;
Result_7069 = (*N_7067).sons[((*N_7067).len)-0];
LA1: ;
return Result_7069;
}
N_NIMCALL(void, Forallslotsaux_12001)(void* Dest_12003, TNimNode* N_12005, NU8 Op_12006) {
NI D_12007;
NI I_12015;
NI HEX3Atmp_19675;
NI Res_19677;
TNimNode* M_12016;
D_12007 = 0;
D_12007 = ((NI) (Dest_12003));
switch ((*N_12005).kind) {
case ((NU8) 0):
break;
case ((NU8) 1):
Forallchildrenaux_11420(((void*) ((NI32)((NU32)(D_12007) + (NU32)((*N_12005).offset)))), (*N_12005).typ, Op_12006);
break;
case ((NU8) 2):
I_12015 = 0;
HEX3Atmp_19675 = 0;
HEX3Atmp_19675 = (NI32)((*N_12005).len - 1);
Res_19677 = 0;
Res_19677 = 0;
while (1) {
if (!(Res_19677 <= HEX3Atmp_19675)) goto LA1;
I_12015 = Res_19677;
Forallslotsaux_12001(Dest_12003, (*N_12005).sons[(I_12015)-0], Op_12006);
Res_19677 += 1;
} LA1: ;
break;
case ((NU8) 3):
M_12016 = 0;
M_12016 = Selectbranch_7063(Dest_12003, N_12005);
if (!!((M_12016 == NIM_NIL))) goto LA3;
Forallslotsaux_12001(Dest_12003, M_12016, Op_12006);
LA3: ;
break;
}
}
N_NIMCALL(void, Forallchildrenaux_11420)(void* Dest_11422, TNimType* Mt_11423, NU8 Op_11424) {
NI D_12033;
NI I_12052;
NI HEX3Atmp_19681;
NI Res_19683;
D_12033 = 0;
D_12033 = ((NI) (Dest_11422));
if (!(Dest_11422 == NIM_NIL)) goto LA2;
goto BeforeRet;
LA2: ;
if (!!((((*Mt_11423).flags &(1<<((((NU8) 0))&7)))!=0))) goto LA5;
switch ((*Mt_11423).kind) {
case ((NU8) 16):
case ((NU8) 4):
case ((NU8) 27):
I_12052 = 0;
HEX3Atmp_19681 = 0;
HEX3Atmp_19681 = (NI32)((NI32)((*Mt_11423).size / (*(*Mt_11423).base).size) - 1);
Res_19683 = 0;
Res_19683 = 0;
while (1) {
if (!(Res_19683 <= HEX3Atmp_19681)) goto LA7;
I_12052 = Res_19683;
Forallchildrenaux_11420(((void*) ((NI32)((NU32)(D_12033) + (NU32)((NI32)((NU32)(I_12052) * (NU32)((*(*Mt_11423).base).size)))))), (*Mt_11423).base, Op_11424);
Res_19683 += 1;
} LA7: ;
break;
case ((NU8) 22):
case ((NU8) 28):
case ((NU8) 24):
Dooperation_11416((*((void**) (D_12033))), Op_11424);
break;
case ((NU8) 17):
case ((NU8) 18):
case ((NU8) 40):
Forallslotsaux_12001(Dest_11422, (*Mt_11423).node, Op_11424);
break;
default:
break;
}
LA5: ;
BeforeRet: ;
}
N_NIMCALL(void, Forallchildren_11412)(TY10402* Cell_11414, NU8 Op_11415) {
void* LOC1;
NI D_12079;
void* LOC2;
TGenericSeq* S_12080;
NI I_12099;
NI HEX3Atmp_19687;
NI Res_19689;
switch ((*(*Cell_11414).Typ).kind) {
case ((NU8) 22):
LOC1 = Celltousr_10818(Cell_11414);
Forallchildrenaux_11420(LOC1, (*(*Cell_11414).Typ).base, Op_11415);
break;
case ((NU8) 24):
D_12079 = 0;
LOC2 = Celltousr_10818(Cell_11414);
D_12079 = ((NI) (LOC2));
S_12080 = 0;
S_12080 = ((TGenericSeq*) (D_12079));
if (!!((S_12080 == NIM_NIL))) goto LA4;
I_12099 = 0;
HEX3Atmp_19687 = 0;
HEX3Atmp_19687 = (NI32)((*S_12080).len - 1);
Res_19689 = 0;
Res_19689 = 0;
while (1) {
if (!(Res_19689 <= HEX3Atmp_19687)) goto LA6;
I_12099 = Res_19689;
Forallchildrenaux_11420(((void*) ((NI32)((NU32)((NI32)((NU32)(D_12079) + (NU32)((NI32)((NU32)(I_12099) * (NU32)((*(*(*Cell_11414).Typ).base).size))))) + (NU32)(8)))), (*(*Cell_11414).Typ).base, Op_11415);
Res_19689 += 1;
} LA6: ;
LA4: ;
break;
case ((NU8) 28):
break;
default:
break;
}
}
N_NIMCALL(void, Collectzct_15401)(TY10790* Gch_15404) {
NI* L_15406;
TY10402* C_15409;
NIM_BOOL LOC6;
L_15406 = 0;
L_15406 = &(*Gch_15404).Zct.Len;
while (1) {
if (!(0 < (*L_15406))) goto LA1;
C_15409 = 0;
C_15409 = (*Gch_15404).Zct.D[(0)-0];
(*C_15409).Refcount = (NI32)((*C_15409).Refcount & -8);
(*Gch_15404).Zct.D[(0)-0] = (*Gch_15404).Zct.D[((NI32)((*L_15406) - 1))-0];
(*L_15406) -= 1;
if (!((NU32)((*C_15409).Refcount) < (NU32)(8))) goto LA3;
LOC6 = Canbecycleroot_10826(C_15409);
if (!LOC6) goto LA7;
Excl_10681(&(*Gch_15404).Cycleroots, C_15409);
LA7: ;
Preparedealloc_11425(C_15409);
Forallchildren_11412(C_15409, ((NU8) 0));
Rawdealloc_9664(&Allocator_8529, ((void*) (C_15409)));
LA3: ;
} LA1: ;
}
N_NIMCALL(void, Init_10488)(TY10414* S_10491) {
void* LOC1;
LOC1 = Alloc0_1777(4096);
(*S_10491).Data = ((TY10410**) (LOC1));
(*S_10491).Max = 1023;
(*S_10491).Counter = 0;
(*S_10491).Head = NIM_NIL;
}
N_NIMCALL(void, Cellsetrawinsert_10533)(TY10414 T_10535, TY10410** Data_10536, TY10410* Desc_10537) {
NI H_10538;
H_10538 = 0;
H_10538 = (NI32)(((NI) ((*Desc_10537).Key)) & T_10535.Max);
while (1) {
if (!!((Data_10536[(H_10538)-0] == NIM_NIL))) goto LA1;
H_10538 = Nexttry_10509(H_10538, T_10535.Max);
} LA1: ;
Data_10536[(H_10538)-0] = Desc_10537;
}
N_NIMCALL(void, Cellsetenlarge_10570)(TY10414* T_10573) {
NI Oldmax_10574;
TY10410** N_10575;
void* LOC1;
NI I_10583;
NI Res_19666;
Oldmax_10574 = 0;
Oldmax_10574 = (*T_10573).Max;
(*T_10573).Max = (NI32)((NI32)((NI32)((*T_10573).Max + 1) * 2) - 1);
N_10575 = 0;
LOC1 = Alloc0_1777((NI32)((NI32)((*T_10573).Max + 1) * 4));
N_10575 = ((TY10410**) (LOC1));
I_10583 = 0;
Res_19666 = 0;
Res_19666 = 0;
while (1) {
if (!(Res_19666 <= Oldmax_10574)) goto LA2;
I_10583 = Res_19666;
if (!!(((*T_10573).Data[(I_10583)-0] == NIM_NIL))) goto LA4;
Cellsetrawinsert_10533((*T_10573), N_10575, (*T_10573).Data[(I_10583)-0]);
LA4: ;
Res_19666 += 1;
} LA2: ;
Dealloc_1784(((void*) ((*T_10573).Data)));
(*T_10573).Data = N_10575;
}
N_NIMCALL(TY10410*, Cellsetput_10595)(TY10414* T_10598, NI Key_10599) {
TY10410* Result_10600;
NI H_10601;
TY10410* X_10602;
NIM_BOOL LOC9;
void* LOC14;
Result_10600 = 0;
H_10601 = 0;
H_10601 = (NI32)(((NI) (Key_10599)) & (*T_10598).Max);
while (1) {
X_10602 = 0;
X_10602 = (*T_10598).Data[(H_10601)-0];
if (!(X_10602 == NIM_NIL)) goto LA3;
goto LA1;
LA3: ;
if (!((*X_10602).Key == Key_10599)) goto LA6;
Result_10600 = X_10602;
goto BeforeRet;
LA6: ;
H_10601 = Nexttry_10509(H_10601, (*T_10598).Max);
} LA1: ;
LOC9 = ((NI32)((NI32)((*T_10598).Max + 1) * 2) < (NI32)((*T_10598).Counter * 3));
if (LOC9) goto LA10;
LOC9 = ((NI32)((NI32)((*T_10598).Max + 1) - (*T_10598).Counter) < 4);
LA10: ;
if (!LOC9) goto LA11;
Cellsetenlarge_10570(T_10598);
LA11: ;
(*T_10598).Counter += 1;
H_10601 = (NI32)(((NI) (Key_10599)) & (*T_10598).Max);
while (1) {
if (!!(((*T_10598).Data[(H_10601)-0] == NIM_NIL))) goto LA13;
H_10601 = Nexttry_10509(H_10601, (*T_10598).Max);
} LA13: ;
LOC14 = Alloc0_1777(((NI)sizeof(TY10410)));
Result_10600 = ((TY10410*) (LOC14));
(*Result_10600).Next = (*T_10598).Head;
(*Result_10600).Key = Key_10599;
(*T_10598).Head = Result_10600;
(*T_10598).Data[(H_10601)-0] = Result_10600;
BeforeRet: ;
return Result_10600;
}
N_NOINLINE(void, Incl_10674)(TY10414* S_10677, TY10402* Cell_10678) {
NI U_10679;
TY10410* T_10680;
U_10679 = 0;
U_10679 = ((NI) (Cell_10678));
T_10680 = 0;
T_10680 = Cellsetput_10595(S_10677, (NI32)((NU32)(U_10679) >> (NU32)(12)));
U_10679 = (NI32)((NU32)((NI32)((NU32)(U_10679) % (NU32)(4096))) / (NU32)(8));
(*T_10680).Bits[((NI32)((NU32)(U_10679) >> (NU32)(5)))-0] = (NI32)((*T_10680).Bits[((NI32)((NU32)(U_10679) >> (NU32)(5)))-0] | (NI32)((NU32)(1) << (NU32)((NI32)(U_10679 & 31))));
}
N_NIMCALL(NIM_BOOL, Containsorincl_10699)(TY10414* S_10702, TY10402* Cell_10703) {
NIM_BOOL Result_10704;
NI U_10705;
TY10410* T_10706;
Result_10704 = 0;
U_10705 = 0;
U_10705 = ((NI) (Cell_10703));
T_10706 = 0;
T_10706 = Cellsetget_10514((*S_10702), (NI32)((NU32)(U_10705) >> (NU32)(12)));
if (!!((T_10706 == NIM_NIL))) goto LA2;
U_10705 = (NI32)((NU32)((NI32)((NU32)(U_10705) % (NU32)(4096))) / (NU32)(8));
Result_10704 = !(((NI32)((*T_10706).Bits[((NI32)((NU32)(U_10705) >> (NU32)(5)))-0] & (NI32)((NU32)(1) << (NU32)((NI32)(U_10705 & 31)))) == 0));
if (!!(Result_10704)) goto LA5;
(*T_10706).Bits[((NI32)((NU32)(U_10705) >> (NU32)(5)))-0] = (NI32)((*T_10706).Bits[((NI32)((NU32)(U_10705) >> (NU32)(5)))-0] | (NI32)((NU32)(1) << (NU32)((NI32)(U_10705 & 31))));
LA5: ;
goto LA1;
LA2: ;
Incl_10674(S_10702, Cell_10703);
Result_10704 = NIM_FALSE;
LA1: ;
return Result_10704;
}
N_NIMCALL(NIM_BOOL, Contains_10654)(TY10414 S_10656, TY10402* Cell_10657) {
NIM_BOOL Result_10658;
NI U_10659;
TY10410* T_10660;
Result_10658 = 0;
U_10659 = 0;
U_10659 = ((NI) (Cell_10657));
T_10660 = 0;
T_10660 = Cellsetget_10514(S_10656, (NI32)((NU32)(U_10659) >> (NU32)(12)));
if (!!((T_10660 == NIM_NIL))) goto LA2;
U_10659 = (NI32)((NU32)((NI32)((NU32)(U_10659) % (NU32)(4096))) / (NU32)(8));
Result_10658 = !(((NI32)((*T_10660).Bits[((NI32)((NU32)(U_10659) >> (NU32)(5)))-0] & (NI32)((NU32)(1) << (NU32)((NI32)(U_10659 & 31)))) == 0));
goto LA1;
LA2: ;
Result_10658 = NIM_FALSE;
LA1: ;
return Result_10658;
}
N_NIMCALL(void, Deinit_10492)(TY10414* S_10495) {
TY10410* It_10496;
TY10410* N_10508;
It_10496 = 0;
It_10496 = (*S_10495).Head;
while (1) {
if (!!((It_10496 == NIM_NIL))) goto LA1;
N_10508 = 0;
N_10508 = (*It_10496).Next;
Dealloc_1784(((void*) (It_10496)));
It_10496 = N_10508;
} LA1: ;
(*S_10495).Head = NIM_NIL;
Dealloc_1784(((void*) ((*S_10495).Data)));
(*S_10495).Data = NIM_NIL;
(*S_10495).Counter = 0;
}
N_NIMCALL(void, Collectcycles_13603)(TY10790* Gch_13606) {
NI Tabsize_13607;
TY10402* C_13608;
TY10414 HEX3Atmp_19701;
TY10410* R_19703;
NI I_19705;
NI W_19707;
NI J_19709;
TY10414 Marker_13623;
TY10402* C_13625;
TY10414 HEX3Atmp_19724;
TY10410* R_19726;
NI I_19728;
NI W_19730;
NI J_19732;
NIM_BOOL LOC17;
TY10402* D_13641;
NIM_BOOL LOC22;
NIM_BOOL LOC24;
TY10402* C_13645;
TY10414 HEX3Atmp_19758;
TY10410* R_19760;
NI I_19762;
NI W_19764;
NI J_19766;
TY10402* D_13660;
NIM_BOOL LOC41;
Tabsize_13607 = 0;
Tabsize_13607 = 0;
C_13608 = 0;
memset((void*)&HEX3Atmp_19701, 0, sizeof(HEX3Atmp_19701));
HEX3Atmp_19701 = (*Gch_13606).Cycleroots;
R_19703 = 0;
R_19703 = HEX3Atmp_19701.Head;
while (1) {
if (!!((R_19703 == NIM_NIL))) goto LA1;
I_19705 = 0;
I_19705 = 0;
while (1) {
if (!(I_19705 <= 15)) goto LA2;
W_19707 = 0;
W_19707 = (*R_19703).Bits[(I_19705)-0];
J_19709 = 0;
J_19709 = 0;
while (1) {
if (!!((W_19707 == 0))) goto LA3;
if (!!(((NI32)(W_19707 & 1) == 0))) goto LA5;
C_13608 = ((TY10402*) ((NI32)((NI32)((NU32)((*R_19703).Key) << (NU32)(12)) | (NI32)((NU32)((NI32)((NU32)((NI32)((NU32)(I_19705) << (NU32)(5))) + (NU32)(J_19709))) * (NU32)(8)))));
Tabsize_13607 += 1;
Forallchildren_11412(C_13608, ((NU8) 2));
LA5: ;
J_19709 += 1;
W_19707 = (NI32)((NU32)(W_19707) >> (NU32)(1));
} LA3: ;
I_19705 += 1;
} LA2: ;
R_19703 = (*R_19703).Next;
} LA1: ;
(*Gch_13606).Stat.Cycletablesize = (((*Gch_13606).Stat.Cycletablesize >= Tabsize_13607) ? (*Gch_13606).Stat.Cycletablesize : Tabsize_13607);
memset((void*)&Marker_13623, 0, sizeof(Marker_13623));
Init_10488(&Marker_13623);
C_13625 = 0;
memset((void*)&HEX3Atmp_19724, 0, sizeof(HEX3Atmp_19724));
HEX3Atmp_19724 = (*Gch_13606).Cycleroots;
R_19726 = 0;
R_19726 = HEX3Atmp_19724.Head;
while (1) {
if (!!((R_19726 == NIM_NIL))) goto LA7;
I_19728 = 0;
I_19728 = 0;
while (1) {
if (!(I_19728 <= 15)) goto LA8;
W_19730 = 0;
W_19730 = (*R_19726).Bits[(I_19728)-0];
J_19732 = 0;
J_19732 = 0;
while (1) {
if (!!((W_19730 == 0))) goto LA9;
if (!!(((NI32)(W_19730 & 1) == 0))) goto LA11;
C_13625 = ((TY10402*) ((NI32)((NI32)((NU32)((*R_19726).Key) << (NU32)(12)) | (NI32)((NU32)((NI32)((NU32)((NI32)((NU32)(I_19728) << (NU32)(5))) + (NU32)(J_19732))) * (NU32)(8)))));
if (!((NU32)(8) <= (NU32)((*C_13625).Refcount))) goto LA14;
LOC17 = Containsorincl_10699(&Marker_13623, C_13625);
if (!!(LOC17)) goto LA18;
(*Gch_13606).Tempstack.Len = 0;
Forallchildren_11412(C_13625, ((NU8) 1));
while (1) {
if (!(0 < (*Gch_13606).Tempstack.Len)) goto LA20;
(*Gch_13606).Tempstack.Len -= 1;
D_13641 = 0;
D_13641 = (*Gch_13606).Tempstack.D[((*Gch_13606).Tempstack.Len)-0];
(*D_13641).Refcount = (NI32)((NU32)((*D_13641).Refcount) + (NU32)(8));
LOC22 = Contains_10654((*Gch_13606).Cycleroots, D_13641);
if (!(LOC22)) goto LA23;
LOC24 = Containsorincl_10699(&Marker_13623, D_13641);
LOC22 = !(LOC24);
LA23: ;
if (!LOC22) goto LA25;
Forallchildren_11412(D_13641, ((NU8) 1));
LA25: ;
} LA20: ;
LA18: ;
LA14: ;
LA11: ;
J_19732 += 1;
W_19730 = (NI32)((NU32)(W_19730) >> (NU32)(1));
} LA9: ;
I_19728 += 1;
} LA8: ;
R_19726 = (*R_19726).Next;
} LA7: ;
C_13645 = 0;
memset((void*)&HEX3Atmp_19758, 0, sizeof(HEX3Atmp_19758));
HEX3Atmp_19758 = (*Gch_13606).Cycleroots;
R_19760 = 0;
R_19760 = HEX3Atmp_19758.Head;
while (1) {
if (!!((R_19760 == NIM_NIL))) goto LA27;
I_19762 = 0;
I_19762 = 0;
while (1) {
if (!(I_19762 <= 15)) goto LA28;
W_19764 = 0;
W_19764 = (*R_19760).Bits[(I_19762)-0];
J_19766 = 0;
J_19766 = 0;
while (1) {
if (!!((W_19764 == 0))) goto LA29;
if (!!(((NI32)(W_19764 & 1) == 0))) goto LA31;
C_13645 = ((TY10402*) ((NI32)((NI32)((NU32)((*R_19760).Key) << (NU32)(12)) | (NI32)((NU32)((NI32)((NU32)((NI32)((NU32)(I_19762) << (NU32)(5))) + (NU32)(J_19766))) * (NU32)(8)))));
if (!((NU32)((*C_13645).Refcount) < (NU32)(8))) goto LA34;
(*Gch_13606).Tempstack.Len = 0;
Forallchildren_11412(C_13645, ((NU8) 1));
while (1) {
if (!(0 < (*Gch_13606).Tempstack.Len)) goto LA36;
(*Gch_13606).Tempstack.Len -= 1;
D_13660 = 0;
D_13660 = (*Gch_13606).Tempstack.D[((*Gch_13606).Tempstack.Len)-0];
if (!((NU32)((*D_13660).Refcount) < (NU32)(8))) goto LA38;
LOC41 = Contains_10654((*Gch_13606).Cycleroots, D_13660);
if (!!(LOC41)) goto LA42;
Addzct_10811(&(*Gch_13606).Zct, D_13660);
LA42: ;
LA38: ;
} LA36: ;
Preparedealloc_11425(C_13645);
Rawdealloc_9664(&Allocator_8529, ((void*) (C_13645)));
LA34: ;
LA31: ;
J_19766 += 1;
W_19764 = (NI32)((NU32)(W_19764) >> (NU32)(1));
} LA29: ;
I_19762 += 1;
} LA28: ;
R_19760 = (*R_19760).Next;
} LA27: ;
Deinit_10492(&(*Gch_13606).Cycleroots);
Init_10488(&(*Gch_13606).Cycleroots);
}
static N_INLINE(void, Rtladdzct_11456)(TY10402* C_11458) {
Addzct_10811(&Gch_10808.Zct, C_11458);
}
static N_INLINE(void, Rtladdcycleroot_11452)(TY10402* C_11454) {
Incl_10674(&Gch_10808.Cycleroots, C_11454);
}
static N_INLINE(void, Decref_11460)(TY10402* C_11462) {
NIM_BOOL LOC4;
(*C_11462).Refcount = (NI32)((NU32)((*C_11462).Refcount) - (NU32)(8));
if (!((NU32)((*C_11462).Refcount) < (NU32)(8))) goto LA2;
Rtladdzct_11456(C_11462);
goto LA1;
LA2: ;
LOC4 = Canbecycleroot_10826(C_11462);
if (!LOC4) goto LA5;
Rtladdcycleroot_11452(C_11462);
goto LA1;
LA5: ;
LA1: ;
}
N_NIMCALL(void, Unmarkstackandregisters_16001)(TY10790* Gch_16004) {
TY10402** D_16005;
NI I_16013;
NI HEX3Atmp_19793;
NI Res_19795;
D_16005 = 0;
D_16005 = (*Gch_16004).Decstack.D;
I_16013 = 0;
HEX3Atmp_19793 = 0;
HEX3Atmp_19793 = (NI32)((*Gch_16004).Decstack.Len - 1);
Res_19795 = 0;
Res_19795 = 0;
while (1) {
if (!(Res_19795 <= HEX3Atmp_19793)) goto LA1;
I_16013 = Res_19795;
Decref_11460(D_16005[(I_16013)-0]);
Res_19795 += 1;
} LA1: ;
(*Gch_16004).Decstack.Len = 0;
}
N_NIMCALL(void, Collectct_11405)(TY10790* Gch_11408) {
NIM_BOOL LOC2;
NIM_BOOL LOC3;
NIM_BOOL LOC5;
NI LOC7;
NI LOC11;
NIM_BOOL LOC13;
NI LOC14;
NI LOC18;
LOC3 = (256 <= (*Gch_11408).Zct.Len);
if (LOC3) goto LA4;
LOC5 = NIM_TRUE;
if (!(LOC5)) goto LA6;
LOC7 = Getoccupiedmem_2004();
LOC5 = (Cyclethreshold_10809 <= LOC7);
LA6: ;
LOC3 = LOC5;
LA4: ;
LOC2 = LOC3;
if (LOC2) goto LA8;
LOC2 = NIM_FALSE;
LA8: ;
if (!LOC2) goto LA9;
LOC11 = Stacksize_15201();
(*Gch_11408).Stat.Maxstacksize = (((*Gch_11408).Stat.Maxstacksize >= LOC11) ? (*Gch_11408).Stat.Maxstacksize : LOC11);
Markstackandregisters_15219(Gch_11408);
Markthreadstacks_14411(Gch_11408);
(*Gch_11408).Stat.Maxstackcells = (((*Gch_11408).Stat.Maxstackcells >= (*Gch_11408).Decstack.Len) ? (*Gch_11408).Stat.Maxstackcells : (*Gch_11408).Decstack.Len);
(*Gch_11408).Stat.Stackscans += 1;
Collectzct_15401(Gch_11408);
LOC14 = Getoccupiedmem_2004();
LOC13 = (Cyclethreshold_10809 <= LOC14);
if (LOC13) goto LA15;
LOC13 = NIM_FALSE;
LA15: ;
if (!LOC13) goto LA16;
Collectcycles_13603(Gch_11408);
Collectzct_15401(Gch_11408);
(*Gch_11408).Stat.Cyclecollections += 1;
LOC18 = Getoccupiedmem_2004();
Cyclethreshold_10809 = ((4194304 >= (NI32)(LOC18 * 2)) ? 4194304 : (NI32)(LOC18 * 2));
(*Gch_11408).Stat.Maxthreshold = (((*Gch_11408).Stat.Maxthreshold >= Cyclethreshold_10809) ? (*Gch_11408).Stat.Maxthreshold : Cyclethreshold_10809);
LA16: ;
Unmarkstackandregisters_16001(Gch_11408);
LA9: ;
}
static N_INLINE(void, Checkcollection_12100)(void) {
if (!(Recgclock_10810 == 0)) goto LA2;
Collectct_11405(&Gch_10808);
LA2: ;
}
N_NIMCALL(void*, newObj)(TNimType* Typ_12107, NI Size_12108) {
void* Result_12109;
TY10402* Res_12123;
void* LOC1;
NI L_12202;
TY10402** D_12203;
NI I_12213;
NI HEX3Atmp_19693;
NI HEX3Atmp_19694;
NI Res_19696;
TY10402* C_12214;
Result_12109 = 0;
Checkcollection_12100();
Res_12123 = 0;
LOC1 = Rawalloc_9395(&Allocator_8529, (NI32)(Size_12108 + ((NI)sizeof(TY10402))));
Res_12123 = ((TY10402*) (LOC1));
zeroMem(((void*) (Res_12123)), (NI32)(Size_12108 + ((NI)sizeof(TY10402))));
(*Res_12123).Typ = Typ_12107;
(*Res_12123).Refcount = 4;
L_12202 = 0;
L_12202 = Gch_10808.Zct.Len;
D_12203 = 0;
D_12203 = Gch_10808.Zct.D;
I_12213 = 0;
HEX3Atmp_19693 = 0;
HEX3Atmp_19694 = 0;
HEX3Atmp_19693 = (NI32)(L_12202 - 1);
HEX3Atmp_19694 = ((0 >= (NI32)(L_12202 - 8)) ? 0 : (NI32)(L_12202 - 8));
Res_19696 = 0;
Res_19696 = HEX3Atmp_19693;
while (1) {
if (!(HEX3Atmp_19694 <= Res_19696)) goto LA3;
I_12213 = Res_19696;
C_12214 = 0;
C_12214 = D_12203[(I_12213)-0];
if (!((NU32)(8) <= (NU32)((*C_12214).Refcount))) goto LA5;
(*C_12214).Refcount = (NI32)((*C_12214).Refcount & -8);
D_12203[(I_12213)-0] = Res_12123;
goto LA2;
LA5: ;
Res_19696 -= 1;
} LA3: ;
Add_10458(&Gch_10808.Zct, Res_12123);
LA2: ;
Result_12109 = Celltousr_10818(Res_12123);
return Result_12109;
}
static N_INLINE(void, asgnRefNoCycle)(void** Dest_11616, void* Src_11617) {
TY10402* C_11618;
TY10402* C_11619;
if (!!((Src_11617 == NIM_NIL))) goto LA2;
C_11618 = 0;
C_11618 = Usrtocell_10822(Src_11617);
(*C_11618).Refcount = (NI32)((NU32)((*C_11618).Refcount) + (NU32)(8));
LA2: ;
if (!!(((*Dest_11616) == NIM_NIL))) goto LA5;
C_11619 = 0;
C_11619 = Usrtocell_10822((*Dest_11616));
(*C_11619).Refcount = (NI32)((NU32)((*C_11619).Refcount) - (NU32)(8));
if (!((NU32)((*C_11619).Refcount) < (NU32)(8))) goto LA8;
Rtladdzct_11456(C_11619);
LA8: ;
LA5: ;
(*Dest_11616) = Src_11617;
}
N_NIMCALL(NimStringDesc*, rawNewString)(NI Space_17087) {
NimStringDesc* Result_17088;
NI S_17089;
void* LOC4;
Result_17088 = 0;
S_17089 = 0;
S_17089 = Space_17087;
if (!(S_17089 < 8)) goto LA2;
S_17089 = 7;
LA2: ;
LOC4 = newObj(&Strdesc_3017, (NI32)(((NI)sizeof(TGenericSeq)) + (NI32)((NI32)(S_17089 + 1) * 1)));
Result_17088 = ((NimStringDesc*) (LOC4));
(*Result_17088).Sup.space = S_17089;
return Result_17088;
}
N_NIMCALL(NimStringDesc*, copyString)(NimStringDesc* Src_17108) {
NimStringDesc* Result_17109;
Result_17109 = 0;
if (!(Src_17108 == NIM_NIL)) goto LA2;
Result_17109 = NIM_NIL;
goto BeforeRet;
LA2: ;
Result_17109 = rawNewString((*Src_17108).Sup.space);
(*Result_17109).Sup.len = (*Src_17108).Sup.len;
memcpy(((NCSTRING) ((*Result_17109).data)), ((NCSTRING) ((*Src_17108).data)), ((int) ((NI32)((NI32)((*Src_17108).Sup.len + 1) * 1))));
BeforeRet: ;
return Result_17109;
}
N_NIMCALL(void, Gcdisable_2663)(void) {
Recgclock_10810 += 1;
}
N_NOINLINE(NIM_BOOL, Isonstack_11409)(void* P_11411) {
NIM_BOOL Result_15211;
TY15204 Stacktop_15214;
NI B_15215;
NI A_15217;
NI X_15218;
NIM_BOOL LOC1;
Result_15211 = 0;
memset((void*)&Stacktop_15214, 0, sizeof(Stacktop_15214));
B_15215 = 0;
B_15215 = ((NI) (Stackbottom_10807));
A_15217 = 0;
A_15217 = ((NI) (&Stacktop_15214[(0)-0]));
X_15218 = 0;
X_15218 = ((NI) (P_11411));
LOC1 = ((NU32)(A_15217) <= (NU32)(X_15218));
if (!(LOC1)) goto LA2;
LOC1 = ((NU32)(X_15218) <= (NU32)(B_15215));
LA2: ;
Result_15211 = LOC1;
return Result_15211;
}
static N_INLINE(void, Incref_11601)(TY10402* C_11603) {
NIM_BOOL LOC2;
(*C_11603).Refcount = (NI32)((NU32)((*C_11603).Refcount) + (NU32)(8));
LOC2 = Canbecycleroot_10826(C_11603);
if (!LOC2) goto LA3;
Rtladdcycleroot_11452(C_11603);
LA3: ;
}
N_NIMCALL(void, unsureAsgnRef)(void** Dest_11622, void* Src_11623) {
NIM_BOOL LOC2;
TY10402* LOC8;
TY10402* LOC12;
LOC2 = Isonstack_11409(((void*) (Dest_11622)));
if (!!(LOC2)) goto LA3;
if (!!((Src_11623 == NIM_NIL))) goto LA6;
LOC8 = Usrtocell_10822(Src_11623);
Incref_11601(LOC8);
LA6: ;
if (!!(((*Dest_11622) == NIM_NIL))) goto LA10;
LOC12 = Usrtocell_10822((*Dest_11622));
Decref_11460(LOC12);
LA10: ;
LA3: ;
(*Dest_11622) = Src_11623;
}
static N_INLINE(NI, Resize_17001)(NI Old_17003) {
NI Result_17004;
Result_17004 = 0;
if (!(Old_17003 <= 0)) goto LA2;
Result_17004 = 4;
goto BeforeRet;
goto LA1;
LA2: ;
if (!(Old_17003 < 65536)) goto LA4;
Result_17004 = (NI32)(Old_17003 * 2);
goto BeforeRet;
goto LA1;
LA4: ;
Result_17004 = (NI32)((NI32)(Old_17003 * 3) / 2);
goto BeforeRet;
LA1: ;
BeforeRet: ;
return Result_17004;
}
N_NIMCALL(void*, Growobj_12606)(void* Old_12608, NI Newsize_12609) {
void* Result_12610;
TY10402* Ol_12611;
TY10402* Res_12636;
void* LOC1;
NI Elemsize_12637;
NI Oldsize_12647;
NI J_12652;
TY10402** D_12653;
NIM_BOOL LOC13;
Result_12610 = 0;
Checkcollection_12100();
Ol_12611 = 0;
Ol_12611 = Usrtocell_10822(Old_12608);
Res_12636 = 0;
LOC1 = Rawalloc_9395(&Allocator_8529, (NI32)(Newsize_12609 + ((NI)sizeof(TY10402))));
Res_12636 = ((TY10402*) (LOC1));
Elemsize_12637 = 0;
Elemsize_12637 = 1;
if (!!(((*(*Ol_12611).Typ).kind == ((NU8) 28)))) goto LA3;
Elemsize_12637 = (*(*(*Ol_12611).Typ).base).size;
LA3: ;
Oldsize_12647 = 0;
Oldsize_12647 = (NI32)((NI32)((*((TGenericSeq*) (Old_12608))).len * Elemsize_12637) + 8);
memcpy(((void*) (Res_12636)), ((void*) (Ol_12611)), (NI32)(Oldsize_12647 + ((NI)sizeof(TY10402))));
zeroMem(((void*) ((NI32)((NU32)((NI32)((NU32)(((NI) (Res_12636))) + (NU32)(Oldsize_12647))) + (NU32)(((NI)sizeof(TY10402)))))), (NI32)(Newsize_12609 - Oldsize_12647));
if (!((NI32)((*Ol_12611).Refcount & 7) == 4)) goto LA6;
J_12652 = 0;
J_12652 = (NI32)(Gch_10808.Zct.Len - 1);
D_12653 = 0;
D_12653 = Gch_10808.Zct.D;
while (1) {
if (!(0 <= J_12652)) goto LA8;
if (!(D_12653[(J_12652)-0] == Ol_12611)) goto LA10;
D_12653[(J_12652)-0] = Res_12636;
goto LA8;
LA10: ;
J_12652 -= 1;
} LA8: ;
LA6: ;
LOC13 = Canbecycleroot_10826(Ol_12611);
if (!LOC13) goto LA14;
Excl_10681(&Gch_10808.Cycleroots, Ol_12611);
LA14: ;
Rawdealloc_9664(&Allocator_8529, ((void*) (Ol_12611)));
Result_12610 = Celltousr_10818(Res_12636);
return Result_12610;
}
N_NIMCALL(NimStringDesc*, resizeString)(NimStringDesc* Dest_17182, NI Addlen_17183) {
NimStringDesc* Result_17184;
NI Sp_17189;
NI LOC4;
void* LOC5;
Result_17184 = 0;
if (!((NI32)((NI32)((*Dest_17182).Sup.len + Addlen_17183) + 1) <= (*Dest_17182).Sup.space)) goto LA2;
Result_17184 = Dest_17182;
goto LA1;
LA2: ;
Sp_17189 = 0;
LOC4 = Resize_17001((*Dest_17182).Sup.space);
Sp_17189 = ((LOC4 >= (NI32)((NI32)((*Dest_17182).Sup.len + Addlen_17183) + 1)) ? LOC4 : (NI32)((NI32)((*Dest_17182).Sup.len + Addlen_17183) + 1));
LOC5 = Growobj_12606(((void*) (Dest_17182)), (NI32)(((NI)sizeof(TGenericSeq)) + (NI32)((NI32)(Sp_17189 + 1) * 1)));
Result_17184 = ((NimStringDesc*) (LOC5));
(*Result_17184).Sup.space = Sp_17189;
LA1: ;
return Result_17184;
}
N_NIMCALL(NimStringDesc*, setLengthStr)(NimStringDesc* S_17225, NI Newlen_17226) {
NimStringDesc* Result_17227;
NI N_17230;
Result_17227 = 0;
N_17230 = 0;
N_17230 = ((Newlen_17226 >= 0) ? Newlen_17226 : 0);
if (!(N_17230 <= (*S_17225).Sup.space)) goto LA2;
Result_17227 = S_17225;
goto LA1;
LA2: ;
Result_17227 = resizeString(S_17225, N_17230);
LA1: ;
(*Result_17227).Sup.len = N_17230;
(*Result_17227).data[(N_17230)-0] = 0;
return Result_17227;
}
static N_INLINE(void, appendString)(NimStringDesc* Dest_17192, NimStringDesc* Src_17193) {
memcpy(((NCSTRING) (&(*Dest_17192).data[((*Dest_17192).Sup.len)-0])), ((NCSTRING) ((*Src_17193).data)), ((int) ((NI32)((NI32)((*Src_17193).Sup.len + 1) * 1))));
(*Dest_17192).Sup.len += (*Src_17193).Sup.len;
}
N_NIMCALL(NimStringDesc*, nimIntToStr)(NI X_17803) {
NimStringDesc* Result_17804;
NI I_17805;
NI Y_17806;
NI D_17807;
NI J_17848;
NI HEX3Atmp_19812;
NI Res_19814;
NIM_CHAR LOC9;
Result_17804 = 0;
Result_17804 = mnewString(16);
I_17805 = 0;
I_17805 = 0;
Y_17806 = 0;
Y_17806 = X_17803;
while (1) {
D_17807 = 0;
D_17807 = (NI32)(Y_17806 / 10);
Result_17804->data[I_17805] = ((NIM_CHAR) (((NI) ((NI32)((NI32)abs(((NI) ((NI32)(Y_17806 - (NI32)(D_17807 * 10))))) + 48)))));
I_17805 += 1;
Y_17806 = D_17807;
if (!(Y_17806 == 0)) goto LA3;
goto LA1;
LA3: ;
} LA1: ;
if (!(X_17803 < 0)) goto LA6;
Result_17804->data[I_17805] = 45;
I_17805 += 1;
LA6: ;
Result_17804 = setLengthStr(Result_17804, I_17805);
J_17848 = 0;
HEX3Atmp_19812 = 0;
HEX3Atmp_19812 = (NI32)((NI32)(I_17805 / 2) - 1);
Res_19814 = 0;
Res_19814 = 0;
while (1) {
if (!(Res_19814 <= HEX3Atmp_19812)) goto LA8;
J_17848 = Res_19814;
LOC9 = Result_17804->data[J_17848];
Result_17804->data[J_17848] = Result_17804->data[(NI32)((NI32)(I_17805 - J_17848) - 1)];
Result_17804->data[(NI32)((NI32)(I_17805 - J_17848) - 1)] = LOC9;
Res_19814 += 1;
} LA8: ;
return Result_17804;
}
N_NIMCALL(NimStringDesc*, addChar)(NimStringDesc* S_1603, NIM_CHAR C_1604) {
NimStringDesc* Result_17165;
void* LOC4;
Result_17165 = 0;
Result_17165 = S_1603;
if (!((*Result_17165).Sup.space <= (*Result_17165).Sup.len)) goto LA2;
(*Result_17165).Sup.space = Resize_17001((*Result_17165).Sup.space);
LOC4 = Growobj_12606(((void*) (Result_17165)), (NI32)(((NI)sizeof(TGenericSeq)) + (NI32)((NI32)((*Result_17165).Sup.space + 1) * 1)));
Result_17165 = ((NimStringDesc*) (LOC4));
LA2: ;
(*Result_17165).data[((*Result_17165).Sup.len)-0] = C_1604;
(*Result_17165).data[((NI32)((*Result_17165).Sup.len + 1))-0] = 0;
(*Result_17165).Sup.len += 1;
return Result_17165;
}
N_NIMCALL(void, Add_2722)(NimStringDesc** X_2725, NCSTRING Y_2726) {
NI I_2727;
I_2727 = 0;
I_2727 = 0;
while (1) {
if (!!(((NU8)(Y_2726[I_2727]) == (NU8)(0)))) goto LA1;
(*X_2725) = addChar((*X_2725), Y_2726[I_2727]);
I_2727 += 1;
} LA1: ;
}
N_NIMCALL(void, Auxwritestacktrace_4684)(TFrame* F_4686, NimStringDesc** S_4688) {
TFrame* It_4690;
NI I_4691;
NI Total_4692;
NIM_BOOL LOC2;
TFrame* B_4730;
NI J_4761;
NI HEX3Atmp_19621;
NI Res_19623;
NIM_BOOL LOC13;
NI J_4834;
NI HEX3Atmp_19634;
NI Res_19636;
NimStringDesc* LOC19;
NI Oldlen_4850;
NimStringDesc* LOC23;
NI K_4866;
NI HEX3Atmp_19628;
NI Res_19630;
It_4690 = 0;
It_4690 = F_4686;
I_4691 = 0;
I_4691 = 0;
Total_4692 = 0;
Total_4692 = 0;
while (1) {
LOC2 = !((It_4690 == NIM_NIL));
if (!(LOC2)) goto LA3;
LOC2 = (I_4691 <= 96);
LA3: ;
if (!LOC2) goto LA1;
Tempframes_4682[(I_4691)-0] = It_4690;
I_4691 += 1;
Total_4692 += 1;
It_4690 = (*It_4690).prev;
} LA1: ;
B_4730 = 0;
B_4730 = It_4690;
while (1) {
if (!!((It_4690 == NIM_NIL))) goto LA4;
Total_4692 += 1;
It_4690 = (*It_4690).prev;
} LA4: ;
J_4761 = 0;
HEX3Atmp_19621 = 0;
HEX3Atmp_19621 = (NI32)((NI32)(Total_4692 - I_4691) - 31);
Res_19623 = 0;
Res_19623 = 1;
while (1) {
if (!(Res_19623 <= HEX3Atmp_19621)) goto LA5;
J_4761 = Res_19623;
if (!!((B_4730 == NIM_NIL))) goto LA7;
B_4730 = (*B_4730).prev;
LA7: ;
Res_19623 += 1;
} LA5: ;
if (!!((Total_4692 == I_4691))) goto LA10;
Tempframes_4682[(I_4691)-0] = NIM_NIL;
I_4691 += 1;
LA10: ;
while (1) {
LOC13 = !((B_4730 == NIM_NIL));
if (!(LOC13)) goto LA14;
LOC13 = (I_4691 <= 127);
LA14: ;
if (!LOC13) goto LA12;
Tempframes_4682[(I_4691)-0] = B_4730;
I_4691 += 1;
B_4730 = (*B_4730).prev;
} LA12: ;
J_4834 = 0;
HEX3Atmp_19634 = 0;
HEX3Atmp_19634 = (NI32)(I_4691 - 1);
Res_19636 = 0;
Res_19636 = HEX3Atmp_19634;
while (1) {
if (!(0 <= Res_19636)) goto LA15;
J_4834 = Res_19636;
if (!(Tempframes_4682[(J_4834)-0] == NIM_NIL)) goto LA17;
(*S_4688) = resizeString((*S_4688), 1);
appendString((*S_4688), ((NimStringDesc*) &TMP19911));
LOC19 = nimIntToStr((NI32)((NI32)(Total_4692 - I_4691) - 1));
(*S_4688) = resizeString((*S_4688), LOC19->Sup.len + 0);
appendString((*S_4688), LOC19);
(*S_4688) = resizeString((*S_4688), 19);
appendString((*S_4688), ((NimStringDesc*) &TMP19912));
goto LA16;
LA17: ;
Oldlen_4850 = 0;
Oldlen_4850 = (*S_4688)->Sup.len;
Add_2722(S_4688, (*Tempframes_4682[(J_4834)-0]).filename);
if (!(0 < (*Tempframes_4682[(J_4834)-0]).line)) goto LA21;
(*S_4688) = addChar((*S_4688), 40);
LOC23 = nimIntToStr((*Tempframes_4682[(J_4834)-0]).line);
(*S_4688) = resizeString((*S_4688), LOC23->Sup.len + 0);
appendString((*S_4688), LOC23);
(*S_4688) = addChar((*S_4688), 41);
LA21: ;
K_4866 = 0;
HEX3Atmp_19628 = 0;
HEX3Atmp_19628 = ((1 >= (NI32)(25 - (NI32)((*S_4688)->Sup.len - Oldlen_4850))) ? 1 : (NI32)(25 - (NI32)((*S_4688)->Sup.len - Oldlen_4850)));
Res_19630 = 0;
Res_19630 = 1;
while (1) {
if (!(Res_19630 <= HEX3Atmp_19628)) goto LA24;
K_4866 = Res_19630;
(*S_4688) = addChar((*S_4688), 32);
Res_19630 += 1;
} LA24: ;
Add_2722(S_4688, (*Tempframes_4682[(J_4834)-0]).procname);
LA16: ;
(*S_4688) = resizeString((*S_4688), Stacktracenewline_4683->Sup.len + 0);
appendString((*S_4688), Stacktracenewline_4683);
Res_19636 -= 1;
} LA15: ;
}
N_NIMCALL(void, Rawwritestacktrace_4867)(NimStringDesc** S_4870) {
if (!(framePtr == NIM_NIL)) goto LA2;
(*S_4870) = resizeString((*S_4870), 28);
appendString((*S_4870), ((NimStringDesc*) &TMP19909));
(*S_4870) = resizeString((*S_4870), Stacktracenewline_4683->Sup.len + 0);
appendString((*S_4870), Stacktracenewline_4683);
goto LA1;
LA2: ;
(*S_4870) = resizeString((*S_4870), 33);
appendString((*S_4870), ((NimStringDesc*) &TMP19910));
(*S_4870) = resizeString((*S_4870), Stacktracenewline_4683->Sup.len + 0);
appendString((*S_4870), Stacktracenewline_4683);
Auxwritestacktrace_4684(framePtr, S_4870);
LA1: ;
}
N_NIMCALL(NimStringDesc*, toNimStr)(NCSTRING Str_17099, NI Len_17100) {
NimStringDesc* Result_17101;
Result_17101 = 0;
Result_17101 = rawNewString(Len_17100);
(*Result_17101).Sup.len = Len_17100;
memcpy(((NCSTRING) ((*Result_17101).data)), Str_17099, ((int) ((NI32)((NI32)(Len_17100 + 1) * 1))));
(*Result_17101).data[(Len_17100)-0] = 0;
return Result_17101;
}
N_NIMCALL(NimStringDesc*, cstrToNimstr)(NCSTRING Str_17104) {
NimStringDesc* Result_17105;
NI LOC1;
Result_17105 = 0;
LOC1 = strlen(Str_17104);
Result_17105 = toNimStr(Str_17104, LOC1);
goto BeforeRet;
BeforeRet: ;
return Result_17105;
}
N_NIMCALL(void, Write_3670)(FILE* F_3672, NCSTRING C_3673) {
fputs(C_3673, F_3672);
}
N_NIMCALL(void, Writetostderr_4432)(NCSTRING Msg_4434) {
Write_3670(stdout, Msg_4434);
}
static N_INLINE(void, Quitordebug_4882)(void) {
exit(1);
}
N_NIMCALL(void, Gcenable_2665)(void) {
if (!(0 < Recgclock_10810)) goto LA2;
Recgclock_10810 -= 1;
LA2: ;
}
N_NIMCALL(void, raiseException)(E_Base* E_4604, NCSTRING Ename_4605) {
NIM_BOOL LOC8;
NimStringDesc* LOC12;
Gcdisable_2663();
(*E_4604).name = Ename_4605;
if (!!((excHandler == NIM_NIL))) goto LA2;
unsureAsgnRef((void**) &(*excHandler).exc, E_4604);
longjmp((*excHandler).context, ((NI32) 1));
goto LA1;
LA2: ;
if (!!(Buf_4677 == 0)) goto LA5;
Buf_4677 = setLengthStr(Buf_4677, 0);
Rawwritestacktrace_4867(&Buf_4677);
LOC8 = !(((*E_4604).message == NIM_NIL));
if (!(LOC8)) goto LA9;
LOC8 = !(((NU8)((*E_4604).message->data[0]) == (NU8)(0)));
LA9: ;
if (!LOC8) goto LA10;
Buf_4677 = resizeString(Buf_4677, 28);
appendString(Buf_4677, ((NimStringDesc*) &TMP19913));
Buf_4677 = resizeString(Buf_4677, (*E_4604).message->Sup.len + 0);
appendString(Buf_4677, (*E_4604).message);
goto LA7;
LA10: ;
Buf_4677 = resizeString(Buf_4677, 26);
appendString(Buf_4677, ((NimStringDesc*) &TMP19914));
LA7: ;
Buf_4677 = resizeString(Buf_4677, 2);
appendString(Buf_4677, ((NimStringDesc*) &TMP19915));
LOC12 = cstrToNimstr(Ename_4605);
Buf_4677 = resizeString(Buf_4677, LOC12->Sup.len + 0);
appendString(Buf_4677, LOC12);
Buf_4677 = resizeString(Buf_4677, 2);
appendString(Buf_4677, ((NimStringDesc*) &TMP19916));
Writetostderr_4432(Buf_4677->data);
goto LA4;
LA5: ;
Writetostderr_4432(Ename_4605);
LA4: ;
Quitordebug_4882();
LA1: ;
Gcenable_2665();
}
N_NIMCALL(void, Write_3658)(FILE* F_3660, NimStringDesc* S_3661) {
NI LOC2;
TY420* E_4263;
LOC2 = Writebuffer_3733(F_3660, ((void*) (S_3661->data)), S_3661->Sup.len);
if (!!((LOC2 == S_3661->Sup.len))) goto LA3;
E_4263 = 0;
E_4263 = (TY420*) newObj(NTI4262, sizeof(TY420));
(*E_4263).Sup.Sup.Sup.Sup.m_type = NTI420;
asgnRefNoCycle((void**) &(*E_4263).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP19908)));
raiseException((E_Base*)E_4263, "EIO");
LA3: ;
}
static N_INLINE(void, rawEcho)(NimStringDesc* X_4094) {
Write_3658(stdout, X_4094);
}
static N_INLINE(void, rawEchoNL)(void) {
Write_3658(stdout, ((NimStringDesc*) &TMP19917));
}
N_NIMCALL(void, Quit_2822)(NimStringDesc* Errormsg_2824) {
rawEcho(Errormsg_2824);
rawEchoNL();
exit(1);
}
N_NIMCALL(void, Raiseoutofmem_7858)(void) {
if (!(Goutofmem_7857 == NIM_NIL)) goto LA2;
Quit_2822(((NimStringDesc*) &TMP19918));
LA2: ;
asgnRefNoCycle((void**) &(*Goutofmem_7857).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP19919)));
raiseException((E_Base*)Goutofmem_7857, "EOutOfMemory");
}
static N_INLINE(void*, Osallocpages_8013)(NI Size_8015) {
void* Result_8016;
NIM_BOOL LOC2;
Result_8016 = 0;
Result_8016 = mmap(NIM_NIL, Size_8015, ((NI32) 3), ((NI32) 34), ((NI32) -1), 0);
LOC2 = (Result_8016 == NIM_NIL);
if (LOC2) goto LA3;
LOC2 = (Result_8016 == ((void*) -1));
LA3: ;
if (!LOC2) goto LA4;
Raiseoutofmem_7858();
LA4: ;
return Result_8016;
}
static N_INLINE(void, Inccurrmem_8486)(TY8474* A_8489, NI Bytes_8490) {
(*A_8489).Currmem += Bytes_8490;
}
N_NIMCALL(void*, Llalloc_8530)(TY8474* A_8533, NI Size_8534) {
void* Result_8535;
NIM_BOOL LOC2;
NI Request_8549;
void* LOC6;
Result_8535 = 0;
LOC2 = ((*A_8533).Llmem == NIM_NIL);
if (LOC2) goto LA3;
LOC2 = ((*(*A_8533).Llmem).Size < Size_8534);
LA3: ;
if (!LOC2) goto LA4;
Request_8549 = 0;
Request_8549 = Roundup_8456((NI32)(Size_8534 + ((NI)sizeof(TY8472))), 4096);
LOC6 = Osallocpages_8013(Request_8549);
(*A_8533).Llmem = ((TY8472*) (LOC6));
Inccurrmem_8486(A_8533, Request_8549);
(*(*A_8533).Llmem).Size = (NI32)(Request_8549 - ((NI)sizeof(TY8472)));
(*(*A_8533).Llmem).Acc = ((NI)sizeof(TY8472));
LA4: ;
Result_8535 = ((void*) ((NI32)(((NI) ((*A_8533).Llmem)) + (*(*A_8533).Llmem).Acc)));
(*(*A_8533).Llmem).Size -= Size_8534;
(*(*A_8533).Llmem).Acc += Size_8534;
zeroMem(Result_8535, Size_8534);
return Result_8535;
}
N_NIMCALL(TY8407*, Intsetput_8593)(TY8411* T_8596, NI Key_8597) {
TY8407* Result_8598;
void* LOC4;
Result_8598 = 0;
Result_8598 = Intsetget_8574(&(*T_8596), Key_8597);
if (!(Result_8598 == NIM_NIL)) goto LA2;
LOC4 = Llalloc_8530(&Allocator_8529, ((NI)sizeof(TY8407)));
Result_8598 = ((TY8407*) (LOC4));
(*Result_8598).Next = (*T_8596).Data[((NI32)(Key_8597 & 1023))-0];
(*T_8596).Data[((NI32)(Key_8597 & 1023))-0] = Result_8598;
(*Result_8598).Key = Key_8597;
LA2: ;
return Result_8598;
}
N_NIMCALL(void, Incl_8631)(TY8411* S_8634, NI Key_8635) {
TY8407* T_8636;
NI U_8637;
T_8636 = 0;
T_8636 = Intsetput_8593(S_8634, (NI32)((NU32)(Key_8635) >> (NU32)(9)));
U_8637 = 0;
U_8637 = (NI32)(Key_8635 & 511);
(*T_8636).Bits[((NI32)((NU32)(U_8637) >> (NU32)(5)))-0] = (NI32)((*T_8636).Bits[((NI32)((NU32)(U_8637) >> (NU32)(5)))-0] | (NI32)((NU32)(1) << (NU32)((NI32)(U_8637 & 31))));
}
N_NIMCALL(void, Splitchunk_9266)(TY8474* A_9269, TY8434* C_9270, NI Size_9271) {
TY8434* Rest_9272;
NI LOC1;
Rest_9272 = 0;
Rest_9272 = ((TY8434*) ((NI32)((NU32)(((NI) (C_9270))) + (NU32)(Size_9271))));
(*Rest_9272).Sup.Size = (NI32)((*C_9270).Sup.Size - Size_9271);
(*Rest_9272).Sup.Used = NIM_FALSE;
(*Rest_9272).Next = NIM_NIL;
(*Rest_9272).Prev = NIM_NIL;
(*Rest_9272).Sup.Prevsize = Size_9271;
Updateprevsize_8811(A_9269, C_9270, (*Rest_9272).Sup.Size);
(*C_9270).Sup.Size = Size_9271;
LOC1 = Pageindex_8677(&Rest_9272->Sup);
Incl_8631(&(*A_9269).Chunkstarts, LOC1);
Listadd_9207(&(*A_9269).Freechunkslist, Rest_9272);
}
N_NIMCALL(TY8434*, Requestoschunks_8692)(TY8474* A_8695, NI Size_8696) {
TY8434* Result_8697;
void* LOC1;
NI Nxt_8712;
TY8430* Next_8715;
NI LOC3;
NIM_BOOL LOC4;
NI Prv_8718;
TY8430* Prev_8721;
NIM_BOOL LOC8;
NI LOC9;
Result_8697 = 0;
Inccurrmem_8486(A_8695, Size_8696);
(*A_8695).Freemem += Size_8696;
LOC1 = Osallocpages_8013(Size_8696);
Result_8697 = ((TY8434*) (LOC1));
(*Result_8697).Next = NIM_NIL;
(*Result_8697).Prev = NIM_NIL;
(*Result_8697).Sup.Used = NIM_FALSE;
(*Result_8697).Sup.Size = Size_8696;
Nxt_8712 = 0;
Nxt_8712 = (NI32)((NU32)(((NI) (Result_8697))) + (NU32)(Size_8696));
Next_8715 = 0;
Next_8715 = ((TY8430*) (Nxt_8712));
LOC3 = Pageindex_8677(Next_8715);
LOC4 = Contains_8611(&(*A_8695).Chunkstarts, LOC3);
if (!LOC4) goto LA5;
(*Next_8715).Prevsize = Size_8696;
LA5: ;
Prv_8718 = 0;
Prv_8718 = (NI32)((NU32)(((NI) (Result_8697))) - (NU32)(Lastsize_8691));
Prev_8721 = 0;
Prev_8721 = ((TY8430*) (Prv_8718));
LOC9 = Pageindex_8677(Prev_8721);
LOC8 = Contains_8611(&(*A_8695).Chunkstarts, LOC9);
if (!(LOC8)) goto LA10;
LOC8 = ((*Prev_8721).Size == Lastsize_8691);
LA10: ;
if (!LOC8) goto LA11;
(*Result_8697).Sup.Prevsize = Lastsize_8691;
goto LA7;
LA11: ;
(*Result_8697).Sup.Prevsize = 0;
LA7: ;
Lastsize_8691 = Size_8696;
return Result_8697;
}
N_NIMCALL(TY8434*, Getbigchunk_9292)(TY8474* A_9295, NI Size_9296) {
TY8434* Result_9297;
NI LOC11;
Result_9297 = 0;
Result_9297 = (*A_9295).Freechunkslist;
while (1) {
if (!!((Result_9297 == NIM_NIL))) goto LA2;
if (!((*Result_9297).Sup.Size == Size_9296)) goto LA4;
Listremove_8846(&(*A_9295).Freechunkslist, Result_9297);
goto LA1;
goto LA3;
LA4: ;
if (!(Size_9296 < (*Result_9297).Sup.Size)) goto LA6;
Listremove_8846(&(*A_9295).Freechunkslist, Result_9297);
Splitchunk_9266(A_9295, Result_9297, Size_9296);
goto LA1;
goto LA3;
LA6: ;
LA3: ;
Result_9297 = (*Result_9297).Next;
} LA2: ;
if (!(Size_9296 < 524288)) goto LA9;
Result_9297 = Requestoschunks_8692(A_9295, 524288);
Splitchunk_9266(A_9295, Result_9297, Size_9296);
goto LA8;
LA9: ;
Result_9297 = Requestoschunks_8692(A_9295, Size_9296);
LA8: ;
LA1: ;
(*Result_9297).Sup.Prevsize = 0;
(*Result_9297).Sup.Used = NIM_TRUE;
LOC11 = Pageindex_8677(&Result_9297->Sup);
Incl_8631(&(*A_9295).Chunkstarts, LOC11);
(*A_9295).Freemem -= Size_9296;
return Result_9297;
}
N_NIMCALL(TY8432*, Getsmallchunk_9362)(TY8474* A_9365) {
TY8432* Result_9366;
TY8434* Res_9367;
Result_9366 = 0;
Res_9367 = 0;
Res_9367 = Getbigchunk_9292(A_9365, 4096);
Result_9366 = ((TY8432*) (Res_9367));
return Result_9366;
}
N_NIMCALL(void*, Rawalloc_9395)(TY8474* A_9398, NI Requestedsize_9399) {
void* Result_9400;
NI Size_9405;
NI S_9408;
TY8432* C_9409;
TY8434* C_9636;
Result_9400 = 0;
Size_9405 = 0;
Size_9405 = Roundup_8456(Requestedsize_9399, 8);
if (!(Size_9405 <= (NI32)(4096 - (NI32)(((NI)sizeof(TY8432)) - 8)))) goto LA2;
S_9408 = 0;
S_9408 = (NI32)(Size_9405 / 8);
C_9409 = 0;
C_9409 = (*A_9398).Freesmallchunks[(S_9408)-0];
if (!(C_9409 == NIM_NIL)) goto LA5;
C_9409 = Getsmallchunk_9362(A_9398);
(*C_9409).Freelist = NIM_NIL;
(*C_9409).Sup.Size = Size_9405;
(*C_9409).Acc = Size_9405;
(*C_9409).Free = (NI32)((NI32)(4096 - (NI32)(((NI)sizeof(TY8432)) - 8)) - Size_9405);
(*C_9409).Next = NIM_NIL;
(*C_9409).Prev = NIM_NIL;
Listadd_9426(&(*A_9398).Freesmallchunks[(S_9408)-0], C_9409);
Result_9400 = ((void*) (&(*C_9409).Data));
goto LA4;
LA5: ;
if (!((*C_9409).Freelist == NIM_NIL)) goto LA8;
Result_9400 = ((void*) ((NI32)((NU32)(((NI) (&(*C_9409).Data))) + (NU32)((*C_9409).Acc))));
(*C_9409).Acc += Size_9405;
goto LA7;
LA8: ;
Result_9400 = ((void*) ((*C_9409).Freelist));
(*C_9409).Freelist = (*(*C_9409).Freelist).Next;
LA7: ;
(*C_9409).Free -= Size_9405;
LA4: ;
if (!((*C_9409).Free < Size_9405)) goto LA11;
Listremove_9568(&(*A_9398).Freesmallchunks[(S_9408)-0], C_9409);
LA11: ;
goto LA1;
LA2: ;
Size_9405 = Roundup_8456((NI32)(Requestedsize_9399 + (NI32)(((NI)sizeof(TY8434)) - 8)), 4096);
C_9636 = 0;
C_9636 = Getbigchunk_9292(A_9398, Size_9405);
Result_9400 = ((void*) (&(*C_9636).Data));
LA1: ;
return Result_9400;
}
N_NOCONV(void*, Alloc_1774)(NI Size_1776) {
void* Result_10018;
Result_10018 = 0;
Result_10018 = Rawalloc_9395(&Allocator_8529, (NI32)(Size_1776 + ((NI)sizeof(TY8422))));
(*((TY8422*) (Result_10018))).Zerofield = 1;
Result_10018 = ((void*) ((NI32)((NU32)(((NI) (Result_10018))) + (NU32)(((NI)sizeof(TY8422))))));
return Result_10018;
}
N_NOCONV(void*, Alloc0_1777)(NI Size_1779) {
void* Result_10024;
Result_10024 = 0;
Result_10024 = Alloc_1774(Size_1779);
zeroMem(Result_10024, Size_1779);
return Result_10024;
}
N_NIMCALL(void, Init_10478)(TY10418* S_10481, NI Cap_10482) {
void* LOC1;
(*S_10481).Len = 0;
(*S_10481).Cap = Cap_10482;
LOC1 = Alloc0_1777((NI32)(Cap_10482 * 4));
(*S_10481).D = ((TY10402**) (LOC1));
}
N_NIMCALL(void, Initgc_3011)(void) {
Gch_10808.Stat.Stackscans = 0;
Gch_10808.Stat.Cyclecollections = 0;
Gch_10808.Stat.Maxthreshold = 0;
Gch_10808.Stat.Maxstacksize = 0;
Gch_10808.Stat.Maxstackcells = 0;
Gch_10808.Stat.Cycletablesize = 0;
Init_10478(&Gch_10808.Zct, 1024);
Init_10478(&Gch_10808.Tempstack, 1024);
Init_10488(&Gch_10808.Cycleroots);
Init_10478(&Gch_10808.Decstack, 1024);
asgnRefNoCycle((void**) &Goutofmem_7857, (TY442*) newObj(NTI7861, sizeof(TY442)));
(*Goutofmem_7857).Sup.Sup.Sup.Sup.m_type = NTI442;
}
N_NOCONV(void, signalHandler)(int Sig_5048) {
int S_5049;
S_5049 = 0;
S_5049 = Sig_5048;
Gcdisable_2663();
Buf_4677 = setLengthStr(Buf_4677, 0);
Rawwritestacktrace_4867(&Buf_4677);
if (!(S_5049 == SIGINT)) goto LA2;
Buf_4677 = resizeString(Buf_4677, 31);
appendString(Buf_4677, ((NimStringDesc*) &TMP19925));
goto LA1;
LA2: ;
if (!(S_5049 == SIGSEGV)) goto LA4;
Buf_4677 = resizeString(Buf_4677, 61);
appendString(Buf_4677, ((NimStringDesc*) &TMP19926));
goto LA1;
LA4: ;
if (!(S_5049 == SIGABRT)) goto LA6;
if (!Dbgaborting_5045) goto LA9;
goto BeforeRet;
LA9: ;
Buf_4677 = resizeString(Buf_4677, 31);
appendString(Buf_4677, ((NimStringDesc*) &TMP19927));
goto LA1;
LA6: ;
if (!(S_5049 == SIGFPE)) goto LA11;
Buf_4677 = resizeString(Buf_4677, 26);
appendString(Buf_4677, ((NimStringDesc*) &TMP19928));
goto LA1;
LA11: ;
if (!(S_5049 == SIGILL)) goto LA13;
Buf_4677 = resizeString(Buf_4677, 27);
appendString(Buf_4677, ((NimStringDesc*) &TMP19929));
goto LA1;
LA13: ;
if (!(S_5049 == SIGSEGV)) goto LA15;
Buf_4677 = resizeString(Buf_4677, 60);
appendString(Buf_4677, ((NimStringDesc*) &TMP19930));
goto LA1;
LA15: ;
Buf_4677 = resizeString(Buf_4677, 15);
appendString(Buf_4677, ((NimStringDesc*) &TMP19931));
LA1: ;
Writetostderr_4432(Buf_4677->data);
Dbgaborting_5045 = NIM_TRUE;
Gcenable_2665();
exit(1);
BeforeRet: ;
}
N_NIMCALL(void, registerSignalHandler)(void) {
signal(SIGINT, signalHandler);
signal(SIGSEGV, signalHandler);
signal(SIGABRT, signalHandler);
signal(SIGFPE, signalHandler);
signal(SIGILL, signalHandler);
signal(SIGSEGV, signalHandler);
}
N_NIMCALL(NI, getRefcount)(void* P_10847) {
NI Result_10848;
TY10402* LOC1;
Result_10848 = 0;
LOC1 = Usrtocell_10822(P_10847);
Result_10848 = (NI32)((NU32)(((NI) ((*LOC1).Refcount))) >> (NU32)(3));
return Result_10848;
}
N_NIMCALL(NimStringDesc*, mnewString)(NI Len_17095) {
NimStringDesc* Result_17096;
Result_17096 = 0;
Result_17096 = rawNewString(Len_17095);
(*Result_17096).Sup.len = Len_17095;
return Result_17096;
}
N_NIMCALL(NimStringDesc*, copyStrLast)(NimStringDesc* S_17143, NI Start_17144, NI Last_17145) {
NimStringDesc* Result_17146;
NI Start_17149;
NI Len_17152;
Result_17146 = 0;
Start_17149 = 0;
Start_17149 = ((Start_17144 >= 0) ? Start_17144 : 0);
Len_17152 = 0;
Len_17152 = (NI32)((NI32)(((Last_17145 <= (NI32)((*S_17143).Sup.len - 1)) ? Last_17145 : (NI32)((*S_17143).Sup.len - 1)) - Start_17149) + 1);
if (!(0 < Len_17152)) goto LA2;
Result_17146 = rawNewString(Len_17152);
(*Result_17146).Sup.len = Len_17152;
memcpy(((NCSTRING) ((*Result_17146).data)), ((NCSTRING) (&(*S_17143).data[(Start_17149)-0])), ((int) ((NI32)(Len_17152 * 1))));
(*Result_17146).data[(Len_17152)-0] = 0;
goto LA1;
LA2: ;
Result_17146 = mnewString(0);
LA1: ;
return Result_17146;
}
N_NIMCALL(NimStringDesc*, copyStr)(NimStringDesc* S_17158, NI Start_17159) {
NimStringDesc* Result_17160;
Result_17160 = 0;
Result_17160 = copyStrLast(S_17158, Start_17159, (NI32)((*S_17158).Sup.len - 1));
goto BeforeRet;
BeforeRet: ;
return Result_17160;
}
N_NIMCALL(NimStringDesc*, getCurrentExceptionMsg)(void) {
NimStringDesc* Result_19003;
Result_19003 = 0;
if (!(excHandler == NIM_NIL)) goto LA2;
Result_19003 = copyString(((NimStringDesc*) &TMP19932));
goto BeforeRet;
LA2: ;
Result_19003 = copyString((*(*excHandler).exc).message);
goto BeforeRet;
BeforeRet: ;
return Result_19003;
}
N_NOINLINE(void, raiseOverflow)(void) {
EOverflow* E_5492;
E_5492 = 0;
E_5492 = (EOverflow*) newObj(NTI5491, sizeof(EOverflow));
(*E_5492).Sup.Sup.Sup.Sup.m_type = NTI432;
asgnRefNoCycle((void**) &(*E_5492).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP37440)));
raiseException((E_Base*)E_5492, "EOverflow");
}
static N_INLINE(NI, addInt)(NI A_5603, NI B_5604) {
NI Result_5605;
NIM_BOOL LOC2;
Result_5605 = 0;
Result_5605 = (NI32)((NU32)(A_5603) + (NU32)(B_5604));
LOC2 = (0 <= (NI32)(Result_5605 ^ A_5603));
if (LOC2) goto LA3;
LOC2 = (0 <= (NI32)(Result_5605 ^ B_5604));
LA3: ;
if (!LOC2) goto LA4;
goto BeforeRet;
LA4: ;
raiseOverflow();
BeforeRet: ;
return Result_5605;
}
N_NIMCALL(NI, mulInt)(NI A_6603, NI B_6604) {
NI Result_6605;
NF Resasfloat_6606;
NF Floatprod_6607;
Result_6605 = 0;
Resasfloat_6606 = 0;
Floatprod_6607 = 0;
Result_6605 = (NI32)((NU32)(A_6603) * (NU32)(B_6604));
Floatprod_6607 = (((double) (A_6603)) * ((double) (B_6604)));
Resasfloat_6606 = ((double) (Result_6605));
if (!(Resasfloat_6606 == Floatprod_6607)) goto LA2;
goto BeforeRet;
LA2: ;
if (!((32.0000 * ((Resasfloat_6606 - Floatprod_6607) > 0? ((Resasfloat_6606 - Floatprod_6607)) : -((Resasfloat_6606 - Floatprod_6607)))) <= (Floatprod_6607 > 0? (Floatprod_6607) : -(Floatprod_6607)))) goto LA5;
goto BeforeRet;
LA5: ;
raiseOverflow();
BeforeRet: ;
return Result_6605;
}
N_NIMCALL(void*, newSeq)(TNimType* Typ_12603, NI Len_12604) {
void* Result_12605;
NI LOC1;
NI LOC2;
Result_12605 = 0;
LOC1 = mulInt(Len_12604, (*(*Typ_12603).base).size);
LOC2 = addInt(LOC1, 8);
Result_12605 = newObj(Typ_12603, LOC2);
(*((TGenericSeq*) (Result_12605))).len = Len_12604;
(*((TGenericSeq*) (Result_12605))).space = Len_12604;
return Result_12605;
}
N_NIMCALL(NI, Cmp_1319)(NimStringDesc* X_1321, NimStringDesc* Y_1322) {
NI Result_3319;
int LOC1;
Result_3319 = 0;
LOC1 = strcmp(X_1321->data, Y_1322->data);
Result_3319 = ((NI) (LOC1));
goto BeforeRet;
BeforeRet: ;
return Result_3319;
}
N_NIMCALL(TNimType*, extGetCellType)(void* C_10843) {
TNimType* Result_10844;
TY10402* LOC1;
Result_10844 = 0;
LOC1 = Usrtocell_10822(C_10843);
Result_10844 = (*LOC1).Typ;
return Result_10844;
}
N_NIMCALL(TGenericSeq*, setLengthSeq)(TGenericSeq* Seq_17403, NI Elemsize_17404, NI Newlen_17405) {
TGenericSeq* Result_17406;
NI LOC4;
void* LOC5;
NI I_17420;
NI HEX3Atmp_19805;
NI Res_19807;
TNimType* LOC9;
Result_17406 = 0;
Result_17406 = Seq_17403;
if (!((*Result_17406).space < Newlen_17405)) goto LA2;
LOC4 = Resize_17001((*Result_17406).space);
(*Result_17406).space = ((LOC4 >= Newlen_17405) ? LOC4 : Newlen_17405);
LOC5 = Growobj_12606(((void*) (Result_17406)), (NI32)((NI32)(Elemsize_17404 * (*Result_17406).space) + 8));
Result_17406 = ((TGenericSeq*) (LOC5));
goto LA1;
LA2: ;
if (!(Newlen_17405 < (*Result_17406).len)) goto LA6;
I_17420 = 0;
HEX3Atmp_19805 = 0;
HEX3Atmp_19805 = (NI32)((*Result_17406).len - 1);
Res_19807 = 0;
Res_19807 = Newlen_17405;
while (1) {
if (!(Res_19807 <= HEX3Atmp_19805)) goto LA8;
I_17420 = Res_19807;
LOC9 = extGetCellType(((void*) (Result_17406)));
Forallchildrenaux_11420(((void*) ((NI32)((NU32)((NI32)((NU32)(((NI) (Result_17406))) + (NU32)(8))) + (NU32)((NI32)((NU32)(I_17420) * (NU32)(Elemsize_17404)))))), (*LOC9).base, ((NU8) 0));
Res_19807 += 1;
} LA8: ;
zeroMem(((void*) ((NI32)((NU32)((NI32)((NU32)(((NI) (Result_17406))) + (NU32)(8))) + (NU32)((NI32)((NU32)(Newlen_17405) * (NU32)(Elemsize_17404)))))), (NI32)((NU32)((NI32)((NU32)((*Result_17406).len) - (NU32)(Newlen_17405))) * (NU32)(Elemsize_17404)));
goto LA1;
LA6: ;
LA1: ;
(*Result_17406).len = Newlen_17405;
return Result_17406;
}
N_NIMCALL(void, Objectinitaux_18064)(void* Dest_18066, TNimNode* N_18068) {
NI D_18069;
NI I_18077;
NI HEX3Atmp_19850;
NI Res_19852;
TNimNode* M_18078;
D_18069 = 0;
D_18069 = ((NI) (Dest_18066));
switch ((*N_18068).kind) {
case ((NU8) 0):
break;
case ((NU8) 1):
objectInit(((void*) ((NI32)((NU32)(D_18069) + (NU32)((*N_18068).offset)))), (*N_18068).typ);
break;
case ((NU8) 2):
I_18077 = 0;
HEX3Atmp_19850 = 0;
HEX3Atmp_19850 = (NI32)((*N_18068).len - 1);
Res_19852 = 0;
Res_19852 = 0;
while (1) {
if (!(Res_19852 <= HEX3Atmp_19850)) goto LA1;
I_18077 = Res_19852;
Objectinitaux_18064(Dest_18066, (*N_18068).sons[(I_18077)-0]);
Res_19852 += 1;
} LA1: ;
break;
case ((NU8) 3):
M_18078 = 0;
M_18078 = Selectbranch_7063(Dest_18066, N_18068);
if (!!((M_18078 == NIM_NIL))) goto LA3;
Objectinitaux_18064(Dest_18066, M_18078);
LA3: ;
break;
}
}
N_NIMCALL(void, objectInit)(void* Dest_18062, TNimType* Typ_18063) {
NI D_18094;
TNimType** Pint_18096;
NI I_18104;
NI HEX3Atmp_19856;
NI Res_19858;
D_18094 = 0;
D_18094 = ((NI) (Dest_18062));
switch ((*Typ_18063).kind) {
case ((NU8) 17):
Pint_18096 = 0;
Pint_18096 = ((TNimType**) (Dest_18062));
(*Pint_18096) = Typ_18063;
Objectinitaux_18064(Dest_18062, (*Typ_18063).node);
break;
case ((NU8) 18):
case ((NU8) 40):
Objectinitaux_18064(Dest_18062, (*Typ_18063).node);
break;
case ((NU8) 16):
case ((NU8) 4):
I_18104 = 0;
HEX3Atmp_19856 = 0;
HEX3Atmp_19856 = (NI32)((NI32)((*Typ_18063).size / (*(*Typ_18063).base).size) - 1);
Res_19858 = 0;
Res_19858 = 0;
while (1) {
if (!(Res_19858 <= HEX3Atmp_19856)) goto LA1;
I_18104 = Res_19858;
objectInit(((void*) ((NI32)((NU32)(D_18094) + (NU32)((NI32)(I_18104 * (*(*Typ_18063).base).size))))), (*Typ_18063).base);
Res_19858 += 1;
} LA1: ;
break;
default:
break;
}
}
N_NIMCALL(NIM_BOOL, Open_3617)(FILE** F_3620, NimStringDesc* Filename_3621, NU8 Mode_3622, NI Bufsize_3623) {
NIM_BOOL Result_4112;
void* P_4113;
int LOC5;
TY442* E_4119;
int LOC11;
Result_4112 = 0;
P_4113 = 0;
P_4113 = fopen(Filename_3621->data, Formatopen_4101[(Mode_3622)-0]->data);
Result_4112 = !((P_4113 == NIM_NIL));
(*F_3620) = ((FILE*) (P_4113));
if (!(0 < Bufsize_3623)) goto LA2;
LOC5 = setvbuf((*F_3620), NIM_NIL, _IOFBF, ((int) (Bufsize_3623)));
if (!!((LOC5 == ((NI32) 0)))) goto LA6;
E_4119 = 0;
E_4119 = (TY442*) newObj(NTI7861, sizeof(TY442));
(*E_4119).Sup.Sup.Sup.Sup.m_type = NTI442;
asgnRefNoCycle((void**) &(*E_4119).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP19919)));
raiseException((E_Base*)E_4119, "EOutOfMemory");
LA6: ;
goto LA1;
LA2: ;
if (!(Bufsize_3623 == 0)) goto LA9;
LOC11 = setvbuf((*F_3620), NIM_NIL, _IONBF, ((NI32) 0));
goto LA1;
LA9: ;
LA1: ;
return Result_4112;
}
N_NIMCALL(NI, Readbuffer_3714)(FILE* F_3716, void* Buffer_3717, NI Len_3718) {
NI Result_4199;
Result_4199 = 0;
Result_4199 = fread(Buffer_3717, 1, Len_3718, F_3716);
return Result_4199;
}
N_NIMCALL(void, Rawreadline_3789)(FILE* F_3791, NimStringDesc** Result_3793) {
int C_3794;
(*Result_3793) = setLengthStr((*Result_3793), 0);
while (1) {
C_3794 = 0;
C_3794 = fgetc(F_3791);
if (!(C_3794 < ((NI32) 0))) goto LA3;
goto LA1;
LA3: ;
if (!(C_3794 == ((NI32) 10))) goto LA6;
goto LA1;
LA6: ;
if (!(C_3794 == ((NI32) 13))) goto LA9;
C_3794 = fgetc(F_3791);
if (!!((C_3794 == ((NI32) 10)))) goto LA12;
ungetc(C_3794, F_3791);
LA12: ;
goto LA1;
LA9: ;
(*Result_3793) = addChar((*Result_3793), ((NIM_CHAR) (((NI) (((NI) (C_3794)))))));
} LA1: ;
}
N_NIMCALL(NimStringDesc*, Readline_3679)(FILE* F_3681) {
NimStringDesc* Result_3806;
Result_3806 = 0;
Result_3806 = copyString(((NimStringDesc*) &TMP19932));
Rawreadline_3789(F_3681, &Result_3806);
return Result_3806;
}
N_NIMCALL(NI64, mulInt64)(NI64 A_5579, NI64 B_5580) {
NI64 Result_5581;
NF64 Resasfloat_5582;
NF64 Floatprod_5583;
Result_5581 = 0;
Resasfloat_5582 = 0;
Floatprod_5583 = 0;
Result_5581 = (NI64)((NU64)(A_5579) * (NU64)(B_5580));
Floatprod_5583 = ((double) (A_5579));
Floatprod_5583 = ((NF64) ((((NF) (Floatprod_5583)) * ((NF) (((double) (B_5580)))))));
Resasfloat_5582 = ((double) (Result_5581));
if (!(((NF) (Resasfloat_5582)) == ((NF) (Floatprod_5583)))) goto LA2;
goto BeforeRet;
LA2: ;
if (!((32.0000 * ((((NF) (Resasfloat_5582)) - ((NF) (Floatprod_5583))) > 0? ((((NF) (Resasfloat_5582)) - ((NF) (Floatprod_5583)))) : -((((NF) (Resasfloat_5582)) - ((NF) (Floatprod_5583)))))) <= (((NF) (Floatprod_5583)) > 0? (((NF) (Floatprod_5583))) : -(((NF) (Floatprod_5583)))))) goto LA5;
goto BeforeRet;
LA5: ;
raiseOverflow();
BeforeRet: ;
return Result_5581;
}
N_NIMCALL(TGenericSeq*, incrSeq)(TGenericSeq* Seq_17235, NI Elemsize_17236) {
TGenericSeq* Result_17237;
void* LOC4;
Result_17237 = 0;
Result_17237 = Seq_17235;
if (!((*Result_17237).space <= (*Result_17237).len)) goto LA2;
(*Result_17237).space = Resize_17001((*Result_17237).space);
LOC4 = Growobj_12606(((void*) (Result_17237)), (NI32)((NI32)(Elemsize_17236 * (*Result_17237).space) + 8));
Result_17237 = ((TGenericSeq*) (LOC4));
LA2: ;
(*Result_17237).len += 1;
return Result_17237;
}
N_NIMCALL(NI, Ptrsize_10033)(void* P_10035) {
NI Result_10036;
void* X_10037;
TY8430* LOC1;
Result_10036 = 0;
X_10037 = 0;
X_10037 = ((void*) ((NI32)((NU32)(((NI) (P_10035))) - (NU32)(((NI)sizeof(TY8422))))));
LOC1 = Pageaddr_8685(X_10037);
Result_10036 = (NI32)((*LOC1).Size - ((NI)sizeof(TY8422)));
return Result_10036;
}
N_NOCONV(void*, Realloc_1780)(void* P_1782, NI Newsize_1783) {
void* Result_10042;
NI LOC7;
Result_10042 = 0;
if (!(0 < Newsize_1783)) goto LA2;
Result_10042 = Alloc_1774(Newsize_1783);
if (!!((P_1782 == NIM_NIL))) goto LA5;
LOC7 = Ptrsize_10033(P_1782);
memcpy(Result_10042, P_1782, LOC7);
Dealloc_1784(P_1782);
LA5: ;
goto LA1;
LA2: ;
if (!!((P_1782 == NIM_NIL))) goto LA8;
Dealloc_1784(P_1782);
goto LA1;
LA8: ;
LA1: ;
return Result_10042;
}
N_NIMCALL(NimStringDesc*, nimCharToStr)(NIM_CHAR X_17928) {
NimStringDesc* Result_17929;
Result_17929 = 0;
Result_17929 = mnewString(1);
Result_17929->data[0] = X_17928;
return Result_17929;
}
N_NIMCALL(NimStringDesc*, nimInt64ToStr)(NI64 X_17867) {
NimStringDesc* Result_17868;
NI I_17869;
NI64 Y_17870;
NI64 D_17871;
NI J_17912;
NI HEX3Atmp_19819;
NI Res_19821;
NIM_CHAR LOC9;
Result_17868 = 0;
Result_17868 = mnewString(32);
I_17869 = 0;
I_17869 = 0;
Y_17870 = 0;
Y_17870 = X_17867;
while (1) {
D_17871 = 0;
D_17871 = (NI64)(Y_17870 / 10);
Result_17868->data[I_17869] = ((NIM_CHAR) (((NI) ((NI32)((NI32)abs(((NI) ((NI64)(Y_17870 - (NI64)(D_17871 * 10))))) + 48)))));
I_17869 += 1;
Y_17870 = D_17871;
if (!(Y_17870 == 0)) goto LA3;
goto LA1;
LA3: ;
} LA1: ;
if (!(X_17867 < 0)) goto LA6;
Result_17868->data[I_17869] = 45;
I_17869 += 1;
LA6: ;
Result_17868 = setLengthStr(Result_17868, I_17869);
J_17912 = 0;
HEX3Atmp_19819 = 0;
HEX3Atmp_19819 = (NI32)((NI32)(I_17869 / 2) - 1);
Res_19821 = 0;
Res_19821 = 0;
while (1) {
if (!(Res_19821 <= HEX3Atmp_19819)) goto LA8;
J_17912 = Res_19821;
LOC9 = Result_17868->data[J_17912];
Result_17868->data[J_17912] = Result_17868->data[(NI32)((NI32)(I_17869 - J_17912) - 1)];
Result_17868->data[(NI32)((NI32)(I_17869 - J_17912) - 1)] = LOC9;
Res_19821 += 1;
} LA8: ;
return Result_17868;
}
N_NIMCALL(NimStringDesc*, nimFloatToStr)(NF X_17860) {
NimStringDesc* Result_17861;
TY17862 Buf_17864;
Result_17861 = 0;
memset((void*)&Buf_17864, 0, sizeof(Buf_17864));
sprintf(((NCSTRING) (Buf_17864)), "%#g", X_17860);
Result_17861 = cstrToNimstr(((NCSTRING) (Buf_17864)));
goto BeforeRet;
BeforeRet: ;
return Result_17861;
}
N_NIMCALL(NimStringDesc*, reprEnum)(NI E_18179, TNimType* Typ_18180) {
NimStringDesc* Result_18181;
NimStringDesc* LOC4;
NimStringDesc* LOC5;
Result_18181 = 0;
if (!((NU32)(E_18179) < (NU32)((*(*Typ_18180).node).len))) goto LA2;
Result_18181 = cstrToNimstr((*(*(*Typ_18180).node).sons[(E_18179)-0]).name);
goto LA1;
LA2: ;
LOC5 = nimIntToStr(E_18179);
LOC4 = rawNewString(LOC5->Sup.len + 16);
appendString(LOC4, LOC5);
appendString(LOC4, ((NimStringDesc*) &TMP193760));
Result_18181 = LOC4;
LA1: ;
return Result_18181;
}
N_NIMCALL(NIM_BOOL, Endoffile_3638)(FILE* F_3640) {
NIM_BOOL Result_4069;
int C_4070;
Result_4069 = 0;
C_4070 = 0;
C_4070 = fgetc(F_3640);
ungetc(C_4070, F_3640);
Result_4069 = (C_4070 == ((NI32) -1));
goto BeforeRet;
BeforeRet: ;
return Result_4069;
}
N_NIMCALL(NI64, Getfilepos_3742)(FILE* F_3744) {
NI64 Result_4305;
NI LOC1;
TY420* E_4309;
Result_4305 = 0;
LOC1 = ftell(F_3744);
Result_4305 = ((NI64) (LOC1));
if (!(Result_4305 < 0)) goto LA3;
E_4309 = 0;
E_4309 = (TY420*) newObj(NTI4262, sizeof(TY420));
(*E_4309).Sup.Sup.Sup.Sup.m_type = NTI420;
asgnRefNoCycle((void**) &(*E_4309).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP193863)));
raiseException((E_Base*)E_4309, "EIO");
LA3: ;
return Result_4305;
}
N_NIMCALL(void, Setfilepos_3738)(FILE* F_3740, NI64 Pos_3741) {
NI LOC2;
TY420* E_4286;
LOC2 = fseek(F_3740, ((NI) (Pos_3741)), 0);
if (!!((LOC2 == 0))) goto LA3;
E_4286 = 0;
E_4286 = (TY420*) newObj(NTI4262, sizeof(TY420));
(*E_4286).Sup.Sup.Sup.Sup.m_type = NTI420;
asgnRefNoCycle((void**) &(*E_4286).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP193864)));
raiseException((E_Base*)E_4286, "EIO");
LA3: ;
}
N_NIMCALL(NI64, Getfilesize_3695)(FILE* F_3697) {
NI64 Result_4328;
NI64 Oldpos_4329;
NI LOC1;
Result_4328 = 0;
Oldpos_4329 = 0;
Oldpos_4329 = Getfilepos_3742(F_3697);
LOC1 = fseek(F_3697, 0, 2);
Result_4328 = Getfilepos_3742(F_3697);
Setfilepos_3738(F_3697, Oldpos_4329);
return Result_4328;
}
N_NIMCALL(NimStringDesc*, Readfile_3647)(NimStringDesc* Filename_3649) {
NimStringDesc* Result_4057;
FILE* F_4058;
TSafePoint TMP193862;
NIM_BOOL LOC2;
NI64 volatile Len_4060;
NI LOC9;
Result_4057 = 0;
F_4058 = 0;
TMP193862.prev = excHandler;
excHandler = &TMP193862;
TMP193862.status = setjmp(TMP193862.context);
if (TMP193862.status == 0) {
LOC2 = Open_3617(&F_4058, Filename_3649, ((NU8) 0), -1);
if (!LOC2) goto LA3;
Len_4060 = 0;
Len_4060 = Getfilesize_3695(F_4058);
if (!(Len_4060 < 2147483647)) goto LA6;
Result_4057 = mnewString(((NI) (Len_4060)));
LOC9 = Readbuffer_3714(F_4058, ((void*) (&Result_4057->data[0])), ((NI) (Len_4060)));
if (!!((((NI64) (LOC9)) == Len_4060))) goto LA10;
Result_4057 = copyString(NIM_NIL);
LA10: ;
LA6: ;
fclose(F_4058);
goto LA1;
LA3: ;
Result_4057 = copyString(NIM_NIL);
LA1: ;
} else {
if ((TMP193862.exc->Sup.m_type == NTI420)) {
Result_4057 = copyString(NIM_NIL);
TMP193862.status = 0;}
}
excHandler = excHandler->prev;
if (TMP193862.status != 0) { raiseException(TMP193862.exc, TMP193862.exc->name); }
return Result_4057;
}
N_NIMCALL(void, Genericassignaux_17968)(void* Dest_17970, void* Src_17971, TNimNode* N_17973) {
NI D_17974;
NI S_17975;
NI I_17983;
NI HEX3Atmp_19826;
NI Res_19828;
TNimNode* M_17984;
D_17974 = 0;
D_17974 = ((NI) (Dest_17970));
S_17975 = 0;
S_17975 = ((NI) (Src_17971));
switch ((*N_17973).kind) {
case ((NU8) 0):
break;
case ((NU8) 1):
genericAssign(((void*) ((NI32)((NU32)(D_17974) + (NU32)((*N_17973).offset)))), ((void*) ((NI32)((NU32)(S_17975) + (NU32)((*N_17973).offset)))), (*N_17973).typ);
break;
case ((NU8) 2):
I_17983 = 0;
HEX3Atmp_19826 = 0;
HEX3Atmp_19826 = (NI32)((*N_17973).len - 1);
Res_19828 = 0;
Res_19828 = 0;
while (1) {
if (!(Res_19828 <= HEX3Atmp_19826)) goto LA1;
I_17983 = Res_19828;
Genericassignaux_17968(Dest_17970, Src_17971, (*N_17973).sons[(I_17983)-0]);
Res_19828 += 1;
} LA1: ;
break;
case ((NU8) 3):
memcpy(((void*) ((NI32)((NU32)(D_17974) + (NU32)((*N_17973).offset)))), ((void*) ((NI32)((NU32)(S_17975) + (NU32)((*N_17973).offset)))), (*(*N_17973).typ).size);
M_17984 = 0;
M_17984 = Selectbranch_7063(Src_17971, N_17973);
if (!!((M_17984 == NIM_NIL))) goto LA3;
Genericassignaux_17968(Dest_17970, Src_17971, M_17984);
LA3: ;
break;
}
}
N_NIMCALL(void, genericAssign)(void* Dest_17965, void* Src_17966, TNimType* Mt_17967) {
NI D_18001;
NI S_18002;
void* S2_18014;
TGenericSeq* Seq_18015;
void** X_18016;
void* LOC4;
NI Dst_18017;
NI I_18025;
NI HEX3Atmp_19832;
NI Res_19834;
TGenericSeq* Dstseq_18026;
NI I_18034;
NI HEX3Atmp_19838;
NI Res_19840;
void* S2_18035;
NimStringDesc* LOC10;
void** X_18036;
D_18001 = 0;
D_18001 = ((NI) (Dest_17965));
S_18002 = 0;
S_18002 = ((NI) (Src_17966));
switch ((*Mt_17967).kind) {
case ((NU8) 24):
S2_18014 = 0;
S2_18014 = (*((void**) (Src_17966)));
Seq_18015 = 0;
Seq_18015 = ((TGenericSeq*) (S2_18014));
if (!(S2_18014 == NIM_NIL)) goto LA2;
X_18016 = 0;
X_18016 = ((void**) (Dest_17965));
(*X_18016) = NIM_NIL;
goto BeforeRet;
LA2: ;
LOC4 = newObj(Mt_17967, (NI32)((NI32)((*Seq_18015).len * (*(*Mt_17967).base).size) + 8));
unsureAsgnRef(((void**) (Dest_17965)), LOC4);
Dst_18017 = 0;
Dst_18017 = ((NI) ((*((void**) (Dest_17965)))));
I_18025 = 0;
HEX3Atmp_19832 = 0;
HEX3Atmp_19832 = (NI32)((*Seq_18015).len - 1);
Res_19834 = 0;
Res_19834 = 0;
while (1) {
if (!(Res_19834 <= HEX3Atmp_19832)) goto LA5;
I_18025 = Res_19834;
genericAssign(((void*) ((NI32)((NU32)((NI32)((NU32)(Dst_18017) + (NU32)((NI32)((NU32)(I_18025) * (NU32)((*(*Mt_17967).base).size))))) + (NU32)(8)))), ((void*) ((NI32)((NU32)((NI32)((NU32)(((NI) (S2_18014))) + (NU32)((NI32)((NU32)(I_18025) * (NU32)((*(*Mt_17967).base).size))))) + (NU32)(8)))), (*Mt_17967).base);
Res_19834 += 1;
} LA5: ;
Dstseq_18026 = 0;
Dstseq_18026 = ((TGenericSeq*) (Dst_18017));
(*Dstseq_18026).len = (*Seq_18015).len;
(*Dstseq_18026).space = (*Seq_18015).len;
break;
case ((NU8) 17):
case ((NU8) 18):
case ((NU8) 40):
Genericassignaux_17968(Dest_17965, Src_17966, (*Mt_17967).node);
break;
case ((NU8) 16):
case ((NU8) 4):
I_18034 = 0;
HEX3Atmp_19838 = 0;
HEX3Atmp_19838 = (NI32)((NI32)((*Mt_17967).size / (*(*Mt_17967).base).size) - 1);
Res_19840 = 0;
Res_19840 = 0;
while (1) {
if (!(Res_19840 <= HEX3Atmp_19838)) goto LA6;
I_18034 = Res_19840;
genericAssign(((void*) ((NI32)((NU32)(D_18001) + (NU32)((NI32)((NU32)(I_18034) * (NU32)((*(*Mt_17967).base).size)))))), ((void*) ((NI32)((NU32)(S_18002) + (NU32)((NI32)((NU32)(I_18034) * (NU32)((*(*Mt_17967).base).size)))))), (*Mt_17967).base);
Res_19840 += 1;
} LA6: ;
break;
case ((NU8) 28):
S2_18035 = 0;
S2_18035 = (*((void**) (S_18002)));
if (!!((S2_18035 == NIM_NIL))) goto LA8;
LOC10 = copyString(((NimStringDesc*) (S2_18035)));
unsureAsgnRef(((void**) (Dest_17965)), ((void*) (LOC10)));
goto LA7;
LA8: ;
X_18036 = 0;
X_18036 = ((void**) (Dest_17965));
(*X_18036) = NIM_NIL;
goto BeforeRet;
LA7: ;
break;
case ((NU8) 22):
unsureAsgnRef(((void**) (Dest_17965)), (*((void**) (S_18002))));
break;
default:
memcpy(Dest_17965, Src_17966, (*Mt_17967).size);
break;
}
BeforeRet: ;
}
N_NIMCALL(void, genericSeqAssign)(void* Dest_18039, void* Src_18040, TNimType* Mt_18041) {
void* Src_18042;
Src_18042 = 0;
Src_18042 = Src_18040;
genericAssign(Dest_18039, ((void*) (&Src_18042)), Mt_18041);
}
N_NIMCALL(NimStringDesc*, Gcgetstatistics_2682)(void) {
NimStringDesc* Result_16244;
NimStringDesc* LOC1;
NI LOC2;
NimStringDesc* LOC3;
NI LOC4;
NimStringDesc* LOC5;
NimStringDesc* LOC6;
NimStringDesc* LOC7;
NimStringDesc* LOC8;
NimStringDesc* LOC9;
NimStringDesc* LOC10;
NimStringDesc* LOC11;
NimStringDesc* LOC12;
Result_16244 = 0;
Gcdisable_2663();
LOC2 = Gettotalmem_2008();
LOC3 = nimIntToStr(LOC2);
LOC4 = Getoccupiedmem_2004();
LOC5 = nimIntToStr(LOC4);
LOC6 = nimIntToStr(Gch_10808.Stat.Stackscans);
LOC7 = nimIntToStr(Gch_10808.Stat.Maxstackcells);
LOC8 = nimIntToStr(Gch_10808.Stat.Cyclecollections);
LOC9 = nimIntToStr(Gch_10808.Stat.Maxthreshold);
LOC10 = nimIntToStr(Gch_10808.Zct.Cap);
LOC11 = nimIntToStr(Gch_10808.Stat.Cycletablesize);
LOC12 = nimIntToStr(Gch_10808.Stat.Maxstacksize);
LOC1 = rawNewString(LOC3->Sup.len + LOC5->Sup.len + LOC6->Sup.len + LOC7->Sup.len + LOC8->Sup.len + LOC9->Sup.len + LOC10->Sup.len + LOC11->Sup.len + LOC12->Sup.len + 196);
appendString(LOC1, ((NimStringDesc*) &TMP195481));
appendString(LOC1, LOC3);
appendString(LOC1, ((NimStringDesc*) &TMP195482));
appendString(LOC1, LOC5);
appendString(LOC1, ((NimStringDesc*) &TMP195483));
appendString(LOC1, LOC6);
appendString(LOC1, ((NimStringDesc*) &TMP195484));
appendString(LOC1, LOC7);
appendString(LOC1, ((NimStringDesc*) &TMP195485));
appendString(LOC1, LOC8);
appendString(LOC1, ((NimStringDesc*) &TMP195486));
appendString(LOC1, LOC9);
appendString(LOC1, ((NimStringDesc*) &TMP195487));
appendString(LOC1, LOC10);
appendString(LOC1, ((NimStringDesc*) &TMP195488));
appendString(LOC1, LOC11);
appendString(LOC1, ((NimStringDesc*) &TMP195489));
appendString(LOC1, LOC12);
Result_16244 = LOC1;
Gcenable_2665();
return Result_16244;
}
N_NIMCALL(void, Listremove_8846)(TY8434** Head_8850, TY8434* C_8851) {
if (!(C_8851 == (*Head_8850))) goto LA2;
(*Head_8850) = (*C_8851).Next;
if (!!(((*Head_8850) == NIM_NIL))) goto LA5;
(*(*Head_8850)).Prev = NIM_NIL;
LA5: ;
goto LA1;
LA2: ;
(*(*C_8851).Prev).Next = (*C_8851).Next;
if (!!(((*C_8851).Next == NIM_NIL))) goto LA8;
(*(*C_8851).Next).Prev = (*C_8851).Prev;
LA8: ;
LA1: ;
(*C_8851).Next = NIM_NIL;
(*C_8851).Prev = NIM_NIL;
}
N_NIMCALL(void, Listadd_9426)(TY8432** Head_9430, TY8432* C_9431) {
(*C_9431).Next = (*Head_9430);
if (!!(((*Head_9430) == NIM_NIL))) goto LA2;
(*(*Head_9430)).Prev = C_9431;
LA2: ;
(*Head_9430) = C_9431;
}
N_NIMCALL(void, Listremove_9568)(TY8432** Head_9572, TY8432* C_9573) {
if (!(C_9573 == (*Head_9572))) goto LA2;
(*Head_9572) = (*C_9573).Next;
if (!!(((*Head_9572) == NIM_NIL))) goto LA5;
(*(*Head_9572)).Prev = NIM_NIL;
LA5: ;
goto LA1;
LA2: ;
(*(*C_9573).Prev).Next = (*C_9573).Next;
if (!!(((*C_9573).Next == NIM_NIL))) goto LA8;
(*(*C_9573).Next).Prev = (*C_9573).Prev;
LA8: ;
LA1: ;
(*C_9573).Next = NIM_NIL;
(*C_9573).Prev = NIM_NIL;
}
N_NIMCALL(void, Listadd_9207)(TY8434** Head_9211, TY8434* C_9212) {
(*C_9212).Next = (*Head_9211);
if (!!(((*Head_9211) == NIM_NIL))) goto LA2;
(*(*Head_9211)).Prev = C_9212;
LA2: ;
(*Head_9211) = C_9212;
}
N_NOINLINE(void, systemInit)(void) {
Dbglinehook_2721 = ((TY2718) (NIM_NIL));
Strdesc_3017.size = 4;
Strdesc_3017.kind = ((NU8) 28);
Strdesc_3017.flags = 2;
Initstackbottom_3013();
Initgc_3011();
excHandler = NIM_NIL;
asgnRefNoCycle((void**) &Stacktracenewline_4683, copyString(((NimStringDesc*) &TMP19917)));
registerSignalHandler();
asgnRefNoCycle((void**) &Gassertionfailed_5021, (EAssertionFailed*) newObj(NTI5020, sizeof(EAssertionFailed)));
(*Gassertionfailed_5021).Sup.Sup.Sup.m_type = NTI436;
asgnRefNoCycle((void**) &Buf_4677, mnewString(2048));
asgnRefNoCycle((void**) &Assertbuf_4678, mnewString(2048));
Buf_4677 = setLengthStr(Buf_4677, 0);
Assertbuf_4678 = setLengthStr(Assertbuf_4678, 0);
Lastsize_8691 = 4096;
Cyclethreshold_10809 = 4194304;
Recgclock_10810 = 0;
}

