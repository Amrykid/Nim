/* Generated by Nimrod Compiler v0.8.11 */
/*   (c) 2011 Andreas Rumpf */

typedef long long int NI;
typedef unsigned long long int NU;
#include "nimbase.h"

#include <windows.h>
#include <errno.h>
#include <io.h>
#include <fcntl.h>
#include <signal.h>
typedef struct TNimType TNimType;
typedef struct TNimNode TNimNode;
typedef struct TY10590 TY10590;
typedef struct TY10218 TY10218;
typedef struct TY10202 TY10202;
typedef struct TY10214 TY10214;
typedef struct TY10210 TY10210;
typedef struct TY10588 TY10588;
typedef struct TY8274 TY8274;
typedef struct TY8232 TY8232;
typedef struct TY8230 TY8230;
typedef struct TY8222 TY8222;
typedef struct TY8272 TY8272;
typedef struct TY8234 TY8234;
typedef struct TY8211 TY8211;
typedef struct TY8207 TY8207;
typedef struct NimStringDesc NimStringDesc;
typedef struct TGenericSeq TGenericSeq;
typedef struct TY420 TY420;
typedef struct TY418 TY418;
typedef struct TY416 TY416;
typedef struct E_Base E_Base;
typedef struct TNimObject TNimObject;
typedef struct TSafePoint TSafePoint;
typedef struct TY442 TY442;
typedef struct EAssertionFailed EAssertionFailed;
typedef struct EOverflow EOverflow;
typedef struct TY428 TY428;
typedef struct TY452 TY452;
typedef N_NIMCALL_PTR(void, TY2719) (void);
struct TNimType {
NI size;
NU8 kind;
NU8 flags;
TNimType* base;
TNimNode* node;
void* finalizer;
};
struct TY10218 {
NI Len;
NI Cap;
TY10202** D;
};
struct TY10214 {
NI Counter;
NI Max;
TY10210* Head;
TY10210** Data;
};
struct TY10588 {
NI Stackscans;
NI Cyclecollections;
NI Maxthreshold;
NI Maxstacksize;
NI Maxstackcells;
NI Cycletablesize;
};
struct TY10590 {
TY10218 Zct;
TY10218 Decstack;
TY10214 Cycleroots;
TY10218 Tempstack;
TY10588 Stat;
};
struct TY8230 {
NI Prevsize;
NI Size;
NIM_BOOL Used;
};
struct TY8232 {
  TY8230 Sup;
TY8232* Next;
TY8232* Prev;
TY8222* Freelist;
NI Free;
NI Acc;
NF64 Data;
};
typedef TY8232* TY8281[512];
typedef TY8207* TY8209[1024];
struct TY8211 {
TY8209 Data;
};
struct TY8274 {
TY8272* Llmem;
NI Currmem;
NI Maxmem;
NI Freemem;
TY8281 Freesmallchunks;
TY8234* Freechunkslist;
TY8211 Chunkstarts;
};
struct TY8234 {
  TY8230 Sup;
TY8234* Next;
TY8234* Prev;
NI Align;
NF64 Data;
};
typedef NI TY8214[8];
struct TY8207 {
TY8207* Next;
NI Key;
TY8214 Bits;
};
struct TY8272 {
NI Size;
NI Acc;
};
struct TGenericSeq {
NI len;
NI space;
};
typedef NIM_CHAR TY239[100000001];
struct NimStringDesc {
  TGenericSeq Sup;
TY239 data;
};
struct TNimNode {
NU8 kind;
NI offset;
TNimType* typ;
NCSTRING name;
NI len;
TNimNode** sons;
};
struct TNimObject {
TNimType* m_type;
};
struct E_Base {
  TNimObject Sup;
E_Base* parent;
NCSTRING name;
NimStringDesc* message;
};
struct TY416 {
  E_Base Sup;
};
struct TY418 {
  TY416 Sup;
};
struct TY420 {
  TY418 Sup;
};
struct TY10202 {
NI Refcount;
TNimType* Typ;
};
struct TY8222 {
TY8222* Next;
NI Zerofield;
};
struct TY10210 {
TY10210* Next;
NI Key;
TY8214 Bits;
};
typedef N_NIMCALL_PTR(void, TFinalizer) (void* Self_10594);
struct TSafePoint {
TSafePoint* prev;
NI status;
E_Base* exc;
jmp_buf context;
};
struct TY442 {
  TY418 Sup;
};
typedef NimStringDesc* TY4102[5];
typedef TFrame* TY4803[128];
struct EAssertionFailed {
  TY416 Sup;
};
struct TY428 {
  TY416 Sup;
};
struct EOverflow {
  TY428 Sup;
};
struct TY452 {
  TY416 Sup;
};
typedef NIM_CHAR TY18862[60];
static N_INLINE(void, Initstackbottom_3013)(void);
N_NOINLINE(void, setStackBottom)(void* Thestackbottom_1624);
N_NIMCALL(void, Initgc_3011)(void);
N_NIMCALL(void, Init_10278)(TY10218* S_10281, NI Cap_10282);
N_NOCONV(void*, Alloc0_1953)(NI Size_1955);
N_NOCONV(void*, Alloc_1950)(NI Size_1952);
N_NIMCALL(void*, Rawalloc_9195)(TY8274* A_9198, NI Requestedsize_9199);
static N_INLINE(NI, Roundup_8256)(NI X_8258, NI V_8259);
N_NIMCALL(TY8232*, Getsmallchunk_9162)(TY8274* A_9165);
N_NIMCALL(TY8234*, Getbigchunk_9092)(TY8274* A_9095, NI Size_9096);
N_NIMCALL(void, Splitchunk_9066)(TY8274* A_9069, TY8234* C_9070, NI Size_9071);
static N_INLINE(void, Updateprevsize_8611)(TY8274* A_8614, TY8234* C_8615, NI Prevsize_8616);
static N_INLINE(NIM_BOOL, Isaccessible_8552)(void* P_8554);
N_NIMCALL(NIM_BOOL, Contains_8411)(TY8211* S_8413, NI Key_8414);
N_NIMCALL(TY8207*, Intsetget_8374)(TY8211* T_8376, NI Key_8377);
static N_INLINE(NI, Pageindex_8481)(void* P_8483);
N_NIMCALL(void, Incl_8431)(TY8211* S_8434, NI Key_8435);
N_NIMCALL(TY8207*, Intsetput_8393)(TY8211* T_8396, NI Key_8397);
N_NIMCALL(void*, Llalloc_8330)(TY8274* A_8333, NI Size_8334);
static N_INLINE(void*, Osallocpages_7871)(NI Size_7873);
N_NIMCALL(void, Raiseoutofmem_7841)(void);
N_NIMCALL(void, Quit_2821)(NimStringDesc* Errormsg_2823);
static N_INLINE(void, rawEcho)(NimStringDesc* X_4094);
N_NIMCALL(void, Write_3658)(FILE* F_3660, NimStringDesc* S_3661);
N_NIMCALL(NI, Writebuffer_3733)(FILE* F_3735, void* Buffer_3736, NI Len_3737);
N_NIMCALL(void*, newObj)(TNimType* Typ_13307, NI Size_13308);
static N_INLINE(void, Aquire_10611)(TY10590* Gch_10614);
static N_INLINE(void, Checkcollection_13300)(void);
N_NIMCALL(void, Collectct_11605)(TY10590* Gch_11608);
N_NIMCALL(NI, Getoccupiedmem_2017)(void);
N_NIMCALL(NI, Gettotalmem_2021)(void);
N_NIMCALL(NI, Getfreemem_2019)(void);
N_NOINLINE(NI, Stacksize_16401)(void);
N_CDECL(void, Markstackandregisters_16415)(TY10590* Gch_16418);
static N_INLINE(void, Gcmark_15603)(void* P_15605);
static N_INLINE(TY10202*, Usrtocell_11012)(void* Usr_11014);
N_NIMCALL(NIM_BOOL, Isallocatedptr_9801)(TY8274* A_9803, void* P_9804);
static N_INLINE(TY8230*, Pageaddr_8485)(void* P_8487);
static N_INLINE(NIM_BOOL, Chunkunused_8607)(TY8230* C_8609);
static N_INLINE(NIM_BOOL, Issmallchunk_8601)(TY8230* C_8603);
static N_INLINE(void, Add_10258)(TY10218* S_10261, TY10202* C_10262);
N_NOCONV(void, Dealloc_1960)(void* P_1962);
N_NIMCALL(void, Rawdealloc_9464)(TY8274* A_9467, void* P_9468);
N_NIMCALL(void, Freebigchunk_8620)(TY8274* A_8623, TY8234* C_8624);
N_NIMCALL(void, Excl_8438)(TY8211* S_8441, NI Key_8442);
static N_INLINE(NI, Pageindex_8477)(TY8230* C_8479);
N_NIMCALL(void, Freeoschunks_8526)(TY8274* A_8529, void* P_8530, NI Size_8531);
static N_INLINE(void, Osdeallocpages_7875)(void* P_7877, NI Size_7878);
static N_INLINE(void, Deccurrmem_8303)(TY8274* A_8306, NI Bytes_8307);
N_NIMCALL(void, Markthreadstacks_15611)(TY10590* Gch_15614);
N_NIMCALL(void, Collectzct_16601)(TY10590* Gch_16604);
static N_INLINE(NIM_BOOL, Canbecycleroot_11016)(TY10202* C_11018);
N_NIMCALL(void, Excl_10481)(TY10214* S_10484, TY10202* Cell_10485);
N_NIMCALL(TY10210*, Cellsetget_10314)(TY10214* T_10316, NI Key_10317);
static N_INLINE(NI, Nexttry_10309)(NI H_10311, NI Maxhash_10312);
N_NIMCALL(void, Preparedealloc_11625)(TY10202* Cell_11627);
static N_INLINE(void*, Celltousr_11008)(TY10202* Cell_11010);
N_NIMCALL(void, Forallchildren_11612)(TY10202* Cell_11614, NU8 Op_11615);
N_NIMCALL(void, Forallchildrenaux_11620)(void* Dest_11622, TNimType* Mt_11623, NU8 Op_11624);
N_NIMCALL(void, Dooperation_11616)(void* P_11618, NU8 Op_11619);
N_NOINLINE(void, Addzct_11001)(TY10218* S_11004, TY10202* C_11005);
N_NIMCALL(void, Forallslotsaux_13201)(void* Dest_13203, TNimNode* N_13205, NU8 Op_13206);
N_NIMCALL(TNimNode*, Selectbranch_7263)(void* Aa_7265, TNimNode* N_7267);
N_NIMCALL(NI, Getdiscriminant_7243)(void* Aa_7245, TNimNode* N_7247);
N_NIMCALL(void, Collectcycles_14803)(TY10590* Gch_14806);
N_NIMCALL(void, Init_10288)(TY10214* S_10291);
N_NIMCALL(NIM_BOOL, Containsorincl_10499)(TY10214* S_10502, TY10202* Cell_10503);
N_NOINLINE(void, Incl_10474)(TY10214* S_10477, TY10202* Cell_10478);
N_NIMCALL(TY10210*, Cellsetput_10395)(TY10214* T_10398, NI Key_10399);
N_NIMCALL(void, Cellsetenlarge_10370)(TY10214* T_10373);
N_NIMCALL(void, Cellsetrawinsert_10333)(TY10214* T_10335, TY10210** Data_10336, TY10210* Desc_10337);
N_NIMCALL(NIM_BOOL, Contains_10454)(TY10214* S_10456, TY10202* Cell_10457);
N_NIMCALL(void, Deinit_10292)(TY10214* S_10295);
N_NIMCALL(void, Unmarkstackandregisters_17201)(TY10590* Gch_17204);
static N_INLINE(void, Decref_12401)(TY10202* C_12403);
static N_INLINE(NI, Atomicdec_3006)(NI* Memloc_3009, NI X_3010);
static N_INLINE(void, Rtladdzct_12001)(TY10202* C_12003);
static N_INLINE(void, Rtladdcycleroot_11652)(TY10202* C_11654);
static N_INLINE(void, Release_10801)(TY10590* Gch_10804);
static N_INLINE(void, asgnRefNoCycle)(void** Dest_12618, void* Src_12619);
static N_INLINE(NI, Atomicinc_3001)(NI* Memloc_3004, NI X_3005);
N_NIMCALL(NimStringDesc*, copyString)(NimStringDesc* Src_18108);
N_NIMCALL(NimStringDesc*, rawNewString)(NI Space_18087);
N_NIMCALL(void, raiseException)(E_Base* E_5204, NCSTRING Ename_5205);
N_NIMCALL(void, Gcdisable_2663)(void);
static N_INLINE(void, pushCurrentException)(E_Base* E_4641);
static N_INLINE(void, asgnRef)(void** Dest_12614, void* Src_12615);
static N_INLINE(void, Incref_12602)(TY10202* C_12604);
N_NIMCALL(NimStringDesc*, setLengthStr)(NimStringDesc* S_18225, NI Newlen_18226);
N_NIMCALL(NimStringDesc*, resizeString)(NimStringDesc* Dest_18182, NI Addlen_18183);
static N_INLINE(NI, Resize_18001)(NI Old_18003);
N_NIMCALL(void*, Growobj_13807)(void* Old_13809, NI Newsize_13810);
N_NIMCALL(void, Rawwritestacktrace_4989)(NimStringDesc** S_4992);
static N_INLINE(void, appendString)(NimStringDesc* Dest_18192, NimStringDesc* Src_18193);
N_NIMCALL(NimStringDesc*, cstrToNimstr)(NCSTRING Str_18104);
N_NIMCALL(NimStringDesc*, toNimStr)(NCSTRING Str_18099, NI Len_18100);
N_NIMCALL(void, Writetostderr_4417)(NCSTRING Msg_4419);
N_NIMCALL(void, Write_3670)(FILE* F_3672, NCSTRING C_3673);
static N_INLINE(void, Quitordebug_5001)(void);
N_NIMCALL(void, Gcenable_2665)(void);
static N_INLINE(void, rawEchoNL)(void);
static N_INLINE(void, Inccurrmem_8286)(TY8274* A_8289, NI Bytes_8290);
N_NIMCALL(TY8234*, Requestoschunks_8492)(TY8274* A_8495, NI Size_8496);
N_NOCONV(void, signalHandler)(NI32 Sig_5278);
N_NIMCALL(void, registerSignalHandler)(void);
N_NIMCALL(NimStringDesc*, mnewString)(NI Len_1349);
N_NIMCALL(NI, getRefcount)(void* P_11037);
N_NIMCALL(NimStringDesc*, mnewString)(NI Len_18095);
N_NIMCALL(NimStringDesc*, copyStrLast)(NimStringDesc* S_18143, NI Start_18144, NI Last_18145);
N_NIMCALL(NimStringDesc*, copyStr)(NimStringDesc* S_18158, NI Start_18159);
static N_INLINE(NI, addInt)(NI A_5803, NI B_5804);
N_NOINLINE(void, raiseOverflow)(void);
N_NIMCALL(NI, mulInt)(NI A_6803, NI B_6804);
N_NOINLINE(NIM_BOOL, Isonstack_11609)(void* P_11611);
N_NIMCALL(TNimType*, extGetCellType)(void* C_11033);
N_NIMCALL(void, Objectinitaux_19064)(void* Dest_19066, TNimNode* N_19068);
N_NIMCALL(void, objectInit)(void* Dest_19062, TNimType* Typ_19063);
N_NIMCALL(void, Rawwrite_7064)(FILE* F_7066, NimStringDesc* S_7067);
N_NOINLINE(void, Procaddrerror_7073)(NCSTRING Name_7075);
N_NIMCALL(void, Rawreadline_3789)(FILE* F_3791, NimStringDesc** Result_3793);
N_NIMCALL(NimStringDesc*, addChar)(NimStringDesc* S_1603, NIM_CHAR C_1604);
N_NIMCALL(NI, Ptrsize_9833)(void* P_9835);
N_NIMCALL(NimStringDesc*, nimIntToStr)(NI X_18803);
static N_INLINE(void, pushSafePoint)(TSafePoint* S_4635);
N_NIMCALL(NIM_BOOL, Open_3617)(FILE** F_3620, NimStringDesc* Filename_3621, NU8 Mode_3622, NI Bufsize_3623);
N_NIMCALL(NI64, Getfilesize_3695)(FILE* F_3697);
N_NIMCALL(NI64, Getfilepos_3742)(FILE* F_3744);
N_NIMCALL(void, Setfilepos_3738)(FILE* F_3740, NI64 Pos_3741);
N_NIMCALL(NI, Readbuffer_3714)(FILE* F_3716, void* Buffer_3717, NI Len_3718);
static N_INLINE(void, popSafePoint)(void);
static N_INLINE(E_Base*, getCurrentException)(void);
static N_INLINE(void, popCurrentException)(void);
N_NIMCALL(void, reraiseException)(void);
N_NIMCALL(void, genericAssign)(void* Dest_18965, void* Src_18966, TNimType* Mt_18967);
N_NIMCALL(void, unsureAsgnRef)(void** Dest_12626, void* Src_12627);
N_NIMCALL(void, Genericassignaux_18968)(void* Dest_18970, void* Src_18971, TNimNode* N_18973);
N_NIMCALL(void, Listremove_8646)(TY8234** Head_8650, TY8234* C_8651);
N_NIMCALL(void, Listadd_9226)(TY8232** Head_9230, TY8232* C_9231);
N_NIMCALL(void, Listremove_9368)(TY8232** Head_9372, TY8232* C_9373);
N_NIMCALL(void, Listadd_9007)(TY8234** Head_9011, TY8234* C_9012);
STRING_LITERAL(TMP20519, "cannot write string to file", 27);
STRING_LITERAL(TMP20520, "No stack traceback available", 28);
STRING_LITERAL(TMP20521, "Error: unhandled exception: ", 28);
STRING_LITERAL(TMP20522, "Error: unhandled exception", 26);
STRING_LITERAL(TMP20523, " [", 2);
STRING_LITERAL(TMP20524, "]\015\012", 3);
STRING_LITERAL(TMP20525, "\015\012", 2);
STRING_LITERAL(TMP20526, "out of memory; cannot even throw an exception", 45);
STRING_LITERAL(TMP20527, "out of memory", 13);
STRING_LITERAL(TMP20528, "rb", 2);
STRING_LITERAL(TMP20529, "wb", 2);
STRING_LITERAL(TMP20530, "w+b", 3);
STRING_LITERAL(TMP20531, "r+b", 3);
STRING_LITERAL(TMP20532, "ab", 2);
NIM_CONST TY4102 Formatopen_4101 = {((NimStringDesc*) &TMP20528),
((NimStringDesc*) &TMP20529),
((NimStringDesc*) &TMP20530),
((NimStringDesc*) &TMP20531),
((NimStringDesc*) &TMP20532)}
;
STRING_LITERAL(TMP20533, "SIGINT: Interrupted by Ctrl-C.\015\012", 32);
STRING_LITERAL(TMP20534, "SIGSEGV: Illegal storage access. (Attempt to read from nil?)\015\012", 62);
STRING_LITERAL(TMP20535, "SIGABRT: Abnormal termination.\015\012", 32);
STRING_LITERAL(TMP20536, "SIGFPE: Arithmetic error.\015\012", 27);
STRING_LITERAL(TMP20537, "SIGILL: Illegal operation.\015\012", 28);
STRING_LITERAL(TMP20538, "SIGBUS: Illegal storage access. (Attempt to read from nil?)\015\012", 61);
STRING_LITERAL(TMP20539, "unknown signal\015\012", 16);
STRING_LITERAL(TMP34039, "over- or underflow", 18);
STRING_LITERAL(TMP189627, "could not load: ", 16);
STRING_LITERAL(TMP189628, "could not import: ", 18);
STRING_LITERAL(TMP189649, "", 0);
STRING_LITERAL(TMP189660, "no exception to reraise", 23);
STRING_LITERAL(TMP189762, " (invalid data!)", 16);
STRING_LITERAL(TMP189866, "cannot retrieve file position", 29);
STRING_LITERAL(TMP189867, "cannot set file position", 24);
STRING_LITERAL(TMP191491, "[GC] total memory: ", 19);
STRING_LITERAL(TMP191492, "\015\012[GC] occupied memory: ", 24);
STRING_LITERAL(TMP191493, "\015\012[GC] stack scans: ", 20);
STRING_LITERAL(TMP191494, "\015\012[GC] stack cells: ", 20);
STRING_LITERAL(TMP191495, "\015\012[GC] cycle collections: ", 26);
STRING_LITERAL(TMP191496, "\015\012[GC] max threshold: ", 22);
STRING_LITERAL(TMP191497, "\015\012[GC] zct capacity: ", 21);
STRING_LITERAL(TMP191498, "\015\012[GC] max cycle table size: ", 29);
STRING_LITERAL(TMP191499, "\015\012[GC] max stack size: ", 23);
TY2719 Dbglinehook_2722;
NIM_THREADVAR TFrame* framePtr;
TNimType Strdesc_3017;
extern TNimType* NTI4254; /* ref EIO */
extern TNimType* NTI420; /* EIO */
extern TNimType* NTI7844; /* ref EOutOfMemory */
extern TNimType* NTI442; /* EOutOfMemory */
NimStringDesc* Stacktracenewline_4416;
NIM_THREADVAR TSafePoint* excHandler;
NIM_THREADVAR E_Base* Currexception_4632;
NimStringDesc* Buf_4801;
NimStringDesc* Assertbuf_4802;
TY4803 Tempframes_4805;
EAssertionFailed* Gassertionfailed_5251;
NIM_BOOL Dbgaborting_5275;
extern TNimType* NTI5250; /* ref EAssertionFailed */
extern TNimType* NTI436; /* EAssertionFailed */
NIM_BOOL Ismultithreaded_7401;
TY442* Goutofmem_7840;
TY8274 Allocator_8329;
NI Lastsize_8491;
void* Stackbottom_10607;
TY10590 Gch_10608;
NI Cyclethreshold_10609;
NI Recgclock_10610;
extern TNimType* NTI5651; /* ref EOverflow */
extern TNimType* NTI432; /* EOverflow */
extern TNimType* NTI5233; /* ref ENoExceptionToReraise */
extern TNimType* NTI452; /* ENoExceptionToReraise */
N_NOINLINE(void, setStackBottom)(void* Thestackbottom_1624) {
NI A_16004;
NI B_16005;
if (!(Stackbottom_10607 == NIM_NIL)) goto LA2;
Stackbottom_10607 = Thestackbottom_1624;
goto LA1;
LA2: ;
A_16004 = 0;
A_16004 = ((NI) (Thestackbottom_1624));
B_16005 = 0;
B_16005 = ((NI) (Stackbottom_10607));
Stackbottom_10607 = ((void*) (((A_16004 >= B_16005) ? A_16004 : B_16005)));
LA1: ;
}
static N_INLINE(void, Initstackbottom_3013)(void) {
void* volatile Locals_3015;
Locals_3015 = 0;
setStackBottom(((void*) (&Locals_3015)));
}
static N_INLINE(NI, Roundup_8256)(NI X_8258, NI V_8259) {
NI Result_8260;
Result_8260 = 0;
Result_8260 = (NI64)((NI64)(X_8258 + (NI64)(V_8259 - 1)) & (NI64)((NU64) ~((NI64)(V_8259 - 1))));
return Result_8260;
}
N_NIMCALL(TY8207*, Intsetget_8374)(TY8211* T_8376, NI Key_8377) {
TY8207* Result_8378;
TY8207* It_8379;
Result_8378 = 0;
It_8379 = 0;
It_8379 = (*T_8376).Data[((NI64)(Key_8377 & 1023))-0];
while (1) {
if (!!((It_8379 == NIM_NIL))) goto LA1;
if (!((*It_8379).Key == Key_8377)) goto LA3;
Result_8378 = It_8379;
goto BeforeRet;
LA3: ;
It_8379 = (*It_8379).Next;
} LA1: ;
Result_8378 = NIM_NIL;
BeforeRet: ;
return Result_8378;
}
N_NIMCALL(NIM_BOOL, Contains_8411)(TY8211* S_8413, NI Key_8414) {
NIM_BOOL Result_8415;
TY8207* T_8416;
NI U_8428;
Result_8415 = 0;
T_8416 = 0;
T_8416 = Intsetget_8374(S_8413, (NI64)((NU64)(Key_8414) >> (NU64)(9)));
if (!!((T_8416 == NIM_NIL))) goto LA2;
U_8428 = 0;
U_8428 = (NI64)(Key_8414 & 511);
Result_8415 = !(((NI64)((*T_8416).Bits[((NI64)((NU64)(U_8428) >> (NU64)(6)))-0] & (NI64)((NU64)(1) << (NU64)((NI64)(U_8428 & 63)))) == 0));
goto LA1;
LA2: ;
Result_8415 = NIM_FALSE;
LA1: ;
return Result_8415;
}
static N_INLINE(NI, Pageindex_8481)(void* P_8483) {
NI Result_8484;
Result_8484 = 0;
Result_8484 = (NI64)((NU64)(((NI) (P_8483))) >> (NU64)(12));
return Result_8484;
}
static N_INLINE(NIM_BOOL, Isaccessible_8552)(void* P_8554) {
NIM_BOOL Result_8555;
NI LOC1;
Result_8555 = 0;
LOC1 = Pageindex_8481(P_8554);
Result_8555 = Contains_8411(&Allocator_8329.Chunkstarts, LOC1);
return Result_8555;
}
static N_INLINE(void, Updateprevsize_8611)(TY8274* A_8614, TY8234* C_8615, NI Prevsize_8616) {
TY8230* Ri_8617;
NIM_BOOL LOC2;
Ri_8617 = 0;
Ri_8617 = ((TY8230*) ((NI64)((NU64)(((NI) (C_8615))) + (NU64)((*C_8615).Sup.Size))));
LOC2 = Isaccessible_8552(((void*) (Ri_8617)));
if (!LOC2) goto LA3;
(*Ri_8617).Prevsize = Prevsize_8616;
LA3: ;
}
N_NIMCALL(NI, Writebuffer_3733)(FILE* F_3735, void* Buffer_3736, NI Len_3737) {
NI Result_4243;
Result_4243 = 0;
Result_4243 = fwrite(Buffer_3736, 1, Len_3737, F_3735);
return Result_4243;
}
static N_INLINE(void, Aquire_10611)(TY10590* Gch_10614) {
}
N_NIMCALL(NI, Gettotalmem_2021)(void) {
NI Result_9877;
Result_9877 = 0;
Result_9877 = Allocator_8329.Currmem;
goto BeforeRet;
BeforeRet: ;
return Result_9877;
}
N_NIMCALL(NI, Getfreemem_2019)(void) {
NI Result_9874;
Result_9874 = 0;
Result_9874 = Allocator_8329.Freemem;
return Result_9874;
}
N_NIMCALL(NI, Getoccupiedmem_2017)(void) {
NI Result_9880;
NI LOC1;
NI LOC2;
Result_9880 = 0;
LOC1 = Gettotalmem_2021();
LOC2 = Getfreemem_2019();
Result_9880 = (NI64)(LOC1 - LOC2);
goto BeforeRet;
BeforeRet: ;
return Result_9880;
}
N_NOINLINE(NI, Stacksize_16401)(void) {
NI Result_16403;
void* volatile Stacktop_16404;
Result_16403 = 0;
Stacktop_16404 = 0;
Result_16403 = (NI64)abs((NI64)(((NI) (&Stacktop_16404)) - ((NI) (Stackbottom_10607))));
return Result_16403;
}
static N_INLINE(TY10202*, Usrtocell_11012)(void* Usr_11014) {
TY10202* Result_11015;
Result_11015 = 0;
Result_11015 = ((TY10202*) ((NI64)((NU64)(((NI) (Usr_11014))) - (NU64)(((NI) (((NI)sizeof(TY10202))))))));
return Result_11015;
}
static N_INLINE(TY8230*, Pageaddr_8485)(void* P_8487) {
TY8230* Result_8488;
Result_8488 = 0;
Result_8488 = ((TY8230*) ((NI64)(((NI) (P_8487)) & -4096)));
return Result_8488;
}
static N_INLINE(NIM_BOOL, Chunkunused_8607)(TY8230* C_8609) {
NIM_BOOL Result_8610;
Result_8610 = 0;
Result_8610 = !((*C_8609).Used);
return Result_8610;
}
static N_INLINE(NIM_BOOL, Issmallchunk_8601)(TY8230* C_8603) {
NIM_BOOL Result_8604;
Result_8604 = 0;
Result_8604 = ((*C_8603).Size <= (NI64)(4096 - (NI64)(((NI)sizeof(TY8232)) - 8)));
goto BeforeRet;
BeforeRet: ;
return Result_8604;
}
N_NIMCALL(NIM_BOOL, Isallocatedptr_9801)(TY8274* A_9803, void* P_9804) {
NIM_BOOL Result_9805;
NIM_BOOL LOC2;
TY8230* C_9806;
NIM_BOOL LOC6;
NIM_BOOL LOC10;
TY8232* C_9807;
NI Offset_9808;
NIM_BOOL LOC13;
NIM_BOOL LOC14;
TY8234* C_9812;
NIM_BOOL LOC17;
Result_9805 = 0;
LOC2 = Isaccessible_8552(P_9804);
if (!LOC2) goto LA3;
C_9806 = 0;
C_9806 = Pageaddr_8485(P_9804);
LOC6 = Chunkunused_8607(C_9806);
if (!!(LOC6)) goto LA7;
LOC10 = Issmallchunk_8601(C_9806);
if (!LOC10) goto LA11;
C_9807 = 0;
C_9807 = ((TY8232*) (C_9806));
Offset_9808 = 0;
Offset_9808 = (NI64)((NU64)((NI64)(((NI) (P_9804)) & 4095)) - (NU64)((NI64)(((NI)sizeof(TY8232)) - 8)));
LOC14 = ((NU64)(Offset_9808) < (NU64)((*C_9807).Acc));
if (!(LOC14)) goto LA15;
LOC14 = ((NI64)((NU64)(Offset_9808) % (NU64)((*C_9807).Sup.Size)) == 0);
LA15: ;
LOC13 = LOC14;
if (!(LOC13)) goto LA16;
LOC13 = ((NU64)(1) < (NU64)((*((TY8222*) (P_9804))).Zerofield));
LA16: ;
Result_9805 = LOC13;
goto LA9;
LA11: ;
C_9812 = 0;
C_9812 = ((TY8234*) (C_9806));
LOC17 = (P_9804 == ((void*) (&(*C_9812).Data)));
if (!(LOC17)) goto LA18;
LOC17 = ((NU64)(1) < (NU64)((*((TY8222*) (P_9804))).Zerofield));
LA18: ;
Result_9805 = LOC17;
LA9: ;
LA7: ;
LA3: ;
return Result_9805;
}
N_NIMCALL(void, Excl_8438)(TY8211* S_8441, NI Key_8442) {
TY8207* T_8443;
NI U_8455;
T_8443 = 0;
T_8443 = Intsetget_8374(&(*S_8441), (NI64)((NU64)(Key_8442) >> (NU64)(9)));
if (!!((T_8443 == NIM_NIL))) goto LA2;
U_8455 = 0;
U_8455 = (NI64)(Key_8442 & 511);
(*T_8443).Bits[((NI64)((NU64)(U_8455) >> (NU64)(6)))-0] = (NI64)((*T_8443).Bits[((NI64)((NU64)(U_8455) >> (NU64)(6)))-0] & (NI64)((NU64) ~((NI64)((NU64)(1) << (NU64)((NI64)(U_8455 & 63))))));
LA2: ;
}
static N_INLINE(NI, Pageindex_8477)(TY8230* C_8479) {
NI Result_8480;
Result_8480 = 0;
Result_8480 = (NI64)((NU64)(((NI) (C_8479))) >> (NU64)(12));
return Result_8480;
}
static N_INLINE(void, Osdeallocpages_7875)(void* P_7877, NI Size_7878) {
VirtualFree(P_7877, 0, ((NI32) 32768));
}
static N_INLINE(void, Deccurrmem_8303)(TY8274* A_8306, NI Bytes_8307) {
(*A_8306).Maxmem = (((*A_8306).Maxmem >= (*A_8306).Currmem) ? (*A_8306).Maxmem : (*A_8306).Currmem);
(*A_8306).Currmem -= Bytes_8307;
}
N_NIMCALL(void, Freeoschunks_8526)(TY8274* A_8529, void* P_8530, NI Size_8531) {
TY8230* C_8532;
NI Nxt_8533;
TY8230* Next_8536;
NI LOC2;
NIM_BOOL LOC3;
NI LOC6;
C_8532 = 0;
C_8532 = ((TY8230*) (P_8530));
Nxt_8533 = 0;
Nxt_8533 = (NI64)((NU64)(((NI) (P_8530))) + (NU64)((*C_8532).Size));
Next_8536 = 0;
Next_8536 = ((TY8230*) (Nxt_8533));
LOC2 = Pageindex_8477(Next_8536);
LOC3 = Contains_8411(&(*A_8529).Chunkstarts, LOC2);
if (!LOC3) goto LA4;
(*Next_8536).Prevsize = 0;
LA4: ;
LOC6 = Pageindex_8481(P_8530);
Excl_8438(&(*A_8529).Chunkstarts, LOC6);
Osdeallocpages_7875(P_8530, Size_8531);
Deccurrmem_8303(A_8529, Size_8531);
(*A_8529).Freemem -= Size_8531;
}
N_NIMCALL(void, Freebigchunk_8620)(TY8274* A_8623, TY8234* C_8624) {
TY8234* C_8625;
TY8230* Ri_8640;
NIM_BOOL LOC2;
NIM_BOOL LOC7;
NI LOC10;
TY8230* Le_8803;
NIM_BOOL LOC15;
NIM_BOOL LOC20;
NI LOC23;
NI LOC27;
C_8625 = 0;
C_8625 = C_8624;
(*A_8623).Freemem += (*C_8625).Sup.Size;
Ri_8640 = 0;
Ri_8640 = ((TY8230*) ((NI64)((NU64)(((NI) (C_8625))) + (NU64)((*C_8625).Sup.Size))));
LOC2 = Isaccessible_8552(((void*) (Ri_8640)));
if (!(LOC2)) goto LA3;
LOC2 = Chunkunused_8607(Ri_8640);
LA3: ;
if (!LOC2) goto LA4;
LOC7 = Issmallchunk_8601(Ri_8640);
if (!!(LOC7)) goto LA8;
Listremove_8646(&(*A_8623).Freechunkslist, ((TY8234*) (Ri_8640)));
(*C_8625).Sup.Size += (*Ri_8640).Size;
LOC10 = Pageindex_8477(Ri_8640);
Excl_8438(&(*A_8623).Chunkstarts, LOC10);
LA8: ;
LA4: ;
if (!!(((*C_8625).Sup.Prevsize == 0))) goto LA12;
Le_8803 = 0;
Le_8803 = ((TY8230*) ((NI64)((NU64)(((NI) (C_8625))) - (NU64)((*C_8625).Sup.Prevsize))));
LOC15 = Isaccessible_8552(((void*) (Le_8803)));
if (!(LOC15)) goto LA16;
LOC15 = Chunkunused_8607(Le_8803);
LA16: ;
if (!LOC15) goto LA17;
LOC20 = Issmallchunk_8601(Le_8803);
if (!!(LOC20)) goto LA21;
Listremove_8646(&(*A_8623).Freechunkslist, ((TY8234*) (Le_8803)));
(*Le_8803).Size += (*C_8625).Sup.Size;
LOC23 = Pageindex_8477(&C_8625->Sup);
Excl_8438(&(*A_8623).Chunkstarts, LOC23);
C_8625 = ((TY8234*) (Le_8803));
LA21: ;
LA17: ;
LA12: ;
if (!((*C_8625).Sup.Size < 1048576)) goto LA25;
LOC27 = Pageindex_8477(&C_8625->Sup);
Incl_8431(&(*A_8623).Chunkstarts, LOC27);
Updateprevsize_8611(A_8623, C_8625, (*C_8625).Sup.Size);
Listadd_9007(&(*A_8623).Freechunkslist, C_8625);
(*C_8625).Sup.Used = NIM_FALSE;
goto LA24;
LA25: ;
Freeoschunks_8526(A_8623, ((void*) (C_8625)), (*C_8625).Sup.Size);
LA24: ;
}
N_NIMCALL(void, Rawdealloc_9464)(TY8274* A_9467, void* P_9468) {
TY8230* C_9469;
NIM_BOOL LOC2;
TY8232* C_9470;
NI S_9471;
TY8222* F_9473;
C_9469 = 0;
C_9469 = Pageaddr_8485(P_9468);
LOC2 = Issmallchunk_8601(C_9469);
if (!LOC2) goto LA3;
C_9470 = 0;
C_9470 = ((TY8232*) (C_9469));
S_9471 = 0;
S_9471 = (*C_9470).Sup.Size;
F_9473 = 0;
F_9473 = ((TY8222*) (P_9468));
(*F_9473).Zerofield = 0;
(*F_9473).Next = (*C_9470).Freelist;
(*C_9470).Freelist = F_9473;
if (!((*C_9470).Free < S_9471)) goto LA6;
Listadd_9226(&(*A_9467).Freesmallchunks[((NI64)(S_9471 / 8))-0], C_9470);
(*C_9470).Free += S_9471;
goto LA5;
LA6: ;
(*C_9470).Free += S_9471;
if (!((*C_9470).Free == (NI64)(4096 - (NI64)(((NI)sizeof(TY8232)) - 8)))) goto LA9;
Listremove_9368(&(*A_9467).Freesmallchunks[((NI64)(S_9471 / 8))-0], C_9470);
(*C_9470).Sup.Size = 4096;
Freebigchunk_8620(A_9467, ((TY8234*) (C_9470)));
LA9: ;
LA5: ;
goto LA1;
LA3: ;
Freebigchunk_8620(A_9467, ((TY8234*) (C_9469)));
LA1: ;
}
N_NOCONV(void, Dealloc_1960)(void* P_1962) {
void* X_9828;
X_9828 = 0;
X_9828 = ((void*) ((NI64)((NU64)(((NI) (P_1962))) - (NU64)(((NI)sizeof(TY8222))))));
Rawdealloc_9464(&Allocator_8329, X_9828);
}
static N_INLINE(void, Add_10258)(TY10218* S_10261, TY10202* C_10262) {
TY10202** D_10265;
void* LOC4;
if (!((*S_10261).Cap <= (*S_10261).Len)) goto LA2;
(*S_10261).Cap = (NI64)((NI64)((*S_10261).Cap * 3) / 2);
D_10265 = 0;
LOC4 = Alloc_1950((NI64)((*S_10261).Cap * 8));
D_10265 = ((TY10202**) (LOC4));
memcpy(((void*) (D_10265)), ((void*) ((*S_10261).D)), (NI64)((*S_10261).Len * 8));
Dealloc_1960(((void*) ((*S_10261).D)));
(*S_10261).D = D_10265;
LA2: ;
(*S_10261).D[((*S_10261).Len)-0] = C_10262;
(*S_10261).Len += 1;
}
static N_INLINE(void, Gcmark_15603)(void* P_15605) {
TY10202* Cell_15606;
NI C_15607;
NIM_BOOL LOC2;
NIM_BOOL LOC7;
Cell_15606 = 0;
Cell_15606 = Usrtocell_11012(P_15605);
C_15607 = 0;
C_15607 = ((NI) (Cell_15606));
LOC2 = ((NU64)(4096) < (NU64)(C_15607));
if (!(LOC2)) goto LA3;
LOC2 = ((NI64)(C_15607 & 7) == 0);
LA3: ;
if (!LOC2) goto LA4;
LOC7 = Isallocatedptr_9801(&Allocator_8329, ((void*) (Cell_15606)));
if (!LOC7) goto LA8;
(*Cell_15606).Refcount = (NI64)((NU64)((*Cell_15606).Refcount) + (NU64)(8));
Add_10258(&Gch_10608.Decstack, Cell_15606);
LA8: ;
LA4: ;
}
N_CDECL(void, Markstackandregisters_16415)(TY10590* Gch_16418) {
jmp_buf Registers_16419;
NI32 LOC2;
NI Max_16423;
NI Sp_16425;
memset((void*)&Registers_16419, 0, sizeof(Registers_16419));
LOC2 = setjmp(Registers_16419);
if (!(LOC2 == ((NI32) 0))) goto LA3;
Max_16423 = 0;
Max_16423 = ((NI) (Stackbottom_10607));
Sp_16425 = 0;
Sp_16425 = ((NI) (Registers_16419));
while (1) {
if (!((NU64)(Sp_16425) <= (NU64)(Max_16423))) goto LA5;
Gcmark_15603((*((void**) (Sp_16425))));
Sp_16425 = (NI64)((NU64)(Sp_16425) + (NU64)(8));
} LA5: ;
LA3: ;
}
N_NIMCALL(void, Markthreadstacks_15611)(TY10590* Gch_15614) {
}
static N_INLINE(NIM_BOOL, Canbecycleroot_11016)(TY10202* C_11018) {
NIM_BOOL Result_11019;
Result_11019 = 0;
Result_11019 = !((((*(*C_11018).Typ).flags &(1<<((((NU8) 1))&7)))!=0));
return Result_11019;
}
static N_INLINE(NI, Nexttry_10309)(NI H_10311, NI Maxhash_10312) {
NI Result_10313;
Result_10313 = 0;
Result_10313 = (NI64)((NI64)((NI64)(5 * H_10311) + 1) & Maxhash_10312);
return Result_10313;
}
N_NIMCALL(TY10210*, Cellsetget_10314)(TY10214* T_10316, NI Key_10317) {
TY10210* Result_10318;
NI H_10319;
Result_10318 = 0;
H_10319 = 0;
H_10319 = (NI64)(((NI) (Key_10317)) & (*T_10316).Max);
while (1) {
if (!!(((*T_10316).Data[(H_10319)-0] == NIM_NIL))) goto LA1;
if (!((*(*T_10316).Data[(H_10319)-0]).Key == Key_10317)) goto LA3;
Result_10318 = (*T_10316).Data[(H_10319)-0];
goto BeforeRet;
LA3: ;
H_10319 = Nexttry_10309(H_10319, (*T_10316).Max);
} LA1: ;
Result_10318 = NIM_NIL;
goto BeforeRet;
BeforeRet: ;
return Result_10318;
}
N_NIMCALL(void, Excl_10481)(TY10214* S_10484, TY10202* Cell_10485) {
NI U_10486;
TY10210* T_10487;
U_10486 = 0;
U_10486 = ((NI) (Cell_10485));
T_10487 = 0;
T_10487 = Cellsetget_10314(&(*S_10484), (NI64)((NU64)(U_10486) >> (NU64)(12)));
if (!!((T_10487 == NIM_NIL))) goto LA2;
U_10486 = (NI64)((NU64)((NI64)((NU64)(U_10486) % (NU64)(4096))) / (NU64)(8));
(*T_10487).Bits[((NI64)((NU64)(U_10486) >> (NU64)(6)))-0] = (NI64)((*T_10487).Bits[((NI64)((NU64)(U_10486) >> (NU64)(6)))-0] & (NI64)((NU64) ~((NI64)((NU64)(1) << (NU64)((NI64)(U_10486 & 63))))));
LA2: ;
}
static N_INLINE(void*, Celltousr_11008)(TY10202* Cell_11010) {
void* Result_11011;
Result_11011 = 0;
Result_11011 = ((void*) ((NI64)((NU64)(((NI) (Cell_11010))) + (NU64)(((NI) (((NI)sizeof(TY10202))))))));
return Result_11011;
}
N_NIMCALL(void, Preparedealloc_11625)(TY10202* Cell_11627) {
void* LOC4;
if (!!(((*(*Cell_11627).Typ).finalizer == NIM_NIL))) goto LA2;
Recgclock_10610 += 1;
LOC4 = Celltousr_11008(Cell_11627);
((TFinalizer) ((*(*Cell_11627).Typ).finalizer))(LOC4);
Recgclock_10610 -= 1;
LA2: ;
}
N_NOINLINE(void, Addzct_11001)(TY10218* S_11004, TY10202* C_11005) {
if (!((NI64)((*C_11005).Refcount & 4) == 0)) goto LA2;
(*C_11005).Refcount = (NI64)((NI64)((*C_11005).Refcount & -8) | 4);
Add_10258(S_11004, C_11005);
LA2: ;
}
N_NIMCALL(void, Dooperation_11616)(void* P_11618, NU8 Op_11619) {
TY10202* C_14606;
if (!(P_11618 == NIM_NIL)) goto LA2;
goto BeforeRet;
LA2: ;
C_14606 = 0;
C_14606 = Usrtocell_11012(P_11618);
switch (Op_11619) {
case ((NU8) 0):
(*C_14606).Refcount = (NI64)((NU64)((*C_14606).Refcount) - (NU64)(8));
if (!((NU64)((*C_14606).Refcount) < (NU64)(8))) goto LA5;
Addzct_11001(&Gch_10608.Zct, C_14606);
LA5: ;
break;
case ((NU8) 1):
Add_10258(&Gch_10608.Tempstack, C_14606);
break;
case ((NU8) 2):
(*C_14606).Refcount = (NI64)((NU64)((*C_14606).Refcount) - (NU64)(8));
break;
}
BeforeRet: ;
}
N_NIMCALL(NI, Getdiscriminant_7243)(void* Aa_7245, TNimNode* N_7247) {
NI Result_7248;
NI D_7258;
NI A_7259;
Result_7248 = 0;
D_7258 = 0;
A_7259 = 0;
A_7259 = ((NI) (Aa_7245));
switch ((*(*N_7247).typ).size) {
case 1:
D_7258 = ((NI)(NU)(NU8)((*((NI8*) ((NI64)((NU64)(A_7259) + (NU64)((*N_7247).offset)))))));
break;
case 2:
D_7258 = ((NI)(NU)(NU16)((*((NI16*) ((NI64)((NU64)(A_7259) + (NU64)((*N_7247).offset)))))));
break;
case 4:
D_7258 = ((NI) ((*((NI32*) ((NI64)((NU64)(A_7259) + (NU64)((*N_7247).offset)))))));
break;
default:
break;
}
Result_7248 = D_7258;
goto BeforeRet;
BeforeRet: ;
return Result_7248;
}
N_NIMCALL(TNimNode*, Selectbranch_7263)(void* Aa_7265, TNimNode* N_7267) {
TNimNode* Result_7269;
NI Discr_7270;
Result_7269 = 0;
Discr_7270 = 0;
Discr_7270 = Getdiscriminant_7243(Aa_7265, N_7267);
if (!((NU64)(Discr_7270) < (NU64)((*N_7267).len))) goto LA2;
Result_7269 = (*N_7267).sons[(Discr_7270)-0];
if (!(Result_7269 == NIM_NIL)) goto LA5;
Result_7269 = (*N_7267).sons[((*N_7267).len)-0];
LA5: ;
goto LA1;
LA2: ;
Result_7269 = (*N_7267).sons[((*N_7267).len)-0];
LA1: ;
return Result_7269;
}
N_NIMCALL(void, Forallslotsaux_13201)(void* Dest_13203, TNimNode* N_13205, NU8 Op_13206) {
NI D_13207;
NI I_13215;
NI HEX3Atmp_20423;
NI Res_20425;
TNimNode* M_13216;
D_13207 = 0;
D_13207 = ((NI) (Dest_13203));
switch ((*N_13205).kind) {
case ((NU8) 0):
break;
case ((NU8) 1):
Forallchildrenaux_11620(((void*) ((NI64)((NU64)(D_13207) + (NU64)((*N_13205).offset)))), (*N_13205).typ, Op_13206);
break;
case ((NU8) 2):
I_13215 = 0;
HEX3Atmp_20423 = 0;
HEX3Atmp_20423 = (NI64)((*N_13205).len - 1);
Res_20425 = 0;
Res_20425 = 0;
while (1) {
if (!(Res_20425 <= HEX3Atmp_20423)) goto LA1;
I_13215 = Res_20425;
Forallslotsaux_13201(Dest_13203, (*N_13205).sons[(I_13215)-0], Op_13206);
Res_20425 += 1;
} LA1: ;
break;
case ((NU8) 3):
M_13216 = 0;
M_13216 = Selectbranch_7263(Dest_13203, N_13205);
if (!!((M_13216 == NIM_NIL))) goto LA3;
Forallslotsaux_13201(Dest_13203, M_13216, Op_13206);
LA3: ;
break;
}
}
N_NIMCALL(void, Forallchildrenaux_11620)(void* Dest_11622, TNimType* Mt_11623, NU8 Op_11624) {
NI D_13233;
NI I_13252;
NI HEX3Atmp_20426;
NI Res_20428;
D_13233 = 0;
D_13233 = ((NI) (Dest_11622));
if (!(Dest_11622 == NIM_NIL)) goto LA2;
goto BeforeRet;
LA2: ;
if (!!((((*Mt_11623).flags &(1<<((((NU8) 0))&7)))!=0))) goto LA5;
switch ((*Mt_11623).kind) {
case ((NU8) 16):
case ((NU8) 4):
case ((NU8) 27):
I_13252 = 0;
HEX3Atmp_20426 = 0;
HEX3Atmp_20426 = (NI64)((NI64)((*Mt_11623).size / (*(*Mt_11623).base).size) - 1);
Res_20428 = 0;
Res_20428 = 0;
while (1) {
if (!(Res_20428 <= HEX3Atmp_20426)) goto LA7;
I_13252 = Res_20428;
Forallchildrenaux_11620(((void*) ((NI64)((NU64)(D_13233) + (NU64)((NI64)((NU64)(I_13252) * (NU64)((*(*Mt_11623).base).size)))))), (*Mt_11623).base, Op_11624);
Res_20428 += 1;
} LA7: ;
break;
case ((NU8) 22):
case ((NU8) 28):
case ((NU8) 24):
Dooperation_11616((*((void**) (D_13233))), Op_11624);
break;
case ((NU8) 17):
case ((NU8) 18):
case ((NU8) 40):
Forallslotsaux_13201(Dest_11622, (*Mt_11623).node, Op_11624);
break;
default:
break;
}
LA5: ;
BeforeRet: ;
}
N_NIMCALL(void, Forallchildren_11612)(TY10202* Cell_11614, NU8 Op_11615) {
void* LOC1;
NI D_13279;
void* LOC2;
TGenericSeq* S_13280;
NI I_13299;
NI HEX3Atmp_20429;
NI Res_20431;
switch ((*(*Cell_11614).Typ).kind) {
case ((NU8) 22):
LOC1 = Celltousr_11008(Cell_11614);
Forallchildrenaux_11620(LOC1, (*(*Cell_11614).Typ).base, Op_11615);
break;
case ((NU8) 24):
D_13279 = 0;
LOC2 = Celltousr_11008(Cell_11614);
D_13279 = ((NI) (LOC2));
S_13280 = 0;
S_13280 = ((TGenericSeq*) (D_13279));
if (!!((S_13280 == NIM_NIL))) goto LA4;
I_13299 = 0;
HEX3Atmp_20429 = 0;
HEX3Atmp_20429 = (NI64)((*S_13280).len - 1);
Res_20431 = 0;
Res_20431 = 0;
while (1) {
if (!(Res_20431 <= HEX3Atmp_20429)) goto LA6;
I_13299 = Res_20431;
Forallchildrenaux_11620(((void*) ((NI64)((NU64)((NI64)((NU64)(D_13279) + (NU64)((NI64)((NU64)(I_13299) * (NU64)((*(*(*Cell_11614).Typ).base).size))))) + (NU64)(16)))), (*(*Cell_11614).Typ).base, Op_11615);
Res_20431 += 1;
} LA6: ;
LA4: ;
break;
case ((NU8) 28):
break;
default:
break;
}
}
N_NIMCALL(void, Collectzct_16601)(TY10590* Gch_16604) {
NI* L_16606;
TY10202* C_16609;
NIM_BOOL LOC6;
L_16606 = 0;
L_16606 = &(*Gch_16604).Zct.Len;
while (1) {
if (!(0 < (*L_16606))) goto LA1;
C_16609 = 0;
C_16609 = (*Gch_16604).Zct.D[(0)-0];
(*C_16609).Refcount = (NI64)((*C_16609).Refcount & -8);
(*Gch_16604).Zct.D[(0)-0] = (*Gch_16604).Zct.D[((NI64)((*L_16606) - 1))-0];
(*L_16606) -= 1;
if (!((NU64)((*C_16609).Refcount) < (NU64)(8))) goto LA3;
LOC6 = Canbecycleroot_11016(C_16609);
if (!LOC6) goto LA7;
Excl_10481(&(*Gch_16604).Cycleroots, C_16609);
LA7: ;
Preparedealloc_11625(C_16609);
Forallchildren_11612(C_16609, ((NU8) 0));
Rawdealloc_9464(&Allocator_8329, ((void*) (C_16609)));
LA3: ;
} LA1: ;
}
N_NIMCALL(void, Init_10288)(TY10214* S_10291) {
void* LOC1;
LOC1 = Alloc0_1953(8192);
(*S_10291).Data = ((TY10210**) (LOC1));
(*S_10291).Max = 1023;
(*S_10291).Counter = 0;
(*S_10291).Head = NIM_NIL;
}
N_NIMCALL(void, Cellsetrawinsert_10333)(TY10214* T_10335, TY10210** Data_10336, TY10210* Desc_10337) {
NI H_10338;
H_10338 = 0;
H_10338 = (NI64)(((NI) ((*Desc_10337).Key)) & (*T_10335).Max);
while (1) {
if (!!((Data_10336[(H_10338)-0] == NIM_NIL))) goto LA1;
H_10338 = Nexttry_10309(H_10338, (*T_10335).Max);
} LA1: ;
Data_10336[(H_10338)-0] = Desc_10337;
}
N_NIMCALL(void, Cellsetenlarge_10370)(TY10214* T_10373) {
NI Oldmax_10374;
TY10210** N_10375;
void* LOC1;
NI I_10383;
NI Res_20422;
Oldmax_10374 = 0;
Oldmax_10374 = (*T_10373).Max;
(*T_10373).Max = (NI64)((NI64)((NI64)((*T_10373).Max + 1) * 2) - 1);
N_10375 = 0;
LOC1 = Alloc0_1953((NI64)((NI64)((*T_10373).Max + 1) * 8));
N_10375 = ((TY10210**) (LOC1));
I_10383 = 0;
Res_20422 = 0;
Res_20422 = 0;
while (1) {
if (!(Res_20422 <= Oldmax_10374)) goto LA2;
I_10383 = Res_20422;
if (!!(((*T_10373).Data[(I_10383)-0] == NIM_NIL))) goto LA4;
Cellsetrawinsert_10333(&(*T_10373), N_10375, (*T_10373).Data[(I_10383)-0]);
LA4: ;
Res_20422 += 1;
} LA2: ;
Dealloc_1960(((void*) ((*T_10373).Data)));
(*T_10373).Data = N_10375;
}
N_NIMCALL(TY10210*, Cellsetput_10395)(TY10214* T_10398, NI Key_10399) {
TY10210* Result_10400;
NI H_10401;
TY10210* X_10402;
NIM_BOOL LOC9;
void* LOC14;
Result_10400 = 0;
H_10401 = 0;
H_10401 = (NI64)(((NI) (Key_10399)) & (*T_10398).Max);
while (1) {
X_10402 = 0;
X_10402 = (*T_10398).Data[(H_10401)-0];
if (!(X_10402 == NIM_NIL)) goto LA3;
goto LA1;
LA3: ;
if (!((*X_10402).Key == Key_10399)) goto LA6;
Result_10400 = X_10402;
goto BeforeRet;
LA6: ;
H_10401 = Nexttry_10309(H_10401, (*T_10398).Max);
} LA1: ;
LOC9 = ((NI64)((NI64)((*T_10398).Max + 1) * 2) < (NI64)((*T_10398).Counter * 3));
if (LOC9) goto LA10;
LOC9 = ((NI64)((NI64)((*T_10398).Max + 1) - (*T_10398).Counter) < 4);
LA10: ;
if (!LOC9) goto LA11;
Cellsetenlarge_10370(T_10398);
LA11: ;
(*T_10398).Counter += 1;
H_10401 = (NI64)(((NI) (Key_10399)) & (*T_10398).Max);
while (1) {
if (!!(((*T_10398).Data[(H_10401)-0] == NIM_NIL))) goto LA13;
H_10401 = Nexttry_10309(H_10401, (*T_10398).Max);
} LA13: ;
LOC14 = Alloc0_1953(((NI)sizeof(TY10210)));
Result_10400 = ((TY10210*) (LOC14));
(*Result_10400).Next = (*T_10398).Head;
(*Result_10400).Key = Key_10399;
(*T_10398).Head = Result_10400;
(*T_10398).Data[(H_10401)-0] = Result_10400;
BeforeRet: ;
return Result_10400;
}
N_NOINLINE(void, Incl_10474)(TY10214* S_10477, TY10202* Cell_10478) {
NI U_10479;
TY10210* T_10480;
U_10479 = 0;
U_10479 = ((NI) (Cell_10478));
T_10480 = 0;
T_10480 = Cellsetput_10395(S_10477, (NI64)((NU64)(U_10479) >> (NU64)(12)));
U_10479 = (NI64)((NU64)((NI64)((NU64)(U_10479) % (NU64)(4096))) / (NU64)(8));
(*T_10480).Bits[((NI64)((NU64)(U_10479) >> (NU64)(6)))-0] = (NI64)((*T_10480).Bits[((NI64)((NU64)(U_10479) >> (NU64)(6)))-0] | (NI64)((NU64)(1) << (NU64)((NI64)(U_10479 & 63))));
}
N_NIMCALL(NIM_BOOL, Containsorincl_10499)(TY10214* S_10502, TY10202* Cell_10503) {
NIM_BOOL Result_10504;
NI U_10505;
TY10210* T_10506;
Result_10504 = 0;
U_10505 = 0;
U_10505 = ((NI) (Cell_10503));
T_10506 = 0;
T_10506 = Cellsetget_10314(&(*S_10502), (NI64)((NU64)(U_10505) >> (NU64)(12)));
if (!!((T_10506 == NIM_NIL))) goto LA2;
U_10505 = (NI64)((NU64)((NI64)((NU64)(U_10505) % (NU64)(4096))) / (NU64)(8));
Result_10504 = !(((NI64)((*T_10506).Bits[((NI64)((NU64)(U_10505) >> (NU64)(6)))-0] & (NI64)((NU64)(1) << (NU64)((NI64)(U_10505 & 63)))) == 0));
if (!!(Result_10504)) goto LA5;
(*T_10506).Bits[((NI64)((NU64)(U_10505) >> (NU64)(6)))-0] = (NI64)((*T_10506).Bits[((NI64)((NU64)(U_10505) >> (NU64)(6)))-0] | (NI64)((NU64)(1) << (NU64)((NI64)(U_10505 & 63))));
LA5: ;
goto LA1;
LA2: ;
Incl_10474(S_10502, Cell_10503);
Result_10504 = NIM_FALSE;
LA1: ;
return Result_10504;
}
N_NIMCALL(NIM_BOOL, Contains_10454)(TY10214* S_10456, TY10202* Cell_10457) {
NIM_BOOL Result_10458;
NI U_10459;
TY10210* T_10460;
Result_10458 = 0;
U_10459 = 0;
U_10459 = ((NI) (Cell_10457));
T_10460 = 0;
T_10460 = Cellsetget_10314(S_10456, (NI64)((NU64)(U_10459) >> (NU64)(12)));
if (!!((T_10460 == NIM_NIL))) goto LA2;
U_10459 = (NI64)((NU64)((NI64)((NU64)(U_10459) % (NU64)(4096))) / (NU64)(8));
Result_10458 = !(((NI64)((*T_10460).Bits[((NI64)((NU64)(U_10459) >> (NU64)(6)))-0] & (NI64)((NU64)(1) << (NU64)((NI64)(U_10459 & 63)))) == 0));
goto LA1;
LA2: ;
Result_10458 = NIM_FALSE;
LA1: ;
return Result_10458;
}
N_NIMCALL(void, Deinit_10292)(TY10214* S_10295) {
TY10210* It_10296;
TY10210* N_10308;
It_10296 = 0;
It_10296 = (*S_10295).Head;
while (1) {
if (!!((It_10296 == NIM_NIL))) goto LA1;
N_10308 = 0;
N_10308 = (*It_10296).Next;
Dealloc_1960(((void*) (It_10296)));
It_10296 = N_10308;
} LA1: ;
(*S_10295).Head = NIM_NIL;
Dealloc_1960(((void*) ((*S_10295).Data)));
(*S_10295).Data = NIM_NIL;
(*S_10295).Counter = 0;
}
N_NIMCALL(void, Collectcycles_14803)(TY10590* Gch_14806) {
NI Tabsize_14807;
TY10202* C_14808;
TY10214 HEX3Atmp_20436;
TY10210* R_20438;
NI I_20440;
NI W_20442;
NI J_20444;
TY10214 Marker_14823;
TY10202* C_14825;
TY10214 HEX3Atmp_20445;
TY10210* R_20447;
NI I_20449;
NI W_20451;
NI J_20453;
NIM_BOOL LOC17;
TY10202* D_14841;
NIM_BOOL LOC22;
NIM_BOOL LOC24;
TY10202* C_14845;
TY10214 HEX3Atmp_20454;
TY10210* R_20456;
NI I_20458;
NI W_20460;
NI J_20462;
TY10202* D_14860;
NIM_BOOL LOC41;
Tabsize_14807 = 0;
Tabsize_14807 = 0;
C_14808 = 0;
memset((void*)&HEX3Atmp_20436, 0, sizeof(HEX3Atmp_20436));
HEX3Atmp_20436 = (*Gch_14806).Cycleroots;
R_20438 = 0;
R_20438 = HEX3Atmp_20436.Head;
while (1) {
if (!!((R_20438 == NIM_NIL))) goto LA1;
I_20440 = 0;
I_20440 = 0;
while (1) {
if (!(I_20440 <= 7)) goto LA2;
W_20442 = 0;
W_20442 = (*R_20438).Bits[(I_20440)-0];
J_20444 = 0;
J_20444 = 0;
while (1) {
if (!!((W_20442 == 0))) goto LA3;
if (!!(((NI64)(W_20442 & 1) == 0))) goto LA5;
C_14808 = ((TY10202*) ((NI64)((NI64)((NU64)((*R_20438).Key) << (NU64)(12)) | (NI64)((NU64)((NI64)((NU64)((NI64)((NU64)(I_20440) << (NU64)(6))) + (NU64)(J_20444))) * (NU64)(8)))));
Tabsize_14807 += 1;
Forallchildren_11612(C_14808, ((NU8) 2));
LA5: ;
J_20444 += 1;
W_20442 = (NI64)((NU64)(W_20442) >> (NU64)(1));
} LA3: ;
I_20440 += 1;
} LA2: ;
R_20438 = (*R_20438).Next;
} LA1: ;
(*Gch_14806).Stat.Cycletablesize = (((*Gch_14806).Stat.Cycletablesize >= Tabsize_14807) ? (*Gch_14806).Stat.Cycletablesize : Tabsize_14807);
memset((void*)&Marker_14823, 0, sizeof(Marker_14823));
Init_10288(&Marker_14823);
C_14825 = 0;
memset((void*)&HEX3Atmp_20445, 0, sizeof(HEX3Atmp_20445));
HEX3Atmp_20445 = (*Gch_14806).Cycleroots;
R_20447 = 0;
R_20447 = HEX3Atmp_20445.Head;
while (1) {
if (!!((R_20447 == NIM_NIL))) goto LA7;
I_20449 = 0;
I_20449 = 0;
while (1) {
if (!(I_20449 <= 7)) goto LA8;
W_20451 = 0;
W_20451 = (*R_20447).Bits[(I_20449)-0];
J_20453 = 0;
J_20453 = 0;
while (1) {
if (!!((W_20451 == 0))) goto LA9;
if (!!(((NI64)(W_20451 & 1) == 0))) goto LA11;
C_14825 = ((TY10202*) ((NI64)((NI64)((NU64)((*R_20447).Key) << (NU64)(12)) | (NI64)((NU64)((NI64)((NU64)((NI64)((NU64)(I_20449) << (NU64)(6))) + (NU64)(J_20453))) * (NU64)(8)))));
if (!((NU64)(8) <= (NU64)((*C_14825).Refcount))) goto LA14;
LOC17 = Containsorincl_10499(&Marker_14823, C_14825);
if (!!(LOC17)) goto LA18;
(*Gch_14806).Tempstack.Len = 0;
Forallchildren_11612(C_14825, ((NU8) 1));
while (1) {
if (!(0 < (*Gch_14806).Tempstack.Len)) goto LA20;
(*Gch_14806).Tempstack.Len -= 1;
D_14841 = 0;
D_14841 = (*Gch_14806).Tempstack.D[((*Gch_14806).Tempstack.Len)-0];
(*D_14841).Refcount = (NI64)((NU64)((*D_14841).Refcount) + (NU64)(8));
LOC22 = Contains_10454(&(*Gch_14806).Cycleroots, D_14841);
if (!(LOC22)) goto LA23;
LOC24 = Containsorincl_10499(&Marker_14823, D_14841);
LOC22 = !(LOC24);
LA23: ;
if (!LOC22) goto LA25;
Forallchildren_11612(D_14841, ((NU8) 1));
LA25: ;
} LA20: ;
LA18: ;
LA14: ;
LA11: ;
J_20453 += 1;
W_20451 = (NI64)((NU64)(W_20451) >> (NU64)(1));
} LA9: ;
I_20449 += 1;
} LA8: ;
R_20447 = (*R_20447).Next;
} LA7: ;
C_14845 = 0;
memset((void*)&HEX3Atmp_20454, 0, sizeof(HEX3Atmp_20454));
HEX3Atmp_20454 = (*Gch_14806).Cycleroots;
R_20456 = 0;
R_20456 = HEX3Atmp_20454.Head;
while (1) {
if (!!((R_20456 == NIM_NIL))) goto LA27;
I_20458 = 0;
I_20458 = 0;
while (1) {
if (!(I_20458 <= 7)) goto LA28;
W_20460 = 0;
W_20460 = (*R_20456).Bits[(I_20458)-0];
J_20462 = 0;
J_20462 = 0;
while (1) {
if (!!((W_20460 == 0))) goto LA29;
if (!!(((NI64)(W_20460 & 1) == 0))) goto LA31;
C_14845 = ((TY10202*) ((NI64)((NI64)((NU64)((*R_20456).Key) << (NU64)(12)) | (NI64)((NU64)((NI64)((NU64)((NI64)((NU64)(I_20458) << (NU64)(6))) + (NU64)(J_20462))) * (NU64)(8)))));
if (!((NU64)((*C_14845).Refcount) < (NU64)(8))) goto LA34;
(*Gch_14806).Tempstack.Len = 0;
Forallchildren_11612(C_14845, ((NU8) 1));
while (1) {
if (!(0 < (*Gch_14806).Tempstack.Len)) goto LA36;
(*Gch_14806).Tempstack.Len -= 1;
D_14860 = 0;
D_14860 = (*Gch_14806).Tempstack.D[((*Gch_14806).Tempstack.Len)-0];
if (!((NU64)((*D_14860).Refcount) < (NU64)(8))) goto LA38;
LOC41 = Contains_10454(&(*Gch_14806).Cycleroots, D_14860);
if (!!(LOC41)) goto LA42;
Addzct_11001(&(*Gch_14806).Zct, D_14860);
LA42: ;
LA38: ;
} LA36: ;
Preparedealloc_11625(C_14845);
Rawdealloc_9464(&Allocator_8329, ((void*) (C_14845)));
LA34: ;
LA31: ;
J_20462 += 1;
W_20460 = (NI64)((NU64)(W_20460) >> (NU64)(1));
} LA29: ;
I_20458 += 1;
} LA28: ;
R_20456 = (*R_20456).Next;
} LA27: ;
Deinit_10292(&(*Gch_14806).Cycleroots);
Init_10288(&(*Gch_14806).Cycleroots);
}
static N_INLINE(NI, Atomicdec_3006)(NI* Memloc_3009, NI X_3010) {
NI Result_7606;
Result_7606 = 0;
(*Memloc_3009) -= X_3010;
Result_7606 = (*Memloc_3009);
return Result_7606;
}
static N_INLINE(void, Rtladdzct_12001)(TY10202* C_12003) {
Addzct_11001(&Gch_10608.Zct, C_12003);
}
static N_INLINE(void, Rtladdcycleroot_11652)(TY10202* C_11654) {
Incl_10474(&Gch_10608.Cycleroots, C_11654);
}
static N_INLINE(void, Decref_12401)(TY10202* C_12403) {
NI LOC2;
NIM_BOOL LOC5;
LOC2 = Atomicdec_3006(&(*C_12403).Refcount, 8);
if (!((NU64)(LOC2) < (NU64)(8))) goto LA3;
Rtladdzct_12001(C_12403);
goto LA1;
LA3: ;
LOC5 = Canbecycleroot_11016(C_12403);
if (!LOC5) goto LA6;
Rtladdcycleroot_11652(C_12403);
goto LA1;
LA6: ;
LA1: ;
}
N_NIMCALL(void, Unmarkstackandregisters_17201)(TY10590* Gch_17204) {
TY10202** D_17205;
NI I_17213;
NI HEX3Atmp_20463;
NI Res_20465;
D_17205 = 0;
D_17205 = (*Gch_17204).Decstack.D;
I_17213 = 0;
HEX3Atmp_20463 = 0;
HEX3Atmp_20463 = (NI64)((*Gch_17204).Decstack.Len - 1);
Res_20465 = 0;
Res_20465 = 0;
while (1) {
if (!(Res_20465 <= HEX3Atmp_20463)) goto LA1;
I_17213 = Res_20465;
Decref_12401(D_17205[(I_17213)-0]);
Res_20465 += 1;
} LA1: ;
(*Gch_17204).Decstack.Len = 0;
}
N_NIMCALL(void, Collectct_11605)(TY10590* Gch_11608) {
NIM_BOOL LOC2;
NIM_BOOL LOC3;
NIM_BOOL LOC5;
NI LOC7;
NI LOC11;
NIM_BOOL LOC13;
NI LOC14;
NI LOC18;
LOC3 = (256 <= (*Gch_11608).Zct.Len);
if (LOC3) goto LA4;
LOC5 = NIM_TRUE;
if (!(LOC5)) goto LA6;
LOC7 = Getoccupiedmem_2017();
LOC5 = (Cyclethreshold_10609 <= LOC7);
LA6: ;
LOC3 = LOC5;
LA4: ;
LOC2 = LOC3;
if (LOC2) goto LA8;
LOC2 = NIM_FALSE;
LA8: ;
if (!LOC2) goto LA9;
LOC11 = Stacksize_16401();
(*Gch_11608).Stat.Maxstacksize = (((*Gch_11608).Stat.Maxstacksize >= LOC11) ? (*Gch_11608).Stat.Maxstacksize : LOC11);
Markstackandregisters_16415(Gch_11608);
Markthreadstacks_15611(Gch_11608);
(*Gch_11608).Stat.Maxstackcells = (((*Gch_11608).Stat.Maxstackcells >= (*Gch_11608).Decstack.Len) ? (*Gch_11608).Stat.Maxstackcells : (*Gch_11608).Decstack.Len);
(*Gch_11608).Stat.Stackscans += 1;
Collectzct_16601(Gch_11608);
LOC14 = Getoccupiedmem_2017();
LOC13 = (Cyclethreshold_10609 <= LOC14);
if (LOC13) goto LA15;
LOC13 = NIM_FALSE;
LA15: ;
if (!LOC13) goto LA16;
Collectcycles_14803(Gch_11608);
Collectzct_16601(Gch_11608);
(*Gch_11608).Stat.Cyclecollections += 1;
LOC18 = Getoccupiedmem_2017();
Cyclethreshold_10609 = ((4194304 >= (NI64)(LOC18 * 2)) ? 4194304 : (NI64)(LOC18 * 2));
(*Gch_11608).Stat.Maxthreshold = (((*Gch_11608).Stat.Maxthreshold >= Cyclethreshold_10609) ? (*Gch_11608).Stat.Maxthreshold : Cyclethreshold_10609);
LA16: ;
Unmarkstackandregisters_17201(Gch_11608);
LA9: ;
}
static N_INLINE(void, Checkcollection_13300)(void) {
if (!(Recgclock_10610 == 0)) goto LA2;
Collectct_11605(&Gch_10608);
LA2: ;
}
static N_INLINE(void, Release_10801)(TY10590* Gch_10804) {
}
N_NIMCALL(void*, newObj)(TNimType* Typ_13307, NI Size_13308) {
void* Result_13309;
TY10202* Res_13324;
void* LOC1;
NI L_13402;
TY10202** D_13403;
NI I_13413;
NI HEX3Atmp_20432;
NI HEX3Atmp_20433;
NI Res_20435;
TY10202* C_13414;
Result_13309 = 0;
Aquire_10611(&Gch_10608);
Checkcollection_13300();
Res_13324 = 0;
LOC1 = Rawalloc_9195(&Allocator_8329, (NI64)(Size_13308 + ((NI)sizeof(TY10202))));
Res_13324 = ((TY10202*) (LOC1));
zeroMem(((void*) (Res_13324)), (NI64)(Size_13308 + ((NI)sizeof(TY10202))));
(*Res_13324).Typ = Typ_13307;
(*Res_13324).Refcount = 4;
L_13402 = 0;
L_13402 = Gch_10608.Zct.Len;
D_13403 = 0;
D_13403 = Gch_10608.Zct.D;
I_13413 = 0;
HEX3Atmp_20432 = 0;
HEX3Atmp_20433 = 0;
HEX3Atmp_20432 = (NI64)(L_13402 - 1);
HEX3Atmp_20433 = ((0 >= (NI64)(L_13402 - 8)) ? 0 : (NI64)(L_13402 - 8));
Res_20435 = 0;
Res_20435 = HEX3Atmp_20432;
while (1) {
if (!(HEX3Atmp_20433 <= Res_20435)) goto LA3;
I_13413 = Res_20435;
C_13414 = 0;
C_13414 = D_13403[(I_13413)-0];
if (!((NU64)(8) <= (NU64)((*C_13414).Refcount))) goto LA5;
(*C_13414).Refcount = (NI64)((*C_13414).Refcount & -8);
D_13403[(I_13413)-0] = Res_13324;
goto LA2;
LA5: ;
Res_20435 -= 1;
} LA3: ;
Add_10258(&Gch_10608.Zct, Res_13324);
LA2: ;
Release_10801(&Gch_10608);
Result_13309 = Celltousr_11008(Res_13324);
return Result_13309;
}
static N_INLINE(NI, Atomicinc_3001)(NI* Memloc_3004, NI X_3005) {
NI Result_7407;
Result_7407 = 0;
(*Memloc_3004) += X_3005;
Result_7407 = (*Memloc_3004);
return Result_7407;
}
static N_INLINE(void, asgnRefNoCycle)(void** Dest_12618, void* Src_12619) {
TY10202* C_12620;
NI LOC4;
TY10202* C_12622;
NI LOC9;
if (!!((Src_12619 == NIM_NIL))) goto LA2;
C_12620 = 0;
C_12620 = Usrtocell_11012(Src_12619);
LOC4 = Atomicinc_3001(&(*C_12620).Refcount, 8);
LA2: ;
if (!!(((*Dest_12618) == NIM_NIL))) goto LA6;
C_12622 = 0;
C_12622 = Usrtocell_11012((*Dest_12618));
LOC9 = Atomicdec_3006(&(*C_12622).Refcount, 8);
if (!((NU64)(LOC9) < (NU64)(8))) goto LA10;
Rtladdzct_12001(C_12622);
LA10: ;
LA6: ;
(*Dest_12618) = Src_12619;
}
N_NIMCALL(NimStringDesc*, rawNewString)(NI Space_18087) {
NimStringDesc* Result_18088;
NI S_18089;
void* LOC4;
Result_18088 = 0;
S_18089 = 0;
S_18089 = Space_18087;
if (!(S_18089 < 8)) goto LA2;
S_18089 = 7;
LA2: ;
LOC4 = newObj(&Strdesc_3017, (NI64)(((NI)sizeof(TGenericSeq)) + (NI64)((NI64)(S_18089 + 1) * 1)));
Result_18088 = ((NimStringDesc*) (LOC4));
(*Result_18088).Sup.space = S_18089;
return Result_18088;
}
N_NIMCALL(NimStringDesc*, copyString)(NimStringDesc* Src_18108) {
NimStringDesc* Result_18109;
Result_18109 = 0;
if (!(Src_18108 == NIM_NIL)) goto LA2;
Result_18109 = NIM_NIL;
goto BeforeRet;
LA2: ;
Result_18109 = rawNewString((*Src_18108).Sup.space);
(*Result_18109).Sup.len = (*Src_18108).Sup.len;
memcpy(((NCSTRING) ((*Result_18109).data)), ((NCSTRING) ((*Src_18108).data)), ((NI32) ((NI64)((NI64)((*Src_18108).Sup.len + 1) * 1))));
BeforeRet: ;
return Result_18109;
}
N_NIMCALL(void, Gcdisable_2663)(void) {
NI LOC1;
LOC1 = Atomicinc_3001(&Recgclock_10610, 1);
}
static N_INLINE(void, Incref_12602)(TY10202* C_12604) {
NI LOC1;
NIM_BOOL LOC3;
LOC1 = Atomicinc_3001(&(*C_12604).Refcount, 8);
LOC3 = Canbecycleroot_11016(C_12604);
if (!LOC3) goto LA4;
Rtladdcycleroot_11652(C_12604);
LA4: ;
}
static N_INLINE(void, asgnRef)(void** Dest_12614, void* Src_12615) {
TY10202* LOC4;
TY10202* LOC8;
if (!!((Src_12615 == NIM_NIL))) goto LA2;
LOC4 = Usrtocell_11012(Src_12615);
Incref_12602(LOC4);
LA2: ;
if (!!(((*Dest_12614) == NIM_NIL))) goto LA6;
LOC8 = Usrtocell_11012((*Dest_12614));
Decref_12401(LOC8);
LA6: ;
(*Dest_12614) = Src_12615;
}
static N_INLINE(void, pushCurrentException)(E_Base* E_4641) {
asgnRef((void**) &(*E_4641).parent, Currexception_4632);
asgnRef((void**) &Currexception_4632, E_4641);
}
static N_INLINE(NI, Resize_18001)(NI Old_18003) {
NI Result_18004;
Result_18004 = 0;
if (!(Old_18003 <= 0)) goto LA2;
Result_18004 = 4;
goto BeforeRet;
goto LA1;
LA2: ;
if (!(Old_18003 < 65536)) goto LA4;
Result_18004 = (NI64)(Old_18003 * 2);
goto BeforeRet;
goto LA1;
LA4: ;
Result_18004 = (NI64)((NI64)(Old_18003 * 3) / 2);
goto BeforeRet;
LA1: ;
BeforeRet: ;
return Result_18004;
}
N_NIMCALL(void*, Growobj_13807)(void* Old_13809, NI Newsize_13810) {
void* Result_13811;
TY10202* Ol_13813;
TY10202* Res_13838;
void* LOC1;
NI Elemsize_13839;
NI Oldsize_13849;
NI J_13854;
TY10202** D_13855;
NIM_BOOL LOC13;
Result_13811 = 0;
Aquire_10611(&Gch_10608);
Checkcollection_13300();
Ol_13813 = 0;
Ol_13813 = Usrtocell_11012(Old_13809);
Res_13838 = 0;
LOC1 = Rawalloc_9195(&Allocator_8329, (NI64)(Newsize_13810 + ((NI)sizeof(TY10202))));
Res_13838 = ((TY10202*) (LOC1));
Elemsize_13839 = 0;
Elemsize_13839 = 1;
if (!!(((*(*Ol_13813).Typ).kind == ((NU8) 28)))) goto LA3;
Elemsize_13839 = (*(*(*Ol_13813).Typ).base).size;
LA3: ;
Oldsize_13849 = 0;
Oldsize_13849 = (NI64)((NI64)((*((TGenericSeq*) (Old_13809))).len * Elemsize_13839) + 16);
memcpy(((void*) (Res_13838)), ((void*) (Ol_13813)), (NI64)(Oldsize_13849 + ((NI)sizeof(TY10202))));
zeroMem(((void*) ((NI64)((NU64)((NI64)((NU64)(((NI) (Res_13838))) + (NU64)(Oldsize_13849))) + (NU64)(((NI)sizeof(TY10202)))))), (NI64)(Newsize_13810 - Oldsize_13849));
if (!((NI64)((*Ol_13813).Refcount & 7) == 4)) goto LA6;
J_13854 = 0;
J_13854 = (NI64)(Gch_10608.Zct.Len - 1);
D_13855 = 0;
D_13855 = Gch_10608.Zct.D;
while (1) {
if (!(0 <= J_13854)) goto LA8;
if (!(D_13855[(J_13854)-0] == Ol_13813)) goto LA10;
D_13855[(J_13854)-0] = Res_13838;
goto LA8;
LA10: ;
J_13854 -= 1;
} LA8: ;
LA6: ;
LOC13 = Canbecycleroot_11016(Ol_13813);
if (!LOC13) goto LA14;
Excl_10481(&Gch_10608.Cycleroots, Ol_13813);
LA14: ;
Rawdealloc_9464(&Allocator_8329, ((void*) (Ol_13813)));
Release_10801(&Gch_10608);
Result_13811 = Celltousr_11008(Res_13838);
return Result_13811;
}
N_NIMCALL(NimStringDesc*, resizeString)(NimStringDesc* Dest_18182, NI Addlen_18183) {
NimStringDesc* Result_18184;
NI Sp_18189;
NI LOC4;
void* LOC5;
Result_18184 = 0;
if (!((NI64)((NI64)((*Dest_18182).Sup.len + Addlen_18183) + 1) <= (*Dest_18182).Sup.space)) goto LA2;
Result_18184 = Dest_18182;
goto LA1;
LA2: ;
Sp_18189 = 0;
LOC4 = Resize_18001((*Dest_18182).Sup.space);
Sp_18189 = ((LOC4 >= (NI64)((NI64)((*Dest_18182).Sup.len + Addlen_18183) + 1)) ? LOC4 : (NI64)((NI64)((*Dest_18182).Sup.len + Addlen_18183) + 1));
LOC5 = Growobj_13807(((void*) (Dest_18182)), (NI64)(((NI)sizeof(TGenericSeq)) + (NI64)((NI64)(Sp_18189 + 1) * 1)));
Result_18184 = ((NimStringDesc*) (LOC5));
(*Result_18184).Sup.space = Sp_18189;
LA1: ;
return Result_18184;
}
N_NIMCALL(NimStringDesc*, setLengthStr)(NimStringDesc* S_18225, NI Newlen_18226) {
NimStringDesc* Result_18227;
NI N_18230;
Result_18227 = 0;
N_18230 = 0;
N_18230 = ((Newlen_18226 >= 0) ? Newlen_18226 : 0);
if (!(N_18230 <= (*S_18225).Sup.space)) goto LA2;
Result_18227 = S_18225;
goto LA1;
LA2: ;
Result_18227 = resizeString(S_18225, N_18230);
LA1: ;
(*Result_18227).Sup.len = N_18230;
(*Result_18227).data[(N_18230)-0] = 0;
return Result_18227;
}
static N_INLINE(void, appendString)(NimStringDesc* Dest_18192, NimStringDesc* Src_18193) {
memcpy(((NCSTRING) (&(*Dest_18192).data[((*Dest_18192).Sup.len)-0])), ((NCSTRING) ((*Src_18193).data)), ((NI32) ((NI64)((NI64)((*Src_18193).Sup.len + 1) * 1))));
(*Dest_18192).Sup.len += (*Src_18193).Sup.len;
}
N_NIMCALL(void, Rawwritestacktrace_4989)(NimStringDesc** S_4992) {
(*S_4992) = resizeString((*S_4992), 28);
appendString((*S_4992), ((NimStringDesc*) &TMP20520));
(*S_4992) = resizeString((*S_4992), Stacktracenewline_4416->Sup.len + 0);
appendString((*S_4992), Stacktracenewline_4416);
}
N_NIMCALL(NimStringDesc*, toNimStr)(NCSTRING Str_18099, NI Len_18100) {
NimStringDesc* Result_18101;
Result_18101 = 0;
Result_18101 = rawNewString(Len_18100);
(*Result_18101).Sup.len = Len_18100;
memcpy(((NCSTRING) ((*Result_18101).data)), Str_18099, ((NI32) ((NI64)((NI64)(Len_18100 + 1) * 1))));
(*Result_18101).data[(Len_18100)-0] = 0;
return Result_18101;
}
N_NIMCALL(NimStringDesc*, cstrToNimstr)(NCSTRING Str_18104) {
NimStringDesc* Result_18105;
NI LOC1;
Result_18105 = 0;
LOC1 = strlen(Str_18104);
Result_18105 = toNimStr(Str_18104, LOC1);
goto BeforeRet;
BeforeRet: ;
return Result_18105;
}
N_NIMCALL(void, Write_3670)(FILE* F_3672, NCSTRING C_3673) {
fputs(C_3673, F_3672);
}
N_NIMCALL(void, Writetostderr_4417)(NCSTRING Msg_4419) {
Write_3670(stdout, Msg_4419);
}
static N_INLINE(void, Quitordebug_5001)(void) {
exit(1);
}
N_NIMCALL(void, Gcenable_2665)(void) {
NI LOC4;
if (!(0 < Recgclock_10610)) goto LA2;
LOC4 = Atomicdec_3006(&Recgclock_10610, 1);
LA2: ;
}
N_NIMCALL(void, raiseException)(E_Base* E_5204, NCSTRING Ename_5205) {
NIM_BOOL LOC8;
NimStringDesc* LOC12;
Gcdisable_2663();
(*E_5204).name = Ename_5205;
if (!!((excHandler == NIM_NIL))) goto LA2;
pushCurrentException(E_5204);
longjmp((*excHandler).context, ((NI32) 1));
goto LA1;
LA2: ;
if (!!(Buf_4801 == 0)) goto LA5;
Buf_4801 = setLengthStr(Buf_4801, 0);
Rawwritestacktrace_4989(&Buf_4801);
LOC8 = !(((*E_5204).message == NIM_NIL));
if (!(LOC8)) goto LA9;
LOC8 = !(((NU8)((*E_5204).message->data[0]) == (NU8)(0)));
LA9: ;
if (!LOC8) goto LA10;
Buf_4801 = resizeString(Buf_4801, 28);
appendString(Buf_4801, ((NimStringDesc*) &TMP20521));
Buf_4801 = resizeString(Buf_4801, (*E_5204).message->Sup.len + 0);
appendString(Buf_4801, (*E_5204).message);
goto LA7;
LA10: ;
Buf_4801 = resizeString(Buf_4801, 26);
appendString(Buf_4801, ((NimStringDesc*) &TMP20522));
LA7: ;
Buf_4801 = resizeString(Buf_4801, 2);
appendString(Buf_4801, ((NimStringDesc*) &TMP20523));
LOC12 = 0;
LOC12 = cstrToNimstr(Ename_5205);
Buf_4801 = resizeString(Buf_4801, LOC12->Sup.len + 0);
appendString(Buf_4801, LOC12);
Buf_4801 = resizeString(Buf_4801, 3);
appendString(Buf_4801, ((NimStringDesc*) &TMP20524));
Writetostderr_4417(Buf_4801->data);
goto LA4;
LA5: ;
Writetostderr_4417(Ename_5205);
LA4: ;
Quitordebug_5001();
LA1: ;
Gcenable_2665();
}
N_NIMCALL(void, Write_3658)(FILE* F_3660, NimStringDesc* S_3661) {
NI LOC2;
TY420* E_4255;
LOC2 = Writebuffer_3733(F_3660, ((void*) (S_3661->data)), S_3661->Sup.len);
if (!!((LOC2 == S_3661->Sup.len))) goto LA3;
E_4255 = 0;
E_4255 = (TY420*) newObj(NTI4254, sizeof(TY420));
(*E_4255).Sup.Sup.Sup.Sup.m_type = NTI420;
asgnRefNoCycle((void**) &(*E_4255).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP20519)));
raiseException((E_Base*)E_4255, "EIO");
LA3: ;
}
static N_INLINE(void, rawEcho)(NimStringDesc* X_4094) {
Write_3658(stdout, X_4094);
}
static N_INLINE(void, rawEchoNL)(void) {
Write_3658(stdout, ((NimStringDesc*) &TMP20525));
}
N_NIMCALL(void, Quit_2821)(NimStringDesc* Errormsg_2823) {
rawEcho(Errormsg_2823);
rawEchoNL();
exit(1);
}
N_NIMCALL(void, Raiseoutofmem_7841)(void) {
if (!(Goutofmem_7840 == NIM_NIL)) goto LA2;
Quit_2821(((NimStringDesc*) &TMP20526));
LA2: ;
asgnRefNoCycle((void**) &(*Goutofmem_7840).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP20527)));
raiseException((E_Base*)Goutofmem_7840, "EOutOfMemory");
}
static N_INLINE(void*, Osallocpages_7871)(NI Size_7873) {
void* Result_7874;
Result_7874 = 0;
Result_7874 = VirtualAlloc(NIM_NIL, Size_7873, ((NI32) 12288), ((NI32) 4));
if (!(Result_7874 == NIM_NIL)) goto LA2;
Raiseoutofmem_7841();
LA2: ;
return Result_7874;
}
static N_INLINE(void, Inccurrmem_8286)(TY8274* A_8289, NI Bytes_8290) {
(*A_8289).Currmem += Bytes_8290;
}
N_NIMCALL(void*, Llalloc_8330)(TY8274* A_8333, NI Size_8334) {
void* Result_8335;
NIM_BOOL LOC2;
NI Request_8349;
void* LOC6;
Result_8335 = 0;
LOC2 = ((*A_8333).Llmem == NIM_NIL);
if (LOC2) goto LA3;
LOC2 = ((*(*A_8333).Llmem).Size < Size_8334);
LA3: ;
if (!LOC2) goto LA4;
Request_8349 = 0;
Request_8349 = Roundup_8256((NI64)(Size_8334 + ((NI)sizeof(TY8272))), 4096);
LOC6 = Osallocpages_7871(Request_8349);
(*A_8333).Llmem = ((TY8272*) (LOC6));
Inccurrmem_8286(A_8333, Request_8349);
(*(*A_8333).Llmem).Size = (NI64)(Request_8349 - ((NI)sizeof(TY8272)));
(*(*A_8333).Llmem).Acc = ((NI)sizeof(TY8272));
LA4: ;
Result_8335 = ((void*) ((NI64)(((NI) ((*A_8333).Llmem)) + (*(*A_8333).Llmem).Acc)));
(*(*A_8333).Llmem).Size -= Size_8334;
(*(*A_8333).Llmem).Acc += Size_8334;
zeroMem(Result_8335, Size_8334);
return Result_8335;
}
N_NIMCALL(TY8207*, Intsetput_8393)(TY8211* T_8396, NI Key_8397) {
TY8207* Result_8398;
void* LOC4;
Result_8398 = 0;
Result_8398 = Intsetget_8374(&(*T_8396), Key_8397);
if (!(Result_8398 == NIM_NIL)) goto LA2;
LOC4 = Llalloc_8330(&Allocator_8329, ((NI)sizeof(TY8207)));
Result_8398 = ((TY8207*) (LOC4));
(*Result_8398).Next = (*T_8396).Data[((NI64)(Key_8397 & 1023))-0];
(*T_8396).Data[((NI64)(Key_8397 & 1023))-0] = Result_8398;
(*Result_8398).Key = Key_8397;
LA2: ;
return Result_8398;
}
N_NIMCALL(void, Incl_8431)(TY8211* S_8434, NI Key_8435) {
TY8207* T_8436;
NI U_8437;
T_8436 = 0;
T_8436 = Intsetput_8393(S_8434, (NI64)((NU64)(Key_8435) >> (NU64)(9)));
U_8437 = 0;
U_8437 = (NI64)(Key_8435 & 511);
(*T_8436).Bits[((NI64)((NU64)(U_8437) >> (NU64)(6)))-0] = (NI64)((*T_8436).Bits[((NI64)((NU64)(U_8437) >> (NU64)(6)))-0] | (NI64)((NU64)(1) << (NU64)((NI64)(U_8437 & 63))));
}
N_NIMCALL(void, Splitchunk_9066)(TY8274* A_9069, TY8234* C_9070, NI Size_9071) {
TY8234* Rest_9072;
NI LOC1;
Rest_9072 = 0;
Rest_9072 = ((TY8234*) ((NI64)((NU64)(((NI) (C_9070))) + (NU64)(Size_9071))));
(*Rest_9072).Sup.Size = (NI64)((*C_9070).Sup.Size - Size_9071);
(*Rest_9072).Sup.Used = NIM_FALSE;
(*Rest_9072).Next = NIM_NIL;
(*Rest_9072).Prev = NIM_NIL;
(*Rest_9072).Sup.Prevsize = Size_9071;
Updateprevsize_8611(A_9069, C_9070, (*Rest_9072).Sup.Size);
(*C_9070).Sup.Size = Size_9071;
LOC1 = Pageindex_8477(&Rest_9072->Sup);
Incl_8431(&(*A_9069).Chunkstarts, LOC1);
Listadd_9007(&(*A_9069).Freechunkslist, Rest_9072);
}
N_NIMCALL(TY8234*, Requestoschunks_8492)(TY8274* A_8495, NI Size_8496) {
TY8234* Result_8497;
void* LOC1;
NI Nxt_8512;
TY8230* Next_8515;
NI LOC3;
NIM_BOOL LOC4;
NI Prv_8518;
TY8230* Prev_8521;
NIM_BOOL LOC8;
NI LOC9;
Result_8497 = 0;
Inccurrmem_8286(A_8495, Size_8496);
(*A_8495).Freemem += Size_8496;
LOC1 = Osallocpages_7871(Size_8496);
Result_8497 = ((TY8234*) (LOC1));
(*Result_8497).Next = NIM_NIL;
(*Result_8497).Prev = NIM_NIL;
(*Result_8497).Sup.Used = NIM_FALSE;
(*Result_8497).Sup.Size = Size_8496;
Nxt_8512 = 0;
Nxt_8512 = (NI64)((NU64)(((NI) (Result_8497))) + (NU64)(Size_8496));
Next_8515 = 0;
Next_8515 = ((TY8230*) (Nxt_8512));
LOC3 = Pageindex_8477(Next_8515);
LOC4 = Contains_8411(&(*A_8495).Chunkstarts, LOC3);
if (!LOC4) goto LA5;
(*Next_8515).Prevsize = Size_8496;
LA5: ;
Prv_8518 = 0;
Prv_8518 = (NI64)((NU64)(((NI) (Result_8497))) - (NU64)(Lastsize_8491));
Prev_8521 = 0;
Prev_8521 = ((TY8230*) (Prv_8518));
LOC9 = Pageindex_8477(Prev_8521);
LOC8 = Contains_8411(&(*A_8495).Chunkstarts, LOC9);
if (!(LOC8)) goto LA10;
LOC8 = ((*Prev_8521).Size == Lastsize_8491);
LA10: ;
if (!LOC8) goto LA11;
(*Result_8497).Sup.Prevsize = Lastsize_8491;
goto LA7;
LA11: ;
(*Result_8497).Sup.Prevsize = 0;
LA7: ;
Lastsize_8491 = Size_8496;
return Result_8497;
}
N_NIMCALL(TY8234*, Getbigchunk_9092)(TY8274* A_9095, NI Size_9096) {
TY8234* Result_9097;
NI LOC11;
Result_9097 = 0;
Result_9097 = (*A_9095).Freechunkslist;
while (1) {
if (!!((Result_9097 == NIM_NIL))) goto LA2;
if (!((*Result_9097).Sup.Size == Size_9096)) goto LA4;
Listremove_8646(&(*A_9095).Freechunkslist, Result_9097);
goto LA1;
goto LA3;
LA4: ;
if (!(Size_9096 < (*Result_9097).Sup.Size)) goto LA6;
Listremove_8646(&(*A_9095).Freechunkslist, Result_9097);
Splitchunk_9066(A_9095, Result_9097, Size_9096);
goto LA1;
goto LA3;
LA6: ;
LA3: ;
Result_9097 = (*Result_9097).Next;
} LA2: ;
if (!(Size_9096 < 524288)) goto LA9;
Result_9097 = Requestoschunks_8492(A_9095, 524288);
Splitchunk_9066(A_9095, Result_9097, Size_9096);
goto LA8;
LA9: ;
Result_9097 = Requestoschunks_8492(A_9095, Size_9096);
LA8: ;
LA1: ;
(*Result_9097).Sup.Prevsize = 0;
(*Result_9097).Sup.Used = NIM_TRUE;
LOC11 = Pageindex_8477(&Result_9097->Sup);
Incl_8431(&(*A_9095).Chunkstarts, LOC11);
(*A_9095).Freemem -= Size_9096;
return Result_9097;
}
N_NIMCALL(TY8232*, Getsmallchunk_9162)(TY8274* A_9165) {
TY8232* Result_9166;
TY8234* Res_9167;
Result_9166 = 0;
Res_9167 = 0;
Res_9167 = Getbigchunk_9092(A_9165, 4096);
Result_9166 = ((TY8232*) (Res_9167));
return Result_9166;
}
N_NIMCALL(void*, Rawalloc_9195)(TY8274* A_9198, NI Requestedsize_9199) {
void* Result_9200;
NI Size_9205;
NI S_9208;
TY8232* C_9209;
TY8234* C_9436;
Result_9200 = 0;
Size_9205 = 0;
Size_9205 = Roundup_8256(Requestedsize_9199, 8);
if (!(Size_9205 <= (NI64)(4096 - (NI64)(((NI)sizeof(TY8232)) - 8)))) goto LA2;
S_9208 = 0;
S_9208 = (NI64)(Size_9205 / 8);
C_9209 = 0;
C_9209 = (*A_9198).Freesmallchunks[(S_9208)-0];
if (!(C_9209 == NIM_NIL)) goto LA5;
C_9209 = Getsmallchunk_9162(A_9198);
(*C_9209).Freelist = NIM_NIL;
(*C_9209).Sup.Size = Size_9205;
(*C_9209).Acc = Size_9205;
(*C_9209).Free = (NI64)((NI64)(4096 - (NI64)(((NI)sizeof(TY8232)) - 8)) - Size_9205);
(*C_9209).Next = NIM_NIL;
(*C_9209).Prev = NIM_NIL;
Listadd_9226(&(*A_9198).Freesmallchunks[(S_9208)-0], C_9209);
Result_9200 = ((void*) (&(*C_9209).Data));
goto LA4;
LA5: ;
if (!((*C_9209).Freelist == NIM_NIL)) goto LA8;
Result_9200 = ((void*) ((NI64)((NU64)(((NI) (&(*C_9209).Data))) + (NU64)((*C_9209).Acc))));
(*C_9209).Acc += Size_9205;
goto LA7;
LA8: ;
Result_9200 = ((void*) ((*C_9209).Freelist));
(*C_9209).Freelist = (*(*C_9209).Freelist).Next;
LA7: ;
(*C_9209).Free -= Size_9205;
LA4: ;
if (!((*C_9209).Free < Size_9205)) goto LA11;
Listremove_9368(&(*A_9198).Freesmallchunks[(S_9208)-0], C_9209);
LA11: ;
goto LA1;
LA2: ;
Size_9205 = Roundup_8256((NI64)(Requestedsize_9199 + (NI64)(((NI)sizeof(TY8234)) - 8)), 4096);
C_9436 = 0;
C_9436 = Getbigchunk_9092(A_9198, Size_9205);
Result_9200 = ((void*) (&(*C_9436).Data));
LA1: ;
return Result_9200;
}
N_NOCONV(void*, Alloc_1950)(NI Size_1952) {
void* Result_9818;
Result_9818 = 0;
Result_9818 = Rawalloc_9195(&Allocator_8329, (NI64)(Size_1952 + ((NI)sizeof(TY8222))));
(*((TY8222*) (Result_9818))).Zerofield = 1;
Result_9818 = ((void*) ((NI64)((NU64)(((NI) (Result_9818))) + (NU64)(((NI)sizeof(TY8222))))));
return Result_9818;
}
N_NOCONV(void*, Alloc0_1953)(NI Size_1955) {
void* Result_9824;
Result_9824 = 0;
Result_9824 = Alloc_1950(Size_1955);
zeroMem(Result_9824, Size_1955);
return Result_9824;
}
N_NIMCALL(void, Init_10278)(TY10218* S_10281, NI Cap_10282) {
void* LOC1;
(*S_10281).Len = 0;
(*S_10281).Cap = Cap_10282;
LOC1 = Alloc0_1953((NI64)(Cap_10282 * 8));
(*S_10281).D = ((TY10202**) (LOC1));
}
N_NIMCALL(void, Initgc_3011)(void) {
Gch_10608.Stat.Stackscans = 0;
Gch_10608.Stat.Cyclecollections = 0;
Gch_10608.Stat.Maxthreshold = 0;
Gch_10608.Stat.Maxstacksize = 0;
Gch_10608.Stat.Maxstackcells = 0;
Gch_10608.Stat.Cycletablesize = 0;
Init_10278(&Gch_10608.Zct, 1024);
Init_10278(&Gch_10608.Tempstack, 1024);
Init_10288(&Gch_10608.Cycleroots);
Init_10278(&Gch_10608.Decstack, 1024);
asgnRefNoCycle((void**) &Goutofmem_7840, (TY442*) newObj(NTI7844, sizeof(TY442)));
(*Goutofmem_7840).Sup.Sup.Sup.Sup.m_type = NTI442;
}
N_NOCONV(void, signalHandler)(NI32 Sig_5278) {
NI32 S_5279;
S_5279 = 0;
S_5279 = Sig_5278;
Gcdisable_2663();
Buf_4801 = setLengthStr(Buf_4801, 0);
Rawwritestacktrace_4989(&Buf_4801);
if (!(S_5279 == SIGINT)) goto LA2;
Buf_4801 = resizeString(Buf_4801, 32);
appendString(Buf_4801, ((NimStringDesc*) &TMP20533));
goto LA1;
LA2: ;
if (!(S_5279 == SIGSEGV)) goto LA4;
Buf_4801 = resizeString(Buf_4801, 62);
appendString(Buf_4801, ((NimStringDesc*) &TMP20534));
goto LA1;
LA4: ;
if (!(S_5279 == SIGABRT)) goto LA6;
if (!Dbgaborting_5275) goto LA9;
goto BeforeRet;
LA9: ;
Buf_4801 = resizeString(Buf_4801, 32);
appendString(Buf_4801, ((NimStringDesc*) &TMP20535));
goto LA1;
LA6: ;
if (!(S_5279 == SIGFPE)) goto LA11;
Buf_4801 = resizeString(Buf_4801, 27);
appendString(Buf_4801, ((NimStringDesc*) &TMP20536));
goto LA1;
LA11: ;
if (!(S_5279 == SIGILL)) goto LA13;
Buf_4801 = resizeString(Buf_4801, 28);
appendString(Buf_4801, ((NimStringDesc*) &TMP20537));
goto LA1;
LA13: ;
if (!(S_5279 == SIGSEGV)) goto LA15;
Buf_4801 = resizeString(Buf_4801, 61);
appendString(Buf_4801, ((NimStringDesc*) &TMP20538));
goto LA1;
LA15: ;
Buf_4801 = resizeString(Buf_4801, 16);
appendString(Buf_4801, ((NimStringDesc*) &TMP20539));
LA1: ;
Writetostderr_4417(Buf_4801->data);
Dbgaborting_5275 = NIM_TRUE;
Gcenable_2665();
exit(1);
BeforeRet: ;
}
N_NIMCALL(void, registerSignalHandler)(void) {
signal(SIGINT, signalHandler);
signal(SIGSEGV, signalHandler);
signal(SIGABRT, signalHandler);
signal(SIGFPE, signalHandler);
signal(SIGILL, signalHandler);
signal(SIGSEGV, signalHandler);
}
N_NIMCALL(NI, getRefcount)(void* P_11037) {
NI Result_11038;
TY10202* LOC1;
Result_11038 = 0;
LOC1 = Usrtocell_11012(P_11037);
Result_11038 = (NI64)((NU64)(((NI) ((*LOC1).Refcount))) >> (NU64)(3));
return Result_11038;
}
N_NIMCALL(NimStringDesc*, mnewString)(NI Len_18095) {
NimStringDesc* Result_18096;
Result_18096 = 0;
Result_18096 = rawNewString(Len_18095);
(*Result_18096).Sup.len = Len_18095;
return Result_18096;
}
N_NIMCALL(NimStringDesc*, copyStrLast)(NimStringDesc* S_18143, NI Start_18144, NI Last_18145) {
NimStringDesc* Result_18146;
NI Start_18149;
NI Len_18152;
Result_18146 = 0;
Start_18149 = 0;
Start_18149 = ((Start_18144 >= 0) ? Start_18144 : 0);
Len_18152 = 0;
Len_18152 = (NI64)((NI64)(((Last_18145 <= (NI64)((*S_18143).Sup.len - 1)) ? Last_18145 : (NI64)((*S_18143).Sup.len - 1)) - Start_18149) + 1);
if (!(0 < Len_18152)) goto LA2;
Result_18146 = rawNewString(Len_18152);
(*Result_18146).Sup.len = Len_18152;
memcpy(((NCSTRING) ((*Result_18146).data)), ((NCSTRING) (&(*S_18143).data[(Start_18149)-0])), ((NI32) ((NI64)(Len_18152 * 1))));
(*Result_18146).data[(Len_18152)-0] = 0;
goto LA1;
LA2: ;
Result_18146 = mnewString(0);
LA1: ;
return Result_18146;
}
N_NIMCALL(NimStringDesc*, copyStr)(NimStringDesc* S_18158, NI Start_18159) {
NimStringDesc* Result_18160;
Result_18160 = 0;
Result_18160 = copyStrLast(S_18158, Start_18159, (NI64)((*S_18158).Sup.len - 1));
goto BeforeRet;
BeforeRet: ;
return Result_18160;
}
N_NOINLINE(void, raiseOverflow)(void) {
EOverflow* E_5652;
E_5652 = 0;
E_5652 = (EOverflow*) newObj(NTI5651, sizeof(EOverflow));
(*E_5652).Sup.Sup.Sup.Sup.m_type = NTI432;
asgnRefNoCycle((void**) &(*E_5652).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP34039)));
raiseException((E_Base*)E_5652, "EOverflow");
}
static N_INLINE(NI, addInt)(NI A_5803, NI B_5804) {
NI Result_5805;
NIM_BOOL LOC2;
Result_5805 = 0;
Result_5805 = (NI64)((NU64)(A_5803) + (NU64)(B_5804));
LOC2 = (0 <= (NI64)(Result_5805 ^ A_5803));
if (LOC2) goto LA3;
LOC2 = (0 <= (NI64)(Result_5805 ^ B_5804));
LA3: ;
if (!LOC2) goto LA4;
goto BeforeRet;
LA4: ;
raiseOverflow();
BeforeRet: ;
return Result_5805;
}
N_NIMCALL(NI, mulInt)(NI A_6803, NI B_6804) {
NI Result_6805;
NF Resasfloat_6806;
NF Floatprod_6807;
Result_6805 = 0;
Resasfloat_6806 = 0;
Floatprod_6807 = 0;
Result_6805 = (NI64)((NU64)(A_6803) * (NU64)(B_6804));
Floatprod_6807 = (((double) (A_6803)) * ((double) (B_6804)));
Resasfloat_6806 = ((double) (Result_6805));
if (!(Resasfloat_6806 == Floatprod_6807)) goto LA2;
goto BeforeRet;
LA2: ;
if (!((3.2000000000000000e+01 * ((Resasfloat_6806 - Floatprod_6807) > 0? ((Resasfloat_6806 - Floatprod_6807)) : -((Resasfloat_6806 - Floatprod_6807)))) <= (Floatprod_6807 > 0? (Floatprod_6807) : -(Floatprod_6807)))) goto LA5;
goto BeforeRet;
LA5: ;
raiseOverflow();
BeforeRet: ;
return Result_6805;
}
N_NIMCALL(void*, newSeq)(TNimType* Typ_13804, NI Len_13805) {
void* Result_13806;
NI LOC1;
NI LOC2;
Result_13806 = 0;
LOC1 = mulInt(Len_13805, (*(*Typ_13804).base).size);
LOC2 = addInt(LOC1, 16);
Result_13806 = newObj(Typ_13804, LOC2);
(*((TGenericSeq*) (Result_13806))).len = Len_13805;
(*((TGenericSeq*) (Result_13806))).space = Len_13805;
return Result_13806;
}
N_NIMCALL(NI, Cmp_1321)(NimStringDesc* X_1323, NimStringDesc* Y_1324) {
NI Result_3319;
NI32 LOC1;
Result_3319 = 0;
LOC1 = strcmp(X_1323->data, Y_1324->data);
Result_3319 = ((NI) (LOC1));
goto BeforeRet;
BeforeRet: ;
return Result_3319;
}
N_NOINLINE(NIM_BOOL, Isonstack_11609)(void* P_11611) {
NIM_BOOL Result_16409;
void* volatile Stacktop_16410;
NI B_16411;
NI A_16413;
NI X_16414;
NIM_BOOL LOC1;
Result_16409 = 0;
Stacktop_16410 = 0;
B_16411 = 0;
B_16411 = ((NI) (Stackbottom_10607));
A_16413 = 0;
A_16413 = ((NI) (&Stacktop_16410));
X_16414 = 0;
X_16414 = ((NI) (P_11611));
LOC1 = ((NU64)(A_16413) <= (NU64)(X_16414));
if (!(LOC1)) goto LA2;
LOC1 = ((NU64)(X_16414) <= (NU64)(B_16411));
LA2: ;
Result_16409 = LOC1;
return Result_16409;
}
N_NIMCALL(void, unsureAsgnRef)(void** Dest_12626, void* Src_12627) {
NIM_BOOL LOC2;
TY10202* LOC8;
TY10202* LOC12;
LOC2 = Isonstack_11609(((void*) (Dest_12626)));
if (!!(LOC2)) goto LA3;
if (!!((Src_12627 == NIM_NIL))) goto LA6;
LOC8 = Usrtocell_11012(Src_12627);
Incref_12602(LOC8);
LA6: ;
if (!!(((*Dest_12626) == NIM_NIL))) goto LA10;
LOC12 = Usrtocell_11012((*Dest_12626));
Decref_12401(LOC12);
LA10: ;
LA3: ;
(*Dest_12626) = Src_12627;
}
N_NIMCALL(TNimType*, extGetCellType)(void* C_11033) {
TNimType* Result_11034;
TY10202* LOC1;
Result_11034 = 0;
LOC1 = Usrtocell_11012(C_11033);
Result_11034 = (*LOC1).Typ;
return Result_11034;
}
N_NIMCALL(TGenericSeq*, setLengthSeq)(TGenericSeq* Seq_18403, NI Elemsize_18404, NI Newlen_18405) {
TGenericSeq* Result_18406;
NI LOC4;
void* LOC5;
NI I_18420;
NI HEX3Atmp_20469;
NI Res_20471;
TNimType* LOC9;
Result_18406 = 0;
Result_18406 = Seq_18403;
if (!((*Result_18406).space < Newlen_18405)) goto LA2;
LOC4 = Resize_18001((*Result_18406).space);
(*Result_18406).space = ((LOC4 >= Newlen_18405) ? LOC4 : Newlen_18405);
LOC5 = Growobj_13807(((void*) (Result_18406)), (NI64)((NI64)(Elemsize_18404 * (*Result_18406).space) + 16));
Result_18406 = ((TGenericSeq*) (LOC5));
goto LA1;
LA2: ;
if (!(Newlen_18405 < (*Result_18406).len)) goto LA6;
I_18420 = 0;
HEX3Atmp_20469 = 0;
HEX3Atmp_20469 = (NI64)((*Result_18406).len - 1);
Res_20471 = 0;
Res_20471 = Newlen_18405;
while (1) {
if (!(Res_20471 <= HEX3Atmp_20469)) goto LA8;
I_18420 = Res_20471;
LOC9 = extGetCellType(((void*) (Result_18406)));
Forallchildrenaux_11620(((void*) ((NI64)((NU64)((NI64)((NU64)(((NI) (Result_18406))) + (NU64)(16))) + (NU64)((NI64)((NU64)(I_18420) * (NU64)(Elemsize_18404)))))), (*LOC9).base, ((NU8) 0));
Res_20471 += 1;
} LA8: ;
zeroMem(((void*) ((NI64)((NU64)((NI64)((NU64)(((NI) (Result_18406))) + (NU64)(16))) + (NU64)((NI64)((NU64)(Newlen_18405) * (NU64)(Elemsize_18404)))))), (NI64)((NU64)((NI64)((NU64)((*Result_18406).len) - (NU64)(Newlen_18405))) * (NU64)(Elemsize_18404)));
goto LA1;
LA6: ;
LA1: ;
(*Result_18406).len = Newlen_18405;
return Result_18406;
}
N_NIMCALL(void, Objectinitaux_19064)(void* Dest_19066, TNimNode* N_19068) {
NI D_19069;
NI I_19077;
NI HEX3Atmp_20490;
NI Res_20492;
TNimNode* M_19078;
D_19069 = 0;
D_19069 = ((NI) (Dest_19066));
switch ((*N_19068).kind) {
case ((NU8) 0):
break;
case ((NU8) 1):
objectInit(((void*) ((NI64)((NU64)(D_19069) + (NU64)((*N_19068).offset)))), (*N_19068).typ);
break;
case ((NU8) 2):
I_19077 = 0;
HEX3Atmp_20490 = 0;
HEX3Atmp_20490 = (NI64)((*N_19068).len - 1);
Res_20492 = 0;
Res_20492 = 0;
while (1) {
if (!(Res_20492 <= HEX3Atmp_20490)) goto LA1;
I_19077 = Res_20492;
Objectinitaux_19064(Dest_19066, (*N_19068).sons[(I_19077)-0]);
Res_20492 += 1;
} LA1: ;
break;
case ((NU8) 3):
M_19078 = 0;
M_19078 = Selectbranch_7263(Dest_19066, N_19068);
if (!!((M_19078 == NIM_NIL))) goto LA3;
Objectinitaux_19064(Dest_19066, M_19078);
LA3: ;
break;
}
}
N_NIMCALL(void, objectInit)(void* Dest_19062, TNimType* Typ_19063) {
NI D_19094;
TNimType** Pint_19096;
NI I_19104;
NI HEX3Atmp_20493;
NI Res_20495;
D_19094 = 0;
D_19094 = ((NI) (Dest_19062));
switch ((*Typ_19063).kind) {
case ((NU8) 17):
Pint_19096 = 0;
Pint_19096 = ((TNimType**) (Dest_19062));
(*Pint_19096) = Typ_19063;
Objectinitaux_19064(Dest_19062, (*Typ_19063).node);
break;
case ((NU8) 18):
case ((NU8) 40):
Objectinitaux_19064(Dest_19062, (*Typ_19063).node);
break;
case ((NU8) 16):
case ((NU8) 4):
I_19104 = 0;
HEX3Atmp_20493 = 0;
HEX3Atmp_20493 = (NI64)((NI64)((*Typ_19063).size / (*(*Typ_19063).base).size) - 1);
Res_20495 = 0;
Res_20495 = 0;
while (1) {
if (!(Res_20495 <= HEX3Atmp_20493)) goto LA1;
I_19104 = Res_20495;
objectInit(((void*) ((NI64)((NU64)(D_19094) + (NU64)((NI64)(I_19104 * (*(*Typ_19063).base).size))))), (*Typ_19063).base);
Res_20495 += 1;
} LA1: ;
break;
default:
break;
}
}
N_NIMCALL(NimStringDesc*, addChar)(NimStringDesc* S_1603, NIM_CHAR C_1604) {
NimStringDesc* Result_18165;
void* LOC4;
Result_18165 = 0;
Result_18165 = S_1603;
if (!((*Result_18165).Sup.space <= (*Result_18165).Sup.len)) goto LA2;
(*Result_18165).Sup.space = Resize_18001((*Result_18165).Sup.space);
LOC4 = Growobj_13807(((void*) (Result_18165)), (NI64)(((NI)sizeof(TGenericSeq)) + (NI64)((NI64)((*Result_18165).Sup.space + 1) * 1)));
Result_18165 = ((NimStringDesc*) (LOC4));
LA2: ;
(*Result_18165).data[((*Result_18165).Sup.len)-0] = C_1604;
(*Result_18165).data[((NI64)((*Result_18165).Sup.len + 1))-0] = 0;
(*Result_18165).Sup.len += 1;
return Result_18165;
}
N_NIMCALL(NimStringDesc*, nimIntToStr)(NI X_18803) {
NimStringDesc* Result_18804;
NI I_18805;
NI Y_18806;
NI D_18807;
NI J_18848;
NI HEX3Atmp_20472;
NI Res_20474;
NIM_CHAR LOC9;
Result_18804 = 0;
Result_18804 = mnewString(32);
I_18805 = 0;
I_18805 = 0;
Y_18806 = 0;
Y_18806 = X_18803;
while (1) {
D_18807 = 0;
D_18807 = (NI64)(Y_18806 / 10);
Result_18804->data[I_18805] = ((NIM_CHAR) (((NI) ((NI64)((NI64)abs(((NI) ((NI64)(Y_18806 - (NI64)(D_18807 * 10))))) + 48)))));
I_18805 += 1;
Y_18806 = D_18807;
if (!(Y_18806 == 0)) goto LA3;
goto LA1;
LA3: ;
} LA1: ;
if (!(X_18803 < 0)) goto LA6;
Result_18804->data[I_18805] = 45;
I_18805 += 1;
LA6: ;
Result_18804 = setLengthStr(Result_18804, I_18805);
J_18848 = 0;
HEX3Atmp_20472 = 0;
HEX3Atmp_20472 = (NI64)((NI64)(I_18805 / 2) - 1);
Res_20474 = 0;
Res_20474 = 0;
while (1) {
if (!(Res_20474 <= HEX3Atmp_20472)) goto LA8;
J_18848 = Res_20474;
LOC9 = Result_18804->data[J_18848];
Result_18804->data[J_18848] = Result_18804->data[(NI64)((NI64)(I_18805 - J_18848) - 1)];
Result_18804->data[(NI64)((NI64)(I_18805 - J_18848) - 1)] = LOC9;
Res_20474 += 1;
} LA8: ;
return Result_18804;
}
N_NIMCALL(TGenericSeq*, incrSeq)(TGenericSeq* Seq_18235, NI Elemsize_18236) {
TGenericSeq* Result_18237;
void* LOC4;
Result_18237 = 0;
Result_18237 = Seq_18235;
if (!((*Result_18237).space <= (*Result_18237).len)) goto LA2;
(*Result_18237).space = Resize_18001((*Result_18237).space);
LOC4 = Growobj_13807(((void*) (Result_18237)), (NI64)((NI64)(Elemsize_18236 * (*Result_18237).space) + 16));
Result_18237 = ((TGenericSeq*) (LOC4));
LA2: ;
(*Result_18237).len += 1;
return Result_18237;
}
N_NIMCALL(void*, nimLoadLibrary)(NimStringDesc* Path_1611) {
void* Result_7094;
void* LOC1;
Result_7094 = 0;
LOC1 = LoadLibraryA(Path_1611->data);
Result_7094 = ((void*) (LOC1));
return Result_7094;
}
N_NIMCALL(void, Rawwrite_7064)(FILE* F_7066, NimStringDesc* S_7067) {
NI LOC1;
LOC1 = Writebuffer_3733(F_7066, ((void*) (S_7067->data)), S_7067->Sup.len);
}
N_NOINLINE(void, nimLoadLibraryError)(NimStringDesc* Path_1621) {
Rawwrite_7064(stdout, ((NimStringDesc*) &TMP189627));
Rawwrite_7064(stdout, Path_1621);
Rawwrite_7064(stdout, ((NimStringDesc*) &TMP20525));
exit(1);
}
N_NOINLINE(void, Procaddrerror_7073)(NCSTRING Name_7075) {
Rawwrite_7064(stdout, ((NimStringDesc*) &TMP189628));
Write_3670(stdout, Name_7075);
Rawwrite_7064(stdout, ((NimStringDesc*) &TMP20525));
exit(1);
}
N_NIMCALL(void*, nimGetProcAddr)(void* Lib_1617, NCSTRING Name_1618) {
void* Result_7099;
Result_7099 = 0;
Result_7099 = GetProcAddress(((void*) (Lib_1617)), Name_1618);
if (!(Result_7099 == NIM_NIL)) goto LA2;
Procaddrerror_7073(Name_1618);
LA2: ;
return Result_7099;
}
N_NIMCALL(NIM_BOOL, Open_3617)(FILE** F_3620, NimStringDesc* Filename_3621, NU8 Mode_3622, NI Bufsize_3623) {
NIM_BOOL Result_4112;
void* P_4113;
NI32 LOC5;
TY442* E_4119;
NI32 LOC11;
Result_4112 = 0;
P_4113 = 0;
P_4113 = fopen(Filename_3621->data, Formatopen_4101[(Mode_3622)-0]->data);
Result_4112 = !((P_4113 == NIM_NIL));
(*F_3620) = ((FILE*) (P_4113));
if (!(0 < Bufsize_3623)) goto LA2;
LOC5 = setvbuf((*F_3620), NIM_NIL, _IOFBF, ((NI32) (Bufsize_3623)));
if (!!((LOC5 == ((NI32) 0)))) goto LA6;
E_4119 = 0;
E_4119 = (TY442*) newObj(NTI7844, sizeof(TY442));
(*E_4119).Sup.Sup.Sup.Sup.m_type = NTI442;
asgnRefNoCycle((void**) &(*E_4119).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP20527)));
raiseException((E_Base*)E_4119, "EOutOfMemory");
LA6: ;
goto LA1;
LA2: ;
if (!(Bufsize_3623 == 0)) goto LA9;
LOC11 = setvbuf((*F_3620), NIM_NIL, _IONBF, ((NI32) 0));
goto LA1;
LA9: ;
LA1: ;
return Result_4112;
}
N_NIMCALL(NI, Readbuffer_3714)(FILE* F_3716, void* Buffer_3717, NI Len_3718) {
NI Result_4191;
Result_4191 = 0;
Result_4191 = fread(Buffer_3717, 1, Len_3718, F_3716);
return Result_4191;
}
N_NIMCALL(void, Rawreadline_3789)(FILE* F_3791, NimStringDesc** Result_3793) {
NI32 C_3794;
(*Result_3793) = setLengthStr((*Result_3793), 0);
while (1) {
C_3794 = 0;
C_3794 = fgetc(F_3791);
if (!(C_3794 < ((NI32) 0))) goto LA3;
goto LA1;
LA3: ;
if (!(C_3794 == ((NI32) 10))) goto LA6;
goto LA1;
LA6: ;
if (!(C_3794 == ((NI32) 13))) goto LA9;
C_3794 = fgetc(F_3791);
if (!!((C_3794 == ((NI32) 10)))) goto LA12;
ungetc(C_3794, F_3791);
LA12: ;
goto LA1;
LA9: ;
(*Result_3793) = addChar((*Result_3793), ((NIM_CHAR) (((NI) (((NI) (C_3794)))))));
} LA1: ;
}
N_NIMCALL(NimStringDesc*, Readline_3679)(FILE* F_3681) {
NimStringDesc* Result_3806;
Result_3806 = 0;
Result_3806 = copyString(((NimStringDesc*) &TMP189649));
Rawreadline_3789(F_3681, &Result_3806);
return Result_3806;
}
N_NIMCALL(NI64, mulInt64)(NI64 A_5739, NI64 B_5740) {
NI64 Result_5741;
NF64 Resasfloat_5742;
NF64 Floatprod_5743;
Result_5741 = 0;
Resasfloat_5742 = 0;
Floatprod_5743 = 0;
Result_5741 = (NI64)((NU64)(A_5739) * (NU64)(B_5740));
Floatprod_5743 = ((double) (A_5739));
Floatprod_5743 = ((NF64) ((((NF) (Floatprod_5743)) * ((NF) (((double) (B_5740)))))));
Resasfloat_5742 = ((double) (Result_5741));
if (!(((NF) (Resasfloat_5742)) == ((NF) (Floatprod_5743)))) goto LA2;
goto BeforeRet;
LA2: ;
if (!((3.2000000000000000e+01 * ((((NF) (Resasfloat_5742)) - ((NF) (Floatprod_5743))) > 0? ((((NF) (Resasfloat_5742)) - ((NF) (Floatprod_5743)))) : -((((NF) (Resasfloat_5742)) - ((NF) (Floatprod_5743)))))) <= (((NF) (Floatprod_5743)) > 0? (((NF) (Floatprod_5743))) : -(((NF) (Floatprod_5743)))))) goto LA5;
goto BeforeRet;
LA5: ;
raiseOverflow();
BeforeRet: ;
return Result_5741;
}
N_NIMCALL(void, reraiseException)(void) {
TY452* E_5234;
if (!(Currexception_4632 == NIM_NIL)) goto LA2;
E_5234 = 0;
E_5234 = (TY452*) newObj(NTI5233, sizeof(TY452));
(*E_5234).Sup.Sup.Sup.m_type = NTI452;
asgnRefNoCycle((void**) &(*E_5234).Sup.Sup.message, copyString(((NimStringDesc*) &TMP189660)));
raiseException((E_Base*)E_5234, "ENoExceptionToReraise");
goto LA1;
LA2: ;
raiseException(Currexception_4632, (*Currexception_4632).name);
LA1: ;
}
N_NIMCALL(NI, Ptrsize_9833)(void* P_9835) {
NI Result_9836;
void* X_9837;
TY8230* LOC1;
Result_9836 = 0;
X_9837 = 0;
X_9837 = ((void*) ((NI64)((NU64)(((NI) (P_9835))) - (NU64)(((NI)sizeof(TY8222))))));
LOC1 = Pageaddr_8485(X_9837);
Result_9836 = (NI64)((*LOC1).Size - ((NI)sizeof(TY8222)));
return Result_9836;
}
N_NOCONV(void*, Realloc_1956)(void* P_1958, NI Newsize_1959) {
void* Result_9842;
NI LOC7;
Result_9842 = 0;
if (!(0 < Newsize_1959)) goto LA2;
Result_9842 = Alloc_1950(Newsize_1959);
if (!!((P_1958 == NIM_NIL))) goto LA5;
LOC7 = Ptrsize_9833(P_1958);
memcpy(Result_9842, P_1958, LOC7);
Dealloc_1960(P_1958);
LA5: ;
goto LA1;
LA2: ;
if (!!((P_1958 == NIM_NIL))) goto LA8;
Dealloc_1960(P_1958);
goto LA1;
LA8: ;
LA1: ;
return Result_9842;
}
N_NIMCALL(NimStringDesc*, nimCharToStr)(NIM_CHAR X_18928) {
NimStringDesc* Result_18929;
Result_18929 = 0;
Result_18929 = mnewString(1);
Result_18929->data[0] = X_18928;
return Result_18929;
}
N_NIMCALL(NimStringDesc*, nimInt64ToStr)(NI64 X_18867) {
NimStringDesc* Result_18868;
NI I_18869;
NI64 Y_18870;
NI64 D_18871;
NI J_18912;
NI HEX3Atmp_20475;
NI Res_20477;
NIM_CHAR LOC9;
Result_18868 = 0;
Result_18868 = mnewString(32);
I_18869 = 0;
I_18869 = 0;
Y_18870 = 0;
Y_18870 = X_18867;
while (1) {
D_18871 = 0;
D_18871 = (NI64)(Y_18870 / 10);
Result_18868->data[I_18869] = ((NIM_CHAR) (((NI) ((NI64)((NI64)abs(((NI) ((NI64)(Y_18870 - (NI64)(D_18871 * 10))))) + 48)))));
I_18869 += 1;
Y_18870 = D_18871;
if (!(Y_18870 == 0)) goto LA3;
goto LA1;
LA3: ;
} LA1: ;
if (!(X_18867 < 0)) goto LA6;
Result_18868->data[I_18869] = 45;
I_18869 += 1;
LA6: ;
Result_18868 = setLengthStr(Result_18868, I_18869);
J_18912 = 0;
HEX3Atmp_20475 = 0;
HEX3Atmp_20475 = (NI64)((NI64)(I_18869 / 2) - 1);
Res_20477 = 0;
Res_20477 = 0;
while (1) {
if (!(Res_20477 <= HEX3Atmp_20475)) goto LA8;
J_18912 = Res_20477;
LOC9 = Result_18868->data[J_18912];
Result_18868->data[J_18912] = Result_18868->data[(NI64)((NI64)(I_18869 - J_18912) - 1)];
Result_18868->data[(NI64)((NI64)(I_18869 - J_18912) - 1)] = LOC9;
Res_20477 += 1;
} LA8: ;
return Result_18868;
}
N_NIMCALL(NimStringDesc*, nimFloatToStr)(NF X_18860) {
NimStringDesc* Result_18861;
TY18862 Buf_18864;
Result_18861 = 0;
memset((void*)&Buf_18864, 0, sizeof(Buf_18864));
sprintf(((NCSTRING) (Buf_18864)), "%#.16e", X_18860);
Result_18861 = cstrToNimstr(((NCSTRING) (Buf_18864)));
goto BeforeRet;
BeforeRet: ;
return Result_18861;
}
N_NIMCALL(NimStringDesc*, reprEnum)(NI E_19155, TNimType* Typ_19156) {
NimStringDesc* Result_19157;
NimStringDesc* LOC4;
NimStringDesc* LOC5;
Result_19157 = 0;
if (!((NU64)(E_19155) < (NU64)((*(*Typ_19156).node).len))) goto LA2;
Result_19157 = cstrToNimstr((*(*(*Typ_19156).node).sons[(E_19155)-0]).name);
goto LA1;
LA2: ;
LOC4 = 0;
LOC5 = 0;
LOC5 = nimIntToStr(E_19155);
LOC4 = rawNewString(LOC5->Sup.len + 16);
appendString(LOC4, LOC5);
appendString(LOC4, ((NimStringDesc*) &TMP189762));
Result_19157 = LOC4;
LA1: ;
return Result_19157;
}
N_NIMCALL(NIM_BOOL, Endoffile_3638)(FILE* F_3640) {
NIM_BOOL Result_4069;
NI32 C_4070;
Result_4069 = 0;
C_4070 = 0;
C_4070 = fgetc(F_3640);
ungetc(C_4070, F_3640);
Result_4069 = (C_4070 == ((NI32) -1));
goto BeforeRet;
BeforeRet: ;
return Result_4069;
}
static N_INLINE(void, pushSafePoint)(TSafePoint* S_4635) {
(*S_4635).prev = excHandler;
excHandler = S_4635;
}
N_NIMCALL(NI64, Getfilepos_3742)(FILE* F_3744) {
NI64 Result_4297;
NI LOC1;
TY420* E_4301;
Result_4297 = 0;
LOC1 = ftell(F_3744);
Result_4297 = ((NI64) (LOC1));
if (!(Result_4297 < 0)) goto LA3;
E_4301 = 0;
E_4301 = (TY420*) newObj(NTI4254, sizeof(TY420));
(*E_4301).Sup.Sup.Sup.Sup.m_type = NTI420;
asgnRefNoCycle((void**) &(*E_4301).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP189866)));
raiseException((E_Base*)E_4301, "EIO");
LA3: ;
return Result_4297;
}
N_NIMCALL(void, Setfilepos_3738)(FILE* F_3740, NI64 Pos_3741) {
NI LOC2;
TY420* E_4278;
LOC2 = fseek(F_3740, ((NI) (Pos_3741)), 0);
if (!!((LOC2 == 0))) goto LA3;
E_4278 = 0;
E_4278 = (TY420*) newObj(NTI4254, sizeof(TY420));
(*E_4278).Sup.Sup.Sup.Sup.m_type = NTI420;
asgnRefNoCycle((void**) &(*E_4278).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP189867)));
raiseException((E_Base*)E_4278, "EIO");
LA3: ;
}
N_NIMCALL(NI64, Getfilesize_3695)(FILE* F_3697) {
NI64 Result_4320;
NI64 Oldpos_4321;
NI LOC1;
Result_4320 = 0;
Oldpos_4321 = 0;
Oldpos_4321 = Getfilepos_3742(F_3697);
LOC1 = fseek(F_3697, 0, 2);
Result_4320 = Getfilepos_3742(F_3697);
Setfilepos_3738(F_3697, Oldpos_4321);
return Result_4320;
}
static N_INLINE(void, popSafePoint)(void) {
excHandler = (*excHandler).prev;
}
static N_INLINE(E_Base*, getCurrentException)(void) {
E_Base* Result_19804;
Result_19804 = 0;
Result_19804 = Currexception_4632;
return Result_19804;
}
static N_INLINE(void, popCurrentException)(void) {
asgnRef((void**) &Currexception_4632, (*Currexception_4632).parent);
}
N_NIMCALL(NimStringDesc*, Readfile_3647)(NimStringDesc* Filename_3649) {
NimStringDesc* Result_4057;
FILE* F_4058;
TSafePoint TMP189865;
NIM_BOOL LOC2;
NI64 volatile Len_4060;
NI LOC9;
Result_4057 = 0;
F_4058 = 0;
pushSafePoint(&TMP189865);
TMP189865.status = setjmp(TMP189865.context);
if (TMP189865.status == 0) {
LOC2 = Open_3617(&F_4058, Filename_3649, ((NU8) 0), -1);
if (!LOC2) goto LA3;
Len_4060 = 0;
Len_4060 = Getfilesize_3695(F_4058);
if (!(Len_4060 < IL64(9223372036854775807))) goto LA6;
Result_4057 = mnewString(((NI) (Len_4060)));
LOC9 = Readbuffer_3714(F_4058, ((void*) (&Result_4057->data[0])), ((NI) (Len_4060)));
if (!!((((NI64) (LOC9)) == Len_4060))) goto LA10;
Result_4057 = copyString(NIM_NIL);
LA10: ;
LA6: ;
fclose(F_4058);
goto LA1;
LA3: ;
Result_4057 = copyString(NIM_NIL);
LA1: ;
popSafePoint();
} else {
popSafePoint();
if (getCurrentException()->Sup.m_type == NTI420) {
Result_4057 = copyString(NIM_NIL);
TMP189865.status = 0;popCurrentException();}
}
if (TMP189865.status != 0) reraiseException();
return Result_4057;
}
N_NIMCALL(void, Genericassignaux_18968)(void* Dest_18970, void* Src_18971, TNimNode* N_18973) {
NI D_18974;
NI S_18975;
NI I_18983;
NI HEX3Atmp_20478;
NI Res_20480;
TNimNode* M_18984;
D_18974 = 0;
D_18974 = ((NI) (Dest_18970));
S_18975 = 0;
S_18975 = ((NI) (Src_18971));
switch ((*N_18973).kind) {
case ((NU8) 0):
break;
case ((NU8) 1):
genericAssign(((void*) ((NI64)((NU64)(D_18974) + (NU64)((*N_18973).offset)))), ((void*) ((NI64)((NU64)(S_18975) + (NU64)((*N_18973).offset)))), (*N_18973).typ);
break;
case ((NU8) 2):
I_18983 = 0;
HEX3Atmp_20478 = 0;
HEX3Atmp_20478 = (NI64)((*N_18973).len - 1);
Res_20480 = 0;
Res_20480 = 0;
while (1) {
if (!(Res_20480 <= HEX3Atmp_20478)) goto LA1;
I_18983 = Res_20480;
Genericassignaux_18968(Dest_18970, Src_18971, (*N_18973).sons[(I_18983)-0]);
Res_20480 += 1;
} LA1: ;
break;
case ((NU8) 3):
memcpy(((void*) ((NI64)((NU64)(D_18974) + (NU64)((*N_18973).offset)))), ((void*) ((NI64)((NU64)(S_18975) + (NU64)((*N_18973).offset)))), (*(*N_18973).typ).size);
M_18984 = 0;
M_18984 = Selectbranch_7263(Src_18971, N_18973);
if (!!((M_18984 == NIM_NIL))) goto LA3;
Genericassignaux_18968(Dest_18970, Src_18971, M_18984);
LA3: ;
break;
}
}
N_NIMCALL(void, genericAssign)(void* Dest_18965, void* Src_18966, TNimType* Mt_18967) {
NI D_19001;
NI S_19002;
void* S2_19014;
TGenericSeq* Seq_19015;
void** X_19016;
void* LOC4;
NI Dst_19017;
NI I_19025;
NI HEX3Atmp_20481;
NI Res_20483;
TGenericSeq* Dstseq_19026;
NI I_19034;
NI HEX3Atmp_20484;
NI Res_20486;
void* S2_19035;
NimStringDesc* LOC10;
void** X_19036;
D_19001 = 0;
D_19001 = ((NI) (Dest_18965));
S_19002 = 0;
S_19002 = ((NI) (Src_18966));
switch ((*Mt_18967).kind) {
case ((NU8) 24):
S2_19014 = 0;
S2_19014 = (*((void**) (Src_18966)));
Seq_19015 = 0;
Seq_19015 = ((TGenericSeq*) (S2_19014));
if (!(S2_19014 == NIM_NIL)) goto LA2;
X_19016 = 0;
X_19016 = ((void**) (Dest_18965));
(*X_19016) = NIM_NIL;
goto BeforeRet;
LA2: ;
LOC4 = newObj(Mt_18967, (NI64)((NI64)((*Seq_19015).len * (*(*Mt_18967).base).size) + 16));
unsureAsgnRef(((void**) (Dest_18965)), LOC4);
Dst_19017 = 0;
Dst_19017 = ((NI) ((*((void**) (Dest_18965)))));
I_19025 = 0;
HEX3Atmp_20481 = 0;
HEX3Atmp_20481 = (NI64)((*Seq_19015).len - 1);
Res_20483 = 0;
Res_20483 = 0;
while (1) {
if (!(Res_20483 <= HEX3Atmp_20481)) goto LA5;
I_19025 = Res_20483;
genericAssign(((void*) ((NI64)((NU64)((NI64)((NU64)(Dst_19017) + (NU64)((NI64)((NU64)(I_19025) * (NU64)((*(*Mt_18967).base).size))))) + (NU64)(16)))), ((void*) ((NI64)((NU64)((NI64)((NU64)(((NI) (S2_19014))) + (NU64)((NI64)((NU64)(I_19025) * (NU64)((*(*Mt_18967).base).size))))) + (NU64)(16)))), (*Mt_18967).base);
Res_20483 += 1;
} LA5: ;
Dstseq_19026 = 0;
Dstseq_19026 = ((TGenericSeq*) (Dst_19017));
(*Dstseq_19026).len = (*Seq_19015).len;
(*Dstseq_19026).space = (*Seq_19015).len;
break;
case ((NU8) 17):
case ((NU8) 18):
case ((NU8) 40):
Genericassignaux_18968(Dest_18965, Src_18966, (*Mt_18967).node);
break;
case ((NU8) 16):
case ((NU8) 4):
I_19034 = 0;
HEX3Atmp_20484 = 0;
HEX3Atmp_20484 = (NI64)((NI64)((*Mt_18967).size / (*(*Mt_18967).base).size) - 1);
Res_20486 = 0;
Res_20486 = 0;
while (1) {
if (!(Res_20486 <= HEX3Atmp_20484)) goto LA6;
I_19034 = Res_20486;
genericAssign(((void*) ((NI64)((NU64)(D_19001) + (NU64)((NI64)((NU64)(I_19034) * (NU64)((*(*Mt_18967).base).size)))))), ((void*) ((NI64)((NU64)(S_19002) + (NU64)((NI64)((NU64)(I_19034) * (NU64)((*(*Mt_18967).base).size)))))), (*Mt_18967).base);
Res_20486 += 1;
} LA6: ;
break;
case ((NU8) 28):
S2_19035 = 0;
S2_19035 = (*((void**) (S_19002)));
if (!!((S2_19035 == NIM_NIL))) goto LA8;
LOC10 = copyString(((NimStringDesc*) (S2_19035)));
unsureAsgnRef(((void**) (Dest_18965)), ((void*) (LOC10)));
goto LA7;
LA8: ;
X_19036 = 0;
X_19036 = ((void**) (Dest_18965));
(*X_19036) = NIM_NIL;
goto BeforeRet;
LA7: ;
break;
case ((NU8) 22):
unsureAsgnRef(((void**) (Dest_18965)), (*((void**) (S_19002))));
break;
default:
memcpy(Dest_18965, Src_18966, (*Mt_18967).size);
break;
}
BeforeRet: ;
}
N_NIMCALL(void, genericSeqAssign)(void* Dest_19039, void* Src_19040, TNimType* Mt_19041) {
void* Src_19042;
Src_19042 = 0;
Src_19042 = Src_19040;
genericAssign(Dest_19039, ((void*) (&Src_19042)), Mt_19041);
}
N_NIMCALL(NimStringDesc*, Gcgetstatistics_2682)(void) {
NimStringDesc* Result_17424;
NimStringDesc* LOC1;
NI LOC2;
NimStringDesc* LOC3;
NI LOC4;
NimStringDesc* LOC5;
NimStringDesc* LOC6;
NimStringDesc* LOC7;
NimStringDesc* LOC8;
NimStringDesc* LOC9;
NimStringDesc* LOC10;
NimStringDesc* LOC11;
NimStringDesc* LOC12;
Result_17424 = 0;
Gcdisable_2663();
LOC1 = 0;
LOC2 = Gettotalmem_2021();
LOC3 = 0;
LOC3 = nimIntToStr(LOC2);
LOC4 = Getoccupiedmem_2017();
LOC5 = 0;
LOC5 = nimIntToStr(LOC4);
LOC6 = 0;
LOC6 = nimIntToStr(Gch_10608.Stat.Stackscans);
LOC7 = 0;
LOC7 = nimIntToStr(Gch_10608.Stat.Maxstackcells);
LOC8 = 0;
LOC8 = nimIntToStr(Gch_10608.Stat.Cyclecollections);
LOC9 = 0;
LOC9 = nimIntToStr(Gch_10608.Stat.Maxthreshold);
LOC10 = 0;
LOC10 = nimIntToStr(Gch_10608.Zct.Cap);
LOC11 = 0;
LOC11 = nimIntToStr(Gch_10608.Stat.Cycletablesize);
LOC12 = 0;
LOC12 = nimIntToStr(Gch_10608.Stat.Maxstacksize);
LOC1 = rawNewString(LOC3->Sup.len + LOC5->Sup.len + LOC6->Sup.len + LOC7->Sup.len + LOC8->Sup.len + LOC9->Sup.len + LOC10->Sup.len + LOC11->Sup.len + LOC12->Sup.len + 204);
appendString(LOC1, ((NimStringDesc*) &TMP191491));
appendString(LOC1, LOC3);
appendString(LOC1, ((NimStringDesc*) &TMP191492));
appendString(LOC1, LOC5);
appendString(LOC1, ((NimStringDesc*) &TMP191493));
appendString(LOC1, LOC6);
appendString(LOC1, ((NimStringDesc*) &TMP191494));
appendString(LOC1, LOC7);
appendString(LOC1, ((NimStringDesc*) &TMP191495));
appendString(LOC1, LOC8);
appendString(LOC1, ((NimStringDesc*) &TMP191496));
appendString(LOC1, LOC9);
appendString(LOC1, ((NimStringDesc*) &TMP191497));
appendString(LOC1, LOC10);
appendString(LOC1, ((NimStringDesc*) &TMP191498));
appendString(LOC1, LOC11);
appendString(LOC1, ((NimStringDesc*) &TMP191499));
appendString(LOC1, LOC12);
Result_17424 = LOC1;
Gcenable_2665();
return Result_17424;
}
N_NIMCALL(void, Listremove_8646)(TY8234** Head_8650, TY8234* C_8651) {
if (!(C_8651 == (*Head_8650))) goto LA2;
(*Head_8650) = (*C_8651).Next;
if (!!(((*Head_8650) == NIM_NIL))) goto LA5;
(*(*Head_8650)).Prev = NIM_NIL;
LA5: ;
goto LA1;
LA2: ;
(*(*C_8651).Prev).Next = (*C_8651).Next;
if (!!(((*C_8651).Next == NIM_NIL))) goto LA8;
(*(*C_8651).Next).Prev = (*C_8651).Prev;
LA8: ;
LA1: ;
(*C_8651).Next = NIM_NIL;
(*C_8651).Prev = NIM_NIL;
}
N_NIMCALL(void, Listadd_9226)(TY8232** Head_9230, TY8232* C_9231) {
(*C_9231).Next = (*Head_9230);
if (!!(((*Head_9230) == NIM_NIL))) goto LA2;
(*(*Head_9230)).Prev = C_9231;
LA2: ;
(*Head_9230) = C_9231;
}
N_NIMCALL(void, Listremove_9368)(TY8232** Head_9372, TY8232* C_9373) {
if (!(C_9373 == (*Head_9372))) goto LA2;
(*Head_9372) = (*C_9373).Next;
if (!!(((*Head_9372) == NIM_NIL))) goto LA5;
(*(*Head_9372)).Prev = NIM_NIL;
LA5: ;
goto LA1;
LA2: ;
(*(*C_9373).Prev).Next = (*C_9373).Next;
if (!!(((*C_9373).Next == NIM_NIL))) goto LA8;
(*(*C_9373).Next).Prev = (*C_9373).Prev;
LA8: ;
LA1: ;
(*C_9373).Next = NIM_NIL;
(*C_9373).Prev = NIM_NIL;
}
N_NIMCALL(void, Listadd_9007)(TY8234** Head_9011, TY8234* C_9012) {
(*C_9012).Next = (*Head_9011);
if (!!(((*Head_9011) == NIM_NIL))) goto LA2;
(*(*Head_9011)).Prev = C_9012;
LA2: ;
(*Head_9011) = C_9012;
}
N_NOINLINE(void, systemInit)(void) {
NI LOC1;
NI LOC2;
Dbglinehook_2722 = ((TY2719) (NIM_NIL));
Strdesc_3017.size = 8;
Strdesc_3017.kind = ((NU8) 28);
Strdesc_3017.flags = 2;
Initstackbottom_3013();
Initgc_3011();
LOC1 = fileno(stdin);
setmode(LOC1, O_BINARY);
LOC2 = fileno(stdout);
setmode(LOC2, O_BINARY);
asgnRefNoCycle((void**) &Stacktracenewline_4416, copyString(((NimStringDesc*) &TMP20525)));
excHandler = NIM_NIL;
registerSignalHandler();
asgnRefNoCycle((void**) &Gassertionfailed_5251, (EAssertionFailed*) newObj(NTI5250, sizeof(EAssertionFailed)));
(*Gassertionfailed_5251).Sup.Sup.Sup.m_type = NTI436;
asgnRefNoCycle((void**) &Buf_4801, mnewString(2048));
asgnRefNoCycle((void**) &Assertbuf_4802, mnewString(2048));
Buf_4801 = setLengthStr(Buf_4801, 0);
Assertbuf_4802 = setLengthStr(Assertbuf_4802, 0);
Lastsize_8491 = 4096;
Cyclethreshold_10609 = 4194304;
Recgclock_10610 = 0;
}

