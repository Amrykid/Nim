/* Generated by Nimrod Compiler v0.8.11 */
/*   (c) 2011 Andreas Rumpf */

typedef long long int NI;
typedef unsigned long long int NU;
#include "nimbase.h"

#include <sys/mman.h>
#include <errno.h>
#include <signal.h>
#include <dlfcn.h>
typedef struct TNimType TNimType;
typedef struct TNimNode TNimNode;
typedef struct TY11196 TY11196;
typedef struct TY10818 TY10818;
typedef struct TY10802 TY10802;
typedef struct TY10814 TY10814;
typedef struct TY10810 TY10810;
typedef struct TY11194 TY11194;
typedef struct TY8874 TY8874;
typedef struct TY8832 TY8832;
typedef struct TY8830 TY8830;
typedef struct TY8822 TY8822;
typedef struct TY8872 TY8872;
typedef struct TY8834 TY8834;
typedef struct TY8811 TY8811;
typedef struct TY8807 TY8807;
typedef struct TGenericSeq TGenericSeq;
typedef struct NimStringDesc NimStringDesc;
typedef struct TY420 TY420;
typedef struct TY418 TY418;
typedef struct TY416 TY416;
typedef struct E_Base E_Base;
typedef struct TNimObject TNimObject;
typedef struct TSafePoint TSafePoint;
typedef struct TY442 TY442;
typedef struct EAssertionFailed EAssertionFailed;
typedef struct EOverflow EOverflow;
typedef struct TY428 TY428;
typedef struct TY452 TY452;
typedef N_NIMCALL_PTR(void, TY3119) (void);
struct TNimType {
NI size;
NU8 kind;
NU8 flags;
TNimType* base;
TNimNode* node;
void* finalizer;
};
struct TY10818 {
NI Len;
NI Cap;
TY10802** D;
};
struct TY10814 {
NI Counter;
NI Max;
TY10810* Head;
TY10810** Data;
};
struct TY11194 {
NI Stackscans;
NI Cyclecollections;
NI Maxthreshold;
NI Maxstacksize;
NI Maxstackcells;
NI Cycletablesize;
};
struct TY11196 {
TY10818 Zct;
TY10818 Decstack;
TY10814 Cycleroots;
TY10818 Tempstack;
TY11194 Stat;
};
struct TY8830 {
NI Prevsize;
NI Size;
NIM_BOOL Used;
};
struct TY8832 {
  TY8830 Sup;
TY8832* Next;
TY8832* Prev;
TY8822* Freelist;
NI Free;
NI Acc;
NF64 Data;
};
typedef TY8832* TY8881[512];
typedef TY8807* TY8809[1024];
struct TY8811 {
TY8809 Data;
};
struct TY8874 {
TY8872* Llmem;
NI Currmem;
NI Maxmem;
NI Freemem;
TY8881 Freesmallchunks;
TY8834* Freechunkslist;
TY8811 Chunkstarts;
};
struct TY8834 {
  TY8830 Sup;
TY8834* Next;
TY8834* Prev;
NI Align;
NF64 Data;
};
typedef NI TY8814[8];
struct TY8807 {
TY8807* Next;
NI Key;
TY8814 Bits;
};
struct TY8872 {
NI Size;
NI Acc;
};
struct TGenericSeq {
NI len;
NI space;
};
typedef NIM_CHAR TY239[100000001];
struct NimStringDesc {
  TGenericSeq Sup;
TY239 data;
};
struct TNimNode {
NU8 kind;
NI offset;
TNimType* typ;
NCSTRING name;
NI len;
TNimNode** sons;
};
struct TNimObject {
TNimType* m_type;
};
struct E_Base {
  TNimObject Sup;
E_Base* parent;
NCSTRING name;
NimStringDesc* message;
};
struct TY416 {
  E_Base Sup;
};
struct TY418 {
  TY416 Sup;
};
struct TY420 {
  TY418 Sup;
};
struct TY10802 {
NI Refcount;
TNimType* Typ;
};
struct TY8822 {
TY8822* Next;
NI Zerofield;
};
struct TY10810 {
TY10810* Next;
NI Key;
TY8814 Bits;
};
typedef N_NIMCALL_PTR(void, TFinalizer) (void* Self_11200);
struct TSafePoint {
TSafePoint* prev;
NI status;
E_Base* exc;
jmp_buf context;
};
struct TY442 {
  TY418 Sup;
};
typedef NimStringDesc* TY4510[5];
typedef TFrame* TY5203[128];
struct EAssertionFailed {
  TY416 Sup;
};
struct TY428 {
  TY416 Sup;
};
struct EOverflow {
  TY428 Sup;
};
struct TY452 {
  TY416 Sup;
};
typedef NIM_CHAR TY19465[60];
static N_INLINE(void, Initstackbottom_3233)(void);
N_NOINLINE(void, setStackBottom)(void* Thestackbottom_1824);
N_NIMCALL(void, Initgc_3231)(void);
N_NIMCALL(void, Init_10879)(TY10818* S_10882, NI Cap_10883);
N_NOCONV(void*, Alloc0_2353)(NI Size_2355);
N_NOCONV(void*, Alloc_2350)(NI Size_2352);
N_NIMCALL(void*, Rawalloc_9803)(TY8874* A_9806, NI Requestedsize_9807);
static N_INLINE(NI, Roundup_8856)(NI X_8858, NI V_8859);
N_NIMCALL(TY8832*, Getsmallchunk_9770)(TY8874* A_9773);
N_NIMCALL(TY8834*, Getbigchunk_9694)(TY8874* A_9697, NI Size_9698);
N_NIMCALL(void, Splitchunk_9668)(TY8874* A_9671, TY8834* C_9672, NI Size_9673);
static N_INLINE(void, Updateprevsize_9213)(TY8874* A_9216, TY8834* C_9217, NI Prevsize_9218);
static N_INLINE(NIM_BOOL, Isaccessible_9154)(void* P_9156);
N_NIMCALL(NIM_BOOL, Contains_9013)(TY8811* S_9015, NI Key_9016);
N_NIMCALL(TY8807*, Intsetget_8976)(TY8811* T_8978, NI Key_8979);
static N_INLINE(NI, Pageindex_9083)(void* P_9085);
N_NIMCALL(void, Incl_9033)(TY8811* S_9036, NI Key_9037);
N_NIMCALL(TY8807*, Intsetput_8995)(TY8811* T_8998, NI Key_8999);
N_NIMCALL(void*, Llalloc_8930)(TY8874* A_8933, NI Size_8934);
static N_INLINE(void*, Osallocpages_8413)(NI Size_8415);
N_NIMCALL(void, Raiseoutofmem_8241)(void);
static N_INLINE(void, rawEcho)(NimStringDesc* X_4502);
N_NIMCALL(void, Write_3866)(FILE* F_3868, NimStringDesc* S_3869);
N_NIMCALL(NI, Writebuffer_3941)(FILE* F_3943, void* Buffer_3944, NI Len_3945);
N_NIMCALL(void*, newObj)(TNimType* Typ_13910, NI Size_13911);
static N_INLINE(void, Aquire_11217)(TY11196* Gch_11220);
static N_INLINE(void, Checkcollection_13903)(void);
N_NIMCALL(void, Collectct_12205)(TY11196* Gch_12208);
N_NIMCALL(NI, Getoccupiedmem_2417)(void);
N_NIMCALL(NI, Gettotalmem_2421)(void);
N_NIMCALL(NI, Getfreemem_2419)(void);
N_NOINLINE(NI, Stacksize_17001)(void);
N_CDECL(void, Markstackandregisters_17015)(TY11196* Gch_17018);
static N_INLINE(void, Gcmark_16203)(void* P_16205);
static N_INLINE(TY10802*, Usrtocell_11612)(void* Usr_11614);
N_NIMCALL(NIM_BOOL, Isallocatedptr_10401)(TY8874* A_10403, void* P_10404);
static N_INLINE(TY8830*, Pageaddr_9087)(void* P_9089);
static N_INLINE(NIM_BOOL, Chunkunused_9209)(TY8830* C_9211);
static N_INLINE(NIM_BOOL, Issmallchunk_9203)(TY8830* C_9205);
static N_INLINE(void, Add_10859)(TY10818* S_10862, TY10802* C_10863);
N_NOCONV(void, Dealloc_2360)(void* P_2362);
N_NIMCALL(void, Rawdealloc_10074)(TY8874* A_10077, void* P_10078);
N_NIMCALL(void, Freebigchunk_9222)(TY8874* A_9225, TY8834* C_9226);
N_NIMCALL(void, Excl_9040)(TY8811* S_9043, NI Key_9044);
static N_INLINE(NI, Pageindex_9079)(TY8830* C_9081);
N_NIMCALL(void, Freeoschunks_9128)(TY8874* A_9131, void* P_9132, NI Size_9133);
static N_INLINE(void, Osdeallocpages_8417)(void* P_8419, NI Size_8420);
static N_INLINE(void, Deccurrmem_8903)(TY8874* A_8906, NI Bytes_8907);
N_NIMCALL(void, Markthreadstacks_16211)(TY11196* Gch_16214);
N_NIMCALL(void, Collectzct_17201)(TY11196* Gch_17204);
static N_INLINE(NIM_BOOL, Canbecycleroot_11616)(TY10802* C_11618);
N_NIMCALL(void, Excl_11087)(TY10814* S_11090, TY10802* Cell_11091);
N_NIMCALL(TY10810*, Cellsetget_10915)(TY10814* T_10917, NI Key_10918);
static N_INLINE(NI, Nexttry_10910)(NI H_10912, NI Maxhash_10913);
N_NIMCALL(void, Preparedealloc_12225)(TY10802* Cell_12227);
static N_INLINE(void*, Celltousr_11608)(TY10802* Cell_11610);
N_NIMCALL(void, Forallchildren_12212)(TY10802* Cell_12214, NU8 Op_12215);
N_NIMCALL(void, Forallchildrenaux_12220)(void* Dest_12222, TNimType* Mt_12223, NU8 Op_12224);
N_NIMCALL(void, Dooperation_12216)(void* P_12218, NU8 Op_12219);
N_NOINLINE(void, Addzct_11601)(TY10818* S_11604, TY10802* C_11605);
N_NIMCALL(void, Forallslotsaux_13801)(void* Dest_13803, TNimNode* N_13805, NU8 Op_13806);
N_NIMCALL(TNimNode*, Selectbranch_7664)(void* Aa_7666, TNimNode* N_7668);
N_NIMCALL(NI, Getdiscriminant_7644)(void* Aa_7646, TNimNode* N_7648);
N_NIMCALL(void, Collectcycles_15403)(TY11196* Gch_15406);
N_NIMCALL(void, Init_10889)(TY10814* S_10892);
N_NIMCALL(NIM_BOOL, Containsorincl_11105)(TY10814* S_11108, TY10802* Cell_11109);
N_NOINLINE(void, Incl_11080)(TY10814* S_11083, TY10802* Cell_11084);
N_NIMCALL(TY10810*, Cellsetput_10997)(TY10814* T_11000, NI Key_11001);
N_NIMCALL(void, Cellsetenlarge_10971)(TY10814* T_10974);
N_NIMCALL(void, Cellsetrawinsert_10934)(TY10814* T_10936, TY10810** Data_10937, TY10810* Desc_10938);
N_NIMCALL(NIM_BOOL, Contains_11060)(TY10814* S_11062, TY10802* Cell_11063);
N_NIMCALL(void, Deinit_10893)(TY10814* S_10896);
N_NIMCALL(void, Unmarkstackandregisters_17801)(TY11196* Gch_17804);
static N_INLINE(void, Decref_13001)(TY10802* C_13003);
static N_INLINE(NI, Atomicdec_3226)(NI* Memloc_3229, NI X_3230);
static N_INLINE(void, Rtladdzct_12601)(TY10802* C_12603);
static N_INLINE(void, Rtladdcycleroot_12252)(TY10802* C_12254);
static N_INLINE(void, Release_11401)(TY11196* Gch_11404);
static N_INLINE(void, asgnRefNoCycle)(void** Dest_13218, void* Src_13219);
static N_INLINE(NI, Atomicinc_3221)(NI* Memloc_3224, NI X_3225);
N_NIMCALL(NimStringDesc*, copyString)(NimStringDesc* Src_18712);
N_NIMCALL(NimStringDesc*, rawNewString)(NI Space_18689);
N_NIMCALL(void, raiseException)(E_Base* E_5604, NCSTRING Ename_5605);
N_NIMCALL(void, Gcdisable_3063)(void);
static N_INLINE(void, pushCurrentException)(E_Base* E_5041);
static N_INLINE(void, asgnRef)(void** Dest_13214, void* Src_13215);
static N_INLINE(void, Incref_13202)(TY10802* C_13204);
N_NIMCALL(NimStringDesc*, setLengthStr)(NimStringDesc* S_18832, NI Newlen_18833);
N_NIMCALL(NimStringDesc*, resizeString)(NimStringDesc* Dest_18789, NI Addlen_18790);
static N_INLINE(NI, Resize_18601)(NI Old_18603);
N_NIMCALL(void*, Growobj_14407)(void* Old_14409, NI Newsize_14410);
N_NIMCALL(void, Rawwritestacktrace_5393)(NimStringDesc** S_5396);
static N_INLINE(void, appendString)(NimStringDesc* Dest_18799, NimStringDesc* Src_18800);
N_NIMCALL(NimStringDesc*, cstrToNimstr)(NCSTRING Str_18708);
N_NIMCALL(NimStringDesc*, toNimStr)(NCSTRING Str_18703, NI Len_18704);
N_NIMCALL(void, Writetostderr_4827)(NCSTRING Msg_4829);
N_NIMCALL(void, Write_3878)(FILE* F_3880, NCSTRING C_3881);
static N_INLINE(void, Quitordebug_5401)(void);
N_NIMCALL(void, Gcenable_3065)(void);
static N_INLINE(void, rawEchoNL)(void);
static N_INLINE(void, Inccurrmem_8886)(TY8874* A_8889, NI Bytes_8890);
N_NIMCALL(TY8834*, Requestoschunks_9094)(TY8874* A_9097, NI Size_9098);
N_NOCONV(void, signalHandler)(int Sig_5678);
N_NIMCALL(void, registerSignalHandler)(void);
N_NIMCALL(NimStringDesc*, mnewString)(NI Len_1355);
N_NIMCALL(NI, getRefcount)(void* P_11637);
N_NIMCALL(NimStringDesc*, mnewString)(NI Len_18699);
N_NIMCALL(NimStringDesc*, copyStrLast)(NimStringDesc* S_18748, NI Start_18749, NI Last_18750);
N_NIMCALL(NimStringDesc*, copyStr)(NimStringDesc* S_18765, NI Start_18766);
static N_INLINE(NI, addInt)(NI A_6203, NI B_6204);
N_NOINLINE(void, raiseOverflow)(void);
N_NIMCALL(NI, mulInt)(NI A_7203, NI B_7204);
N_NOINLINE(NIM_BOOL, Isonstack_12209)(void* P_12211);
N_NIMCALL(TNimType*, extGetCellType)(void* C_11633);
N_NIMCALL(void, Objectinitaux_19678)(void* Dest_19680, TNimNode* N_19682);
N_NIMCALL(void, objectInit)(void* Dest_19676, TNimType* Typ_19677);
N_NIMCALL(void, Rawreadline_3997)(FILE* F_3999, NimStringDesc** Result_4001);
N_NIMCALL(NimStringDesc*, addChar)(NimStringDesc* S_1803, NIM_CHAR C_1804);
N_NIMCALL(NI, Ptrsize_10433)(void* P_10435);
N_NIMCALL(NimStringDesc*, nimIntToStr)(NI X_19403);
static N_INLINE(void, pushSafePoint)(TSafePoint* S_5035);
N_NIMCALL(NIM_BOOL, Open_3817)(FILE** F_3820, NimStringDesc* Filename_3821, NU8 Mode_3822, NI Bufsize_3823);
N_NIMCALL(NI64, Getfilesize_3903)(FILE* F_3905);
N_NIMCALL(NI64, Getfilepos_3950)(FILE* F_3952);
N_NIMCALL(void, Setfilepos_3946)(FILE* F_3948, NI64 Pos_3949);
N_NIMCALL(NI, Readbuffer_3922)(FILE* F_3924, void* Buffer_3925, NI Len_3926);
static N_INLINE(void, popSafePoint)(void);
static N_INLINE(E_Base*, getCurrentException)(void);
static N_INLINE(void, popCurrentException)(void);
N_NIMCALL(void, reraiseException)(void);
N_NIMCALL(void, unsureAsgnRef)(void** Dest_13226, void* Src_13227);
N_NIMCALL(void, genericAssign)(void* Dest_19575, void* Src_19576, TNimType* Mt_19577);
N_NIMCALL(void, Genericassignaux_19578)(void* Dest_19580, void* Src_19581, TNimNode* N_19583);
static N_INLINE(void, Listremove_9248)(TY8834** Head_9252, TY8834* C_9253);
static N_INLINE(void, Listadd_9834)(TY8832** Head_9838, TY8832* C_9839);
static N_INLINE(void, Listremove_9978)(TY8832** Head_9982, TY8832* C_9983);
static N_INLINE(void, Listadd_9609)(TY8834** Head_9613, TY8834* C_9614);
STRING_LITERAL(TMP21118, "out of memory; cannot even throw an exception", 45);
STRING_LITERAL(TMP21120, "cannot write string to file", 27);
STRING_LITERAL(TMP21121, "No stack traceback available", 28);
STRING_LITERAL(TMP21122, "Error: unhandled exception: ", 28);
STRING_LITERAL(TMP21123, "Error: unhandled exception", 26);
STRING_LITERAL(TMP21124, " [", 2);
STRING_LITERAL(TMP21125, "]\012", 2);
STRING_LITERAL(TMP21126, "\012", 1);
STRING_LITERAL(TMP21127, "out of memory", 13);
STRING_LITERAL(TMP21128, "rb", 2);
STRING_LITERAL(TMP21129, "wb", 2);
STRING_LITERAL(TMP21130, "w+b", 3);
STRING_LITERAL(TMP21131, "r+b", 3);
STRING_LITERAL(TMP21132, "ab", 2);
NIM_CONST TY4510 Formatopen_4509 = {((NimStringDesc*) &TMP21128),
((NimStringDesc*) &TMP21129),
((NimStringDesc*) &TMP21130),
((NimStringDesc*) &TMP21131),
((NimStringDesc*) &TMP21132)}
;
STRING_LITERAL(TMP21133, "SIGINT: Interrupted by Ctrl-C.\012", 31);
STRING_LITERAL(TMP21134, "SIGSEGV: Illegal storage access. (Attempt to read from nil?)\012", 61);
STRING_LITERAL(TMP21135, "SIGABRT: Abnormal termination.\012", 31);
STRING_LITERAL(TMP21136, "SIGFPE: Arithmetic error.\012", 26);
STRING_LITERAL(TMP21137, "SIGILL: Illegal operation.\012", 27);
STRING_LITERAL(TMP21138, "SIGBUS: Illegal storage access. (Attempt to read from nil?)\012", 60);
STRING_LITERAL(TMP21139, "unknown signal\012", 15);
STRING_LITERAL(TMP39239, "over- or underflow", 18);
STRING_LITERAL(TMP195649, "", 0);
STRING_LITERAL(TMP195660, "no exception to reraise", 23);
STRING_LITERAL(TMP195764, " (invalid data!)", 16);
STRING_LITERAL(TMP195868, "cannot retrieve file position", 29);
STRING_LITERAL(TMP195869, "cannot set file position", 24);
STRING_LITERAL(TMP197501, "[GC] total memory: ", 19);
STRING_LITERAL(TMP197502, "\012[GC] occupied memory: ", 23);
STRING_LITERAL(TMP197503, "\012[GC] stack scans: ", 19);
STRING_LITERAL(TMP197504, "\012[GC] stack cells: ", 19);
STRING_LITERAL(TMP197505, "\012[GC] cycle collections: ", 25);
STRING_LITERAL(TMP197506, "\012[GC] max threshold: ", 21);
STRING_LITERAL(TMP197507, "\012[GC] zct capacity: ", 20);
STRING_LITERAL(TMP197508, "\012[GC] max cycle table size: ", 28);
STRING_LITERAL(TMP197509, "\012[GC] max stack size: ", 22);
TY3119 Dbglinehook_3122;
TFrame* framePtr;
TNimType Strdesc_3237;
extern TNimType* NTI4664; /* ref EIO */
extern TNimType* NTI420; /* EIO */
extern TNimType* NTI8244; /* ref EOutOfMemory */
extern TNimType* NTI442; /* EOutOfMemory */
NimStringDesc* Stacktracenewline_4826;
TSafePoint* excHandler;
E_Base* Currexception_5032;
NimStringDesc* Buf_5201;
NimStringDesc* Assertbuf_5202;
TY5203 Tempframes_5205;
EAssertionFailed* Gassertionfailed_5651;
NIM_BOOL Dbgaborting_5675;
extern TNimType* NTI5650; /* ref EAssertionFailed */
extern TNimType* NTI436; /* EAssertionFailed */
NIM_BOOL Ismultithreaded_7801;
TY442* Goutofmem_8240;
TY8874 Allocator_8929;
NI Lastsize_9093;
void* Stackbottom_11213;
TY11196 Gch_11214;
NI Cyclethreshold_11215;
NI Recgclock_11216;
extern TNimType* NTI6051; /* ref EOverflow */
extern TNimType* NTI432; /* EOverflow */
extern TNimType* NTI5633; /* ref ENoExceptionToReraise */
extern TNimType* NTI452; /* ENoExceptionToReraise */
N_NOINLINE(void, setStackBottom)(void* Thestackbottom_1824) {
NI A_16604;
NI B_16605;
if (!(Stackbottom_11213 == NIM_NIL)) goto LA2;
Stackbottom_11213 = Thestackbottom_1824;
goto LA1;
LA2: ;
A_16604 = 0;
A_16604 = ((NI) (Thestackbottom_1824));
B_16605 = 0;
B_16605 = ((NI) (Stackbottom_11213));
Stackbottom_11213 = ((void*) (((A_16604 >= B_16605) ? A_16604 : B_16605)));
LA1: ;
}
static N_INLINE(void, Initstackbottom_3233)(void) {
void* volatile Locals_3235;
Locals_3235 = 0;
setStackBottom(((void*) (&Locals_3235)));
}
static N_INLINE(NI, Roundup_8856)(NI X_8858, NI V_8859) {
NI Result_8860;
Result_8860 = 0;
Result_8860 = (NI64)((NI64)(X_8858 + (NI64)(V_8859 - 1)) & (NI64)((NU64) ~((NI64)(V_8859 - 1))));
return Result_8860;
}
N_NIMCALL(TY8807*, Intsetget_8976)(TY8811* T_8978, NI Key_8979) {
TY8807* Result_8980;
TY8807* It_8981;
Result_8980 = 0;
It_8981 = 0;
It_8981 = (*T_8978).Data[((NI64)(Key_8979 & 1023))-0];
while (1) {
if (!!((It_8981 == NIM_NIL))) goto LA1;
if (!((*It_8981).Key == Key_8979)) goto LA3;
Result_8980 = It_8981;
goto BeforeRet;
LA3: ;
It_8981 = (*It_8981).Next;
} LA1: ;
Result_8980 = NIM_NIL;
BeforeRet: ;
return Result_8980;
}
N_NIMCALL(NIM_BOOL, Contains_9013)(TY8811* S_9015, NI Key_9016) {
NIM_BOOL Result_9017;
TY8807* T_9018;
NI U_9030;
Result_9017 = 0;
T_9018 = 0;
T_9018 = Intsetget_8976(S_9015, (NI64)((NU64)(Key_9016) >> (NU64)(9)));
if (!!((T_9018 == NIM_NIL))) goto LA2;
U_9030 = 0;
U_9030 = (NI64)(Key_9016 & 511);
Result_9017 = !(((NI64)((*T_9018).Bits[((NI64)((NU64)(U_9030) >> (NU64)(6)))-0] & (NI64)((NU64)(1) << (NU64)((NI64)(U_9030 & 63)))) == 0));
goto LA1;
LA2: ;
Result_9017 = NIM_FALSE;
LA1: ;
return Result_9017;
}
static N_INLINE(NI, Pageindex_9083)(void* P_9085) {
NI Result_9086;
Result_9086 = 0;
Result_9086 = (NI64)((NU64)(((NI) (P_9085))) >> (NU64)(12));
return Result_9086;
}
static N_INLINE(NIM_BOOL, Isaccessible_9154)(void* P_9156) {
NIM_BOOL Result_9157;
NI LOC1;
Result_9157 = 0;
LOC1 = Pageindex_9083(P_9156);
Result_9157 = Contains_9013(&Allocator_8929.Chunkstarts, LOC1);
return Result_9157;
}
static N_INLINE(void, Updateprevsize_9213)(TY8874* A_9216, TY8834* C_9217, NI Prevsize_9218) {
TY8830* Ri_9219;
NIM_BOOL LOC2;
Ri_9219 = 0;
Ri_9219 = ((TY8830*) ((NI64)((NU64)(((NI) (C_9217))) + (NU64)((*C_9217).Sup.Size))));
LOC2 = Isaccessible_9154(((void*) (Ri_9219)));
if (!LOC2) goto LA3;
(*Ri_9219).Prevsize = Prevsize_9218;
LA3: ;
}
N_NIMCALL(NI, Writebuffer_3941)(FILE* F_3943, void* Buffer_3944, NI Len_3945) {
NI Result_4653;
Result_4653 = 0;
Result_4653 = fwrite(Buffer_3944, 1, Len_3945, F_3943);
return Result_4653;
}
static N_INLINE(void, Aquire_11217)(TY11196* Gch_11220) {
}
N_NIMCALL(NI, Gettotalmem_2421)(void) {
NI Result_10479;
Result_10479 = 0;
Result_10479 = Allocator_8929.Currmem;
goto BeforeRet;
BeforeRet: ;
return Result_10479;
}
N_NIMCALL(NI, Getfreemem_2419)(void) {
NI Result_10476;
Result_10476 = 0;
Result_10476 = Allocator_8929.Freemem;
return Result_10476;
}
N_NIMCALL(NI, Getoccupiedmem_2417)(void) {
NI Result_10482;
NI LOC1;
NI LOC2;
Result_10482 = 0;
LOC1 = Gettotalmem_2421();
LOC2 = Getfreemem_2419();
Result_10482 = (NI64)(LOC1 - LOC2);
goto BeforeRet;
BeforeRet: ;
return Result_10482;
}
N_NOINLINE(NI, Stacksize_17001)(void) {
NI Result_17003;
void* volatile Stacktop_17004;
Result_17003 = 0;
Stacktop_17004 = 0;
Result_17003 = (NI64)abs((NI64)(((NI) (&Stacktop_17004)) - ((NI) (Stackbottom_11213))));
return Result_17003;
}
static N_INLINE(TY10802*, Usrtocell_11612)(void* Usr_11614) {
TY10802* Result_11615;
Result_11615 = 0;
Result_11615 = ((TY10802*) ((NI64)((NU64)(((NI) (Usr_11614))) - (NU64)(((NI) (((NI)sizeof(TY10802))))))));
return Result_11615;
}
static N_INLINE(TY8830*, Pageaddr_9087)(void* P_9089) {
TY8830* Result_9090;
Result_9090 = 0;
Result_9090 = ((TY8830*) ((NI64)(((NI) (P_9089)) & -4096)));
return Result_9090;
}
static N_INLINE(NIM_BOOL, Chunkunused_9209)(TY8830* C_9211) {
NIM_BOOL Result_9212;
Result_9212 = 0;
Result_9212 = !((*C_9211).Used);
return Result_9212;
}
static N_INLINE(NIM_BOOL, Issmallchunk_9203)(TY8830* C_9205) {
NIM_BOOL Result_9206;
Result_9206 = 0;
Result_9206 = ((*C_9205).Size <= (NI64)(4096 - (NI64)(((NI)sizeof(TY8832)) - 8)));
goto BeforeRet;
BeforeRet: ;
return Result_9206;
}
N_NIMCALL(NIM_BOOL, Isallocatedptr_10401)(TY8874* A_10403, void* P_10404) {
NIM_BOOL Result_10405;
NIM_BOOL LOC2;
TY8830* C_10406;
NIM_BOOL LOC6;
NIM_BOOL LOC10;
TY8832* C_10407;
NI Offset_10408;
NIM_BOOL LOC13;
NIM_BOOL LOC14;
TY8834* C_10412;
NIM_BOOL LOC17;
Result_10405 = 0;
LOC2 = Isaccessible_9154(P_10404);
if (!LOC2) goto LA3;
C_10406 = 0;
C_10406 = Pageaddr_9087(P_10404);
LOC6 = Chunkunused_9209(C_10406);
if (!!(LOC6)) goto LA7;
LOC10 = Issmallchunk_9203(C_10406);
if (!LOC10) goto LA11;
C_10407 = 0;
C_10407 = ((TY8832*) (C_10406));
Offset_10408 = 0;
Offset_10408 = (NI64)((NU64)((NI64)(((NI) (P_10404)) & 4095)) - (NU64)((NI64)(((NI)sizeof(TY8832)) - 8)));
LOC14 = ((NU64)(Offset_10408) < (NU64)((*C_10407).Acc));
if (!(LOC14)) goto LA15;
LOC14 = ((NI64)((NU64)(Offset_10408) % (NU64)((*C_10407).Sup.Size)) == 0);
LA15: ;
LOC13 = LOC14;
if (!(LOC13)) goto LA16;
LOC13 = ((NU64)(1) < (NU64)((*((TY8822*) (P_10404))).Zerofield));
LA16: ;
Result_10405 = LOC13;
goto LA9;
LA11: ;
C_10412 = 0;
C_10412 = ((TY8834*) (C_10406));
LOC17 = (P_10404 == ((void*) (&(*C_10412).Data)));
if (!(LOC17)) goto LA18;
LOC17 = ((NU64)(1) < (NU64)((*((TY8822*) (P_10404))).Zerofield));
LA18: ;
Result_10405 = LOC17;
LA9: ;
LA7: ;
LA3: ;
return Result_10405;
}
N_NIMCALL(void, Excl_9040)(TY8811* S_9043, NI Key_9044) {
TY8807* T_9045;
NI U_9057;
T_9045 = 0;
T_9045 = Intsetget_8976(&(*S_9043), (NI64)((NU64)(Key_9044) >> (NU64)(9)));
if (!!((T_9045 == NIM_NIL))) goto LA2;
U_9057 = 0;
U_9057 = (NI64)(Key_9044 & 511);
(*T_9045).Bits[((NI64)((NU64)(U_9057) >> (NU64)(6)))-0] = (NI64)((*T_9045).Bits[((NI64)((NU64)(U_9057) >> (NU64)(6)))-0] & (NI64)((NU64) ~((NI64)((NU64)(1) << (NU64)((NI64)(U_9057 & 63))))));
LA2: ;
}
static N_INLINE(NI, Pageindex_9079)(TY8830* C_9081) {
NI Result_9082;
Result_9082 = 0;
Result_9082 = (NI64)((NU64)(((NI) (C_9081))) >> (NU64)(12));
return Result_9082;
}
static N_INLINE(void, Osdeallocpages_8417)(void* P_8419, NI Size_8420) {
munmap(P_8419, Size_8420);
}
static N_INLINE(void, Deccurrmem_8903)(TY8874* A_8906, NI Bytes_8907) {
(*A_8906).Maxmem = (((*A_8906).Maxmem >= (*A_8906).Currmem) ? (*A_8906).Maxmem : (*A_8906).Currmem);
(*A_8906).Currmem -= Bytes_8907;
}
N_NIMCALL(void, Freeoschunks_9128)(TY8874* A_9131, void* P_9132, NI Size_9133) {
TY8830* C_9134;
NI Nxt_9135;
TY8830* Next_9138;
NI LOC2;
NIM_BOOL LOC3;
NI LOC6;
C_9134 = 0;
C_9134 = ((TY8830*) (P_9132));
Nxt_9135 = 0;
Nxt_9135 = (NI64)((NU64)(((NI) (P_9132))) + (NU64)((*C_9134).Size));
Next_9138 = 0;
Next_9138 = ((TY8830*) (Nxt_9135));
LOC2 = Pageindex_9079(Next_9138);
LOC3 = Contains_9013(&(*A_9131).Chunkstarts, LOC2);
if (!LOC3) goto LA4;
(*Next_9138).Prevsize = 0;
LA4: ;
LOC6 = Pageindex_9083(P_9132);
Excl_9040(&(*A_9131).Chunkstarts, LOC6);
Osdeallocpages_8417(P_9132, Size_9133);
Deccurrmem_8903(A_9131, Size_9133);
(*A_9131).Freemem -= Size_9133;
}
N_NIMCALL(void, Freebigchunk_9222)(TY8874* A_9225, TY8834* C_9226) {
TY8834* C_9227;
TY8830* Ri_9242;
NIM_BOOL LOC2;
NIM_BOOL LOC7;
NI LOC10;
TY8830* Le_9403;
NIM_BOOL LOC15;
NIM_BOOL LOC20;
NI LOC23;
NI LOC27;
C_9227 = 0;
C_9227 = C_9226;
(*A_9225).Freemem += (*C_9227).Sup.Size;
Ri_9242 = 0;
Ri_9242 = ((TY8830*) ((NI64)((NU64)(((NI) (C_9227))) + (NU64)((*C_9227).Sup.Size))));
LOC2 = Isaccessible_9154(((void*) (Ri_9242)));
if (!(LOC2)) goto LA3;
LOC2 = Chunkunused_9209(Ri_9242);
LA3: ;
if (!LOC2) goto LA4;
LOC7 = Issmallchunk_9203(Ri_9242);
if (!!(LOC7)) goto LA8;
Listremove_9248(&(*A_9225).Freechunkslist, ((TY8834*) (Ri_9242)));
(*C_9227).Sup.Size += (*Ri_9242).Size;
LOC10 = Pageindex_9079(Ri_9242);
Excl_9040(&(*A_9225).Chunkstarts, LOC10);
LA8: ;
LA4: ;
if (!!(((*C_9227).Sup.Prevsize == 0))) goto LA12;
Le_9403 = 0;
Le_9403 = ((TY8830*) ((NI64)((NU64)(((NI) (C_9227))) - (NU64)((*C_9227).Sup.Prevsize))));
LOC15 = Isaccessible_9154(((void*) (Le_9403)));
if (!(LOC15)) goto LA16;
LOC15 = Chunkunused_9209(Le_9403);
LA16: ;
if (!LOC15) goto LA17;
LOC20 = Issmallchunk_9203(Le_9403);
if (!!(LOC20)) goto LA21;
Listremove_9248(&(*A_9225).Freechunkslist, ((TY8834*) (Le_9403)));
(*Le_9403).Size += (*C_9227).Sup.Size;
LOC23 = Pageindex_9079(&C_9227->Sup);
Excl_9040(&(*A_9225).Chunkstarts, LOC23);
C_9227 = ((TY8834*) (Le_9403));
LA21: ;
LA17: ;
LA12: ;
if (!((*C_9227).Sup.Size < 1048576)) goto LA25;
LOC27 = Pageindex_9079(&C_9227->Sup);
Incl_9033(&(*A_9225).Chunkstarts, LOC27);
Updateprevsize_9213(A_9225, C_9227, (*C_9227).Sup.Size);
Listadd_9609(&(*A_9225).Freechunkslist, C_9227);
(*C_9227).Sup.Used = NIM_FALSE;
goto LA24;
LA25: ;
Freeoschunks_9128(A_9225, ((void*) (C_9227)), (*C_9227).Sup.Size);
LA24: ;
}
N_NIMCALL(void, Rawdealloc_10074)(TY8874* A_10077, void* P_10078) {
TY8830* C_10079;
NIM_BOOL LOC2;
TY8832* C_10080;
NI S_10081;
TY8822* F_10083;
C_10079 = 0;
C_10079 = Pageaddr_9087(P_10078);
LOC2 = Issmallchunk_9203(C_10079);
if (!LOC2) goto LA3;
C_10080 = 0;
C_10080 = ((TY8832*) (C_10079));
S_10081 = 0;
S_10081 = (*C_10080).Sup.Size;
F_10083 = 0;
F_10083 = ((TY8822*) (P_10078));
(*F_10083).Zerofield = 0;
(*F_10083).Next = (*C_10080).Freelist;
(*C_10080).Freelist = F_10083;
if (!((*C_10080).Free < S_10081)) goto LA6;
Listadd_9834(&(*A_10077).Freesmallchunks[((NI64)(S_10081 / 8))-0], C_10080);
(*C_10080).Free += S_10081;
goto LA5;
LA6: ;
(*C_10080).Free += S_10081;
if (!((*C_10080).Free == (NI64)(4096 - (NI64)(((NI)sizeof(TY8832)) - 8)))) goto LA9;
Listremove_9978(&(*A_10077).Freesmallchunks[((NI64)(S_10081 / 8))-0], C_10080);
(*C_10080).Sup.Size = 4096;
Freebigchunk_9222(A_10077, ((TY8834*) (C_10080)));
LA9: ;
LA5: ;
goto LA1;
LA3: ;
Freebigchunk_9222(A_10077, ((TY8834*) (C_10079)));
LA1: ;
}
N_NOCONV(void, Dealloc_2360)(void* P_2362) {
void* X_10428;
X_10428 = 0;
X_10428 = ((void*) ((NI64)((NU64)(((NI) (P_2362))) - (NU64)(((NI)sizeof(TY8822))))));
Rawdealloc_10074(&Allocator_8929, X_10428);
}
static N_INLINE(void, Add_10859)(TY10818* S_10862, TY10802* C_10863) {
TY10802** D_10866;
void* LOC4;
if (!((*S_10862).Cap <= (*S_10862).Len)) goto LA2;
(*S_10862).Cap = (NI64)((NI64)((*S_10862).Cap * 3) / 2);
D_10866 = 0;
LOC4 = Alloc_2350((NI64)((*S_10862).Cap * 8));
D_10866 = ((TY10802**) (LOC4));
memcpy(((void*) (D_10866)), ((void*) ((*S_10862).D)), (NI64)((*S_10862).Len * 8));
Dealloc_2360(((void*) ((*S_10862).D)));
(*S_10862).D = D_10866;
LA2: ;
(*S_10862).D[((*S_10862).Len)-0] = C_10863;
(*S_10862).Len += 1;
}
static N_INLINE(void, Gcmark_16203)(void* P_16205) {
TY10802* Cell_16206;
NI C_16207;
NIM_BOOL LOC2;
NIM_BOOL LOC7;
Cell_16206 = 0;
Cell_16206 = Usrtocell_11612(P_16205);
C_16207 = 0;
C_16207 = ((NI) (Cell_16206));
LOC2 = ((NU64)(4096) < (NU64)(C_16207));
if (!(LOC2)) goto LA3;
LOC2 = ((NI64)(C_16207 & 7) == 0);
LA3: ;
if (!LOC2) goto LA4;
LOC7 = Isallocatedptr_10401(&Allocator_8929, ((void*) (Cell_16206)));
if (!LOC7) goto LA8;
(*Cell_16206).Refcount = (NI64)((NU64)((*Cell_16206).Refcount) + (NU64)(8));
Add_10859(&Gch_11214.Decstack, Cell_16206);
LA8: ;
LA4: ;
}
N_CDECL(void, Markstackandregisters_17015)(TY11196* Gch_17018) {
jmp_buf Registers_17019;
int LOC2;
NI Max_17023;
NI Sp_17025;
memset((void*)&Registers_17019, 0, sizeof(Registers_17019));
LOC2 = setjmp(Registers_17019);
if (!(LOC2 == ((NI32) 0))) goto LA3;
Max_17023 = 0;
Max_17023 = ((NI) (Stackbottom_11213));
Sp_17025 = 0;
Sp_17025 = ((NI) (Registers_17019));
while (1) {
if (!((NU64)(Sp_17025) <= (NU64)(Max_17023))) goto LA5;
Gcmark_16203((*((void**) (Sp_17025))));
Sp_17025 = (NI64)((NU64)(Sp_17025) + (NU64)(8));
} LA5: ;
LA3: ;
}
N_NIMCALL(void, Markthreadstacks_16211)(TY11196* Gch_16214) {
}
static N_INLINE(NIM_BOOL, Canbecycleroot_11616)(TY10802* C_11618) {
NIM_BOOL Result_11619;
Result_11619 = 0;
Result_11619 = !((((*(*C_11618).Typ).flags &(1<<((((NU8) 1))&7)))!=0));
return Result_11619;
}
static N_INLINE(NI, Nexttry_10910)(NI H_10912, NI Maxhash_10913) {
NI Result_10914;
Result_10914 = 0;
Result_10914 = (NI64)((NI64)((NI64)(5 * H_10912) + 1) & Maxhash_10913);
return Result_10914;
}
N_NIMCALL(TY10810*, Cellsetget_10915)(TY10814* T_10917, NI Key_10918) {
TY10810* Result_10919;
NI H_10920;
Result_10919 = 0;
H_10920 = 0;
H_10920 = (NI64)(((NI) (Key_10918)) & (*T_10917).Max);
while (1) {
if (!!(((*T_10917).Data[(H_10920)-0] == NIM_NIL))) goto LA1;
if (!((*(*T_10917).Data[(H_10920)-0]).Key == Key_10918)) goto LA3;
Result_10919 = (*T_10917).Data[(H_10920)-0];
goto BeforeRet;
LA3: ;
H_10920 = Nexttry_10910(H_10920, (*T_10917).Max);
} LA1: ;
Result_10919 = NIM_NIL;
goto BeforeRet;
BeforeRet: ;
return Result_10919;
}
N_NIMCALL(void, Excl_11087)(TY10814* S_11090, TY10802* Cell_11091) {
NI U_11092;
TY10810* T_11093;
U_11092 = 0;
U_11092 = ((NI) (Cell_11091));
T_11093 = 0;
T_11093 = Cellsetget_10915(&(*S_11090), (NI64)((NU64)(U_11092) >> (NU64)(12)));
if (!!((T_11093 == NIM_NIL))) goto LA2;
U_11092 = (NI64)((NU64)((NI64)((NU64)(U_11092) % (NU64)(4096))) / (NU64)(8));
(*T_11093).Bits[((NI64)((NU64)(U_11092) >> (NU64)(6)))-0] = (NI64)((*T_11093).Bits[((NI64)((NU64)(U_11092) >> (NU64)(6)))-0] & (NI64)((NU64) ~((NI64)((NU64)(1) << (NU64)((NI64)(U_11092 & 63))))));
LA2: ;
}
static N_INLINE(void*, Celltousr_11608)(TY10802* Cell_11610) {
void* Result_11611;
Result_11611 = 0;
Result_11611 = ((void*) ((NI64)((NU64)(((NI) (Cell_11610))) + (NU64)(((NI) (((NI)sizeof(TY10802))))))));
return Result_11611;
}
N_NIMCALL(void, Preparedealloc_12225)(TY10802* Cell_12227) {
void* LOC4;
if (!!(((*(*Cell_12227).Typ).finalizer == NIM_NIL))) goto LA2;
Recgclock_11216 += 1;
LOC4 = Celltousr_11608(Cell_12227);
((TFinalizer) ((*(*Cell_12227).Typ).finalizer))(LOC4);
Recgclock_11216 -= 1;
LA2: ;
}
N_NOINLINE(void, Addzct_11601)(TY10818* S_11604, TY10802* C_11605) {
if (!((NI64)((*C_11605).Refcount & 4) == 0)) goto LA2;
(*C_11605).Refcount = (NI64)((NI64)((*C_11605).Refcount & -8) | 4);
Add_10859(S_11604, C_11605);
LA2: ;
}
N_NIMCALL(void, Dooperation_12216)(void* P_12218, NU8 Op_12219) {
TY10802* C_15206;
if (!(P_12218 == NIM_NIL)) goto LA2;
goto BeforeRet;
LA2: ;
C_15206 = 0;
C_15206 = Usrtocell_11612(P_12218);
switch (Op_12219) {
case ((NU8) 0):
(*C_15206).Refcount = (NI64)((NU64)((*C_15206).Refcount) - (NU64)(8));
if (!((NU64)((*C_15206).Refcount) < (NU64)(8))) goto LA5;
Addzct_11601(&Gch_11214.Zct, C_15206);
LA5: ;
break;
case ((NU8) 1):
Add_10859(&Gch_11214.Tempstack, C_15206);
break;
case ((NU8) 2):
(*C_15206).Refcount = (NI64)((NU64)((*C_15206).Refcount) - (NU64)(8));
break;
}
BeforeRet: ;
}
N_NIMCALL(NI, Getdiscriminant_7644)(void* Aa_7646, TNimNode* N_7648) {
NI Result_7649;
NI D_7659;
NI A_7660;
Result_7649 = 0;
D_7659 = 0;
A_7660 = 0;
A_7660 = ((NI) (Aa_7646));
switch ((*(*N_7648).typ).size) {
case 1:
D_7659 = ((NI)(NU)(NU8)((*((NI8*) ((NI64)((NU64)(A_7660) + (NU64)((*N_7648).offset)))))));
break;
case 2:
D_7659 = ((NI)(NU)(NU16)((*((NI16*) ((NI64)((NU64)(A_7660) + (NU64)((*N_7648).offset)))))));
break;
case 4:
D_7659 = ((NI) ((*((int*) ((NI64)((NU64)(A_7660) + (NU64)((*N_7648).offset)))))));
break;
default:
break;
}
Result_7649 = D_7659;
goto BeforeRet;
BeforeRet: ;
return Result_7649;
}
N_NIMCALL(TNimNode*, Selectbranch_7664)(void* Aa_7666, TNimNode* N_7668) {
TNimNode* Result_7670;
NI Discr_7671;
Result_7670 = 0;
Discr_7671 = 0;
Discr_7671 = Getdiscriminant_7644(Aa_7666, N_7668);
if (!((NU64)(Discr_7671) < (NU64)((*N_7668).len))) goto LA2;
Result_7670 = (*N_7668).sons[(Discr_7671)-0];
if (!(Result_7670 == NIM_NIL)) goto LA5;
Result_7670 = (*N_7668).sons[((*N_7668).len)-0];
LA5: ;
goto LA1;
LA2: ;
Result_7670 = (*N_7668).sons[((*N_7668).len)-0];
LA1: ;
return Result_7670;
}
N_NIMCALL(void, Forallslotsaux_13801)(void* Dest_13803, TNimNode* N_13805, NU8 Op_13806) {
NI D_13807;
NI I_13816;
NI HEX3Atmp_21023;
NI Res_21025;
TNimNode* M_13817;
D_13807 = 0;
D_13807 = ((NI) (Dest_13803));
switch ((*N_13805).kind) {
case ((NU8) 0):
break;
case ((NU8) 1):
Forallchildrenaux_12220(((void*) ((NI64)((NU64)(D_13807) + (NU64)((*N_13805).offset)))), (*N_13805).typ, Op_13806);
break;
case ((NU8) 2):
I_13816 = 0;
HEX3Atmp_21023 = 0;
HEX3Atmp_21023 = (NI64)((*N_13805).len - 1);
Res_21025 = 0;
Res_21025 = 0;
while (1) {
if (!(Res_21025 <= HEX3Atmp_21023)) goto LA1;
I_13816 = Res_21025;
Forallslotsaux_13801(Dest_13803, (*N_13805).sons[(I_13816)-0], Op_13806);
Res_21025 += 1;
} LA1: ;
break;
case ((NU8) 3):
M_13817 = 0;
M_13817 = Selectbranch_7664(Dest_13803, N_13805);
if (!!((M_13817 == NIM_NIL))) goto LA3;
Forallslotsaux_13801(Dest_13803, M_13817, Op_13806);
LA3: ;
break;
}
}
N_NIMCALL(void, Forallchildrenaux_12220)(void* Dest_12222, TNimType* Mt_12223, NU8 Op_12224) {
NI D_13834;
NI I_13854;
NI HEX3Atmp_21026;
NI Res_21028;
D_13834 = 0;
D_13834 = ((NI) (Dest_12222));
if (!(Dest_12222 == NIM_NIL)) goto LA2;
goto BeforeRet;
LA2: ;
if (!!((((*Mt_12223).flags &(1<<((((NU8) 0))&7)))!=0))) goto LA5;
switch ((*Mt_12223).kind) {
case ((NU8) 16):
case ((NU8) 4):
case ((NU8) 27):
I_13854 = 0;
HEX3Atmp_21026 = 0;
HEX3Atmp_21026 = (NI64)((NI64)((*Mt_12223).size / (*(*Mt_12223).base).size) - 1);
Res_21028 = 0;
Res_21028 = 0;
while (1) {
if (!(Res_21028 <= HEX3Atmp_21026)) goto LA7;
I_13854 = Res_21028;
Forallchildrenaux_12220(((void*) ((NI64)((NU64)(D_13834) + (NU64)((NI64)((NU64)(I_13854) * (NU64)((*(*Mt_12223).base).size)))))), (*Mt_12223).base, Op_12224);
Res_21028 += 1;
} LA7: ;
break;
case ((NU8) 22):
case ((NU8) 28):
case ((NU8) 24):
Dooperation_12216((*((void**) (D_13834))), Op_12224);
break;
case ((NU8) 17):
case ((NU8) 18):
case ((NU8) 40):
Forallslotsaux_13801(Dest_12222, (*Mt_12223).node, Op_12224);
break;
default:
break;
}
LA5: ;
BeforeRet: ;
}
N_NIMCALL(void, Forallchildren_12212)(TY10802* Cell_12214, NU8 Op_12215) {
void* LOC1;
NI D_13881;
void* LOC2;
TGenericSeq* S_13882;
NI I_13902;
NI HEX3Atmp_21029;
NI Res_21031;
switch ((*(*Cell_12214).Typ).kind) {
case ((NU8) 22):
LOC1 = Celltousr_11608(Cell_12214);
Forallchildrenaux_12220(LOC1, (*(*Cell_12214).Typ).base, Op_12215);
break;
case ((NU8) 24):
D_13881 = 0;
LOC2 = Celltousr_11608(Cell_12214);
D_13881 = ((NI) (LOC2));
S_13882 = 0;
S_13882 = ((TGenericSeq*) (D_13881));
if (!!((S_13882 == NIM_NIL))) goto LA4;
I_13902 = 0;
HEX3Atmp_21029 = 0;
HEX3Atmp_21029 = (NI64)((*S_13882).len - 1);
Res_21031 = 0;
Res_21031 = 0;
while (1) {
if (!(Res_21031 <= HEX3Atmp_21029)) goto LA6;
I_13902 = Res_21031;
Forallchildrenaux_12220(((void*) ((NI64)((NU64)((NI64)((NU64)(D_13881) + (NU64)((NI64)((NU64)(I_13902) * (NU64)((*(*(*Cell_12214).Typ).base).size))))) + (NU64)(16)))), (*(*Cell_12214).Typ).base, Op_12215);
Res_21031 += 1;
} LA6: ;
LA4: ;
break;
case ((NU8) 28):
break;
default:
break;
}
}
N_NIMCALL(void, Collectzct_17201)(TY11196* Gch_17204) {
NI* L_17206;
TY10802* C_17211;
NIM_BOOL LOC6;
L_17206 = 0;
L_17206 = &(*Gch_17204).Zct.Len;
while (1) {
if (!(0 < (*L_17206))) goto LA1;
C_17211 = 0;
C_17211 = (*Gch_17204).Zct.D[(0)-0];
(*C_17211).Refcount = (NI64)((*C_17211).Refcount & -8);
(*Gch_17204).Zct.D[(0)-0] = (*Gch_17204).Zct.D[((NI64)((*L_17206) - 1))-0];
(*L_17206) -= 1;
if (!((NU64)((*C_17211).Refcount) < (NU64)(8))) goto LA3;
LOC6 = Canbecycleroot_11616(C_17211);
if (!LOC6) goto LA7;
Excl_11087(&(*Gch_17204).Cycleroots, C_17211);
LA7: ;
Preparedealloc_12225(C_17211);
Forallchildren_12212(C_17211, ((NU8) 0));
Rawdealloc_10074(&Allocator_8929, ((void*) (C_17211)));
LA3: ;
} LA1: ;
}
N_NIMCALL(void, Init_10889)(TY10814* S_10892) {
void* LOC1;
LOC1 = Alloc0_2353(8192);
(*S_10892).Data = ((TY10810**) (LOC1));
(*S_10892).Max = 1023;
(*S_10892).Counter = 0;
(*S_10892).Head = NIM_NIL;
}
N_NIMCALL(void, Cellsetrawinsert_10934)(TY10814* T_10936, TY10810** Data_10937, TY10810* Desc_10938) {
NI H_10939;
H_10939 = 0;
H_10939 = (NI64)(((NI) ((*Desc_10938).Key)) & (*T_10936).Max);
while (1) {
if (!!((Data_10937[(H_10939)-0] == NIM_NIL))) goto LA1;
H_10939 = Nexttry_10910(H_10939, (*T_10936).Max);
} LA1: ;
Data_10937[(H_10939)-0] = Desc_10938;
}
N_NIMCALL(void, Cellsetenlarge_10971)(TY10814* T_10974) {
NI Oldmax_10975;
TY10810** N_10976;
void* LOC1;
NI I_10985;
NI Res_21022;
Oldmax_10975 = 0;
Oldmax_10975 = (*T_10974).Max;
(*T_10974).Max = (NI64)((NI64)((NI64)((*T_10974).Max + 1) * 2) - 1);
N_10976 = 0;
LOC1 = Alloc0_2353((NI64)((NI64)((*T_10974).Max + 1) * 8));
N_10976 = ((TY10810**) (LOC1));
I_10985 = 0;
Res_21022 = 0;
Res_21022 = 0;
while (1) {
if (!(Res_21022 <= Oldmax_10975)) goto LA2;
I_10985 = Res_21022;
if (!!(((*T_10974).Data[(I_10985)-0] == NIM_NIL))) goto LA4;
Cellsetrawinsert_10934(&(*T_10974), N_10976, (*T_10974).Data[(I_10985)-0]);
LA4: ;
Res_21022 += 1;
} LA2: ;
Dealloc_2360(((void*) ((*T_10974).Data)));
(*T_10974).Data = N_10976;
}
N_NIMCALL(TY10810*, Cellsetput_10997)(TY10814* T_11000, NI Key_11001) {
TY10810* Result_11002;
NI H_11003;
TY10810* X_11004;
NIM_BOOL LOC9;
void* LOC14;
Result_11002 = 0;
H_11003 = 0;
H_11003 = (NI64)(((NI) (Key_11001)) & (*T_11000).Max);
while (1) {
X_11004 = 0;
X_11004 = (*T_11000).Data[(H_11003)-0];
if (!(X_11004 == NIM_NIL)) goto LA3;
goto LA1;
LA3: ;
if (!((*X_11004).Key == Key_11001)) goto LA6;
Result_11002 = X_11004;
goto BeforeRet;
LA6: ;
H_11003 = Nexttry_10910(H_11003, (*T_11000).Max);
} LA1: ;
LOC9 = ((NI64)((NI64)((*T_11000).Max + 1) * 2) < (NI64)((*T_11000).Counter * 3));
if (LOC9) goto LA10;
LOC9 = ((NI64)((NI64)((*T_11000).Max + 1) - (*T_11000).Counter) < 4);
LA10: ;
if (!LOC9) goto LA11;
Cellsetenlarge_10971(T_11000);
LA11: ;
(*T_11000).Counter += 1;
H_11003 = (NI64)(((NI) (Key_11001)) & (*T_11000).Max);
while (1) {
if (!!(((*T_11000).Data[(H_11003)-0] == NIM_NIL))) goto LA13;
H_11003 = Nexttry_10910(H_11003, (*T_11000).Max);
} LA13: ;
LOC14 = Alloc0_2353(((NI)sizeof(TY10810)));
Result_11002 = ((TY10810*) (LOC14));
(*Result_11002).Next = (*T_11000).Head;
(*Result_11002).Key = Key_11001;
(*T_11000).Head = Result_11002;
(*T_11000).Data[(H_11003)-0] = Result_11002;
BeforeRet: ;
return Result_11002;
}
N_NOINLINE(void, Incl_11080)(TY10814* S_11083, TY10802* Cell_11084) {
NI U_11085;
TY10810* T_11086;
U_11085 = 0;
U_11085 = ((NI) (Cell_11084));
T_11086 = 0;
T_11086 = Cellsetput_10997(S_11083, (NI64)((NU64)(U_11085) >> (NU64)(12)));
U_11085 = (NI64)((NU64)((NI64)((NU64)(U_11085) % (NU64)(4096))) / (NU64)(8));
(*T_11086).Bits[((NI64)((NU64)(U_11085) >> (NU64)(6)))-0] = (NI64)((*T_11086).Bits[((NI64)((NU64)(U_11085) >> (NU64)(6)))-0] | (NI64)((NU64)(1) << (NU64)((NI64)(U_11085 & 63))));
}
N_NIMCALL(NIM_BOOL, Containsorincl_11105)(TY10814* S_11108, TY10802* Cell_11109) {
NIM_BOOL Result_11110;
NI U_11111;
TY10810* T_11112;
Result_11110 = 0;
U_11111 = 0;
U_11111 = ((NI) (Cell_11109));
T_11112 = 0;
T_11112 = Cellsetget_10915(&(*S_11108), (NI64)((NU64)(U_11111) >> (NU64)(12)));
if (!!((T_11112 == NIM_NIL))) goto LA2;
U_11111 = (NI64)((NU64)((NI64)((NU64)(U_11111) % (NU64)(4096))) / (NU64)(8));
Result_11110 = !(((NI64)((*T_11112).Bits[((NI64)((NU64)(U_11111) >> (NU64)(6)))-0] & (NI64)((NU64)(1) << (NU64)((NI64)(U_11111 & 63)))) == 0));
if (!!(Result_11110)) goto LA5;
(*T_11112).Bits[((NI64)((NU64)(U_11111) >> (NU64)(6)))-0] = (NI64)((*T_11112).Bits[((NI64)((NU64)(U_11111) >> (NU64)(6)))-0] | (NI64)((NU64)(1) << (NU64)((NI64)(U_11111 & 63))));
LA5: ;
goto LA1;
LA2: ;
Incl_11080(S_11108, Cell_11109);
Result_11110 = NIM_FALSE;
LA1: ;
return Result_11110;
}
N_NIMCALL(NIM_BOOL, Contains_11060)(TY10814* S_11062, TY10802* Cell_11063) {
NIM_BOOL Result_11064;
NI U_11065;
TY10810* T_11066;
Result_11064 = 0;
U_11065 = 0;
U_11065 = ((NI) (Cell_11063));
T_11066 = 0;
T_11066 = Cellsetget_10915(S_11062, (NI64)((NU64)(U_11065) >> (NU64)(12)));
if (!!((T_11066 == NIM_NIL))) goto LA2;
U_11065 = (NI64)((NU64)((NI64)((NU64)(U_11065) % (NU64)(4096))) / (NU64)(8));
Result_11064 = !(((NI64)((*T_11066).Bits[((NI64)((NU64)(U_11065) >> (NU64)(6)))-0] & (NI64)((NU64)(1) << (NU64)((NI64)(U_11065 & 63)))) == 0));
goto LA1;
LA2: ;
Result_11064 = NIM_FALSE;
LA1: ;
return Result_11064;
}
N_NIMCALL(void, Deinit_10893)(TY10814* S_10896) {
TY10810* It_10897;
TY10810* N_10909;
It_10897 = 0;
It_10897 = (*S_10896).Head;
while (1) {
if (!!((It_10897 == NIM_NIL))) goto LA1;
N_10909 = 0;
N_10909 = (*It_10897).Next;
Dealloc_2360(((void*) (It_10897)));
It_10897 = N_10909;
} LA1: ;
(*S_10896).Head = NIM_NIL;
Dealloc_2360(((void*) ((*S_10896).Data)));
(*S_10896).Data = NIM_NIL;
(*S_10896).Counter = 0;
}
N_NIMCALL(void, Collectcycles_15403)(TY11196* Gch_15406) {
NI Tabsize_15407;
TY10802* C_15408;
TY10814 HEX3Atmp_21036;
TY10810* R_21038;
NI I_21040;
NI W_21042;
NI J_21044;
TY10814 Marker_15423;
TY10802* C_15425;
TY10814 HEX3Atmp_21045;
TY10810* R_21047;
NI I_21049;
NI W_21051;
NI J_21053;
NIM_BOOL LOC17;
TY10802* D_15443;
NIM_BOOL LOC22;
NIM_BOOL LOC24;
TY10802* C_15447;
TY10814 HEX3Atmp_21054;
TY10810* R_21056;
NI I_21058;
NI W_21060;
NI J_21062;
TY10802* D_15464;
NIM_BOOL LOC41;
Tabsize_15407 = 0;
Tabsize_15407 = 0;
C_15408 = 0;
memset((void*)&HEX3Atmp_21036, 0, sizeof(HEX3Atmp_21036));
HEX3Atmp_21036 = (*Gch_15406).Cycleroots;
R_21038 = 0;
R_21038 = HEX3Atmp_21036.Head;
while (1) {
if (!!((R_21038 == NIM_NIL))) goto LA1;
I_21040 = 0;
I_21040 = 0;
while (1) {
if (!(I_21040 <= 7)) goto LA2;
W_21042 = 0;
W_21042 = (*R_21038).Bits[(I_21040)-0];
J_21044 = 0;
J_21044 = 0;
while (1) {
if (!!((W_21042 == 0))) goto LA3;
if (!!(((NI64)(W_21042 & 1) == 0))) goto LA5;
C_15408 = ((TY10802*) ((NI64)((NI64)((NU64)((*R_21038).Key) << (NU64)(12)) | (NI64)((NU64)((NI64)((NU64)((NI64)((NU64)(I_21040) << (NU64)(6))) + (NU64)(J_21044))) * (NU64)(8)))));
Tabsize_15407 += 1;
Forallchildren_12212(C_15408, ((NU8) 2));
LA5: ;
J_21044 += 1;
W_21042 = (NI64)((NU64)(W_21042) >> (NU64)(1));
} LA3: ;
I_21040 += 1;
} LA2: ;
R_21038 = (*R_21038).Next;
} LA1: ;
(*Gch_15406).Stat.Cycletablesize = (((*Gch_15406).Stat.Cycletablesize >= Tabsize_15407) ? (*Gch_15406).Stat.Cycletablesize : Tabsize_15407);
memset((void*)&Marker_15423, 0, sizeof(Marker_15423));
Init_10889(&Marker_15423);
C_15425 = 0;
memset((void*)&HEX3Atmp_21045, 0, sizeof(HEX3Atmp_21045));
HEX3Atmp_21045 = (*Gch_15406).Cycleroots;
R_21047 = 0;
R_21047 = HEX3Atmp_21045.Head;
while (1) {
if (!!((R_21047 == NIM_NIL))) goto LA7;
I_21049 = 0;
I_21049 = 0;
while (1) {
if (!(I_21049 <= 7)) goto LA8;
W_21051 = 0;
W_21051 = (*R_21047).Bits[(I_21049)-0];
J_21053 = 0;
J_21053 = 0;
while (1) {
if (!!((W_21051 == 0))) goto LA9;
if (!!(((NI64)(W_21051 & 1) == 0))) goto LA11;
C_15425 = ((TY10802*) ((NI64)((NI64)((NU64)((*R_21047).Key) << (NU64)(12)) | (NI64)((NU64)((NI64)((NU64)((NI64)((NU64)(I_21049) << (NU64)(6))) + (NU64)(J_21053))) * (NU64)(8)))));
if (!((NU64)(8) <= (NU64)((*C_15425).Refcount))) goto LA14;
LOC17 = Containsorincl_11105(&Marker_15423, C_15425);
if (!!(LOC17)) goto LA18;
(*Gch_15406).Tempstack.Len = 0;
Forallchildren_12212(C_15425, ((NU8) 1));
while (1) {
if (!(0 < (*Gch_15406).Tempstack.Len)) goto LA20;
(*Gch_15406).Tempstack.Len -= 1;
D_15443 = 0;
D_15443 = (*Gch_15406).Tempstack.D[((*Gch_15406).Tempstack.Len)-0];
(*D_15443).Refcount = (NI64)((NU64)((*D_15443).Refcount) + (NU64)(8));
LOC22 = Contains_11060(&(*Gch_15406).Cycleroots, D_15443);
if (!(LOC22)) goto LA23;
LOC24 = Containsorincl_11105(&Marker_15423, D_15443);
LOC22 = !(LOC24);
LA23: ;
if (!LOC22) goto LA25;
Forallchildren_12212(D_15443, ((NU8) 1));
LA25: ;
} LA20: ;
LA18: ;
LA14: ;
LA11: ;
J_21053 += 1;
W_21051 = (NI64)((NU64)(W_21051) >> (NU64)(1));
} LA9: ;
I_21049 += 1;
} LA8: ;
R_21047 = (*R_21047).Next;
} LA7: ;
C_15447 = 0;
memset((void*)&HEX3Atmp_21054, 0, sizeof(HEX3Atmp_21054));
HEX3Atmp_21054 = (*Gch_15406).Cycleroots;
R_21056 = 0;
R_21056 = HEX3Atmp_21054.Head;
while (1) {
if (!!((R_21056 == NIM_NIL))) goto LA27;
I_21058 = 0;
I_21058 = 0;
while (1) {
if (!(I_21058 <= 7)) goto LA28;
W_21060 = 0;
W_21060 = (*R_21056).Bits[(I_21058)-0];
J_21062 = 0;
J_21062 = 0;
while (1) {
if (!!((W_21060 == 0))) goto LA29;
if (!!(((NI64)(W_21060 & 1) == 0))) goto LA31;
C_15447 = ((TY10802*) ((NI64)((NI64)((NU64)((*R_21056).Key) << (NU64)(12)) | (NI64)((NU64)((NI64)((NU64)((NI64)((NU64)(I_21058) << (NU64)(6))) + (NU64)(J_21062))) * (NU64)(8)))));
if (!((NU64)((*C_15447).Refcount) < (NU64)(8))) goto LA34;
(*Gch_15406).Tempstack.Len = 0;
Forallchildren_12212(C_15447, ((NU8) 1));
while (1) {
if (!(0 < (*Gch_15406).Tempstack.Len)) goto LA36;
(*Gch_15406).Tempstack.Len -= 1;
D_15464 = 0;
D_15464 = (*Gch_15406).Tempstack.D[((*Gch_15406).Tempstack.Len)-0];
if (!((NU64)((*D_15464).Refcount) < (NU64)(8))) goto LA38;
LOC41 = Contains_11060(&(*Gch_15406).Cycleroots, D_15464);
if (!!(LOC41)) goto LA42;
Addzct_11601(&(*Gch_15406).Zct, D_15464);
LA42: ;
LA38: ;
} LA36: ;
Preparedealloc_12225(C_15447);
Rawdealloc_10074(&Allocator_8929, ((void*) (C_15447)));
LA34: ;
LA31: ;
J_21062 += 1;
W_21060 = (NI64)((NU64)(W_21060) >> (NU64)(1));
} LA29: ;
I_21058 += 1;
} LA28: ;
R_21056 = (*R_21056).Next;
} LA27: ;
Deinit_10893(&(*Gch_15406).Cycleroots);
Init_10889(&(*Gch_15406).Cycleroots);
}
static N_INLINE(NI, Atomicdec_3226)(NI* Memloc_3229, NI X_3230) {
NI Result_8006;
Result_8006 = 0;
(*Memloc_3229) -= X_3230;
Result_8006 = (*Memloc_3229);
return Result_8006;
}
static N_INLINE(void, Rtladdzct_12601)(TY10802* C_12603) {
Addzct_11601(&Gch_11214.Zct, C_12603);
}
static N_INLINE(void, Rtladdcycleroot_12252)(TY10802* C_12254) {
Incl_11080(&Gch_11214.Cycleroots, C_12254);
}
static N_INLINE(void, Decref_13001)(TY10802* C_13003) {
NI LOC2;
NIM_BOOL LOC5;
LOC2 = Atomicdec_3226(&(*C_13003).Refcount, 8);
if (!((NU64)(LOC2) < (NU64)(8))) goto LA3;
Rtladdzct_12601(C_13003);
goto LA1;
LA3: ;
LOC5 = Canbecycleroot_11616(C_13003);
if (!LOC5) goto LA6;
Rtladdcycleroot_12252(C_13003);
goto LA1;
LA6: ;
LA1: ;
}
N_NIMCALL(void, Unmarkstackandregisters_17801)(TY11196* Gch_17804) {
TY10802** D_17805;
NI I_17814;
NI HEX3Atmp_21063;
NI Res_21065;
D_17805 = 0;
D_17805 = (*Gch_17804).Decstack.D;
I_17814 = 0;
HEX3Atmp_21063 = 0;
HEX3Atmp_21063 = (NI64)((*Gch_17804).Decstack.Len - 1);
Res_21065 = 0;
Res_21065 = 0;
while (1) {
if (!(Res_21065 <= HEX3Atmp_21063)) goto LA1;
I_17814 = Res_21065;
Decref_13001(D_17805[(I_17814)-0]);
Res_21065 += 1;
} LA1: ;
(*Gch_17804).Decstack.Len = 0;
}
N_NIMCALL(void, Collectct_12205)(TY11196* Gch_12208) {
NIM_BOOL LOC2;
NIM_BOOL LOC3;
NIM_BOOL LOC5;
NI LOC7;
NI LOC11;
NIM_BOOL LOC13;
NI LOC14;
NI LOC18;
LOC3 = (256 <= (*Gch_12208).Zct.Len);
if (LOC3) goto LA4;
LOC5 = NIM_TRUE;
if (!(LOC5)) goto LA6;
LOC7 = Getoccupiedmem_2417();
LOC5 = (Cyclethreshold_11215 <= LOC7);
LA6: ;
LOC3 = LOC5;
LA4: ;
LOC2 = LOC3;
if (LOC2) goto LA8;
LOC2 = NIM_FALSE;
LA8: ;
if (!LOC2) goto LA9;
LOC11 = Stacksize_17001();
(*Gch_12208).Stat.Maxstacksize = (((*Gch_12208).Stat.Maxstacksize >= LOC11) ? (*Gch_12208).Stat.Maxstacksize : LOC11);
Markstackandregisters_17015(Gch_12208);
Markthreadstacks_16211(Gch_12208);
(*Gch_12208).Stat.Maxstackcells = (((*Gch_12208).Stat.Maxstackcells >= (*Gch_12208).Decstack.Len) ? (*Gch_12208).Stat.Maxstackcells : (*Gch_12208).Decstack.Len);
(*Gch_12208).Stat.Stackscans += 1;
Collectzct_17201(Gch_12208);
LOC14 = Getoccupiedmem_2417();
LOC13 = (Cyclethreshold_11215 <= LOC14);
if (LOC13) goto LA15;
LOC13 = NIM_FALSE;
LA15: ;
if (!LOC13) goto LA16;
Collectcycles_15403(Gch_12208);
Collectzct_17201(Gch_12208);
(*Gch_12208).Stat.Cyclecollections += 1;
LOC18 = Getoccupiedmem_2417();
Cyclethreshold_11215 = ((4194304 >= (NI64)(LOC18 * 2)) ? 4194304 : (NI64)(LOC18 * 2));
(*Gch_12208).Stat.Maxthreshold = (((*Gch_12208).Stat.Maxthreshold >= Cyclethreshold_11215) ? (*Gch_12208).Stat.Maxthreshold : Cyclethreshold_11215);
LA16: ;
Unmarkstackandregisters_17801(Gch_12208);
LA9: ;
}
static N_INLINE(void, Checkcollection_13903)(void) {
if (!(Recgclock_11216 == 0)) goto LA2;
Collectct_12205(&Gch_11214);
LA2: ;
}
static N_INLINE(void, Release_11401)(TY11196* Gch_11404) {
}
N_NIMCALL(void*, newObj)(TNimType* Typ_13910, NI Size_13911) {
void* Result_13912;
TY10802* Res_13927;
void* LOC1;
NI L_14002;
TY10802** D_14003;
NI I_14013;
NI HEX3Atmp_21032;
NI HEX3Atmp_21033;
NI Res_21035;
TY10802* C_14014;
Result_13912 = 0;
Aquire_11217(&Gch_11214);
Checkcollection_13903();
Res_13927 = 0;
LOC1 = Rawalloc_9803(&Allocator_8929, (NI64)(Size_13911 + ((NI)sizeof(TY10802))));
Res_13927 = ((TY10802*) (LOC1));
zeroMem(((void*) (Res_13927)), (NI64)(Size_13911 + ((NI)sizeof(TY10802))));
(*Res_13927).Typ = Typ_13910;
(*Res_13927).Refcount = 4;
L_14002 = 0;
L_14002 = Gch_11214.Zct.Len;
D_14003 = 0;
D_14003 = Gch_11214.Zct.D;
I_14013 = 0;
HEX3Atmp_21032 = 0;
HEX3Atmp_21033 = 0;
HEX3Atmp_21032 = (NI64)(L_14002 - 1);
HEX3Atmp_21033 = ((0 >= (NI64)(L_14002 - 8)) ? 0 : (NI64)(L_14002 - 8));
Res_21035 = 0;
Res_21035 = HEX3Atmp_21032;
while (1) {
if (!(HEX3Atmp_21033 <= Res_21035)) goto LA3;
I_14013 = Res_21035;
C_14014 = 0;
C_14014 = D_14003[(I_14013)-0];
if (!((NU64)(8) <= (NU64)((*C_14014).Refcount))) goto LA5;
(*C_14014).Refcount = (NI64)((*C_14014).Refcount & -8);
D_14003[(I_14013)-0] = Res_13927;
goto LA2;
LA5: ;
Res_21035 -= 1;
} LA3: ;
Add_10859(&Gch_11214.Zct, Res_13927);
LA2: ;
Release_11401(&Gch_11214);
Result_13912 = Celltousr_11608(Res_13927);
return Result_13912;
}
static N_INLINE(NI, Atomicinc_3221)(NI* Memloc_3224, NI X_3225) {
NI Result_7807;
Result_7807 = 0;
(*Memloc_3224) += X_3225;
Result_7807 = (*Memloc_3224);
return Result_7807;
}
static N_INLINE(void, asgnRefNoCycle)(void** Dest_13218, void* Src_13219) {
TY10802* C_13220;
NI LOC4;
TY10802* C_13222;
NI LOC9;
if (!!((Src_13219 == NIM_NIL))) goto LA2;
C_13220 = 0;
C_13220 = Usrtocell_11612(Src_13219);
LOC4 = Atomicinc_3221(&(*C_13220).Refcount, 8);
LA2: ;
if (!!(((*Dest_13218) == NIM_NIL))) goto LA6;
C_13222 = 0;
C_13222 = Usrtocell_11612((*Dest_13218));
LOC9 = Atomicdec_3226(&(*C_13222).Refcount, 8);
if (!((NU64)(LOC9) < (NU64)(8))) goto LA10;
Rtladdzct_12601(C_13222);
LA10: ;
LA6: ;
(*Dest_13218) = Src_13219;
}
N_NIMCALL(NimStringDesc*, rawNewString)(NI Space_18689) {
NimStringDesc* Result_18690;
NI S_18691;
void* LOC4;
Result_18690 = 0;
S_18691 = 0;
S_18691 = Space_18689;
if (!(S_18691 < 8)) goto LA2;
S_18691 = 7;
LA2: ;
LOC4 = newObj(&Strdesc_3237, (NI64)(((NI)sizeof(TGenericSeq)) + (NI64)((NI64)(S_18691 + 1) * 1)));
Result_18690 = ((NimStringDesc*) (LOC4));
(*Result_18690).Sup.space = S_18691;
return Result_18690;
}
N_NIMCALL(NimStringDesc*, copyString)(NimStringDesc* Src_18712) {
NimStringDesc* Result_18713;
Result_18713 = 0;
if (!(Src_18712 == NIM_NIL)) goto LA2;
Result_18713 = NIM_NIL;
goto BeforeRet;
LA2: ;
Result_18713 = rawNewString((*Src_18712).Sup.space);
(*Result_18713).Sup.len = (*Src_18712).Sup.len;
memcpy(((NCSTRING) ((*Result_18713).data)), ((NCSTRING) ((*Src_18712).data)), ((int) ((NI64)((NI64)((*Src_18712).Sup.len + 1) * 1))));
BeforeRet: ;
return Result_18713;
}
N_NIMCALL(void, Gcdisable_3063)(void) {
NI LOC1;
LOC1 = Atomicinc_3221(&Recgclock_11216, 1);
}
static N_INLINE(void, Incref_13202)(TY10802* C_13204) {
NI LOC1;
NIM_BOOL LOC3;
LOC1 = Atomicinc_3221(&(*C_13204).Refcount, 8);
LOC3 = Canbecycleroot_11616(C_13204);
if (!LOC3) goto LA4;
Rtladdcycleroot_12252(C_13204);
LA4: ;
}
static N_INLINE(void, asgnRef)(void** Dest_13214, void* Src_13215) {
TY10802* LOC4;
TY10802* LOC8;
if (!!((Src_13215 == NIM_NIL))) goto LA2;
LOC4 = Usrtocell_11612(Src_13215);
Incref_13202(LOC4);
LA2: ;
if (!!(((*Dest_13214) == NIM_NIL))) goto LA6;
LOC8 = Usrtocell_11612((*Dest_13214));
Decref_13001(LOC8);
LA6: ;
(*Dest_13214) = Src_13215;
}
static N_INLINE(void, pushCurrentException)(E_Base* E_5041) {
asgnRef((void**) &(*E_5041).parent, Currexception_5032);
asgnRef((void**) &Currexception_5032, E_5041);
}
static N_INLINE(NI, Resize_18601)(NI Old_18603) {
NI Result_18604;
Result_18604 = 0;
if (!(Old_18603 <= 0)) goto LA2;
Result_18604 = 4;
goto BeforeRet;
goto LA1;
LA2: ;
if (!(Old_18603 < 65536)) goto LA4;
Result_18604 = (NI64)(Old_18603 * 2);
goto BeforeRet;
goto LA1;
LA4: ;
Result_18604 = (NI64)((NI64)(Old_18603 * 3) / 2);
goto BeforeRet;
LA1: ;
BeforeRet: ;
return Result_18604;
}
N_NIMCALL(void*, Growobj_14407)(void* Old_14409, NI Newsize_14410) {
void* Result_14411;
TY10802* Ol_14413;
TY10802* Res_14438;
void* LOC1;
NI Elemsize_14439;
NI Oldsize_14449;
NI J_14454;
TY10802** D_14455;
NIM_BOOL LOC13;
Result_14411 = 0;
Aquire_11217(&Gch_11214);
Checkcollection_13903();
Ol_14413 = 0;
Ol_14413 = Usrtocell_11612(Old_14409);
Res_14438 = 0;
LOC1 = Rawalloc_9803(&Allocator_8929, (NI64)(Newsize_14410 + ((NI)sizeof(TY10802))));
Res_14438 = ((TY10802*) (LOC1));
Elemsize_14439 = 0;
Elemsize_14439 = 1;
if (!!(((*(*Ol_14413).Typ).kind == ((NU8) 28)))) goto LA3;
Elemsize_14439 = (*(*(*Ol_14413).Typ).base).size;
LA3: ;
Oldsize_14449 = 0;
Oldsize_14449 = (NI64)((NI64)((*((TGenericSeq*) (Old_14409))).len * Elemsize_14439) + 16);
memcpy(((void*) (Res_14438)), ((void*) (Ol_14413)), (NI64)(Oldsize_14449 + ((NI)sizeof(TY10802))));
zeroMem(((void*) ((NI64)((NU64)((NI64)((NU64)(((NI) (Res_14438))) + (NU64)(Oldsize_14449))) + (NU64)(((NI)sizeof(TY10802)))))), (NI64)(Newsize_14410 - Oldsize_14449));
if (!((NI64)((*Ol_14413).Refcount & 7) == 4)) goto LA6;
J_14454 = 0;
J_14454 = (NI64)(Gch_11214.Zct.Len - 1);
D_14455 = 0;
D_14455 = Gch_11214.Zct.D;
while (1) {
if (!(0 <= J_14454)) goto LA8;
if (!(D_14455[(J_14454)-0] == Ol_14413)) goto LA10;
D_14455[(J_14454)-0] = Res_14438;
goto LA8;
LA10: ;
J_14454 -= 1;
} LA8: ;
LA6: ;
LOC13 = Canbecycleroot_11616(Ol_14413);
if (!LOC13) goto LA14;
Excl_11087(&Gch_11214.Cycleroots, Ol_14413);
LA14: ;
Rawdealloc_10074(&Allocator_8929, ((void*) (Ol_14413)));
Release_11401(&Gch_11214);
Result_14411 = Celltousr_11608(Res_14438);
return Result_14411;
}
N_NIMCALL(NimStringDesc*, resizeString)(NimStringDesc* Dest_18789, NI Addlen_18790) {
NimStringDesc* Result_18791;
NI Sp_18796;
NI LOC4;
void* LOC5;
Result_18791 = 0;
if (!((NI64)((NI64)((*Dest_18789).Sup.len + Addlen_18790) + 1) <= (*Dest_18789).Sup.space)) goto LA2;
Result_18791 = Dest_18789;
goto LA1;
LA2: ;
Sp_18796 = 0;
LOC4 = Resize_18601((*Dest_18789).Sup.space);
Sp_18796 = ((LOC4 >= (NI64)((NI64)((*Dest_18789).Sup.len + Addlen_18790) + 1)) ? LOC4 : (NI64)((NI64)((*Dest_18789).Sup.len + Addlen_18790) + 1));
LOC5 = Growobj_14407(((void*) (Dest_18789)), (NI64)(((NI)sizeof(TGenericSeq)) + (NI64)((NI64)(Sp_18796 + 1) * 1)));
Result_18791 = ((NimStringDesc*) (LOC5));
(*Result_18791).Sup.space = Sp_18796;
LA1: ;
return Result_18791;
}
N_NIMCALL(NimStringDesc*, setLengthStr)(NimStringDesc* S_18832, NI Newlen_18833) {
NimStringDesc* Result_18834;
NI N_18837;
Result_18834 = 0;
N_18837 = 0;
N_18837 = ((Newlen_18833 >= 0) ? Newlen_18833 : 0);
if (!(N_18837 <= (*S_18832).Sup.space)) goto LA2;
Result_18834 = S_18832;
goto LA1;
LA2: ;
Result_18834 = resizeString(S_18832, N_18837);
LA1: ;
(*Result_18834).Sup.len = N_18837;
(*Result_18834).data[(N_18837)-0] = 0;
return Result_18834;
}
static N_INLINE(void, appendString)(NimStringDesc* Dest_18799, NimStringDesc* Src_18800) {
memcpy(((NCSTRING) (&(*Dest_18799).data[((*Dest_18799).Sup.len)-0])), ((NCSTRING) ((*Src_18800).data)), ((int) ((NI64)((NI64)((*Src_18800).Sup.len + 1) * 1))));
(*Dest_18799).Sup.len += (*Src_18800).Sup.len;
}
N_NIMCALL(void, Rawwritestacktrace_5393)(NimStringDesc** S_5396) {
(*S_5396) = resizeString((*S_5396), 28);
appendString((*S_5396), ((NimStringDesc*) &TMP21121));
(*S_5396) = resizeString((*S_5396), Stacktracenewline_4826->Sup.len + 0);
appendString((*S_5396), Stacktracenewline_4826);
}
N_NIMCALL(NimStringDesc*, toNimStr)(NCSTRING Str_18703, NI Len_18704) {
NimStringDesc* Result_18705;
Result_18705 = 0;
Result_18705 = rawNewString(Len_18704);
(*Result_18705).Sup.len = Len_18704;
memcpy(((NCSTRING) ((*Result_18705).data)), Str_18703, ((int) ((NI64)((NI64)(Len_18704 + 1) * 1))));
(*Result_18705).data[(Len_18704)-0] = 0;
return Result_18705;
}
N_NIMCALL(NimStringDesc*, cstrToNimstr)(NCSTRING Str_18708) {
NimStringDesc* Result_18709;
NI LOC1;
Result_18709 = 0;
LOC1 = strlen(Str_18708);
Result_18709 = toNimStr(Str_18708, LOC1);
goto BeforeRet;
BeforeRet: ;
return Result_18709;
}
N_NIMCALL(void, Write_3878)(FILE* F_3880, NCSTRING C_3881) {
fputs(C_3881, F_3880);
}
N_NIMCALL(void, Writetostderr_4827)(NCSTRING Msg_4829) {
Write_3878(stdout, Msg_4829);
}
static N_INLINE(void, Quitordebug_5401)(void) {
exit(1);
}
N_NIMCALL(void, Gcenable_3065)(void) {
NI LOC4;
if (!(0 < Recgclock_11216)) goto LA2;
LOC4 = Atomicdec_3226(&Recgclock_11216, 1);
LA2: ;
}
N_NIMCALL(void, raiseException)(E_Base* E_5604, NCSTRING Ename_5605) {
NIM_BOOL LOC8;
NimStringDesc* LOC12;
Gcdisable_3063();
(*E_5604).name = Ename_5605;
if (!!((excHandler == NIM_NIL))) goto LA2;
pushCurrentException(E_5604);
longjmp((*excHandler).context, ((NI32) 1));
goto LA1;
LA2: ;
if (!!(Buf_5201 == 0)) goto LA5;
Buf_5201 = setLengthStr(Buf_5201, 0);
Rawwritestacktrace_5393(&Buf_5201);
LOC8 = !(((*E_5604).message == NIM_NIL));
if (!(LOC8)) goto LA9;
LOC8 = !(((NU8)((*E_5604).message->data[0]) == (NU8)(0)));
LA9: ;
if (!LOC8) goto LA10;
Buf_5201 = resizeString(Buf_5201, 28);
appendString(Buf_5201, ((NimStringDesc*) &TMP21122));
Buf_5201 = resizeString(Buf_5201, (*E_5604).message->Sup.len + 0);
appendString(Buf_5201, (*E_5604).message);
goto LA7;
LA10: ;
Buf_5201 = resizeString(Buf_5201, 26);
appendString(Buf_5201, ((NimStringDesc*) &TMP21123));
LA7: ;
Buf_5201 = resizeString(Buf_5201, 2);
appendString(Buf_5201, ((NimStringDesc*) &TMP21124));
LOC12 = 0;
LOC12 = cstrToNimstr(Ename_5605);
Buf_5201 = resizeString(Buf_5201, LOC12->Sup.len + 0);
appendString(Buf_5201, LOC12);
Buf_5201 = resizeString(Buf_5201, 2);
appendString(Buf_5201, ((NimStringDesc*) &TMP21125));
Writetostderr_4827(Buf_5201->data);
goto LA4;
LA5: ;
Writetostderr_4827(Ename_5605);
LA4: ;
Quitordebug_5401();
LA1: ;
Gcenable_3065();
}
N_NIMCALL(void, Write_3866)(FILE* F_3868, NimStringDesc* S_3869) {
NI LOC2;
TY420* E_4665;
LOC2 = Writebuffer_3941(F_3868, ((void*) (S_3869->data)), S_3869->Sup.len);
if (!!((LOC2 == S_3869->Sup.len))) goto LA3;
E_4665 = 0;
E_4665 = (TY420*) newObj(NTI4664, sizeof(TY420));
(*E_4665).Sup.Sup.Sup.Sup.m_type = NTI420;
asgnRefNoCycle((void**) &(*E_4665).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP21120)));
raiseException((E_Base*)E_4665, "EIO");
LA3: ;
}
static N_INLINE(void, rawEcho)(NimStringDesc* X_4502) {
Write_3866(stdout, X_4502);
}
static N_INLINE(void, rawEchoNL)(void) {
Write_3866(stdout, ((NimStringDesc*) &TMP21126));
}
N_NIMCALL(void, Raiseoutofmem_8241)(void) {
if (!(Goutofmem_8240 == NIM_NIL)) goto LA2;
rawEcho(((NimStringDesc*) &TMP21118));
rawEchoNL();
exit(1);
LA2: ;
asgnRefNoCycle((void**) &(*Goutofmem_8240).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP21127)));
raiseException((E_Base*)Goutofmem_8240, "EOutOfMemory");
}
static N_INLINE(void*, Osallocpages_8413)(NI Size_8415) {
void* Result_8416;
NIM_BOOL LOC2;
Result_8416 = 0;
Result_8416 = mmap(NIM_NIL, Size_8415, ((NI32) 3), ((NI32) 4098), ((NI32) -1), 0);
LOC2 = (Result_8416 == NIM_NIL);
if (LOC2) goto LA3;
LOC2 = (Result_8416 == ((void*) -1));
LA3: ;
if (!LOC2) goto LA4;
Raiseoutofmem_8241();
LA4: ;
return Result_8416;
}
static N_INLINE(void, Inccurrmem_8886)(TY8874* A_8889, NI Bytes_8890) {
(*A_8889).Currmem += Bytes_8890;
}
N_NIMCALL(void*, Llalloc_8930)(TY8874* A_8933, NI Size_8934) {
void* Result_8935;
NIM_BOOL LOC2;
NI Request_8951;
void* LOC6;
Result_8935 = 0;
LOC2 = ((*A_8933).Llmem == NIM_NIL);
if (LOC2) goto LA3;
LOC2 = ((*(*A_8933).Llmem).Size < Size_8934);
LA3: ;
if (!LOC2) goto LA4;
Request_8951 = 0;
Request_8951 = Roundup_8856((NI64)(Size_8934 + ((NI)sizeof(TY8872))), 4096);
LOC6 = Osallocpages_8413(Request_8951);
(*A_8933).Llmem = ((TY8872*) (LOC6));
Inccurrmem_8886(A_8933, Request_8951);
(*(*A_8933).Llmem).Size = (NI64)(Request_8951 - ((NI)sizeof(TY8872)));
(*(*A_8933).Llmem).Acc = ((NI)sizeof(TY8872));
LA4: ;
Result_8935 = ((void*) ((NI64)(((NI) ((*A_8933).Llmem)) + (*(*A_8933).Llmem).Acc)));
(*(*A_8933).Llmem).Size -= Size_8934;
(*(*A_8933).Llmem).Acc += Size_8934;
zeroMem(Result_8935, Size_8934);
return Result_8935;
}
N_NIMCALL(TY8807*, Intsetput_8995)(TY8811* T_8998, NI Key_8999) {
TY8807* Result_9000;
void* LOC4;
Result_9000 = 0;
Result_9000 = Intsetget_8976(&(*T_8998), Key_8999);
if (!(Result_9000 == NIM_NIL)) goto LA2;
LOC4 = Llalloc_8930(&Allocator_8929, ((NI)sizeof(TY8807)));
Result_9000 = ((TY8807*) (LOC4));
(*Result_9000).Next = (*T_8998).Data[((NI64)(Key_8999 & 1023))-0];
(*T_8998).Data[((NI64)(Key_8999 & 1023))-0] = Result_9000;
(*Result_9000).Key = Key_8999;
LA2: ;
return Result_9000;
}
N_NIMCALL(void, Incl_9033)(TY8811* S_9036, NI Key_9037) {
TY8807* T_9038;
NI U_9039;
T_9038 = 0;
T_9038 = Intsetput_8995(S_9036, (NI64)((NU64)(Key_9037) >> (NU64)(9)));
U_9039 = 0;
U_9039 = (NI64)(Key_9037 & 511);
(*T_9038).Bits[((NI64)((NU64)(U_9039) >> (NU64)(6)))-0] = (NI64)((*T_9038).Bits[((NI64)((NU64)(U_9039) >> (NU64)(6)))-0] | (NI64)((NU64)(1) << (NU64)((NI64)(U_9039 & 63))));
}
N_NIMCALL(void, Splitchunk_9668)(TY8874* A_9671, TY8834* C_9672, NI Size_9673) {
TY8834* Rest_9674;
NI LOC1;
Rest_9674 = 0;
Rest_9674 = ((TY8834*) ((NI64)((NU64)(((NI) (C_9672))) + (NU64)(Size_9673))));
(*Rest_9674).Sup.Size = (NI64)((*C_9672).Sup.Size - Size_9673);
(*Rest_9674).Sup.Used = NIM_FALSE;
(*Rest_9674).Next = NIM_NIL;
(*Rest_9674).Prev = NIM_NIL;
(*Rest_9674).Sup.Prevsize = Size_9673;
Updateprevsize_9213(A_9671, C_9672, (*Rest_9674).Sup.Size);
(*C_9672).Sup.Size = Size_9673;
LOC1 = Pageindex_9079(&Rest_9674->Sup);
Incl_9033(&(*A_9671).Chunkstarts, LOC1);
Listadd_9609(&(*A_9671).Freechunkslist, Rest_9674);
}
N_NIMCALL(TY8834*, Requestoschunks_9094)(TY8874* A_9097, NI Size_9098) {
TY8834* Result_9099;
void* LOC1;
NI Nxt_9114;
TY8830* Next_9117;
NI LOC3;
NIM_BOOL LOC4;
NI Prv_9120;
TY8830* Prev_9123;
NIM_BOOL LOC8;
NI LOC9;
Result_9099 = 0;
Inccurrmem_8886(A_9097, Size_9098);
(*A_9097).Freemem += Size_9098;
LOC1 = Osallocpages_8413(Size_9098);
Result_9099 = ((TY8834*) (LOC1));
(*Result_9099).Next = NIM_NIL;
(*Result_9099).Prev = NIM_NIL;
(*Result_9099).Sup.Used = NIM_FALSE;
(*Result_9099).Sup.Size = Size_9098;
Nxt_9114 = 0;
Nxt_9114 = (NI64)((NU64)(((NI) (Result_9099))) + (NU64)(Size_9098));
Next_9117 = 0;
Next_9117 = ((TY8830*) (Nxt_9114));
LOC3 = Pageindex_9079(Next_9117);
LOC4 = Contains_9013(&(*A_9097).Chunkstarts, LOC3);
if (!LOC4) goto LA5;
(*Next_9117).Prevsize = Size_9098;
LA5: ;
Prv_9120 = 0;
Prv_9120 = (NI64)((NU64)(((NI) (Result_9099))) - (NU64)(Lastsize_9093));
Prev_9123 = 0;
Prev_9123 = ((TY8830*) (Prv_9120));
LOC9 = Pageindex_9079(Prev_9123);
LOC8 = Contains_9013(&(*A_9097).Chunkstarts, LOC9);
if (!(LOC8)) goto LA10;
LOC8 = ((*Prev_9123).Size == Lastsize_9093);
LA10: ;
if (!LOC8) goto LA11;
(*Result_9099).Sup.Prevsize = Lastsize_9093;
goto LA7;
LA11: ;
(*Result_9099).Sup.Prevsize = 0;
LA7: ;
Lastsize_9093 = Size_9098;
return Result_9099;
}
N_NIMCALL(TY8834*, Getbigchunk_9694)(TY8874* A_9697, NI Size_9698) {
TY8834* Result_9699;
NI LOC11;
Result_9699 = 0;
Result_9699 = (*A_9697).Freechunkslist;
while (1) {
if (!!((Result_9699 == NIM_NIL))) goto LA2;
if (!((*Result_9699).Sup.Size == Size_9698)) goto LA4;
Listremove_9248(&(*A_9697).Freechunkslist, Result_9699);
goto LA1;
goto LA3;
LA4: ;
if (!(Size_9698 < (*Result_9699).Sup.Size)) goto LA6;
Listremove_9248(&(*A_9697).Freechunkslist, Result_9699);
Splitchunk_9668(A_9697, Result_9699, Size_9698);
goto LA1;
goto LA3;
LA6: ;
LA3: ;
Result_9699 = (*Result_9699).Next;
} LA2: ;
if (!(Size_9698 < 524288)) goto LA9;
Result_9699 = Requestoschunks_9094(A_9697, 524288);
Splitchunk_9668(A_9697, Result_9699, Size_9698);
goto LA8;
LA9: ;
Result_9699 = Requestoschunks_9094(A_9697, Size_9698);
LA8: ;
LA1: ;
(*Result_9699).Sup.Prevsize = 0;
(*Result_9699).Sup.Used = NIM_TRUE;
LOC11 = Pageindex_9079(&Result_9699->Sup);
Incl_9033(&(*A_9697).Chunkstarts, LOC11);
(*A_9697).Freemem -= Size_9698;
return Result_9699;
}
N_NIMCALL(TY8832*, Getsmallchunk_9770)(TY8874* A_9773) {
TY8832* Result_9774;
TY8834* Res_9775;
Result_9774 = 0;
Res_9775 = 0;
Res_9775 = Getbigchunk_9694(A_9773, 4096);
Result_9774 = ((TY8832*) (Res_9775));
return Result_9774;
}
N_NIMCALL(void*, Rawalloc_9803)(TY8874* A_9806, NI Requestedsize_9807) {
void* Result_9808;
NI Size_9813;
NI S_9816;
TY8832* C_9817;
TY8834* C_10046;
Result_9808 = 0;
Size_9813 = 0;
Size_9813 = Roundup_8856(Requestedsize_9807, 8);
if (!(Size_9813 <= (NI64)(4096 - (NI64)(((NI)sizeof(TY8832)) - 8)))) goto LA2;
S_9816 = 0;
S_9816 = (NI64)(Size_9813 / 8);
C_9817 = 0;
C_9817 = (*A_9806).Freesmallchunks[(S_9816)-0];
if (!(C_9817 == NIM_NIL)) goto LA5;
C_9817 = Getsmallchunk_9770(A_9806);
(*C_9817).Freelist = NIM_NIL;
(*C_9817).Sup.Size = Size_9813;
(*C_9817).Acc = Size_9813;
(*C_9817).Free = (NI64)((NI64)(4096 - (NI64)(((NI)sizeof(TY8832)) - 8)) - Size_9813);
(*C_9817).Next = NIM_NIL;
(*C_9817).Prev = NIM_NIL;
Listadd_9834(&(*A_9806).Freesmallchunks[(S_9816)-0], C_9817);
Result_9808 = ((void*) (&(*C_9817).Data));
goto LA4;
LA5: ;
if (!((*C_9817).Freelist == NIM_NIL)) goto LA8;
Result_9808 = ((void*) ((NI64)((NU64)(((NI) (&(*C_9817).Data))) + (NU64)((*C_9817).Acc))));
(*C_9817).Acc += Size_9813;
goto LA7;
LA8: ;
Result_9808 = ((void*) ((*C_9817).Freelist));
(*C_9817).Freelist = (*(*C_9817).Freelist).Next;
LA7: ;
(*C_9817).Free -= Size_9813;
LA4: ;
if (!((*C_9817).Free < Size_9813)) goto LA11;
Listremove_9978(&(*A_9806).Freesmallchunks[(S_9816)-0], C_9817);
LA11: ;
goto LA1;
LA2: ;
Size_9813 = Roundup_8856((NI64)(Requestedsize_9807 + (NI64)(((NI)sizeof(TY8834)) - 8)), 4096);
C_10046 = 0;
C_10046 = Getbigchunk_9694(A_9806, Size_9813);
Result_9808 = ((void*) (&(*C_10046).Data));
LA1: ;
return Result_9808;
}
N_NOCONV(void*, Alloc_2350)(NI Size_2352) {
void* Result_10418;
Result_10418 = 0;
Result_10418 = Rawalloc_9803(&Allocator_8929, (NI64)(Size_2352 + ((NI)sizeof(TY8822))));
(*((TY8822*) (Result_10418))).Zerofield = 1;
Result_10418 = ((void*) ((NI64)((NU64)(((NI) (Result_10418))) + (NU64)(((NI)sizeof(TY8822))))));
return Result_10418;
}
N_NOCONV(void*, Alloc0_2353)(NI Size_2355) {
void* Result_10424;
Result_10424 = 0;
Result_10424 = Alloc_2350(Size_2355);
zeroMem(Result_10424, Size_2355);
return Result_10424;
}
N_NIMCALL(void, Init_10879)(TY10818* S_10882, NI Cap_10883) {
void* LOC1;
(*S_10882).Len = 0;
(*S_10882).Cap = Cap_10883;
LOC1 = Alloc0_2353((NI64)(Cap_10883 * 8));
(*S_10882).D = ((TY10802**) (LOC1));
}
N_NIMCALL(void, Initgc_3231)(void) {
Gch_11214.Stat.Stackscans = 0;
Gch_11214.Stat.Cyclecollections = 0;
Gch_11214.Stat.Maxthreshold = 0;
Gch_11214.Stat.Maxstacksize = 0;
Gch_11214.Stat.Maxstackcells = 0;
Gch_11214.Stat.Cycletablesize = 0;
Init_10879(&Gch_11214.Zct, 1024);
Init_10879(&Gch_11214.Tempstack, 1024);
Init_10889(&Gch_11214.Cycleroots);
Init_10879(&Gch_11214.Decstack, 1024);
asgnRefNoCycle((void**) &Goutofmem_8240, (TY442*) newObj(NTI8244, sizeof(TY442)));
(*Goutofmem_8240).Sup.Sup.Sup.Sup.m_type = NTI442;
}
N_NOCONV(void, signalHandler)(int Sig_5678) {
int S_5679;
S_5679 = 0;
S_5679 = Sig_5678;
Gcdisable_3063();
Buf_5201 = setLengthStr(Buf_5201, 0);
Rawwritestacktrace_5393(&Buf_5201);
if (!(S_5679 == SIGINT)) goto LA2;
Buf_5201 = resizeString(Buf_5201, 31);
appendString(Buf_5201, ((NimStringDesc*) &TMP21133));
goto LA1;
LA2: ;
if (!(S_5679 == SIGSEGV)) goto LA4;
Buf_5201 = resizeString(Buf_5201, 61);
appendString(Buf_5201, ((NimStringDesc*) &TMP21134));
goto LA1;
LA4: ;
if (!(S_5679 == SIGABRT)) goto LA6;
if (!Dbgaborting_5675) goto LA9;
goto BeforeRet;
LA9: ;
Buf_5201 = resizeString(Buf_5201, 31);
appendString(Buf_5201, ((NimStringDesc*) &TMP21135));
goto LA1;
LA6: ;
if (!(S_5679 == SIGFPE)) goto LA11;
Buf_5201 = resizeString(Buf_5201, 26);
appendString(Buf_5201, ((NimStringDesc*) &TMP21136));
goto LA1;
LA11: ;
if (!(S_5679 == SIGILL)) goto LA13;
Buf_5201 = resizeString(Buf_5201, 27);
appendString(Buf_5201, ((NimStringDesc*) &TMP21137));
goto LA1;
LA13: ;
if (!(S_5679 == SIGSEGV)) goto LA15;
Buf_5201 = resizeString(Buf_5201, 60);
appendString(Buf_5201, ((NimStringDesc*) &TMP21138));
goto LA1;
LA15: ;
Buf_5201 = resizeString(Buf_5201, 15);
appendString(Buf_5201, ((NimStringDesc*) &TMP21139));
LA1: ;
Writetostderr_4827(Buf_5201->data);
Dbgaborting_5675 = NIM_TRUE;
Gcenable_3065();
exit(1);
BeforeRet: ;
}
N_NIMCALL(void, registerSignalHandler)(void) {
signal(SIGINT, signalHandler);
signal(SIGSEGV, signalHandler);
signal(SIGABRT, signalHandler);
signal(SIGFPE, signalHandler);
signal(SIGILL, signalHandler);
signal(SIGSEGV, signalHandler);
}
N_NIMCALL(NI, getRefcount)(void* P_11637) {
NI Result_11638;
TY10802* LOC1;
Result_11638 = 0;
LOC1 = Usrtocell_11612(P_11637);
Result_11638 = (NI64)((NU64)(((NI) ((*LOC1).Refcount))) >> (NU64)(3));
return Result_11638;
}
N_NIMCALL(NimStringDesc*, mnewString)(NI Len_18699) {
NimStringDesc* Result_18700;
Result_18700 = 0;
Result_18700 = rawNewString(Len_18699);
(*Result_18700).Sup.len = Len_18699;
return Result_18700;
}
N_NIMCALL(NimStringDesc*, copyStrLast)(NimStringDesc* S_18748, NI Start_18749, NI Last_18750) {
NimStringDesc* Result_18751;
NI Start_18754;
NI Len_18757;
Result_18751 = 0;
Start_18754 = 0;
Start_18754 = ((Start_18749 >= 0) ? Start_18749 : 0);
Len_18757 = 0;
Len_18757 = (NI64)((NI64)(((Last_18750 <= (NI64)((*S_18748).Sup.len - 1)) ? Last_18750 : (NI64)((*S_18748).Sup.len - 1)) - Start_18754) + 1);
if (!(0 < Len_18757)) goto LA2;
Result_18751 = rawNewString(Len_18757);
(*Result_18751).Sup.len = Len_18757;
memcpy(((NCSTRING) ((*Result_18751).data)), ((NCSTRING) (&(*S_18748).data[(Start_18754)-0])), ((int) ((NI64)(Len_18757 * 1))));
(*Result_18751).data[(Len_18757)-0] = 0;
goto LA1;
LA2: ;
Result_18751 = mnewString(0);
LA1: ;
return Result_18751;
}
N_NIMCALL(NimStringDesc*, copyStr)(NimStringDesc* S_18765, NI Start_18766) {
NimStringDesc* Result_18767;
Result_18767 = 0;
Result_18767 = copyStrLast(S_18765, Start_18766, (NI64)((*S_18765).Sup.len - 1));
goto BeforeRet;
BeforeRet: ;
return Result_18767;
}
N_NOINLINE(void, raiseOverflow)(void) {
EOverflow* E_6052;
E_6052 = 0;
E_6052 = (EOverflow*) newObj(NTI6051, sizeof(EOverflow));
(*E_6052).Sup.Sup.Sup.Sup.m_type = NTI432;
asgnRefNoCycle((void**) &(*E_6052).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP39239)));
raiseException((E_Base*)E_6052, "EOverflow");
}
static N_INLINE(NI, addInt)(NI A_6203, NI B_6204) {
NI Result_6205;
NIM_BOOL LOC2;
Result_6205 = 0;
Result_6205 = (NI64)((NU64)(A_6203) + (NU64)(B_6204));
LOC2 = (0 <= (NI64)(Result_6205 ^ A_6203));
if (LOC2) goto LA3;
LOC2 = (0 <= (NI64)(Result_6205 ^ B_6204));
LA3: ;
if (!LOC2) goto LA4;
goto BeforeRet;
LA4: ;
raiseOverflow();
BeforeRet: ;
return Result_6205;
}
N_NIMCALL(NI, mulInt)(NI A_7203, NI B_7204) {
NI Result_7205;
NF Resasfloat_7206;
NF Floatprod_7207;
Result_7205 = 0;
Resasfloat_7206 = 0;
Floatprod_7207 = 0;
Result_7205 = (NI64)((NU64)(A_7203) * (NU64)(B_7204));
Floatprod_7207 = (((double) (A_7203)) * ((double) (B_7204)));
Resasfloat_7206 = ((double) (Result_7205));
if (!(Resasfloat_7206 == Floatprod_7207)) goto LA2;
goto BeforeRet;
LA2: ;
if (!((3.2000000000000000e+01 * ((Resasfloat_7206 - Floatprod_7207) > 0? ((Resasfloat_7206 - Floatprod_7207)) : -((Resasfloat_7206 - Floatprod_7207)))) <= (Floatprod_7207 > 0? (Floatprod_7207) : -(Floatprod_7207)))) goto LA5;
goto BeforeRet;
LA5: ;
raiseOverflow();
BeforeRet: ;
return Result_7205;
}
N_NIMCALL(void*, newSeq)(TNimType* Typ_14404, NI Len_14405) {
void* Result_14406;
NI LOC1;
NI LOC2;
Result_14406 = 0;
LOC1 = mulInt(Len_14405, (*(*Typ_14404).base).size);
LOC2 = addInt(LOC1, 16);
Result_14406 = newObj(Typ_14404, LOC2);
(*((TGenericSeq*) (Result_14406))).len = Len_14405;
(*((TGenericSeq*) (Result_14406))).space = Len_14405;
return Result_14406;
}
N_NIMCALL(NI, Cmp_1327)(NimStringDesc* X_1329, NimStringDesc* Y_1330) {
NI Result_3519;
int LOC1;
Result_3519 = 0;
LOC1 = strcmp(X_1329->data, Y_1330->data);
Result_3519 = ((NI) (LOC1));
goto BeforeRet;
BeforeRet: ;
return Result_3519;
}
N_NOINLINE(NIM_BOOL, Isonstack_12209)(void* P_12211) {
NIM_BOOL Result_17009;
void* volatile Stacktop_17010;
NI B_17011;
NI A_17013;
NI X_17014;
NIM_BOOL LOC1;
Result_17009 = 0;
Stacktop_17010 = 0;
B_17011 = 0;
B_17011 = ((NI) (Stackbottom_11213));
A_17013 = 0;
A_17013 = ((NI) (&Stacktop_17010));
X_17014 = 0;
X_17014 = ((NI) (P_12211));
LOC1 = ((NU64)(A_17013) <= (NU64)(X_17014));
if (!(LOC1)) goto LA2;
LOC1 = ((NU64)(X_17014) <= (NU64)(B_17011));
LA2: ;
Result_17009 = LOC1;
return Result_17009;
}
N_NIMCALL(void, unsureAsgnRef)(void** Dest_13226, void* Src_13227) {
NIM_BOOL LOC2;
TY10802* LOC8;
TY10802* LOC12;
LOC2 = Isonstack_12209(((void*) (Dest_13226)));
if (!!(LOC2)) goto LA3;
if (!!((Src_13227 == NIM_NIL))) goto LA6;
LOC8 = Usrtocell_11612(Src_13227);
Incref_13202(LOC8);
LA6: ;
if (!!(((*Dest_13226) == NIM_NIL))) goto LA10;
LOC12 = Usrtocell_11612((*Dest_13226));
Decref_13001(LOC12);
LA10: ;
LA3: ;
(*Dest_13226) = Src_13227;
}
N_NIMCALL(TNimType*, extGetCellType)(void* C_11633) {
TNimType* Result_11634;
TY10802* LOC1;
Result_11634 = 0;
LOC1 = Usrtocell_11612(C_11633);
Result_11634 = (*LOC1).Typ;
return Result_11634;
}
N_NIMCALL(TGenericSeq*, setLengthSeq)(TGenericSeq* Seq_19003, NI Elemsize_19004, NI Newlen_19005) {
TGenericSeq* Result_19006;
NI LOC4;
void* LOC5;
NI I_19025;
NI HEX3Atmp_21069;
NI Res_21071;
TNimType* LOC9;
Result_19006 = 0;
Result_19006 = Seq_19003;
if (!((*Result_19006).space < Newlen_19005)) goto LA2;
LOC4 = Resize_18601((*Result_19006).space);
(*Result_19006).space = ((LOC4 >= Newlen_19005) ? LOC4 : Newlen_19005);
LOC5 = Growobj_14407(((void*) (Result_19006)), (NI64)((NI64)(Elemsize_19004 * (*Result_19006).space) + 16));
Result_19006 = ((TGenericSeq*) (LOC5));
goto LA1;
LA2: ;
if (!(Newlen_19005 < (*Result_19006).len)) goto LA6;
I_19025 = 0;
HEX3Atmp_21069 = 0;
HEX3Atmp_21069 = (NI64)((*Result_19006).len - 1);
Res_21071 = 0;
Res_21071 = Newlen_19005;
while (1) {
if (!(Res_21071 <= HEX3Atmp_21069)) goto LA8;
I_19025 = Res_21071;
LOC9 = extGetCellType(((void*) (Result_19006)));
Forallchildrenaux_12220(((void*) ((NI64)((NU64)((NI64)((NU64)(((NI) (Result_19006))) + (NU64)(16))) + (NU64)((NI64)((NU64)(I_19025) * (NU64)(Elemsize_19004)))))), (*LOC9).base, ((NU8) 0));
Res_21071 += 1;
} LA8: ;
zeroMem(((void*) ((NI64)((NU64)((NI64)((NU64)(((NI) (Result_19006))) + (NU64)(16))) + (NU64)((NI64)((NU64)(Newlen_19005) * (NU64)(Elemsize_19004)))))), (NI64)((NU64)((NI64)((NU64)((*Result_19006).len) - (NU64)(Newlen_19005))) * (NU64)(Elemsize_19004)));
goto LA1;
LA6: ;
LA1: ;
(*Result_19006).len = Newlen_19005;
return Result_19006;
}
N_NIMCALL(void, Objectinitaux_19678)(void* Dest_19680, TNimNode* N_19682) {
NI D_19683;
NI I_19692;
NI HEX3Atmp_21090;
NI Res_21092;
TNimNode* M_19693;
D_19683 = 0;
D_19683 = ((NI) (Dest_19680));
switch ((*N_19682).kind) {
case ((NU8) 0):
break;
case ((NU8) 1):
objectInit(((void*) ((NI64)((NU64)(D_19683) + (NU64)((*N_19682).offset)))), (*N_19682).typ);
break;
case ((NU8) 2):
I_19692 = 0;
HEX3Atmp_21090 = 0;
HEX3Atmp_21090 = (NI64)((*N_19682).len - 1);
Res_21092 = 0;
Res_21092 = 0;
while (1) {
if (!(Res_21092 <= HEX3Atmp_21090)) goto LA1;
I_19692 = Res_21092;
Objectinitaux_19678(Dest_19680, (*N_19682).sons[(I_19692)-0]);
Res_21092 += 1;
} LA1: ;
break;
case ((NU8) 3):
M_19693 = 0;
M_19693 = Selectbranch_7664(Dest_19680, N_19682);
if (!!((M_19693 == NIM_NIL))) goto LA3;
Objectinitaux_19678(Dest_19680, M_19693);
LA3: ;
break;
}
}
N_NIMCALL(void, objectInit)(void* Dest_19676, TNimType* Typ_19677) {
NI D_19709;
TNimType** Pint_19711;
NI I_19720;
NI HEX3Atmp_21093;
NI Res_21095;
D_19709 = 0;
D_19709 = ((NI) (Dest_19676));
switch ((*Typ_19677).kind) {
case ((NU8) 17):
Pint_19711 = 0;
Pint_19711 = ((TNimType**) (Dest_19676));
(*Pint_19711) = Typ_19677;
Objectinitaux_19678(Dest_19676, (*Typ_19677).node);
break;
case ((NU8) 18):
case ((NU8) 40):
Objectinitaux_19678(Dest_19676, (*Typ_19677).node);
break;
case ((NU8) 16):
case ((NU8) 4):
I_19720 = 0;
HEX3Atmp_21093 = 0;
HEX3Atmp_21093 = (NI64)((NI64)((*Typ_19677).size / (*(*Typ_19677).base).size) - 1);
Res_21095 = 0;
Res_21095 = 0;
while (1) {
if (!(Res_21095 <= HEX3Atmp_21093)) goto LA1;
I_19720 = Res_21095;
objectInit(((void*) ((NI64)((NU64)(D_19709) + (NU64)((NI64)(I_19720 * (*(*Typ_19677).base).size))))), (*Typ_19677).base);
Res_21095 += 1;
} LA1: ;
break;
default:
break;
}
}
N_NIMCALL(NimStringDesc*, addChar)(NimStringDesc* S_1803, NIM_CHAR C_1804) {
NimStringDesc* Result_18772;
void* LOC4;
Result_18772 = 0;
Result_18772 = S_1803;
if (!((*Result_18772).Sup.space <= (*Result_18772).Sup.len)) goto LA2;
(*Result_18772).Sup.space = Resize_18601((*Result_18772).Sup.space);
LOC4 = Growobj_14407(((void*) (Result_18772)), (NI64)(((NI)sizeof(TGenericSeq)) + (NI64)((NI64)((*Result_18772).Sup.space + 1) * 1)));
Result_18772 = ((NimStringDesc*) (LOC4));
LA2: ;
(*Result_18772).data[((*Result_18772).Sup.len)-0] = C_1804;
(*Result_18772).data[((NI64)((*Result_18772).Sup.len + 1))-0] = 0;
(*Result_18772).Sup.len += 1;
return Result_18772;
}
N_NIMCALL(NimStringDesc*, nimIntToStr)(NI X_19403) {
NimStringDesc* Result_19404;
NI I_19405;
NI Y_19406;
NI D_19407;
NI J_19451;
NI HEX3Atmp_21072;
NI Res_21074;
NIM_CHAR LOC9;
Result_19404 = 0;
Result_19404 = mnewString(32);
I_19405 = 0;
I_19405 = 0;
Y_19406 = 0;
Y_19406 = X_19403;
while (1) {
D_19407 = 0;
D_19407 = (NI64)(Y_19406 / 10);
Result_19404->data[I_19405] = ((NIM_CHAR) (((NI) ((NI64)((NI64)abs(((NI) ((NI64)(Y_19406 - (NI64)(D_19407 * 10))))) + 48)))));
I_19405 += 1;
Y_19406 = D_19407;
if (!(Y_19406 == 0)) goto LA3;
goto LA1;
LA3: ;
} LA1: ;
if (!(X_19403 < 0)) goto LA6;
Result_19404->data[I_19405] = 45;
I_19405 += 1;
LA6: ;
Result_19404 = setLengthStr(Result_19404, I_19405);
J_19451 = 0;
HEX3Atmp_21072 = 0;
HEX3Atmp_21072 = (NI64)((NI64)(I_19405 / 2) - 1);
Res_21074 = 0;
Res_21074 = 0;
while (1) {
if (!(Res_21074 <= HEX3Atmp_21072)) goto LA8;
J_19451 = Res_21074;
LOC9 = Result_19404->data[J_19451];
Result_19404->data[J_19451] = Result_19404->data[(NI64)((NI64)(I_19405 - J_19451) - 1)];
Result_19404->data[(NI64)((NI64)(I_19405 - J_19451) - 1)] = LOC9;
Res_21074 += 1;
} LA8: ;
return Result_19404;
}
N_NIMCALL(TGenericSeq*, incrSeq)(TGenericSeq* Seq_18842, NI Elemsize_18843) {
TGenericSeq* Result_18844;
void* LOC4;
Result_18844 = 0;
Result_18844 = Seq_18842;
if (!((*Result_18844).space <= (*Result_18844).len)) goto LA2;
(*Result_18844).space = Resize_18601((*Result_18844).space);
LOC4 = Growobj_14407(((void*) (Result_18844)), (NI64)((NI64)(Elemsize_18843 * (*Result_18844).space) + 16));
Result_18844 = ((TGenericSeq*) (LOC4));
LA2: ;
(*Result_18844).len += 1;
return Result_18844;
}
N_NIMCALL(NIM_BOOL, Open_3817)(FILE** F_3820, NimStringDesc* Filename_3821, NU8 Mode_3822, NI Bufsize_3823) {
NIM_BOOL Result_4520;
void* P_4521;
int LOC5;
TY442* E_4529;
int LOC11;
Result_4520 = 0;
P_4521 = 0;
P_4521 = fopen(Filename_3821->data, Formatopen_4509[(Mode_3822)-0]->data);
Result_4520 = !((P_4521 == NIM_NIL));
(*F_3820) = ((FILE*) (P_4521));
if (!(0 < Bufsize_3823)) goto LA2;
LOC5 = setvbuf((*F_3820), NIM_NIL, _IOFBF, ((int) (Bufsize_3823)));
if (!!((LOC5 == ((NI32) 0)))) goto LA6;
E_4529 = 0;
E_4529 = (TY442*) newObj(NTI8244, sizeof(TY442));
(*E_4529).Sup.Sup.Sup.Sup.m_type = NTI442;
asgnRefNoCycle((void**) &(*E_4529).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP21127)));
raiseException((E_Base*)E_4529, "EOutOfMemory");
LA6: ;
goto LA1;
LA2: ;
if (!(Bufsize_3823 == 0)) goto LA9;
LOC11 = setvbuf((*F_3820), NIM_NIL, _IONBF, ((NI32) 0));
goto LA1;
LA9: ;
LA1: ;
return Result_4520;
}
N_NIMCALL(NI, Readbuffer_3922)(FILE* F_3924, void* Buffer_3925, NI Len_3926) {
NI Result_4601;
Result_4601 = 0;
Result_4601 = fread(Buffer_3925, 1, Len_3926, F_3924);
return Result_4601;
}
N_NIMCALL(void, Rawreadline_3997)(FILE* F_3999, NimStringDesc** Result_4001) {
int C_4002;
(*Result_4001) = setLengthStr((*Result_4001), 0);
while (1) {
C_4002 = 0;
C_4002 = fgetc(F_3999);
if (!(C_4002 < ((NI32) 0))) goto LA3;
goto LA1;
LA3: ;
if (!(C_4002 == ((NI32) 10))) goto LA6;
goto LA1;
LA6: ;
if (!(C_4002 == ((NI32) 13))) goto LA9;
C_4002 = fgetc(F_3999);
if (!!((C_4002 == ((NI32) 10)))) goto LA12;
ungetc(C_4002, F_3999);
LA12: ;
goto LA1;
LA9: ;
(*Result_4001) = addChar((*Result_4001), ((NIM_CHAR) (((NI) (((NI) (C_4002)))))));
} LA1: ;
}
N_NIMCALL(NimStringDesc*, Readline_3887)(FILE* F_3889) {
NimStringDesc* Result_4016;
Result_4016 = 0;
Result_4016 = copyString(((NimStringDesc*) &TMP195649));
Rawreadline_3997(F_3889, &Result_4016);
return Result_4016;
}
N_NIMCALL(NI64, mulInt64)(NI64 A_6139, NI64 B_6140) {
NI64 Result_6141;
NF64 Resasfloat_6142;
NF64 Floatprod_6143;
Result_6141 = 0;
Resasfloat_6142 = 0;
Floatprod_6143 = 0;
Result_6141 = (NI64)((NU64)(A_6139) * (NU64)(B_6140));
Floatprod_6143 = ((double) (A_6139));
Floatprod_6143 = ((NF64) ((((NF) (Floatprod_6143)) * ((NF) (((double) (B_6140)))))));
Resasfloat_6142 = ((double) (Result_6141));
if (!(((NF) (Resasfloat_6142)) == ((NF) (Floatprod_6143)))) goto LA2;
goto BeforeRet;
LA2: ;
if (!((3.2000000000000000e+01 * ((((NF) (Resasfloat_6142)) - ((NF) (Floatprod_6143))) > 0? ((((NF) (Resasfloat_6142)) - ((NF) (Floatprod_6143)))) : -((((NF) (Resasfloat_6142)) - ((NF) (Floatprod_6143)))))) <= (((NF) (Floatprod_6143)) > 0? (((NF) (Floatprod_6143))) : -(((NF) (Floatprod_6143)))))) goto LA5;
goto BeforeRet;
LA5: ;
raiseOverflow();
BeforeRet: ;
return Result_6141;
}
N_NIMCALL(void, reraiseException)(void) {
TY452* E_5634;
if (!(Currexception_5032 == NIM_NIL)) goto LA2;
E_5634 = 0;
E_5634 = (TY452*) newObj(NTI5633, sizeof(TY452));
(*E_5634).Sup.Sup.Sup.m_type = NTI452;
asgnRefNoCycle((void**) &(*E_5634).Sup.Sup.message, copyString(((NimStringDesc*) &TMP195660)));
raiseException((E_Base*)E_5634, "ENoExceptionToReraise");
goto LA1;
LA2: ;
raiseException(Currexception_5032, (*Currexception_5032).name);
LA1: ;
}
N_NIMCALL(NI, Ptrsize_10433)(void* P_10435) {
NI Result_10436;
void* X_10437;
TY8830* LOC1;
Result_10436 = 0;
X_10437 = 0;
X_10437 = ((void*) ((NI64)((NU64)(((NI) (P_10435))) - (NU64)(((NI)sizeof(TY8822))))));
LOC1 = Pageaddr_9087(X_10437);
Result_10436 = (NI64)((*LOC1).Size - ((NI)sizeof(TY8822)));
return Result_10436;
}
N_NOCONV(void*, Realloc_2356)(void* P_2358, NI Newsize_2359) {
void* Result_10442;
NI LOC7;
Result_10442 = 0;
if (!(0 < Newsize_2359)) goto LA2;
Result_10442 = Alloc_2350(Newsize_2359);
if (!!((P_2358 == NIM_NIL))) goto LA5;
LOC7 = Ptrsize_10433(P_2358);
memcpy(Result_10442, P_2358, LOC7);
Dealloc_2360(P_2358);
LA5: ;
goto LA1;
LA2: ;
if (!!((P_2358 == NIM_NIL))) goto LA8;
Dealloc_2360(P_2358);
goto LA1;
LA8: ;
LA1: ;
return Result_10442;
}
N_NIMCALL(NimStringDesc*, nimCharToStr)(NIM_CHAR X_19534) {
NimStringDesc* Result_19535;
Result_19535 = 0;
Result_19535 = mnewString(1);
Result_19535->data[0] = X_19534;
return Result_19535;
}
N_NIMCALL(NimStringDesc*, nimInt64ToStr)(NI64 X_19470) {
NimStringDesc* Result_19471;
NI I_19472;
NI64 Y_19473;
NI64 D_19474;
NI J_19518;
NI HEX3Atmp_21075;
NI Res_21077;
NIM_CHAR LOC9;
Result_19471 = 0;
Result_19471 = mnewString(32);
I_19472 = 0;
I_19472 = 0;
Y_19473 = 0;
Y_19473 = X_19470;
while (1) {
D_19474 = 0;
D_19474 = (NI64)(Y_19473 / 10);
Result_19471->data[I_19472] = ((NIM_CHAR) (((NI) ((NI64)((NI64)abs(((NI) ((NI64)(Y_19473 - (NI64)(D_19474 * 10))))) + 48)))));
I_19472 += 1;
Y_19473 = D_19474;
if (!(Y_19473 == 0)) goto LA3;
goto LA1;
LA3: ;
} LA1: ;
if (!(X_19470 < 0)) goto LA6;
Result_19471->data[I_19472] = 45;
I_19472 += 1;
LA6: ;
Result_19471 = setLengthStr(Result_19471, I_19472);
J_19518 = 0;
HEX3Atmp_21075 = 0;
HEX3Atmp_21075 = (NI64)((NI64)(I_19472 / 2) - 1);
Res_21077 = 0;
Res_21077 = 0;
while (1) {
if (!(Res_21077 <= HEX3Atmp_21075)) goto LA8;
J_19518 = Res_21077;
LOC9 = Result_19471->data[J_19518];
Result_19471->data[J_19518] = Result_19471->data[(NI64)((NI64)(I_19472 - J_19518) - 1)];
Result_19471->data[(NI64)((NI64)(I_19472 - J_19518) - 1)] = LOC9;
Res_21077 += 1;
} LA8: ;
return Result_19471;
}
N_NIMCALL(NimStringDesc*, nimFloatToStr)(NF X_19463) {
NimStringDesc* Result_19464;
TY19465 Buf_19467;
Result_19464 = 0;
memset((void*)&Buf_19467, 0, sizeof(Buf_19467));
sprintf(((NCSTRING) (Buf_19467)), "%#.16e", X_19463);
Result_19464 = cstrToNimstr(((NCSTRING) (Buf_19467)));
goto BeforeRet;
BeforeRet: ;
return Result_19464;
}
N_NIMCALL(NimStringDesc*, reprEnum)(NI E_19771, TNimType* Typ_19772) {
NimStringDesc* Result_19773;
NimStringDesc* LOC4;
NimStringDesc* LOC5;
Result_19773 = 0;
if (!((NU64)(E_19771) < (NU64)((*(*Typ_19772).node).len))) goto LA2;
Result_19773 = cstrToNimstr((*(*(*Typ_19772).node).sons[(E_19771)-0]).name);
goto LA1;
LA2: ;
LOC4 = 0;
LOC5 = 0;
LOC5 = nimIntToStr(E_19771);
LOC4 = rawNewString(LOC5->Sup.len + 16);
appendString(LOC4, LOC5);
appendString(LOC4, ((NimStringDesc*) &TMP195764));
Result_19773 = LOC4;
LA1: ;
return Result_19773;
}
N_NIMCALL(NIM_BOOL, Endoffile_3838)(FILE* F_3840) {
NIM_BOOL Result_4477;
int C_4478;
Result_4477 = 0;
C_4478 = 0;
C_4478 = fgetc(F_3840);
ungetc(C_4478, F_3840);
Result_4477 = (C_4478 == ((NI32) -1));
goto BeforeRet;
BeforeRet: ;
return Result_4477;
}
static N_INLINE(void, pushSafePoint)(TSafePoint* S_5035) {
(*S_5035).prev = excHandler;
excHandler = S_5035;
}
N_NIMCALL(NI64, Getfilepos_3950)(FILE* F_3952) {
NI64 Result_4707;
NI LOC1;
TY420* E_4713;
Result_4707 = 0;
LOC1 = ftell(F_3952);
Result_4707 = ((NI64) (LOC1));
if (!(Result_4707 < 0)) goto LA3;
E_4713 = 0;
E_4713 = (TY420*) newObj(NTI4664, sizeof(TY420));
(*E_4713).Sup.Sup.Sup.Sup.m_type = NTI420;
asgnRefNoCycle((void**) &(*E_4713).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP195868)));
raiseException((E_Base*)E_4713, "EIO");
LA3: ;
return Result_4707;
}
N_NIMCALL(void, Setfilepos_3946)(FILE* F_3948, NI64 Pos_3949) {
NI LOC2;
TY420* E_4688;
LOC2 = fseek(F_3948, ((NI) (Pos_3949)), 0);
if (!!((LOC2 == 0))) goto LA3;
E_4688 = 0;
E_4688 = (TY420*) newObj(NTI4664, sizeof(TY420));
(*E_4688).Sup.Sup.Sup.Sup.m_type = NTI420;
asgnRefNoCycle((void**) &(*E_4688).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP195869)));
raiseException((E_Base*)E_4688, "EIO");
LA3: ;
}
N_NIMCALL(NI64, Getfilesize_3903)(FILE* F_3905) {
NI64 Result_4732;
NI64 Oldpos_4733;
NI LOC1;
Result_4732 = 0;
Oldpos_4733 = 0;
Oldpos_4733 = Getfilepos_3950(F_3905);
LOC1 = fseek(F_3905, 0, 2);
Result_4732 = Getfilepos_3950(F_3905);
Setfilepos_3946(F_3905, Oldpos_4733);
return Result_4732;
}
static N_INLINE(void, popSafePoint)(void) {
excHandler = (*excHandler).prev;
}
static N_INLINE(E_Base*, getCurrentException)(void) {
E_Base* Result_20404;
Result_20404 = 0;
Result_20404 = Currexception_5032;
return Result_20404;
}
static N_INLINE(void, popCurrentException)(void) {
asgnRef((void**) &Currexception_5032, (*Currexception_5032).parent);
}
N_NIMCALL(NimStringDesc*, Readfile_3847)(NimStringDesc* Filename_3849) {
NimStringDesc* Result_4463;
FILE* F_4464;
TSafePoint TMP195867;
NIM_BOOL LOC2;
NI64 volatile Len_4466;
NI LOC9;
Result_4463 = 0;
F_4464 = 0;
pushSafePoint(&TMP195867);
TMP195867.status = setjmp(TMP195867.context);
if (TMP195867.status == 0) {
LOC2 = Open_3817(&F_4464, Filename_3849, ((NU8) 0), -1);
if (!LOC2) goto LA3;
Len_4466 = 0;
Len_4466 = Getfilesize_3903(F_4464);
if (!(Len_4466 < IL64(9223372036854775807))) goto LA6;
Result_4463 = mnewString(((NI) (Len_4466)));
LOC9 = Readbuffer_3922(F_4464, ((void*) (&Result_4463->data[0])), ((NI) (Len_4466)));
if (!!((((NI64) (LOC9)) == Len_4466))) goto LA10;
Result_4463 = copyString(NIM_NIL);
LA10: ;
LA6: ;
fclose(F_4464);
goto LA1;
LA3: ;
Result_4463 = copyString(NIM_NIL);
LA1: ;
popSafePoint();
} else {
popSafePoint();
if (getCurrentException()->Sup.m_type == NTI420) {
Result_4463 = copyString(NIM_NIL);
TMP195867.status = 0;popCurrentException();}
}
if (TMP195867.status != 0) reraiseException();
return Result_4463;
}
N_NIMCALL(void, Genericassignaux_19578)(void* Dest_19580, void* Src_19581, TNimNode* N_19583) {
NI D_19584;
NI S_19585;
NI I_19594;
NI HEX3Atmp_21078;
NI Res_21080;
TNimNode* M_19595;
D_19584 = 0;
D_19584 = ((NI) (Dest_19580));
S_19585 = 0;
S_19585 = ((NI) (Src_19581));
switch ((*N_19583).kind) {
case ((NU8) 0):
break;
case ((NU8) 1):
genericAssign(((void*) ((NI64)((NU64)(D_19584) + (NU64)((*N_19583).offset)))), ((void*) ((NI64)((NU64)(S_19585) + (NU64)((*N_19583).offset)))), (*N_19583).typ);
break;
case ((NU8) 2):
I_19594 = 0;
HEX3Atmp_21078 = 0;
HEX3Atmp_21078 = (NI64)((*N_19583).len - 1);
Res_21080 = 0;
Res_21080 = 0;
while (1) {
if (!(Res_21080 <= HEX3Atmp_21078)) goto LA1;
I_19594 = Res_21080;
Genericassignaux_19578(Dest_19580, Src_19581, (*N_19583).sons[(I_19594)-0]);
Res_21080 += 1;
} LA1: ;
break;
case ((NU8) 3):
memcpy(((void*) ((NI64)((NU64)(D_19584) + (NU64)((*N_19583).offset)))), ((void*) ((NI64)((NU64)(S_19585) + (NU64)((*N_19583).offset)))), (*(*N_19583).typ).size);
M_19595 = 0;
M_19595 = Selectbranch_7664(Src_19581, N_19583);
if (!!((M_19595 == NIM_NIL))) goto LA3;
Genericassignaux_19578(Dest_19580, Src_19581, M_19595);
LA3: ;
break;
}
}
N_NIMCALL(void, genericAssign)(void* Dest_19575, void* Src_19576, TNimType* Mt_19577) {
NI D_19612;
NI S_19613;
void* S2_19625;
TGenericSeq* Seq_19626;
void** X_19627;
void* LOC4;
NI Dst_19628;
NI I_19637;
NI HEX3Atmp_21081;
NI Res_21083;
TGenericSeq* Dstseq_19638;
NI I_19647;
NI HEX3Atmp_21084;
NI Res_21086;
void* S2_19648;
NimStringDesc* LOC10;
void** X_19649;
D_19612 = 0;
D_19612 = ((NI) (Dest_19575));
S_19613 = 0;
S_19613 = ((NI) (Src_19576));
switch ((*Mt_19577).kind) {
case ((NU8) 24):
S2_19625 = 0;
S2_19625 = (*((void**) (Src_19576)));
Seq_19626 = 0;
Seq_19626 = ((TGenericSeq*) (S2_19625));
if (!(S2_19625 == NIM_NIL)) goto LA2;
X_19627 = 0;
X_19627 = ((void**) (Dest_19575));
(*X_19627) = NIM_NIL;
goto BeforeRet;
LA2: ;
LOC4 = newObj(Mt_19577, (NI64)((NI64)((*Seq_19626).len * (*(*Mt_19577).base).size) + 16));
unsureAsgnRef(((void**) (Dest_19575)), LOC4);
Dst_19628 = 0;
Dst_19628 = ((NI) ((*((void**) (Dest_19575)))));
I_19637 = 0;
HEX3Atmp_21081 = 0;
HEX3Atmp_21081 = (NI64)((*Seq_19626).len - 1);
Res_21083 = 0;
Res_21083 = 0;
while (1) {
if (!(Res_21083 <= HEX3Atmp_21081)) goto LA5;
I_19637 = Res_21083;
genericAssign(((void*) ((NI64)((NU64)((NI64)((NU64)(Dst_19628) + (NU64)((NI64)((NU64)(I_19637) * (NU64)((*(*Mt_19577).base).size))))) + (NU64)(16)))), ((void*) ((NI64)((NU64)((NI64)((NU64)(((NI) (S2_19625))) + (NU64)((NI64)((NU64)(I_19637) * (NU64)((*(*Mt_19577).base).size))))) + (NU64)(16)))), (*Mt_19577).base);
Res_21083 += 1;
} LA5: ;
Dstseq_19638 = 0;
Dstseq_19638 = ((TGenericSeq*) (Dst_19628));
(*Dstseq_19638).len = (*Seq_19626).len;
(*Dstseq_19638).space = (*Seq_19626).len;
break;
case ((NU8) 17):
case ((NU8) 18):
case ((NU8) 40):
Genericassignaux_19578(Dest_19575, Src_19576, (*Mt_19577).node);
break;
case ((NU8) 16):
case ((NU8) 4):
I_19647 = 0;
HEX3Atmp_21084 = 0;
HEX3Atmp_21084 = (NI64)((NI64)((*Mt_19577).size / (*(*Mt_19577).base).size) - 1);
Res_21086 = 0;
Res_21086 = 0;
while (1) {
if (!(Res_21086 <= HEX3Atmp_21084)) goto LA6;
I_19647 = Res_21086;
genericAssign(((void*) ((NI64)((NU64)(D_19612) + (NU64)((NI64)((NU64)(I_19647) * (NU64)((*(*Mt_19577).base).size)))))), ((void*) ((NI64)((NU64)(S_19613) + (NU64)((NI64)((NU64)(I_19647) * (NU64)((*(*Mt_19577).base).size)))))), (*Mt_19577).base);
Res_21086 += 1;
} LA6: ;
break;
case ((NU8) 28):
S2_19648 = 0;
S2_19648 = (*((void**) (S_19613)));
if (!!((S2_19648 == NIM_NIL))) goto LA8;
LOC10 = copyString(((NimStringDesc*) (S2_19648)));
unsureAsgnRef(((void**) (Dest_19575)), ((void*) (LOC10)));
goto LA7;
LA8: ;
X_19649 = 0;
X_19649 = ((void**) (Dest_19575));
(*X_19649) = NIM_NIL;
goto BeforeRet;
LA7: ;
break;
case ((NU8) 22):
unsureAsgnRef(((void**) (Dest_19575)), (*((void**) (S_19613))));
break;
default:
memcpy(Dest_19575, Src_19576, (*Mt_19577).size);
break;
}
BeforeRet: ;
}
N_NIMCALL(void, genericSeqAssign)(void* Dest_19652, void* Src_19653, TNimType* Mt_19654) {
void* Src_19655;
Src_19655 = 0;
Src_19655 = Src_19653;
genericAssign(Dest_19652, ((void*) (&Src_19655)), Mt_19654);
}
N_NIMCALL(void, Quit_21140)(NimStringDesc* Errormsg_21142) {
rawEcho(Errormsg_21142);
rawEchoNL();
exit(1);
}
N_NIMCALL(NimStringDesc*, Gcgetstatistics_3082)(void) {
NimStringDesc* Result_18026;
NimStringDesc* LOC1;
NI LOC2;
NimStringDesc* LOC3;
NI LOC4;
NimStringDesc* LOC5;
NimStringDesc* LOC6;
NimStringDesc* LOC7;
NimStringDesc* LOC8;
NimStringDesc* LOC9;
NimStringDesc* LOC10;
NimStringDesc* LOC11;
NimStringDesc* LOC12;
Result_18026 = 0;
Gcdisable_3063();
LOC1 = 0;
LOC2 = Gettotalmem_2421();
LOC3 = 0;
LOC3 = nimIntToStr(LOC2);
LOC4 = Getoccupiedmem_2417();
LOC5 = 0;
LOC5 = nimIntToStr(LOC4);
LOC6 = 0;
LOC6 = nimIntToStr(Gch_11214.Stat.Stackscans);
LOC7 = 0;
LOC7 = nimIntToStr(Gch_11214.Stat.Maxstackcells);
LOC8 = 0;
LOC8 = nimIntToStr(Gch_11214.Stat.Cyclecollections);
LOC9 = 0;
LOC9 = nimIntToStr(Gch_11214.Stat.Maxthreshold);
LOC10 = 0;
LOC10 = nimIntToStr(Gch_11214.Zct.Cap);
LOC11 = 0;
LOC11 = nimIntToStr(Gch_11214.Stat.Cycletablesize);
LOC12 = 0;
LOC12 = nimIntToStr(Gch_11214.Stat.Maxstacksize);
LOC1 = rawNewString(LOC3->Sup.len + LOC5->Sup.len + LOC6->Sup.len + LOC7->Sup.len + LOC8->Sup.len + LOC9->Sup.len + LOC10->Sup.len + LOC11->Sup.len + LOC12->Sup.len + 196);
appendString(LOC1, ((NimStringDesc*) &TMP197501));
appendString(LOC1, LOC3);
appendString(LOC1, ((NimStringDesc*) &TMP197502));
appendString(LOC1, LOC5);
appendString(LOC1, ((NimStringDesc*) &TMP197503));
appendString(LOC1, LOC6);
appendString(LOC1, ((NimStringDesc*) &TMP197504));
appendString(LOC1, LOC7);
appendString(LOC1, ((NimStringDesc*) &TMP197505));
appendString(LOC1, LOC8);
appendString(LOC1, ((NimStringDesc*) &TMP197506));
appendString(LOC1, LOC9);
appendString(LOC1, ((NimStringDesc*) &TMP197507));
appendString(LOC1, LOC10);
appendString(LOC1, ((NimStringDesc*) &TMP197508));
appendString(LOC1, LOC11);
appendString(LOC1, ((NimStringDesc*) &TMP197509));
appendString(LOC1, LOC12);
Result_18026 = LOC1;
Gcenable_3065();
return Result_18026;
}
static N_INLINE(void, Listremove_9248)(TY8834** Head_9252, TY8834* C_9253) {
if (!(C_9253 == (*Head_9252))) goto LA2;
(*Head_9252) = (*C_9253).Next;
if (!!(((*Head_9252) == NIM_NIL))) goto LA5;
(*(*Head_9252)).Prev = NIM_NIL;
LA5: ;
goto LA1;
LA2: ;
(*(*C_9253).Prev).Next = (*C_9253).Next;
if (!!(((*C_9253).Next == NIM_NIL))) goto LA8;
(*(*C_9253).Next).Prev = (*C_9253).Prev;
LA8: ;
LA1: ;
(*C_9253).Next = NIM_NIL;
(*C_9253).Prev = NIM_NIL;
}
static N_INLINE(void, Listadd_9834)(TY8832** Head_9838, TY8832* C_9839) {
(*C_9839).Next = (*Head_9838);
if (!!(((*Head_9838) == NIM_NIL))) goto LA2;
(*(*Head_9838)).Prev = C_9839;
LA2: ;
(*Head_9838) = C_9839;
}
static N_INLINE(void, Listremove_9978)(TY8832** Head_9982, TY8832* C_9983) {
if (!(C_9983 == (*Head_9982))) goto LA2;
(*Head_9982) = (*C_9983).Next;
if (!!(((*Head_9982) == NIM_NIL))) goto LA5;
(*(*Head_9982)).Prev = NIM_NIL;
LA5: ;
goto LA1;
LA2: ;
(*(*C_9983).Prev).Next = (*C_9983).Next;
if (!!(((*C_9983).Next == NIM_NIL))) goto LA8;
(*(*C_9983).Next).Prev = (*C_9983).Prev;
LA8: ;
LA1: ;
(*C_9983).Next = NIM_NIL;
(*C_9983).Prev = NIM_NIL;
}
static N_INLINE(void, Listadd_9609)(TY8834** Head_9613, TY8834* C_9614) {
(*C_9614).Next = (*Head_9613);
if (!!(((*Head_9613) == NIM_NIL))) goto LA2;
(*(*Head_9613)).Prev = C_9614;
LA2: ;
(*Head_9613) = C_9614;
}
N_NOINLINE(void, systemInit)(void) {
Dbglinehook_3122 = ((TY3119) (NIM_NIL));
Strdesc_3237.size = 8;
Strdesc_3237.kind = ((NU8) 28);
Strdesc_3237.flags = 2;
Initstackbottom_3233();
Initgc_3231();
asgnRefNoCycle((void**) &Stacktracenewline_4826, copyString(((NimStringDesc*) &TMP21126)));
excHandler = NIM_NIL;
registerSignalHandler();
asgnRefNoCycle((void**) &Gassertionfailed_5651, (EAssertionFailed*) newObj(NTI5650, sizeof(EAssertionFailed)));
(*Gassertionfailed_5651).Sup.Sup.Sup.m_type = NTI436;
asgnRefNoCycle((void**) &Buf_5201, mnewString(2048));
asgnRefNoCycle((void**) &Assertbuf_5202, mnewString(2048));
Buf_5201 = setLengthStr(Buf_5201, 0);
Assertbuf_5202 = setLengthStr(Assertbuf_5202, 0);
Lastsize_9093 = 4096;
Cyclethreshold_11215 = 4194304;
Recgclock_11216 = 0;
}

