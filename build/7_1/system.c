/* Generated by Nimrod Compiler v0.8.11 */
/*   (c) 2011 Andreas Rumpf */

typedef long int NI;
typedef unsigned long int NU;
#include "nimbase.h"

#include <sys/mman.h>
#include <errno.h>
#include <signal.h>
#include <dlfcn.h>
typedef struct TNimType TNimType;
typedef struct TNimNode TNimNode;
typedef struct TY10790 TY10790;
typedef struct TY10418 TY10418;
typedef struct TY10402 TY10402;
typedef struct TY10414 TY10414;
typedef struct TY10410 TY10410;
typedef struct TY10788 TY10788;
typedef struct TY8474 TY8474;
typedef struct TY8432 TY8432;
typedef struct TY8430 TY8430;
typedef struct TY8422 TY8422;
typedef struct TY8472 TY8472;
typedef struct TY8434 TY8434;
typedef struct TY8411 TY8411;
typedef struct TY8407 TY8407;
typedef struct NimStringDesc NimStringDesc;
typedef struct TGenericSeq TGenericSeq;
typedef struct TY420 TY420;
typedef struct TY418 TY418;
typedef struct TY416 TY416;
typedef struct E_Base E_Base;
typedef struct TNimObject TNimObject;
typedef struct TSafePoint TSafePoint;
typedef struct TY442 TY442;
typedef struct EAssertionFailed EAssertionFailed;
typedef struct EOverflow EOverflow;
typedef struct TY428 TY428;
typedef struct TY452 TY452;
typedef N_NIMCALL_PTR(void, TY2719) (void);
struct TNimType {
NI size;
NU8 kind;
NU8 flags;
TNimType* base;
TNimNode* node;
void* finalizer;
};
struct TY10418 {
NI Len;
NI Cap;
TY10402** D;
};
struct TY10414 {
NI Counter;
NI Max;
TY10410* Head;
TY10410** Data;
};
struct TY10788 {
NI Stackscans;
NI Cyclecollections;
NI Maxthreshold;
NI Maxstacksize;
NI Maxstackcells;
NI Cycletablesize;
};
struct TY10790 {
TY10418 Zct;
TY10418 Decstack;
TY10414 Cycleroots;
TY10418 Tempstack;
TY10788 Stat;
};
struct TY8430 {
NI Prevsize;
NI Size;
NIM_BOOL Used;
};
struct TY8432 {
  TY8430 Sup;
TY8432* Next;
TY8432* Prev;
TY8422* Freelist;
NI Free;
NI Acc;
NF64 Data;
};
typedef TY8432* TY8481[512];
typedef TY8407* TY8409[1024];
struct TY8411 {
TY8409 Data;
};
struct TY8474 {
TY8472* Llmem;
NI Currmem;
NI Maxmem;
NI Freemem;
TY8481 Freesmallchunks;
TY8434* Freechunkslist;
TY8411 Chunkstarts;
};
struct TY8434 {
  TY8430 Sup;
TY8434* Next;
TY8434* Prev;
NI Align;
NF64 Data;
};
typedef NI TY8414[16];
struct TY8407 {
TY8407* Next;
NI Key;
TY8414 Bits;
};
struct TY8472 {
NI Size;
NI Acc;
};
struct TGenericSeq {
NI len;
NI space;
};
typedef NIM_CHAR TY239[100000001];
struct NimStringDesc {
  TGenericSeq Sup;
TY239 data;
};
struct TNimNode {
NU8 kind;
NI offset;
TNimType* typ;
NCSTRING name;
NI len;
TNimNode** sons;
};
struct TNimObject {
TNimType* m_type;
};
struct E_Base {
  TNimObject Sup;
E_Base* parent;
NCSTRING name;
NimStringDesc* message;
};
struct TY416 {
  E_Base Sup;
};
struct TY418 {
  TY416 Sup;
};
struct TY420 {
  TY418 Sup;
};
struct TY10402 {
NI Refcount;
TNimType* Typ;
};
struct TY8422 {
TY8422* Next;
NI Zerofield;
};
struct TY10410 {
TY10410* Next;
NI Key;
TY8414 Bits;
};
typedef N_NIMCALL_PTR(void, TFinalizer) (void* Self_10794);
struct TSafePoint {
TSafePoint* prev;
NI status;
E_Base* exc;
jmp_buf context;
};
struct TY442 {
  TY418 Sup;
};
typedef NimStringDesc* TY4102[5];
typedef TFrame* TY4803[128];
struct EAssertionFailed {
  TY416 Sup;
};
struct TY428 {
  TY416 Sup;
};
struct EOverflow {
  TY428 Sup;
};
struct TY452 {
  TY416 Sup;
};
typedef NIM_CHAR TY19062[60];
static N_INLINE(void, Initstackbottom_3013)(void);
N_NOINLINE(void, setStackBottom)(void* Thestackbottom_1624);
N_NIMCALL(void, Initgc_3011)(void);
N_NIMCALL(void, Init_10478)(TY10418* S_10481, NI Cap_10482);
N_NOCONV(void*, Alloc0_1953)(NI Size_1955);
N_NOCONV(void*, Alloc_1950)(NI Size_1952);
N_NIMCALL(void*, Rawalloc_9395)(TY8474* A_9398, NI Requestedsize_9399);
static N_INLINE(NI, Roundup_8456)(NI X_8458, NI V_8459);
N_NIMCALL(TY8432*, Getsmallchunk_9362)(TY8474* A_9365);
N_NIMCALL(TY8434*, Getbigchunk_9292)(TY8474* A_9295, NI Size_9296);
N_NIMCALL(void, Splitchunk_9266)(TY8474* A_9269, TY8434* C_9270, NI Size_9271);
static N_INLINE(void, Updateprevsize_8811)(TY8474* A_8814, TY8434* C_8815, NI Prevsize_8816);
static N_INLINE(NIM_BOOL, Isaccessible_8752)(void* P_8754);
N_NIMCALL(NIM_BOOL, Contains_8611)(TY8411* S_8613, NI Key_8614);
N_NIMCALL(TY8407*, Intsetget_8574)(TY8411* T_8576, NI Key_8577);
static N_INLINE(NI, Pageindex_8681)(void* P_8683);
N_NIMCALL(void, Incl_8631)(TY8411* S_8634, NI Key_8635);
N_NIMCALL(TY8407*, Intsetput_8593)(TY8411* T_8596, NI Key_8597);
N_NIMCALL(void*, Llalloc_8530)(TY8474* A_8533, NI Size_8534);
static N_INLINE(void*, Osallocpages_8013)(NI Size_8015);
N_NIMCALL(void, Raiseoutofmem_7841)(void);
N_NIMCALL(void, Quit_2821)(NimStringDesc* Errormsg_2823);
static N_INLINE(void, rawEcho)(NimStringDesc* X_4094);
N_NIMCALL(void, Write_3658)(FILE* F_3660, NimStringDesc* S_3661);
N_NIMCALL(NI, Writebuffer_3733)(FILE* F_3735, void* Buffer_3736, NI Len_3737);
N_NIMCALL(void*, newObj)(TNimType* Typ_13507, NI Size_13508);
static N_INLINE(void, Aquire_10811)(TY10790* Gch_10814);
static N_INLINE(void, Checkcollection_13500)(void);
N_NIMCALL(void, Collectct_11805)(TY10790* Gch_11808);
N_NIMCALL(NI, Getoccupiedmem_2017)(void);
N_NIMCALL(NI, Gettotalmem_2021)(void);
N_NIMCALL(NI, Getfreemem_2019)(void);
N_NOINLINE(NI, Stacksize_16601)(void);
N_CDECL(void, Markstackandregisters_16615)(TY10790* Gch_16618);
static N_INLINE(void, Gcmark_15803)(void* P_15805);
static N_INLINE(TY10402*, Usrtocell_11212)(void* Usr_11214);
N_NIMCALL(NIM_BOOL, Isallocatedptr_10001)(TY8474* A_10003, void* P_10004);
static N_INLINE(TY8430*, Pageaddr_8685)(void* P_8687);
static N_INLINE(NIM_BOOL, Chunkunused_8807)(TY8430* C_8809);
static N_INLINE(NIM_BOOL, Issmallchunk_8801)(TY8430* C_8803);
static N_INLINE(void, Add_10458)(TY10418* S_10461, TY10402* C_10462);
N_NOCONV(void, Dealloc_1960)(void* P_1962);
N_NIMCALL(void, Rawdealloc_9664)(TY8474* A_9667, void* P_9668);
N_NIMCALL(void, Freebigchunk_8820)(TY8474* A_8823, TY8434* C_8824);
N_NIMCALL(void, Excl_8638)(TY8411* S_8641, NI Key_8642);
static N_INLINE(NI, Pageindex_8677)(TY8430* C_8679);
N_NIMCALL(void, Freeoschunks_8726)(TY8474* A_8729, void* P_8730, NI Size_8731);
static N_INLINE(void, Osdeallocpages_8017)(void* P_8019, NI Size_8020);
static N_INLINE(void, Deccurrmem_8503)(TY8474* A_8506, NI Bytes_8507);
N_NIMCALL(void, Markthreadstacks_15811)(TY10790* Gch_15814);
N_NIMCALL(void, Collectzct_16801)(TY10790* Gch_16804);
static N_INLINE(NIM_BOOL, Canbecycleroot_11216)(TY10402* C_11218);
N_NIMCALL(void, Excl_10681)(TY10414* S_10684, TY10402* Cell_10685);
N_NIMCALL(TY10410*, Cellsetget_10514)(TY10414 T_10516, NI Key_10517);
static N_INLINE(NI, Nexttry_10509)(NI H_10511, NI Maxhash_10512);
N_NIMCALL(void, Preparedealloc_11825)(TY10402* Cell_11827);
static N_INLINE(void*, Celltousr_11208)(TY10402* Cell_11210);
N_NIMCALL(void, Forallchildren_11812)(TY10402* Cell_11814, NU8 Op_11815);
N_NIMCALL(void, Forallchildrenaux_11820)(void* Dest_11822, TNimType* Mt_11823, NU8 Op_11824);
N_NIMCALL(void, Dooperation_11816)(void* P_11818, NU8 Op_11819);
N_NOINLINE(void, Addzct_11201)(TY10418* S_11204, TY10402* C_11205);
N_NIMCALL(void, Forallslotsaux_13401)(void* Dest_13403, TNimNode* N_13405, NU8 Op_13406);
N_NIMCALL(TNimNode*, Selectbranch_7263)(void* Aa_7265, TNimNode* N_7267);
N_NIMCALL(NI, Getdiscriminant_7243)(void* Aa_7245, TNimNode* N_7247);
N_NIMCALL(void, Collectcycles_15003)(TY10790* Gch_15006);
N_NIMCALL(void, Init_10488)(TY10414* S_10491);
N_NIMCALL(NIM_BOOL, Containsorincl_10699)(TY10414* S_10702, TY10402* Cell_10703);
N_NOINLINE(void, Incl_10674)(TY10414* S_10677, TY10402* Cell_10678);
N_NIMCALL(TY10410*, Cellsetput_10595)(TY10414* T_10598, NI Key_10599);
N_NIMCALL(void, Cellsetenlarge_10570)(TY10414* T_10573);
N_NIMCALL(void, Cellsetrawinsert_10533)(TY10414 T_10535, TY10410** Data_10536, TY10410* Desc_10537);
N_NIMCALL(NIM_BOOL, Contains_10654)(TY10414 S_10656, TY10402* Cell_10657);
N_NIMCALL(void, Deinit_10492)(TY10414* S_10495);
N_NIMCALL(void, Unmarkstackandregisters_17401)(TY10790* Gch_17404);
static N_INLINE(void, Decref_12601)(TY10402* C_12603);
static N_INLINE(NI, Atomicdec_3006)(NI* Memloc_3009, NI X_3010);
static N_INLINE(void, Rtladdzct_12201)(TY10402* C_12203);
static N_INLINE(void, Rtladdcycleroot_11852)(TY10402* C_11854);
static N_INLINE(void, Release_11001)(TY10790* Gch_11004);
static N_INLINE(void, asgnRefNoCycle)(void** Dest_12818, void* Src_12819);
static N_INLINE(NI, Atomicinc_3001)(NI* Memloc_3004, NI X_3005);
N_NIMCALL(NimStringDesc*, copyString)(NimStringDesc* Src_18308);
N_NIMCALL(NimStringDesc*, rawNewString)(NI Space_18287);
N_NIMCALL(void, raiseException)(E_Base* E_5204, NCSTRING Ename_5205);
N_NIMCALL(void, Gcdisable_2663)(void);
static N_INLINE(void, pushCurrentException)(E_Base* E_4641);
static N_INLINE(void, asgnRef)(void** Dest_12814, void* Src_12815);
static N_INLINE(void, Incref_12802)(TY10402* C_12804);
N_NIMCALL(NimStringDesc*, setLengthStr)(NimStringDesc* S_18425, NI Newlen_18426);
N_NIMCALL(NimStringDesc*, resizeString)(NimStringDesc* Dest_18382, NI Addlen_18383);
static N_INLINE(NI, Resize_18201)(NI Old_18203);
N_NIMCALL(void*, Growobj_14007)(void* Old_14009, NI Newsize_14010);
N_NIMCALL(void, Rawwritestacktrace_4989)(NimStringDesc** S_4992);
static N_INLINE(void, appendString)(NimStringDesc* Dest_18392, NimStringDesc* Src_18393);
N_NIMCALL(NimStringDesc*, cstrToNimstr)(NCSTRING Str_18304);
N_NIMCALL(NimStringDesc*, toNimStr)(NCSTRING Str_18299, NI Len_18300);
N_NIMCALL(void, Writetostderr_4417)(NCSTRING Msg_4419);
N_NIMCALL(void, Write_3670)(FILE* F_3672, NCSTRING C_3673);
static N_INLINE(void, Quitordebug_5001)(void);
N_NIMCALL(void, Gcenable_2665)(void);
static N_INLINE(void, rawEchoNL)(void);
static N_INLINE(void, Inccurrmem_8486)(TY8474* A_8489, NI Bytes_8490);
N_NIMCALL(TY8434*, Requestoschunks_8692)(TY8474* A_8695, NI Size_8696);
N_NOCONV(void, signalHandler)(int Sig_5278);
N_NIMCALL(void, registerSignalHandler)(void);
N_NIMCALL(NimStringDesc*, mnewString)(NI Len_1349);
N_NIMCALL(NI, getRefcount)(void* P_11237);
N_NIMCALL(NimStringDesc*, mnewString)(NI Len_18295);
N_NIMCALL(NimStringDesc*, copyStrLast)(NimStringDesc* S_18343, NI Start_18344, NI Last_18345);
N_NIMCALL(NimStringDesc*, copyStr)(NimStringDesc* S_18358, NI Start_18359);
static N_INLINE(NI, addInt)(NI A_5803, NI B_5804);
N_NOINLINE(void, raiseOverflow)(void);
N_NIMCALL(NI, mulInt)(NI A_6803, NI B_6804);
N_NOINLINE(NIM_BOOL, Isonstack_11809)(void* P_11811);
N_NIMCALL(TNimType*, extGetCellType)(void* C_11233);
N_NIMCALL(void, Objectinitaux_19264)(void* Dest_19266, TNimNode* N_19268);
N_NIMCALL(void, objectInit)(void* Dest_19262, TNimType* Typ_19263);
N_NIMCALL(void, Rawreadline_3789)(FILE* F_3791, NimStringDesc** Result_3793);
N_NIMCALL(NimStringDesc*, addChar)(NimStringDesc* S_1603, NIM_CHAR C_1604);
N_NIMCALL(NI, Ptrsize_10033)(void* P_10035);
N_NIMCALL(NimStringDesc*, nimIntToStr)(NI X_19003);
static N_INLINE(void, pushSafePoint)(TSafePoint* S_4635);
N_NIMCALL(NIM_BOOL, Open_3617)(FILE** F_3620, NimStringDesc* Filename_3621, NU8 Mode_3622, NI Bufsize_3623);
N_NIMCALL(NI64, Getfilesize_3695)(FILE* F_3697);
N_NIMCALL(NI64, Getfilepos_3742)(FILE* F_3744);
N_NIMCALL(void, Setfilepos_3738)(FILE* F_3740, NI64 Pos_3741);
N_NIMCALL(NI, Readbuffer_3714)(FILE* F_3716, void* Buffer_3717, NI Len_3718);
static N_INLINE(void, popSafePoint)(void);
static N_INLINE(E_Base*, getCurrentException)(void);
static N_INLINE(void, popCurrentException)(void);
N_NIMCALL(void, reraiseException)(void);
N_NIMCALL(void, genericAssign)(void* Dest_19165, void* Src_19166, TNimType* Mt_19167);
N_NIMCALL(void, unsureAsgnRef)(void** Dest_12826, void* Src_12827);
N_NIMCALL(void, Genericassignaux_19168)(void* Dest_19170, void* Src_19171, TNimNode* N_19173);
N_NIMCALL(void, Listremove_8846)(TY8434** Head_8850, TY8434* C_8851);
N_NIMCALL(void, Listadd_9426)(TY8432** Head_9430, TY8432* C_9431);
N_NIMCALL(void, Listremove_9568)(TY8432** Head_9572, TY8432* C_9573);
N_NIMCALL(void, Listadd_9207)(TY8434** Head_9211, TY8434* C_9212);
STRING_LITERAL(TMP20719, "cannot write string to file", 27);
STRING_LITERAL(TMP20720, "No stack traceback available", 28);
STRING_LITERAL(TMP20721, "Error: unhandled exception: ", 28);
STRING_LITERAL(TMP20722, "Error: unhandled exception", 26);
STRING_LITERAL(TMP20723, " [", 2);
STRING_LITERAL(TMP20724, "]\012", 2);
STRING_LITERAL(TMP20725, "\012", 1);
STRING_LITERAL(TMP20726, "out of memory; cannot even throw an exception", 45);
STRING_LITERAL(TMP20727, "out of memory", 13);
STRING_LITERAL(TMP20728, "rb", 2);
STRING_LITERAL(TMP20729, "wb", 2);
STRING_LITERAL(TMP20730, "w+b", 3);
STRING_LITERAL(TMP20731, "r+b", 3);
STRING_LITERAL(TMP20732, "ab", 2);
NIM_CONST TY4102 Formatopen_4101 = {((NimStringDesc*) &TMP20728),
((NimStringDesc*) &TMP20729),
((NimStringDesc*) &TMP20730),
((NimStringDesc*) &TMP20731),
((NimStringDesc*) &TMP20732)}
;
STRING_LITERAL(TMP20733, "SIGINT: Interrupted by Ctrl-C.\012", 31);
STRING_LITERAL(TMP20734, "SIGSEGV: Illegal storage access. (Attempt to read from nil?)\012", 61);
STRING_LITERAL(TMP20735, "SIGABRT: Abnormal termination.\012", 31);
STRING_LITERAL(TMP20736, "SIGFPE: Arithmetic error.\012", 26);
STRING_LITERAL(TMP20737, "SIGILL: Illegal operation.\012", 27);
STRING_LITERAL(TMP20738, "SIGBUS: Illegal storage access. (Attempt to read from nil?)\012", 60);
STRING_LITERAL(TMP20739, "unknown signal\012", 15);
STRING_LITERAL(TMP38239, "over- or underflow", 18);
STRING_LITERAL(TMP193644, "", 0);
STRING_LITERAL(TMP193655, "no exception to reraise", 23);
STRING_LITERAL(TMP193757, " (invalid data!)", 16);
STRING_LITERAL(TMP193861, "cannot retrieve file position", 29);
STRING_LITERAL(TMP193862, "cannot set file position", 24);
STRING_LITERAL(TMP195492, "[GC] total memory: ", 19);
STRING_LITERAL(TMP195493, "\012[GC] occupied memory: ", 23);
STRING_LITERAL(TMP195494, "\012[GC] stack scans: ", 19);
STRING_LITERAL(TMP195495, "\012[GC] stack cells: ", 19);
STRING_LITERAL(TMP195496, "\012[GC] cycle collections: ", 25);
STRING_LITERAL(TMP195497, "\012[GC] max threshold: ", 21);
STRING_LITERAL(TMP195498, "\012[GC] zct capacity: ", 20);
STRING_LITERAL(TMP195499, "\012[GC] max cycle table size: ", 28);
STRING_LITERAL(TMP195500, "\012[GC] max stack size: ", 22);
TY2719 Dbglinehook_2722;
NIM_THREADVAR TFrame* framePtr;
TNimType Strdesc_3017;
extern TNimType* NTI4254; /* ref EIO */
extern TNimType* NTI420; /* EIO */
extern TNimType* NTI7844; /* ref EOutOfMemory */
extern TNimType* NTI442; /* EOutOfMemory */
NimStringDesc* Stacktracenewline_4416;
NIM_THREADVAR TSafePoint* excHandler;
NIM_THREADVAR E_Base* Currexception_4632;
NimStringDesc* Buf_4801;
NimStringDesc* Assertbuf_4802;
TY4803 Tempframes_4805;
EAssertionFailed* Gassertionfailed_5251;
NIM_BOOL Dbgaborting_5275;
extern TNimType* NTI5250; /* ref EAssertionFailed */
extern TNimType* NTI436; /* EAssertionFailed */
NIM_BOOL Ismultithreaded_7401;
TY442* Goutofmem_7840;
TY8474 Allocator_8529;
NI Lastsize_8691;
void* Stackbottom_10807;
TY10790 Gch_10808;
NI Cyclethreshold_10809;
NI Recgclock_10810;
extern TNimType* NTI5651; /* ref EOverflow */
extern TNimType* NTI432; /* EOverflow */
extern TNimType* NTI5233; /* ref ENoExceptionToReraise */
extern TNimType* NTI452; /* ENoExceptionToReraise */
N_NOINLINE(void, setStackBottom)(void* Thestackbottom_1624) {
NI A_16204;
NI B_16205;
if (!(Stackbottom_10807 == NIM_NIL)) goto LA2;
Stackbottom_10807 = Thestackbottom_1624;
goto LA1;
LA2: ;
A_16204 = 0;
A_16204 = ((NI) (Thestackbottom_1624));
B_16205 = 0;
B_16205 = ((NI) (Stackbottom_10807));
Stackbottom_10807 = ((void*) (((A_16204 >= B_16205) ? A_16204 : B_16205)));
LA1: ;
}
static N_INLINE(void, Initstackbottom_3013)(void) {
void* volatile Locals_3015;
Locals_3015 = 0;
setStackBottom(((void*) (&Locals_3015)));
}
static N_INLINE(NI, Roundup_8456)(NI X_8458, NI V_8459) {
NI Result_8460;
Result_8460 = 0;
Result_8460 = (NI32)((NI32)(X_8458 + (NI32)(V_8459 - 1)) & (NI32)((NU32) ~((NI32)(V_8459 - 1))));
return Result_8460;
}
N_NIMCALL(TY8407*, Intsetget_8574)(TY8411* T_8576, NI Key_8577) {
TY8407* Result_8578;
TY8407* It_8579;
Result_8578 = 0;
It_8579 = 0;
It_8579 = (*T_8576).Data[((NI32)(Key_8577 & 1023))-0];
while (1) {
if (!!((It_8579 == NIM_NIL))) goto LA1;
if (!((*It_8579).Key == Key_8577)) goto LA3;
Result_8578 = It_8579;
goto BeforeRet;
LA3: ;
It_8579 = (*It_8579).Next;
} LA1: ;
Result_8578 = NIM_NIL;
BeforeRet: ;
return Result_8578;
}
N_NIMCALL(NIM_BOOL, Contains_8611)(TY8411* S_8613, NI Key_8614) {
NIM_BOOL Result_8615;
TY8407* T_8616;
NI U_8628;
Result_8615 = 0;
T_8616 = 0;
T_8616 = Intsetget_8574(S_8613, (NI32)((NU32)(Key_8614) >> (NU32)(9)));
if (!!((T_8616 == NIM_NIL))) goto LA2;
U_8628 = 0;
U_8628 = (NI32)(Key_8614 & 511);
Result_8615 = !(((NI32)((*T_8616).Bits[((NI32)((NU32)(U_8628) >> (NU32)(5)))-0] & (NI32)((NU32)(1) << (NU32)((NI32)(U_8628 & 31)))) == 0));
goto LA1;
LA2: ;
Result_8615 = NIM_FALSE;
LA1: ;
return Result_8615;
}
static N_INLINE(NI, Pageindex_8681)(void* P_8683) {
NI Result_8684;
Result_8684 = 0;
Result_8684 = (NI32)((NU32)(((NI) (P_8683))) >> (NU32)(12));
return Result_8684;
}
static N_INLINE(NIM_BOOL, Isaccessible_8752)(void* P_8754) {
NIM_BOOL Result_8755;
NI LOC1;
Result_8755 = 0;
LOC1 = Pageindex_8681(P_8754);
Result_8755 = Contains_8611(&Allocator_8529.Chunkstarts, LOC1);
return Result_8755;
}
static N_INLINE(void, Updateprevsize_8811)(TY8474* A_8814, TY8434* C_8815, NI Prevsize_8816) {
TY8430* Ri_8817;
NIM_BOOL LOC2;
Ri_8817 = 0;
Ri_8817 = ((TY8430*) ((NI32)((NU32)(((NI) (C_8815))) + (NU32)((*C_8815).Sup.Size))));
LOC2 = Isaccessible_8752(((void*) (Ri_8817)));
if (!LOC2) goto LA3;
(*Ri_8817).Prevsize = Prevsize_8816;
LA3: ;
}
N_NIMCALL(NI, Writebuffer_3733)(FILE* F_3735, void* Buffer_3736, NI Len_3737) {
NI Result_4243;
Result_4243 = 0;
Result_4243 = fwrite(Buffer_3736, 1, Len_3737, F_3735);
return Result_4243;
}
static N_INLINE(void, Aquire_10811)(TY10790* Gch_10814) {
}
N_NIMCALL(NI, Gettotalmem_2021)(void) {
NI Result_10077;
Result_10077 = 0;
Result_10077 = Allocator_8529.Currmem;
goto BeforeRet;
BeforeRet: ;
return Result_10077;
}
N_NIMCALL(NI, Getfreemem_2019)(void) {
NI Result_10074;
Result_10074 = 0;
Result_10074 = Allocator_8529.Freemem;
return Result_10074;
}
N_NIMCALL(NI, Getoccupiedmem_2017)(void) {
NI Result_10080;
NI LOC1;
NI LOC2;
Result_10080 = 0;
LOC1 = Gettotalmem_2021();
LOC2 = Getfreemem_2019();
Result_10080 = (NI32)(LOC1 - LOC2);
goto BeforeRet;
BeforeRet: ;
return Result_10080;
}
N_NOINLINE(NI, Stacksize_16601)(void) {
NI Result_16603;
void* volatile Stacktop_16604;
Result_16603 = 0;
Stacktop_16604 = 0;
Result_16603 = (NI32)abs((NI32)(((NI) (&Stacktop_16604)) - ((NI) (Stackbottom_10807))));
return Result_16603;
}
static N_INLINE(TY10402*, Usrtocell_11212)(void* Usr_11214) {
TY10402* Result_11215;
Result_11215 = 0;
Result_11215 = ((TY10402*) ((NI32)((NU32)(((NI) (Usr_11214))) - (NU32)(((NI) (((NI)sizeof(TY10402))))))));
return Result_11215;
}
static N_INLINE(TY8430*, Pageaddr_8685)(void* P_8687) {
TY8430* Result_8688;
Result_8688 = 0;
Result_8688 = ((TY8430*) ((NI32)(((NI) (P_8687)) & -4096)));
return Result_8688;
}
static N_INLINE(NIM_BOOL, Chunkunused_8807)(TY8430* C_8809) {
NIM_BOOL Result_8810;
Result_8810 = 0;
Result_8810 = !((*C_8809).Used);
return Result_8810;
}
static N_INLINE(NIM_BOOL, Issmallchunk_8801)(TY8430* C_8803) {
NIM_BOOL Result_8804;
Result_8804 = 0;
Result_8804 = ((*C_8803).Size <= (NI32)(4096 - (NI32)(((NI)sizeof(TY8432)) - 8)));
goto BeforeRet;
BeforeRet: ;
return Result_8804;
}
N_NIMCALL(NIM_BOOL, Isallocatedptr_10001)(TY8474* A_10003, void* P_10004) {
NIM_BOOL Result_10005;
NIM_BOOL LOC2;
TY8430* C_10006;
NIM_BOOL LOC6;
NIM_BOOL LOC10;
TY8432* C_10007;
NI Offset_10008;
NIM_BOOL LOC13;
NIM_BOOL LOC14;
TY8434* C_10012;
NIM_BOOL LOC17;
Result_10005 = 0;
LOC2 = Isaccessible_8752(P_10004);
if (!LOC2) goto LA3;
C_10006 = 0;
C_10006 = Pageaddr_8685(P_10004);
LOC6 = Chunkunused_8807(C_10006);
if (!!(LOC6)) goto LA7;
LOC10 = Issmallchunk_8801(C_10006);
if (!LOC10) goto LA11;
C_10007 = 0;
C_10007 = ((TY8432*) (C_10006));
Offset_10008 = 0;
Offset_10008 = (NI32)((NU32)((NI32)(((NI) (P_10004)) & 4095)) - (NU32)((NI32)(((NI)sizeof(TY8432)) - 8)));
LOC14 = ((NU32)(Offset_10008) < (NU32)((*C_10007).Acc));
if (!(LOC14)) goto LA15;
LOC14 = ((NI32)((NU32)(Offset_10008) % (NU32)((*C_10007).Sup.Size)) == 0);
LA15: ;
LOC13 = LOC14;
if (!(LOC13)) goto LA16;
LOC13 = ((NU32)(1) < (NU32)((*((TY8422*) (P_10004))).Zerofield));
LA16: ;
Result_10005 = LOC13;
goto LA9;
LA11: ;
C_10012 = 0;
C_10012 = ((TY8434*) (C_10006));
LOC17 = (P_10004 == ((void*) (&(*C_10012).Data)));
if (!(LOC17)) goto LA18;
LOC17 = ((NU32)(1) < (NU32)((*((TY8422*) (P_10004))).Zerofield));
LA18: ;
Result_10005 = LOC17;
LA9: ;
LA7: ;
LA3: ;
return Result_10005;
}
N_NIMCALL(void, Excl_8638)(TY8411* S_8641, NI Key_8642) {
TY8407* T_8643;
NI U_8655;
T_8643 = 0;
T_8643 = Intsetget_8574(&(*S_8641), (NI32)((NU32)(Key_8642) >> (NU32)(9)));
if (!!((T_8643 == NIM_NIL))) goto LA2;
U_8655 = 0;
U_8655 = (NI32)(Key_8642 & 511);
(*T_8643).Bits[((NI32)((NU32)(U_8655) >> (NU32)(5)))-0] = (NI32)((*T_8643).Bits[((NI32)((NU32)(U_8655) >> (NU32)(5)))-0] & (NI32)((NU32) ~((NI32)((NU32)(1) << (NU32)((NI32)(U_8655 & 31))))));
LA2: ;
}
static N_INLINE(NI, Pageindex_8677)(TY8430* C_8679) {
NI Result_8680;
Result_8680 = 0;
Result_8680 = (NI32)((NU32)(((NI) (C_8679))) >> (NU32)(12));
return Result_8680;
}
static N_INLINE(void, Osdeallocpages_8017)(void* P_8019, NI Size_8020) {
munmap(P_8019, Size_8020);
}
static N_INLINE(void, Deccurrmem_8503)(TY8474* A_8506, NI Bytes_8507) {
(*A_8506).Maxmem = (((*A_8506).Maxmem >= (*A_8506).Currmem) ? (*A_8506).Maxmem : (*A_8506).Currmem);
(*A_8506).Currmem -= Bytes_8507;
}
N_NIMCALL(void, Freeoschunks_8726)(TY8474* A_8729, void* P_8730, NI Size_8731) {
TY8430* C_8732;
NI Nxt_8733;
TY8430* Next_8736;
NI LOC2;
NIM_BOOL LOC3;
NI LOC6;
C_8732 = 0;
C_8732 = ((TY8430*) (P_8730));
Nxt_8733 = 0;
Nxt_8733 = (NI32)((NU32)(((NI) (P_8730))) + (NU32)((*C_8732).Size));
Next_8736 = 0;
Next_8736 = ((TY8430*) (Nxt_8733));
LOC2 = Pageindex_8677(Next_8736);
LOC3 = Contains_8611(&(*A_8729).Chunkstarts, LOC2);
if (!LOC3) goto LA4;
(*Next_8736).Prevsize = 0;
LA4: ;
LOC6 = Pageindex_8681(P_8730);
Excl_8638(&(*A_8729).Chunkstarts, LOC6);
Osdeallocpages_8017(P_8730, Size_8731);
Deccurrmem_8503(A_8729, Size_8731);
(*A_8729).Freemem -= Size_8731;
}
N_NIMCALL(void, Freebigchunk_8820)(TY8474* A_8823, TY8434* C_8824) {
TY8434* C_8825;
TY8430* Ri_8840;
NIM_BOOL LOC2;
NIM_BOOL LOC7;
NI LOC10;
TY8430* Le_9003;
NIM_BOOL LOC15;
NIM_BOOL LOC20;
NI LOC23;
NI LOC27;
C_8825 = 0;
C_8825 = C_8824;
(*A_8823).Freemem += (*C_8825).Sup.Size;
Ri_8840 = 0;
Ri_8840 = ((TY8430*) ((NI32)((NU32)(((NI) (C_8825))) + (NU32)((*C_8825).Sup.Size))));
LOC2 = Isaccessible_8752(((void*) (Ri_8840)));
if (!(LOC2)) goto LA3;
LOC2 = Chunkunused_8807(Ri_8840);
LA3: ;
if (!LOC2) goto LA4;
LOC7 = Issmallchunk_8801(Ri_8840);
if (!!(LOC7)) goto LA8;
Listremove_8846(&(*A_8823).Freechunkslist, ((TY8434*) (Ri_8840)));
(*C_8825).Sup.Size += (*Ri_8840).Size;
LOC10 = Pageindex_8677(Ri_8840);
Excl_8638(&(*A_8823).Chunkstarts, LOC10);
LA8: ;
LA4: ;
if (!!(((*C_8825).Sup.Prevsize == 0))) goto LA12;
Le_9003 = 0;
Le_9003 = ((TY8430*) ((NI32)((NU32)(((NI) (C_8825))) - (NU32)((*C_8825).Sup.Prevsize))));
LOC15 = Isaccessible_8752(((void*) (Le_9003)));
if (!(LOC15)) goto LA16;
LOC15 = Chunkunused_8807(Le_9003);
LA16: ;
if (!LOC15) goto LA17;
LOC20 = Issmallchunk_8801(Le_9003);
if (!!(LOC20)) goto LA21;
Listremove_8846(&(*A_8823).Freechunkslist, ((TY8434*) (Le_9003)));
(*Le_9003).Size += (*C_8825).Sup.Size;
LOC23 = Pageindex_8677(&C_8825->Sup);
Excl_8638(&(*A_8823).Chunkstarts, LOC23);
C_8825 = ((TY8434*) (Le_9003));
LA21: ;
LA17: ;
LA12: ;
if (!((*C_8825).Sup.Size < 1048576)) goto LA25;
LOC27 = Pageindex_8677(&C_8825->Sup);
Incl_8631(&(*A_8823).Chunkstarts, LOC27);
Updateprevsize_8811(A_8823, C_8825, (*C_8825).Sup.Size);
Listadd_9207(&(*A_8823).Freechunkslist, C_8825);
(*C_8825).Sup.Used = NIM_FALSE;
goto LA24;
LA25: ;
Freeoschunks_8726(A_8823, ((void*) (C_8825)), (*C_8825).Sup.Size);
LA24: ;
}
N_NIMCALL(void, Rawdealloc_9664)(TY8474* A_9667, void* P_9668) {
TY8430* C_9669;
NIM_BOOL LOC2;
TY8432* C_9670;
NI S_9671;
TY8422* F_9673;
C_9669 = 0;
C_9669 = Pageaddr_8685(P_9668);
LOC2 = Issmallchunk_8801(C_9669);
if (!LOC2) goto LA3;
C_9670 = 0;
C_9670 = ((TY8432*) (C_9669));
S_9671 = 0;
S_9671 = (*C_9670).Sup.Size;
F_9673 = 0;
F_9673 = ((TY8422*) (P_9668));
(*F_9673).Zerofield = 0;
(*F_9673).Next = (*C_9670).Freelist;
(*C_9670).Freelist = F_9673;
if (!((*C_9670).Free < S_9671)) goto LA6;
Listadd_9426(&(*A_9667).Freesmallchunks[((NI32)(S_9671 / 8))-0], C_9670);
(*C_9670).Free += S_9671;
goto LA5;
LA6: ;
(*C_9670).Free += S_9671;
if (!((*C_9670).Free == (NI32)(4096 - (NI32)(((NI)sizeof(TY8432)) - 8)))) goto LA9;
Listremove_9568(&(*A_9667).Freesmallchunks[((NI32)(S_9671 / 8))-0], C_9670);
(*C_9670).Sup.Size = 4096;
Freebigchunk_8820(A_9667, ((TY8434*) (C_9670)));
LA9: ;
LA5: ;
goto LA1;
LA3: ;
Freebigchunk_8820(A_9667, ((TY8434*) (C_9669)));
LA1: ;
}
N_NOCONV(void, Dealloc_1960)(void* P_1962) {
void* X_10028;
X_10028 = 0;
X_10028 = ((void*) ((NI32)((NU32)(((NI) (P_1962))) - (NU32)(((NI)sizeof(TY8422))))));
Rawdealloc_9664(&Allocator_8529, X_10028);
}
static N_INLINE(void, Add_10458)(TY10418* S_10461, TY10402* C_10462) {
TY10402** D_10465;
void* LOC4;
if (!((*S_10461).Cap <= (*S_10461).Len)) goto LA2;
(*S_10461).Cap = (NI32)((NI32)((*S_10461).Cap * 3) / 2);
D_10465 = 0;
LOC4 = Alloc_1950((NI32)((*S_10461).Cap * 4));
D_10465 = ((TY10402**) (LOC4));
memcpy(((void*) (D_10465)), ((void*) ((*S_10461).D)), (NI32)((*S_10461).Len * 4));
Dealloc_1960(((void*) ((*S_10461).D)));
(*S_10461).D = D_10465;
LA2: ;
(*S_10461).D[((*S_10461).Len)-0] = C_10462;
(*S_10461).Len += 1;
}
static N_INLINE(void, Gcmark_15803)(void* P_15805) {
TY10402* Cell_15806;
NI C_15807;
NIM_BOOL LOC2;
NIM_BOOL LOC7;
Cell_15806 = 0;
Cell_15806 = Usrtocell_11212(P_15805);
C_15807 = 0;
C_15807 = ((NI) (Cell_15806));
LOC2 = ((NU32)(4096) < (NU32)(C_15807));
if (!(LOC2)) goto LA3;
LOC2 = ((NI32)(C_15807 & 7) == 0);
LA3: ;
if (!LOC2) goto LA4;
LOC7 = Isallocatedptr_10001(&Allocator_8529, ((void*) (Cell_15806)));
if (!LOC7) goto LA8;
(*Cell_15806).Refcount = (NI32)((NU32)((*Cell_15806).Refcount) + (NU32)(8));
Add_10458(&Gch_10808.Decstack, Cell_15806);
LA8: ;
LA4: ;
}
N_CDECL(void, Markstackandregisters_16615)(TY10790* Gch_16618) {
jmp_buf Registers_16619;
int LOC2;
NI Max_16623;
NI Sp_16625;
memset((void*)&Registers_16619, 0, sizeof(Registers_16619));
LOC2 = setjmp(Registers_16619);
if (!(LOC2 == ((NI32) 0))) goto LA3;
Max_16623 = 0;
Max_16623 = ((NI) (Stackbottom_10807));
Sp_16625 = 0;
Sp_16625 = ((NI) (Registers_16619));
while (1) {
if (!((NU32)(Sp_16625) <= (NU32)(Max_16623))) goto LA5;
Gcmark_15803((*((void**) (Sp_16625))));
Sp_16625 = (NI32)((NU32)(Sp_16625) + (NU32)(4));
} LA5: ;
LA3: ;
}
N_NIMCALL(void, Markthreadstacks_15811)(TY10790* Gch_15814) {
}
static N_INLINE(NIM_BOOL, Canbecycleroot_11216)(TY10402* C_11218) {
NIM_BOOL Result_11219;
Result_11219 = 0;
Result_11219 = !((((*(*C_11218).Typ).flags &(1<<((((NU8) 1))&7)))!=0));
return Result_11219;
}
static N_INLINE(NI, Nexttry_10509)(NI H_10511, NI Maxhash_10512) {
NI Result_10513;
Result_10513 = 0;
Result_10513 = (NI32)((NI32)((NI32)(5 * H_10511) + 1) & Maxhash_10512);
return Result_10513;
}
N_NIMCALL(TY10410*, Cellsetget_10514)(TY10414 T_10516, NI Key_10517) {
TY10410* Result_10518;
NI H_10519;
Result_10518 = 0;
H_10519 = 0;
H_10519 = (NI32)(((NI) (Key_10517)) & T_10516.Max);
while (1) {
if (!!((T_10516.Data[(H_10519)-0] == NIM_NIL))) goto LA1;
if (!((*T_10516.Data[(H_10519)-0]).Key == Key_10517)) goto LA3;
Result_10518 = T_10516.Data[(H_10519)-0];
goto BeforeRet;
LA3: ;
H_10519 = Nexttry_10509(H_10519, T_10516.Max);
} LA1: ;
Result_10518 = NIM_NIL;
goto BeforeRet;
BeforeRet: ;
return Result_10518;
}
N_NIMCALL(void, Excl_10681)(TY10414* S_10684, TY10402* Cell_10685) {
NI U_10686;
TY10410* T_10687;
U_10686 = 0;
U_10686 = ((NI) (Cell_10685));
T_10687 = 0;
T_10687 = Cellsetget_10514((*S_10684), (NI32)((NU32)(U_10686) >> (NU32)(12)));
if (!!((T_10687 == NIM_NIL))) goto LA2;
U_10686 = (NI32)((NU32)((NI32)((NU32)(U_10686) % (NU32)(4096))) / (NU32)(8));
(*T_10687).Bits[((NI32)((NU32)(U_10686) >> (NU32)(5)))-0] = (NI32)((*T_10687).Bits[((NI32)((NU32)(U_10686) >> (NU32)(5)))-0] & (NI32)((NU32) ~((NI32)((NU32)(1) << (NU32)((NI32)(U_10686 & 31))))));
LA2: ;
}
static N_INLINE(void*, Celltousr_11208)(TY10402* Cell_11210) {
void* Result_11211;
Result_11211 = 0;
Result_11211 = ((void*) ((NI32)((NU32)(((NI) (Cell_11210))) + (NU32)(((NI) (((NI)sizeof(TY10402))))))));
return Result_11211;
}
N_NIMCALL(void, Preparedealloc_11825)(TY10402* Cell_11827) {
void* LOC4;
if (!!(((*(*Cell_11827).Typ).finalizer == NIM_NIL))) goto LA2;
Recgclock_10810 += 1;
LOC4 = Celltousr_11208(Cell_11827);
((TFinalizer) ((*(*Cell_11827).Typ).finalizer))(LOC4);
Recgclock_10810 -= 1;
LA2: ;
}
N_NOINLINE(void, Addzct_11201)(TY10418* S_11204, TY10402* C_11205) {
if (!((NI32)((*C_11205).Refcount & 4) == 0)) goto LA2;
(*C_11205).Refcount = (NI32)((NI32)((*C_11205).Refcount & -8) | 4);
Add_10458(S_11204, C_11205);
LA2: ;
}
N_NIMCALL(void, Dooperation_11816)(void* P_11818, NU8 Op_11819) {
TY10402* C_14806;
if (!(P_11818 == NIM_NIL)) goto LA2;
goto BeforeRet;
LA2: ;
C_14806 = 0;
C_14806 = Usrtocell_11212(P_11818);
switch (Op_11819) {
case ((NU8) 0):
(*C_14806).Refcount = (NI32)((NU32)((*C_14806).Refcount) - (NU32)(8));
if (!((NU32)((*C_14806).Refcount) < (NU32)(8))) goto LA5;
Addzct_11201(&Gch_10808.Zct, C_14806);
LA5: ;
break;
case ((NU8) 1):
Add_10458(&Gch_10808.Tempstack, C_14806);
break;
case ((NU8) 2):
(*C_14806).Refcount = (NI32)((NU32)((*C_14806).Refcount) - (NU32)(8));
break;
}
BeforeRet: ;
}
N_NIMCALL(NI, Getdiscriminant_7243)(void* Aa_7245, TNimNode* N_7247) {
NI Result_7248;
NI D_7258;
NI A_7259;
Result_7248 = 0;
D_7258 = 0;
A_7259 = 0;
A_7259 = ((NI) (Aa_7245));
switch ((*(*N_7247).typ).size) {
case 1:
D_7258 = ((NI)(NU)(NU8)((*((NI8*) ((NI32)((NU32)(A_7259) + (NU32)((*N_7247).offset)))))));
break;
case 2:
D_7258 = ((NI)(NU)(NU16)((*((NI16*) ((NI32)((NU32)(A_7259) + (NU32)((*N_7247).offset)))))));
break;
case 4:
D_7258 = ((NI) ((*((int*) ((NI32)((NU32)(A_7259) + (NU32)((*N_7247).offset)))))));
break;
default:
break;
}
Result_7248 = D_7258;
goto BeforeRet;
BeforeRet: ;
return Result_7248;
}
N_NIMCALL(TNimNode*, Selectbranch_7263)(void* Aa_7265, TNimNode* N_7267) {
TNimNode* Result_7269;
NI Discr_7270;
Result_7269 = 0;
Discr_7270 = 0;
Discr_7270 = Getdiscriminant_7243(Aa_7265, N_7267);
if (!((NU32)(Discr_7270) < (NU32)((*N_7267).len))) goto LA2;
Result_7269 = (*N_7267).sons[(Discr_7270)-0];
if (!(Result_7269 == NIM_NIL)) goto LA5;
Result_7269 = (*N_7267).sons[((*N_7267).len)-0];
LA5: ;
goto LA1;
LA2: ;
Result_7269 = (*N_7267).sons[((*N_7267).len)-0];
LA1: ;
return Result_7269;
}
N_NIMCALL(void, Forallslotsaux_13401)(void* Dest_13403, TNimNode* N_13405, NU8 Op_13406) {
NI D_13407;
NI I_13415;
NI HEX3Atmp_20623;
NI Res_20625;
TNimNode* M_13416;
D_13407 = 0;
D_13407 = ((NI) (Dest_13403));
switch ((*N_13405).kind) {
case ((NU8) 0):
break;
case ((NU8) 1):
Forallchildrenaux_11820(((void*) ((NI32)((NU32)(D_13407) + (NU32)((*N_13405).offset)))), (*N_13405).typ, Op_13406);
break;
case ((NU8) 2):
I_13415 = 0;
HEX3Atmp_20623 = 0;
HEX3Atmp_20623 = (NI32)((*N_13405).len - 1);
Res_20625 = 0;
Res_20625 = 0;
while (1) {
if (!(Res_20625 <= HEX3Atmp_20623)) goto LA1;
I_13415 = Res_20625;
Forallslotsaux_13401(Dest_13403, (*N_13405).sons[(I_13415)-0], Op_13406);
Res_20625 += 1;
} LA1: ;
break;
case ((NU8) 3):
M_13416 = 0;
M_13416 = Selectbranch_7263(Dest_13403, N_13405);
if (!!((M_13416 == NIM_NIL))) goto LA3;
Forallslotsaux_13401(Dest_13403, M_13416, Op_13406);
LA3: ;
break;
}
}
N_NIMCALL(void, Forallchildrenaux_11820)(void* Dest_11822, TNimType* Mt_11823, NU8 Op_11824) {
NI D_13433;
NI I_13452;
NI HEX3Atmp_20626;
NI Res_20628;
D_13433 = 0;
D_13433 = ((NI) (Dest_11822));
if (!(Dest_11822 == NIM_NIL)) goto LA2;
goto BeforeRet;
LA2: ;
if (!!((((*Mt_11823).flags &(1<<((((NU8) 0))&7)))!=0))) goto LA5;
switch ((*Mt_11823).kind) {
case ((NU8) 16):
case ((NU8) 4):
case ((NU8) 27):
I_13452 = 0;
HEX3Atmp_20626 = 0;
HEX3Atmp_20626 = (NI32)((NI32)((*Mt_11823).size / (*(*Mt_11823).base).size) - 1);
Res_20628 = 0;
Res_20628 = 0;
while (1) {
if (!(Res_20628 <= HEX3Atmp_20626)) goto LA7;
I_13452 = Res_20628;
Forallchildrenaux_11820(((void*) ((NI32)((NU32)(D_13433) + (NU32)((NI32)((NU32)(I_13452) * (NU32)((*(*Mt_11823).base).size)))))), (*Mt_11823).base, Op_11824);
Res_20628 += 1;
} LA7: ;
break;
case ((NU8) 22):
case ((NU8) 28):
case ((NU8) 24):
Dooperation_11816((*((void**) (D_13433))), Op_11824);
break;
case ((NU8) 17):
case ((NU8) 18):
case ((NU8) 40):
Forallslotsaux_13401(Dest_11822, (*Mt_11823).node, Op_11824);
break;
default:
break;
}
LA5: ;
BeforeRet: ;
}
N_NIMCALL(void, Forallchildren_11812)(TY10402* Cell_11814, NU8 Op_11815) {
void* LOC1;
NI D_13479;
void* LOC2;
TGenericSeq* S_13480;
NI I_13499;
NI HEX3Atmp_20629;
NI Res_20631;
switch ((*(*Cell_11814).Typ).kind) {
case ((NU8) 22):
LOC1 = Celltousr_11208(Cell_11814);
Forallchildrenaux_11820(LOC1, (*(*Cell_11814).Typ).base, Op_11815);
break;
case ((NU8) 24):
D_13479 = 0;
LOC2 = Celltousr_11208(Cell_11814);
D_13479 = ((NI) (LOC2));
S_13480 = 0;
S_13480 = ((TGenericSeq*) (D_13479));
if (!!((S_13480 == NIM_NIL))) goto LA4;
I_13499 = 0;
HEX3Atmp_20629 = 0;
HEX3Atmp_20629 = (NI32)((*S_13480).len - 1);
Res_20631 = 0;
Res_20631 = 0;
while (1) {
if (!(Res_20631 <= HEX3Atmp_20629)) goto LA6;
I_13499 = Res_20631;
Forallchildrenaux_11820(((void*) ((NI32)((NU32)((NI32)((NU32)(D_13479) + (NU32)((NI32)((NU32)(I_13499) * (NU32)((*(*(*Cell_11814).Typ).base).size))))) + (NU32)(8)))), (*(*Cell_11814).Typ).base, Op_11815);
Res_20631 += 1;
} LA6: ;
LA4: ;
break;
case ((NU8) 28):
break;
default:
break;
}
}
N_NIMCALL(void, Collectzct_16801)(TY10790* Gch_16804) {
NI* L_16806;
TY10402* C_16809;
NIM_BOOL LOC6;
L_16806 = 0;
L_16806 = &(*Gch_16804).Zct.Len;
while (1) {
if (!(0 < (*L_16806))) goto LA1;
C_16809 = 0;
C_16809 = (*Gch_16804).Zct.D[(0)-0];
(*C_16809).Refcount = (NI32)((*C_16809).Refcount & -8);
(*Gch_16804).Zct.D[(0)-0] = (*Gch_16804).Zct.D[((NI32)((*L_16806) - 1))-0];
(*L_16806) -= 1;
if (!((NU32)((*C_16809).Refcount) < (NU32)(8))) goto LA3;
LOC6 = Canbecycleroot_11216(C_16809);
if (!LOC6) goto LA7;
Excl_10681(&(*Gch_16804).Cycleroots, C_16809);
LA7: ;
Preparedealloc_11825(C_16809);
Forallchildren_11812(C_16809, ((NU8) 0));
Rawdealloc_9664(&Allocator_8529, ((void*) (C_16809)));
LA3: ;
} LA1: ;
}
N_NIMCALL(void, Init_10488)(TY10414* S_10491) {
void* LOC1;
LOC1 = Alloc0_1953(4096);
(*S_10491).Data = ((TY10410**) (LOC1));
(*S_10491).Max = 1023;
(*S_10491).Counter = 0;
(*S_10491).Head = NIM_NIL;
}
N_NIMCALL(void, Cellsetrawinsert_10533)(TY10414 T_10535, TY10410** Data_10536, TY10410* Desc_10537) {
NI H_10538;
H_10538 = 0;
H_10538 = (NI32)(((NI) ((*Desc_10537).Key)) & T_10535.Max);
while (1) {
if (!!((Data_10536[(H_10538)-0] == NIM_NIL))) goto LA1;
H_10538 = Nexttry_10509(H_10538, T_10535.Max);
} LA1: ;
Data_10536[(H_10538)-0] = Desc_10537;
}
N_NIMCALL(void, Cellsetenlarge_10570)(TY10414* T_10573) {
NI Oldmax_10574;
TY10410** N_10575;
void* LOC1;
NI I_10583;
NI Res_20622;
Oldmax_10574 = 0;
Oldmax_10574 = (*T_10573).Max;
(*T_10573).Max = (NI32)((NI32)((NI32)((*T_10573).Max + 1) * 2) - 1);
N_10575 = 0;
LOC1 = Alloc0_1953((NI32)((NI32)((*T_10573).Max + 1) * 4));
N_10575 = ((TY10410**) (LOC1));
I_10583 = 0;
Res_20622 = 0;
Res_20622 = 0;
while (1) {
if (!(Res_20622 <= Oldmax_10574)) goto LA2;
I_10583 = Res_20622;
if (!!(((*T_10573).Data[(I_10583)-0] == NIM_NIL))) goto LA4;
Cellsetrawinsert_10533((*T_10573), N_10575, (*T_10573).Data[(I_10583)-0]);
LA4: ;
Res_20622 += 1;
} LA2: ;
Dealloc_1960(((void*) ((*T_10573).Data)));
(*T_10573).Data = N_10575;
}
N_NIMCALL(TY10410*, Cellsetput_10595)(TY10414* T_10598, NI Key_10599) {
TY10410* Result_10600;
NI H_10601;
TY10410* X_10602;
NIM_BOOL LOC9;
void* LOC14;
Result_10600 = 0;
H_10601 = 0;
H_10601 = (NI32)(((NI) (Key_10599)) & (*T_10598).Max);
while (1) {
X_10602 = 0;
X_10602 = (*T_10598).Data[(H_10601)-0];
if (!(X_10602 == NIM_NIL)) goto LA3;
goto LA1;
LA3: ;
if (!((*X_10602).Key == Key_10599)) goto LA6;
Result_10600 = X_10602;
goto BeforeRet;
LA6: ;
H_10601 = Nexttry_10509(H_10601, (*T_10598).Max);
} LA1: ;
LOC9 = ((NI32)((NI32)((*T_10598).Max + 1) * 2) < (NI32)((*T_10598).Counter * 3));
if (LOC9) goto LA10;
LOC9 = ((NI32)((NI32)((*T_10598).Max + 1) - (*T_10598).Counter) < 4);
LA10: ;
if (!LOC9) goto LA11;
Cellsetenlarge_10570(T_10598);
LA11: ;
(*T_10598).Counter += 1;
H_10601 = (NI32)(((NI) (Key_10599)) & (*T_10598).Max);
while (1) {
if (!!(((*T_10598).Data[(H_10601)-0] == NIM_NIL))) goto LA13;
H_10601 = Nexttry_10509(H_10601, (*T_10598).Max);
} LA13: ;
LOC14 = Alloc0_1953(((NI)sizeof(TY10410)));
Result_10600 = ((TY10410*) (LOC14));
(*Result_10600).Next = (*T_10598).Head;
(*Result_10600).Key = Key_10599;
(*T_10598).Head = Result_10600;
(*T_10598).Data[(H_10601)-0] = Result_10600;
BeforeRet: ;
return Result_10600;
}
N_NOINLINE(void, Incl_10674)(TY10414* S_10677, TY10402* Cell_10678) {
NI U_10679;
TY10410* T_10680;
U_10679 = 0;
U_10679 = ((NI) (Cell_10678));
T_10680 = 0;
T_10680 = Cellsetput_10595(S_10677, (NI32)((NU32)(U_10679) >> (NU32)(12)));
U_10679 = (NI32)((NU32)((NI32)((NU32)(U_10679) % (NU32)(4096))) / (NU32)(8));
(*T_10680).Bits[((NI32)((NU32)(U_10679) >> (NU32)(5)))-0] = (NI32)((*T_10680).Bits[((NI32)((NU32)(U_10679) >> (NU32)(5)))-0] | (NI32)((NU32)(1) << (NU32)((NI32)(U_10679 & 31))));
}
N_NIMCALL(NIM_BOOL, Containsorincl_10699)(TY10414* S_10702, TY10402* Cell_10703) {
NIM_BOOL Result_10704;
NI U_10705;
TY10410* T_10706;
Result_10704 = 0;
U_10705 = 0;
U_10705 = ((NI) (Cell_10703));
T_10706 = 0;
T_10706 = Cellsetget_10514((*S_10702), (NI32)((NU32)(U_10705) >> (NU32)(12)));
if (!!((T_10706 == NIM_NIL))) goto LA2;
U_10705 = (NI32)((NU32)((NI32)((NU32)(U_10705) % (NU32)(4096))) / (NU32)(8));
Result_10704 = !(((NI32)((*T_10706).Bits[((NI32)((NU32)(U_10705) >> (NU32)(5)))-0] & (NI32)((NU32)(1) << (NU32)((NI32)(U_10705 & 31)))) == 0));
if (!!(Result_10704)) goto LA5;
(*T_10706).Bits[((NI32)((NU32)(U_10705) >> (NU32)(5)))-0] = (NI32)((*T_10706).Bits[((NI32)((NU32)(U_10705) >> (NU32)(5)))-0] | (NI32)((NU32)(1) << (NU32)((NI32)(U_10705 & 31))));
LA5: ;
goto LA1;
LA2: ;
Incl_10674(S_10702, Cell_10703);
Result_10704 = NIM_FALSE;
LA1: ;
return Result_10704;
}
N_NIMCALL(NIM_BOOL, Contains_10654)(TY10414 S_10656, TY10402* Cell_10657) {
NIM_BOOL Result_10658;
NI U_10659;
TY10410* T_10660;
Result_10658 = 0;
U_10659 = 0;
U_10659 = ((NI) (Cell_10657));
T_10660 = 0;
T_10660 = Cellsetget_10514(S_10656, (NI32)((NU32)(U_10659) >> (NU32)(12)));
if (!!((T_10660 == NIM_NIL))) goto LA2;
U_10659 = (NI32)((NU32)((NI32)((NU32)(U_10659) % (NU32)(4096))) / (NU32)(8));
Result_10658 = !(((NI32)((*T_10660).Bits[((NI32)((NU32)(U_10659) >> (NU32)(5)))-0] & (NI32)((NU32)(1) << (NU32)((NI32)(U_10659 & 31)))) == 0));
goto LA1;
LA2: ;
Result_10658 = NIM_FALSE;
LA1: ;
return Result_10658;
}
N_NIMCALL(void, Deinit_10492)(TY10414* S_10495) {
TY10410* It_10496;
TY10410* N_10508;
It_10496 = 0;
It_10496 = (*S_10495).Head;
while (1) {
if (!!((It_10496 == NIM_NIL))) goto LA1;
N_10508 = 0;
N_10508 = (*It_10496).Next;
Dealloc_1960(((void*) (It_10496)));
It_10496 = N_10508;
} LA1: ;
(*S_10495).Head = NIM_NIL;
Dealloc_1960(((void*) ((*S_10495).Data)));
(*S_10495).Data = NIM_NIL;
(*S_10495).Counter = 0;
}
N_NIMCALL(void, Collectcycles_15003)(TY10790* Gch_15006) {
NI Tabsize_15007;
TY10402* C_15008;
TY10414 HEX3Atmp_20636;
TY10410* R_20638;
NI I_20640;
NI W_20642;
NI J_20644;
TY10414 Marker_15023;
TY10402* C_15025;
TY10414 HEX3Atmp_20645;
TY10410* R_20647;
NI I_20649;
NI W_20651;
NI J_20653;
NIM_BOOL LOC17;
TY10402* D_15041;
NIM_BOOL LOC22;
NIM_BOOL LOC24;
TY10402* C_15045;
TY10414 HEX3Atmp_20654;
TY10410* R_20656;
NI I_20658;
NI W_20660;
NI J_20662;
TY10402* D_15060;
NIM_BOOL LOC41;
Tabsize_15007 = 0;
Tabsize_15007 = 0;
C_15008 = 0;
memset((void*)&HEX3Atmp_20636, 0, sizeof(HEX3Atmp_20636));
HEX3Atmp_20636 = (*Gch_15006).Cycleroots;
R_20638 = 0;
R_20638 = HEX3Atmp_20636.Head;
while (1) {
if (!!((R_20638 == NIM_NIL))) goto LA1;
I_20640 = 0;
I_20640 = 0;
while (1) {
if (!(I_20640 <= 15)) goto LA2;
W_20642 = 0;
W_20642 = (*R_20638).Bits[(I_20640)-0];
J_20644 = 0;
J_20644 = 0;
while (1) {
if (!!((W_20642 == 0))) goto LA3;
if (!!(((NI32)(W_20642 & 1) == 0))) goto LA5;
C_15008 = ((TY10402*) ((NI32)((NI32)((NU32)((*R_20638).Key) << (NU32)(12)) | (NI32)((NU32)((NI32)((NU32)((NI32)((NU32)(I_20640) << (NU32)(5))) + (NU32)(J_20644))) * (NU32)(8)))));
Tabsize_15007 += 1;
Forallchildren_11812(C_15008, ((NU8) 2));
LA5: ;
J_20644 += 1;
W_20642 = (NI32)((NU32)(W_20642) >> (NU32)(1));
} LA3: ;
I_20640 += 1;
} LA2: ;
R_20638 = (*R_20638).Next;
} LA1: ;
(*Gch_15006).Stat.Cycletablesize = (((*Gch_15006).Stat.Cycletablesize >= Tabsize_15007) ? (*Gch_15006).Stat.Cycletablesize : Tabsize_15007);
memset((void*)&Marker_15023, 0, sizeof(Marker_15023));
Init_10488(&Marker_15023);
C_15025 = 0;
memset((void*)&HEX3Atmp_20645, 0, sizeof(HEX3Atmp_20645));
HEX3Atmp_20645 = (*Gch_15006).Cycleroots;
R_20647 = 0;
R_20647 = HEX3Atmp_20645.Head;
while (1) {
if (!!((R_20647 == NIM_NIL))) goto LA7;
I_20649 = 0;
I_20649 = 0;
while (1) {
if (!(I_20649 <= 15)) goto LA8;
W_20651 = 0;
W_20651 = (*R_20647).Bits[(I_20649)-0];
J_20653 = 0;
J_20653 = 0;
while (1) {
if (!!((W_20651 == 0))) goto LA9;
if (!!(((NI32)(W_20651 & 1) == 0))) goto LA11;
C_15025 = ((TY10402*) ((NI32)((NI32)((NU32)((*R_20647).Key) << (NU32)(12)) | (NI32)((NU32)((NI32)((NU32)((NI32)((NU32)(I_20649) << (NU32)(5))) + (NU32)(J_20653))) * (NU32)(8)))));
if (!((NU32)(8) <= (NU32)((*C_15025).Refcount))) goto LA14;
LOC17 = Containsorincl_10699(&Marker_15023, C_15025);
if (!!(LOC17)) goto LA18;
(*Gch_15006).Tempstack.Len = 0;
Forallchildren_11812(C_15025, ((NU8) 1));
while (1) {
if (!(0 < (*Gch_15006).Tempstack.Len)) goto LA20;
(*Gch_15006).Tempstack.Len -= 1;
D_15041 = 0;
D_15041 = (*Gch_15006).Tempstack.D[((*Gch_15006).Tempstack.Len)-0];
(*D_15041).Refcount = (NI32)((NU32)((*D_15041).Refcount) + (NU32)(8));
LOC22 = Contains_10654((*Gch_15006).Cycleroots, D_15041);
if (!(LOC22)) goto LA23;
LOC24 = Containsorincl_10699(&Marker_15023, D_15041);
LOC22 = !(LOC24);
LA23: ;
if (!LOC22) goto LA25;
Forallchildren_11812(D_15041, ((NU8) 1));
LA25: ;
} LA20: ;
LA18: ;
LA14: ;
LA11: ;
J_20653 += 1;
W_20651 = (NI32)((NU32)(W_20651) >> (NU32)(1));
} LA9: ;
I_20649 += 1;
} LA8: ;
R_20647 = (*R_20647).Next;
} LA7: ;
C_15045 = 0;
memset((void*)&HEX3Atmp_20654, 0, sizeof(HEX3Atmp_20654));
HEX3Atmp_20654 = (*Gch_15006).Cycleroots;
R_20656 = 0;
R_20656 = HEX3Atmp_20654.Head;
while (1) {
if (!!((R_20656 == NIM_NIL))) goto LA27;
I_20658 = 0;
I_20658 = 0;
while (1) {
if (!(I_20658 <= 15)) goto LA28;
W_20660 = 0;
W_20660 = (*R_20656).Bits[(I_20658)-0];
J_20662 = 0;
J_20662 = 0;
while (1) {
if (!!((W_20660 == 0))) goto LA29;
if (!!(((NI32)(W_20660 & 1) == 0))) goto LA31;
C_15045 = ((TY10402*) ((NI32)((NI32)((NU32)((*R_20656).Key) << (NU32)(12)) | (NI32)((NU32)((NI32)((NU32)((NI32)((NU32)(I_20658) << (NU32)(5))) + (NU32)(J_20662))) * (NU32)(8)))));
if (!((NU32)((*C_15045).Refcount) < (NU32)(8))) goto LA34;
(*Gch_15006).Tempstack.Len = 0;
Forallchildren_11812(C_15045, ((NU8) 1));
while (1) {
if (!(0 < (*Gch_15006).Tempstack.Len)) goto LA36;
(*Gch_15006).Tempstack.Len -= 1;
D_15060 = 0;
D_15060 = (*Gch_15006).Tempstack.D[((*Gch_15006).Tempstack.Len)-0];
if (!((NU32)((*D_15060).Refcount) < (NU32)(8))) goto LA38;
LOC41 = Contains_10654((*Gch_15006).Cycleroots, D_15060);
if (!!(LOC41)) goto LA42;
Addzct_11201(&(*Gch_15006).Zct, D_15060);
LA42: ;
LA38: ;
} LA36: ;
Preparedealloc_11825(C_15045);
Rawdealloc_9664(&Allocator_8529, ((void*) (C_15045)));
LA34: ;
LA31: ;
J_20662 += 1;
W_20660 = (NI32)((NU32)(W_20660) >> (NU32)(1));
} LA29: ;
I_20658 += 1;
} LA28: ;
R_20656 = (*R_20656).Next;
} LA27: ;
Deinit_10492(&(*Gch_15006).Cycleroots);
Init_10488(&(*Gch_15006).Cycleroots);
}
static N_INLINE(NI, Atomicdec_3006)(NI* Memloc_3009, NI X_3010) {
NI Result_7606;
Result_7606 = 0;
(*Memloc_3009) -= X_3010;
Result_7606 = (*Memloc_3009);
return Result_7606;
}
static N_INLINE(void, Rtladdzct_12201)(TY10402* C_12203) {
Addzct_11201(&Gch_10808.Zct, C_12203);
}
static N_INLINE(void, Rtladdcycleroot_11852)(TY10402* C_11854) {
Incl_10674(&Gch_10808.Cycleroots, C_11854);
}
static N_INLINE(void, Decref_12601)(TY10402* C_12603) {
NI LOC2;
NIM_BOOL LOC5;
LOC2 = Atomicdec_3006(&(*C_12603).Refcount, 8);
if (!((NU32)(LOC2) < (NU32)(8))) goto LA3;
Rtladdzct_12201(C_12603);
goto LA1;
LA3: ;
LOC5 = Canbecycleroot_11216(C_12603);
if (!LOC5) goto LA6;
Rtladdcycleroot_11852(C_12603);
goto LA1;
LA6: ;
LA1: ;
}
N_NIMCALL(void, Unmarkstackandregisters_17401)(TY10790* Gch_17404) {
TY10402** D_17405;
NI I_17413;
NI HEX3Atmp_20663;
NI Res_20665;
D_17405 = 0;
D_17405 = (*Gch_17404).Decstack.D;
I_17413 = 0;
HEX3Atmp_20663 = 0;
HEX3Atmp_20663 = (NI32)((*Gch_17404).Decstack.Len - 1);
Res_20665 = 0;
Res_20665 = 0;
while (1) {
if (!(Res_20665 <= HEX3Atmp_20663)) goto LA1;
I_17413 = Res_20665;
Decref_12601(D_17405[(I_17413)-0]);
Res_20665 += 1;
} LA1: ;
(*Gch_17404).Decstack.Len = 0;
}
N_NIMCALL(void, Collectct_11805)(TY10790* Gch_11808) {
NIM_BOOL LOC2;
NIM_BOOL LOC3;
NIM_BOOL LOC5;
NI LOC7;
NI LOC11;
NIM_BOOL LOC13;
NI LOC14;
NI LOC18;
LOC3 = (256 <= (*Gch_11808).Zct.Len);
if (LOC3) goto LA4;
LOC5 = NIM_TRUE;
if (!(LOC5)) goto LA6;
LOC7 = Getoccupiedmem_2017();
LOC5 = (Cyclethreshold_10809 <= LOC7);
LA6: ;
LOC3 = LOC5;
LA4: ;
LOC2 = LOC3;
if (LOC2) goto LA8;
LOC2 = NIM_FALSE;
LA8: ;
if (!LOC2) goto LA9;
LOC11 = Stacksize_16601();
(*Gch_11808).Stat.Maxstacksize = (((*Gch_11808).Stat.Maxstacksize >= LOC11) ? (*Gch_11808).Stat.Maxstacksize : LOC11);
Markstackandregisters_16615(Gch_11808);
Markthreadstacks_15811(Gch_11808);
(*Gch_11808).Stat.Maxstackcells = (((*Gch_11808).Stat.Maxstackcells >= (*Gch_11808).Decstack.Len) ? (*Gch_11808).Stat.Maxstackcells : (*Gch_11808).Decstack.Len);
(*Gch_11808).Stat.Stackscans += 1;
Collectzct_16801(Gch_11808);
LOC14 = Getoccupiedmem_2017();
LOC13 = (Cyclethreshold_10809 <= LOC14);
if (LOC13) goto LA15;
LOC13 = NIM_FALSE;
LA15: ;
if (!LOC13) goto LA16;
Collectcycles_15003(Gch_11808);
Collectzct_16801(Gch_11808);
(*Gch_11808).Stat.Cyclecollections += 1;
LOC18 = Getoccupiedmem_2017();
Cyclethreshold_10809 = ((4194304 >= (NI32)(LOC18 * 2)) ? 4194304 : (NI32)(LOC18 * 2));
(*Gch_11808).Stat.Maxthreshold = (((*Gch_11808).Stat.Maxthreshold >= Cyclethreshold_10809) ? (*Gch_11808).Stat.Maxthreshold : Cyclethreshold_10809);
LA16: ;
Unmarkstackandregisters_17401(Gch_11808);
LA9: ;
}
static N_INLINE(void, Checkcollection_13500)(void) {
if (!(Recgclock_10810 == 0)) goto LA2;
Collectct_11805(&Gch_10808);
LA2: ;
}
static N_INLINE(void, Release_11001)(TY10790* Gch_11004) {
}
N_NIMCALL(void*, newObj)(TNimType* Typ_13507, NI Size_13508) {
void* Result_13509;
TY10402* Res_13524;
void* LOC1;
NI L_13602;
TY10402** D_13603;
NI I_13613;
NI HEX3Atmp_20632;
NI HEX3Atmp_20633;
NI Res_20635;
TY10402* C_13614;
Result_13509 = 0;
Aquire_10811(&Gch_10808);
Checkcollection_13500();
Res_13524 = 0;
LOC1 = Rawalloc_9395(&Allocator_8529, (NI32)(Size_13508 + ((NI)sizeof(TY10402))));
Res_13524 = ((TY10402*) (LOC1));
zeroMem(((void*) (Res_13524)), (NI32)(Size_13508 + ((NI)sizeof(TY10402))));
(*Res_13524).Typ = Typ_13507;
(*Res_13524).Refcount = 4;
L_13602 = 0;
L_13602 = Gch_10808.Zct.Len;
D_13603 = 0;
D_13603 = Gch_10808.Zct.D;
I_13613 = 0;
HEX3Atmp_20632 = 0;
HEX3Atmp_20633 = 0;
HEX3Atmp_20632 = (NI32)(L_13602 - 1);
HEX3Atmp_20633 = ((0 >= (NI32)(L_13602 - 8)) ? 0 : (NI32)(L_13602 - 8));
Res_20635 = 0;
Res_20635 = HEX3Atmp_20632;
while (1) {
if (!(HEX3Atmp_20633 <= Res_20635)) goto LA3;
I_13613 = Res_20635;
C_13614 = 0;
C_13614 = D_13603[(I_13613)-0];
if (!((NU32)(8) <= (NU32)((*C_13614).Refcount))) goto LA5;
(*C_13614).Refcount = (NI32)((*C_13614).Refcount & -8);
D_13603[(I_13613)-0] = Res_13524;
goto LA2;
LA5: ;
Res_20635 -= 1;
} LA3: ;
Add_10458(&Gch_10808.Zct, Res_13524);
LA2: ;
Release_11001(&Gch_10808);
Result_13509 = Celltousr_11208(Res_13524);
return Result_13509;
}
static N_INLINE(NI, Atomicinc_3001)(NI* Memloc_3004, NI X_3005) {
NI Result_7407;
Result_7407 = 0;
(*Memloc_3004) += X_3005;
Result_7407 = (*Memloc_3004);
return Result_7407;
}
static N_INLINE(void, asgnRefNoCycle)(void** Dest_12818, void* Src_12819) {
TY10402* C_12820;
NI LOC4;
TY10402* C_12822;
NI LOC9;
if (!!((Src_12819 == NIM_NIL))) goto LA2;
C_12820 = 0;
C_12820 = Usrtocell_11212(Src_12819);
LOC4 = Atomicinc_3001(&(*C_12820).Refcount, 8);
LA2: ;
if (!!(((*Dest_12818) == NIM_NIL))) goto LA6;
C_12822 = 0;
C_12822 = Usrtocell_11212((*Dest_12818));
LOC9 = Atomicdec_3006(&(*C_12822).Refcount, 8);
if (!((NU32)(LOC9) < (NU32)(8))) goto LA10;
Rtladdzct_12201(C_12822);
LA10: ;
LA6: ;
(*Dest_12818) = Src_12819;
}
N_NIMCALL(NimStringDesc*, rawNewString)(NI Space_18287) {
NimStringDesc* Result_18288;
NI S_18289;
void* LOC4;
Result_18288 = 0;
S_18289 = 0;
S_18289 = Space_18287;
if (!(S_18289 < 8)) goto LA2;
S_18289 = 7;
LA2: ;
LOC4 = newObj(&Strdesc_3017, (NI32)(((NI)sizeof(TGenericSeq)) + (NI32)((NI32)(S_18289 + 1) * 1)));
Result_18288 = ((NimStringDesc*) (LOC4));
(*Result_18288).Sup.space = S_18289;
return Result_18288;
}
N_NIMCALL(NimStringDesc*, copyString)(NimStringDesc* Src_18308) {
NimStringDesc* Result_18309;
Result_18309 = 0;
if (!(Src_18308 == NIM_NIL)) goto LA2;
Result_18309 = NIM_NIL;
goto BeforeRet;
LA2: ;
Result_18309 = rawNewString((*Src_18308).Sup.space);
(*Result_18309).Sup.len = (*Src_18308).Sup.len;
memcpy(((NCSTRING) ((*Result_18309).data)), ((NCSTRING) ((*Src_18308).data)), ((int) ((NI32)((NI32)((*Src_18308).Sup.len + 1) * 1))));
BeforeRet: ;
return Result_18309;
}
N_NIMCALL(void, Gcdisable_2663)(void) {
NI LOC1;
LOC1 = Atomicinc_3001(&Recgclock_10810, 1);
}
static N_INLINE(void, Incref_12802)(TY10402* C_12804) {
NI LOC1;
NIM_BOOL LOC3;
LOC1 = Atomicinc_3001(&(*C_12804).Refcount, 8);
LOC3 = Canbecycleroot_11216(C_12804);
if (!LOC3) goto LA4;
Rtladdcycleroot_11852(C_12804);
LA4: ;
}
static N_INLINE(void, asgnRef)(void** Dest_12814, void* Src_12815) {
TY10402* LOC4;
TY10402* LOC8;
if (!!((Src_12815 == NIM_NIL))) goto LA2;
LOC4 = Usrtocell_11212(Src_12815);
Incref_12802(LOC4);
LA2: ;
if (!!(((*Dest_12814) == NIM_NIL))) goto LA6;
LOC8 = Usrtocell_11212((*Dest_12814));
Decref_12601(LOC8);
LA6: ;
(*Dest_12814) = Src_12815;
}
static N_INLINE(void, pushCurrentException)(E_Base* E_4641) {
asgnRef((void**) &(*E_4641).parent, Currexception_4632);
asgnRef((void**) &Currexception_4632, E_4641);
}
static N_INLINE(NI, Resize_18201)(NI Old_18203) {
NI Result_18204;
Result_18204 = 0;
if (!(Old_18203 <= 0)) goto LA2;
Result_18204 = 4;
goto BeforeRet;
goto LA1;
LA2: ;
if (!(Old_18203 < 65536)) goto LA4;
Result_18204 = (NI32)(Old_18203 * 2);
goto BeforeRet;
goto LA1;
LA4: ;
Result_18204 = (NI32)((NI32)(Old_18203 * 3) / 2);
goto BeforeRet;
LA1: ;
BeforeRet: ;
return Result_18204;
}
N_NIMCALL(void*, Growobj_14007)(void* Old_14009, NI Newsize_14010) {
void* Result_14011;
TY10402* Ol_14013;
TY10402* Res_14038;
void* LOC1;
NI Elemsize_14039;
NI Oldsize_14049;
NI J_14054;
TY10402** D_14055;
NIM_BOOL LOC13;
Result_14011 = 0;
Aquire_10811(&Gch_10808);
Checkcollection_13500();
Ol_14013 = 0;
Ol_14013 = Usrtocell_11212(Old_14009);
Res_14038 = 0;
LOC1 = Rawalloc_9395(&Allocator_8529, (NI32)(Newsize_14010 + ((NI)sizeof(TY10402))));
Res_14038 = ((TY10402*) (LOC1));
Elemsize_14039 = 0;
Elemsize_14039 = 1;
if (!!(((*(*Ol_14013).Typ).kind == ((NU8) 28)))) goto LA3;
Elemsize_14039 = (*(*(*Ol_14013).Typ).base).size;
LA3: ;
Oldsize_14049 = 0;
Oldsize_14049 = (NI32)((NI32)((*((TGenericSeq*) (Old_14009))).len * Elemsize_14039) + 8);
memcpy(((void*) (Res_14038)), ((void*) (Ol_14013)), (NI32)(Oldsize_14049 + ((NI)sizeof(TY10402))));
zeroMem(((void*) ((NI32)((NU32)((NI32)((NU32)(((NI) (Res_14038))) + (NU32)(Oldsize_14049))) + (NU32)(((NI)sizeof(TY10402)))))), (NI32)(Newsize_14010 - Oldsize_14049));
if (!((NI32)((*Ol_14013).Refcount & 7) == 4)) goto LA6;
J_14054 = 0;
J_14054 = (NI32)(Gch_10808.Zct.Len - 1);
D_14055 = 0;
D_14055 = Gch_10808.Zct.D;
while (1) {
if (!(0 <= J_14054)) goto LA8;
if (!(D_14055[(J_14054)-0] == Ol_14013)) goto LA10;
D_14055[(J_14054)-0] = Res_14038;
goto LA8;
LA10: ;
J_14054 -= 1;
} LA8: ;
LA6: ;
LOC13 = Canbecycleroot_11216(Ol_14013);
if (!LOC13) goto LA14;
Excl_10681(&Gch_10808.Cycleroots, Ol_14013);
LA14: ;
Rawdealloc_9664(&Allocator_8529, ((void*) (Ol_14013)));
Release_11001(&Gch_10808);
Result_14011 = Celltousr_11208(Res_14038);
return Result_14011;
}
N_NIMCALL(NimStringDesc*, resizeString)(NimStringDesc* Dest_18382, NI Addlen_18383) {
NimStringDesc* Result_18384;
NI Sp_18389;
NI LOC4;
void* LOC5;
Result_18384 = 0;
if (!((NI32)((NI32)((*Dest_18382).Sup.len + Addlen_18383) + 1) <= (*Dest_18382).Sup.space)) goto LA2;
Result_18384 = Dest_18382;
goto LA1;
LA2: ;
Sp_18389 = 0;
LOC4 = Resize_18201((*Dest_18382).Sup.space);
Sp_18389 = ((LOC4 >= (NI32)((NI32)((*Dest_18382).Sup.len + Addlen_18383) + 1)) ? LOC4 : (NI32)((NI32)((*Dest_18382).Sup.len + Addlen_18383) + 1));
LOC5 = Growobj_14007(((void*) (Dest_18382)), (NI32)(((NI)sizeof(TGenericSeq)) + (NI32)((NI32)(Sp_18389 + 1) * 1)));
Result_18384 = ((NimStringDesc*) (LOC5));
(*Result_18384).Sup.space = Sp_18389;
LA1: ;
return Result_18384;
}
N_NIMCALL(NimStringDesc*, setLengthStr)(NimStringDesc* S_18425, NI Newlen_18426) {
NimStringDesc* Result_18427;
NI N_18430;
Result_18427 = 0;
N_18430 = 0;
N_18430 = ((Newlen_18426 >= 0) ? Newlen_18426 : 0);
if (!(N_18430 <= (*S_18425).Sup.space)) goto LA2;
Result_18427 = S_18425;
goto LA1;
LA2: ;
Result_18427 = resizeString(S_18425, N_18430);
LA1: ;
(*Result_18427).Sup.len = N_18430;
(*Result_18427).data[(N_18430)-0] = 0;
return Result_18427;
}
static N_INLINE(void, appendString)(NimStringDesc* Dest_18392, NimStringDesc* Src_18393) {
memcpy(((NCSTRING) (&(*Dest_18392).data[((*Dest_18392).Sup.len)-0])), ((NCSTRING) ((*Src_18393).data)), ((int) ((NI32)((NI32)((*Src_18393).Sup.len + 1) * 1))));
(*Dest_18392).Sup.len += (*Src_18393).Sup.len;
}
N_NIMCALL(void, Rawwritestacktrace_4989)(NimStringDesc** S_4992) {
(*S_4992) = resizeString((*S_4992), 28);
appendString((*S_4992), ((NimStringDesc*) &TMP20720));
(*S_4992) = resizeString((*S_4992), Stacktracenewline_4416->Sup.len + 0);
appendString((*S_4992), Stacktracenewline_4416);
}
N_NIMCALL(NimStringDesc*, toNimStr)(NCSTRING Str_18299, NI Len_18300) {
NimStringDesc* Result_18301;
Result_18301 = 0;
Result_18301 = rawNewString(Len_18300);
(*Result_18301).Sup.len = Len_18300;
memcpy(((NCSTRING) ((*Result_18301).data)), Str_18299, ((int) ((NI32)((NI32)(Len_18300 + 1) * 1))));
(*Result_18301).data[(Len_18300)-0] = 0;
return Result_18301;
}
N_NIMCALL(NimStringDesc*, cstrToNimstr)(NCSTRING Str_18304) {
NimStringDesc* Result_18305;
NI LOC1;
Result_18305 = 0;
LOC1 = strlen(Str_18304);
Result_18305 = toNimStr(Str_18304, LOC1);
goto BeforeRet;
BeforeRet: ;
return Result_18305;
}
N_NIMCALL(void, Write_3670)(FILE* F_3672, NCSTRING C_3673) {
fputs(C_3673, F_3672);
}
N_NIMCALL(void, Writetostderr_4417)(NCSTRING Msg_4419) {
Write_3670(stdout, Msg_4419);
}
static N_INLINE(void, Quitordebug_5001)(void) {
exit(1);
}
N_NIMCALL(void, Gcenable_2665)(void) {
NI LOC4;
if (!(0 < Recgclock_10810)) goto LA2;
LOC4 = Atomicdec_3006(&Recgclock_10810, 1);
LA2: ;
}
N_NIMCALL(void, raiseException)(E_Base* E_5204, NCSTRING Ename_5205) {
NIM_BOOL LOC8;
NimStringDesc* LOC12;
Gcdisable_2663();
(*E_5204).name = Ename_5205;
if (!!((excHandler == NIM_NIL))) goto LA2;
pushCurrentException(E_5204);
longjmp((*excHandler).context, ((NI32) 1));
goto LA1;
LA2: ;
if (!!(Buf_4801 == 0)) goto LA5;
Buf_4801 = setLengthStr(Buf_4801, 0);
Rawwritestacktrace_4989(&Buf_4801);
LOC8 = !(((*E_5204).message == NIM_NIL));
if (!(LOC8)) goto LA9;
LOC8 = !(((NU8)((*E_5204).message->data[0]) == (NU8)(0)));
LA9: ;
if (!LOC8) goto LA10;
Buf_4801 = resizeString(Buf_4801, 28);
appendString(Buf_4801, ((NimStringDesc*) &TMP20721));
Buf_4801 = resizeString(Buf_4801, (*E_5204).message->Sup.len + 0);
appendString(Buf_4801, (*E_5204).message);
goto LA7;
LA10: ;
Buf_4801 = resizeString(Buf_4801, 26);
appendString(Buf_4801, ((NimStringDesc*) &TMP20722));
LA7: ;
Buf_4801 = resizeString(Buf_4801, 2);
appendString(Buf_4801, ((NimStringDesc*) &TMP20723));
LOC12 = 0;
LOC12 = cstrToNimstr(Ename_5205);
Buf_4801 = resizeString(Buf_4801, LOC12->Sup.len + 0);
appendString(Buf_4801, LOC12);
Buf_4801 = resizeString(Buf_4801, 2);
appendString(Buf_4801, ((NimStringDesc*) &TMP20724));
Writetostderr_4417(Buf_4801->data);
goto LA4;
LA5: ;
Writetostderr_4417(Ename_5205);
LA4: ;
Quitordebug_5001();
LA1: ;
Gcenable_2665();
}
N_NIMCALL(void, Write_3658)(FILE* F_3660, NimStringDesc* S_3661) {
NI LOC2;
TY420* E_4255;
LOC2 = Writebuffer_3733(F_3660, ((void*) (S_3661->data)), S_3661->Sup.len);
if (!!((LOC2 == S_3661->Sup.len))) goto LA3;
E_4255 = 0;
E_4255 = (TY420*) newObj(NTI4254, sizeof(TY420));
(*E_4255).Sup.Sup.Sup.Sup.m_type = NTI420;
asgnRefNoCycle((void**) &(*E_4255).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP20719)));
raiseException((E_Base*)E_4255, "EIO");
LA3: ;
}
static N_INLINE(void, rawEcho)(NimStringDesc* X_4094) {
Write_3658(stdout, X_4094);
}
static N_INLINE(void, rawEchoNL)(void) {
Write_3658(stdout, ((NimStringDesc*) &TMP20725));
}
N_NIMCALL(void, Quit_2821)(NimStringDesc* Errormsg_2823) {
rawEcho(Errormsg_2823);
rawEchoNL();
exit(1);
}
N_NIMCALL(void, Raiseoutofmem_7841)(void) {
if (!(Goutofmem_7840 == NIM_NIL)) goto LA2;
Quit_2821(((NimStringDesc*) &TMP20726));
LA2: ;
asgnRefNoCycle((void**) &(*Goutofmem_7840).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP20727)));
raiseException((E_Base*)Goutofmem_7840, "EOutOfMemory");
}
static N_INLINE(void*, Osallocpages_8013)(NI Size_8015) {
void* Result_8016;
NIM_BOOL LOC2;
Result_8016 = 0;
Result_8016 = mmap(NIM_NIL, Size_8015, ((NI32) 3), ((NI32) 258), ((NI32) -1), 0);
LOC2 = (Result_8016 == NIM_NIL);
if (LOC2) goto LA3;
LOC2 = (Result_8016 == ((void*) -1));
LA3: ;
if (!LOC2) goto LA4;
Raiseoutofmem_7841();
LA4: ;
return Result_8016;
}
static N_INLINE(void, Inccurrmem_8486)(TY8474* A_8489, NI Bytes_8490) {
(*A_8489).Currmem += Bytes_8490;
}
N_NIMCALL(void*, Llalloc_8530)(TY8474* A_8533, NI Size_8534) {
void* Result_8535;
NIM_BOOL LOC2;
NI Request_8549;
void* LOC6;
Result_8535 = 0;
LOC2 = ((*A_8533).Llmem == NIM_NIL);
if (LOC2) goto LA3;
LOC2 = ((*(*A_8533).Llmem).Size < Size_8534);
LA3: ;
if (!LOC2) goto LA4;
Request_8549 = 0;
Request_8549 = Roundup_8456((NI32)(Size_8534 + ((NI)sizeof(TY8472))), 4096);
LOC6 = Osallocpages_8013(Request_8549);
(*A_8533).Llmem = ((TY8472*) (LOC6));
Inccurrmem_8486(A_8533, Request_8549);
(*(*A_8533).Llmem).Size = (NI32)(Request_8549 - ((NI)sizeof(TY8472)));
(*(*A_8533).Llmem).Acc = ((NI)sizeof(TY8472));
LA4: ;
Result_8535 = ((void*) ((NI32)(((NI) ((*A_8533).Llmem)) + (*(*A_8533).Llmem).Acc)));
(*(*A_8533).Llmem).Size -= Size_8534;
(*(*A_8533).Llmem).Acc += Size_8534;
zeroMem(Result_8535, Size_8534);
return Result_8535;
}
N_NIMCALL(TY8407*, Intsetput_8593)(TY8411* T_8596, NI Key_8597) {
TY8407* Result_8598;
void* LOC4;
Result_8598 = 0;
Result_8598 = Intsetget_8574(&(*T_8596), Key_8597);
if (!(Result_8598 == NIM_NIL)) goto LA2;
LOC4 = Llalloc_8530(&Allocator_8529, ((NI)sizeof(TY8407)));
Result_8598 = ((TY8407*) (LOC4));
(*Result_8598).Next = (*T_8596).Data[((NI32)(Key_8597 & 1023))-0];
(*T_8596).Data[((NI32)(Key_8597 & 1023))-0] = Result_8598;
(*Result_8598).Key = Key_8597;
LA2: ;
return Result_8598;
}
N_NIMCALL(void, Incl_8631)(TY8411* S_8634, NI Key_8635) {
TY8407* T_8636;
NI U_8637;
T_8636 = 0;
T_8636 = Intsetput_8593(S_8634, (NI32)((NU32)(Key_8635) >> (NU32)(9)));
U_8637 = 0;
U_8637 = (NI32)(Key_8635 & 511);
(*T_8636).Bits[((NI32)((NU32)(U_8637) >> (NU32)(5)))-0] = (NI32)((*T_8636).Bits[((NI32)((NU32)(U_8637) >> (NU32)(5)))-0] | (NI32)((NU32)(1) << (NU32)((NI32)(U_8637 & 31))));
}
N_NIMCALL(void, Splitchunk_9266)(TY8474* A_9269, TY8434* C_9270, NI Size_9271) {
TY8434* Rest_9272;
NI LOC1;
Rest_9272 = 0;
Rest_9272 = ((TY8434*) ((NI32)((NU32)(((NI) (C_9270))) + (NU32)(Size_9271))));
(*Rest_9272).Sup.Size = (NI32)((*C_9270).Sup.Size - Size_9271);
(*Rest_9272).Sup.Used = NIM_FALSE;
(*Rest_9272).Next = NIM_NIL;
(*Rest_9272).Prev = NIM_NIL;
(*Rest_9272).Sup.Prevsize = Size_9271;
Updateprevsize_8811(A_9269, C_9270, (*Rest_9272).Sup.Size);
(*C_9270).Sup.Size = Size_9271;
LOC1 = Pageindex_8677(&Rest_9272->Sup);
Incl_8631(&(*A_9269).Chunkstarts, LOC1);
Listadd_9207(&(*A_9269).Freechunkslist, Rest_9272);
}
N_NIMCALL(TY8434*, Requestoschunks_8692)(TY8474* A_8695, NI Size_8696) {
TY8434* Result_8697;
void* LOC1;
NI Nxt_8712;
TY8430* Next_8715;
NI LOC3;
NIM_BOOL LOC4;
NI Prv_8718;
TY8430* Prev_8721;
NIM_BOOL LOC8;
NI LOC9;
Result_8697 = 0;
Inccurrmem_8486(A_8695, Size_8696);
(*A_8695).Freemem += Size_8696;
LOC1 = Osallocpages_8013(Size_8696);
Result_8697 = ((TY8434*) (LOC1));
(*Result_8697).Next = NIM_NIL;
(*Result_8697).Prev = NIM_NIL;
(*Result_8697).Sup.Used = NIM_FALSE;
(*Result_8697).Sup.Size = Size_8696;
Nxt_8712 = 0;
Nxt_8712 = (NI32)((NU32)(((NI) (Result_8697))) + (NU32)(Size_8696));
Next_8715 = 0;
Next_8715 = ((TY8430*) (Nxt_8712));
LOC3 = Pageindex_8677(Next_8715);
LOC4 = Contains_8611(&(*A_8695).Chunkstarts, LOC3);
if (!LOC4) goto LA5;
(*Next_8715).Prevsize = Size_8696;
LA5: ;
Prv_8718 = 0;
Prv_8718 = (NI32)((NU32)(((NI) (Result_8697))) - (NU32)(Lastsize_8691));
Prev_8721 = 0;
Prev_8721 = ((TY8430*) (Prv_8718));
LOC9 = Pageindex_8677(Prev_8721);
LOC8 = Contains_8611(&(*A_8695).Chunkstarts, LOC9);
if (!(LOC8)) goto LA10;
LOC8 = ((*Prev_8721).Size == Lastsize_8691);
LA10: ;
if (!LOC8) goto LA11;
(*Result_8697).Sup.Prevsize = Lastsize_8691;
goto LA7;
LA11: ;
(*Result_8697).Sup.Prevsize = 0;
LA7: ;
Lastsize_8691 = Size_8696;
return Result_8697;
}
N_NIMCALL(TY8434*, Getbigchunk_9292)(TY8474* A_9295, NI Size_9296) {
TY8434* Result_9297;
NI LOC11;
Result_9297 = 0;
Result_9297 = (*A_9295).Freechunkslist;
while (1) {
if (!!((Result_9297 == NIM_NIL))) goto LA2;
if (!((*Result_9297).Sup.Size == Size_9296)) goto LA4;
Listremove_8846(&(*A_9295).Freechunkslist, Result_9297);
goto LA1;
goto LA3;
LA4: ;
if (!(Size_9296 < (*Result_9297).Sup.Size)) goto LA6;
Listremove_8846(&(*A_9295).Freechunkslist, Result_9297);
Splitchunk_9266(A_9295, Result_9297, Size_9296);
goto LA1;
goto LA3;
LA6: ;
LA3: ;
Result_9297 = (*Result_9297).Next;
} LA2: ;
if (!(Size_9296 < 524288)) goto LA9;
Result_9297 = Requestoschunks_8692(A_9295, 524288);
Splitchunk_9266(A_9295, Result_9297, Size_9296);
goto LA8;
LA9: ;
Result_9297 = Requestoschunks_8692(A_9295, Size_9296);
LA8: ;
LA1: ;
(*Result_9297).Sup.Prevsize = 0;
(*Result_9297).Sup.Used = NIM_TRUE;
LOC11 = Pageindex_8677(&Result_9297->Sup);
Incl_8631(&(*A_9295).Chunkstarts, LOC11);
(*A_9295).Freemem -= Size_9296;
return Result_9297;
}
N_NIMCALL(TY8432*, Getsmallchunk_9362)(TY8474* A_9365) {
TY8432* Result_9366;
TY8434* Res_9367;
Result_9366 = 0;
Res_9367 = 0;
Res_9367 = Getbigchunk_9292(A_9365, 4096);
Result_9366 = ((TY8432*) (Res_9367));
return Result_9366;
}
N_NIMCALL(void*, Rawalloc_9395)(TY8474* A_9398, NI Requestedsize_9399) {
void* Result_9400;
NI Size_9405;
NI S_9408;
TY8432* C_9409;
TY8434* C_9636;
Result_9400 = 0;
Size_9405 = 0;
Size_9405 = Roundup_8456(Requestedsize_9399, 8);
if (!(Size_9405 <= (NI32)(4096 - (NI32)(((NI)sizeof(TY8432)) - 8)))) goto LA2;
S_9408 = 0;
S_9408 = (NI32)(Size_9405 / 8);
C_9409 = 0;
C_9409 = (*A_9398).Freesmallchunks[(S_9408)-0];
if (!(C_9409 == NIM_NIL)) goto LA5;
C_9409 = Getsmallchunk_9362(A_9398);
(*C_9409).Freelist = NIM_NIL;
(*C_9409).Sup.Size = Size_9405;
(*C_9409).Acc = Size_9405;
(*C_9409).Free = (NI32)((NI32)(4096 - (NI32)(((NI)sizeof(TY8432)) - 8)) - Size_9405);
(*C_9409).Next = NIM_NIL;
(*C_9409).Prev = NIM_NIL;
Listadd_9426(&(*A_9398).Freesmallchunks[(S_9408)-0], C_9409);
Result_9400 = ((void*) (&(*C_9409).Data));
goto LA4;
LA5: ;
if (!((*C_9409).Freelist == NIM_NIL)) goto LA8;
Result_9400 = ((void*) ((NI32)((NU32)(((NI) (&(*C_9409).Data))) + (NU32)((*C_9409).Acc))));
(*C_9409).Acc += Size_9405;
goto LA7;
LA8: ;
Result_9400 = ((void*) ((*C_9409).Freelist));
(*C_9409).Freelist = (*(*C_9409).Freelist).Next;
LA7: ;
(*C_9409).Free -= Size_9405;
LA4: ;
if (!((*C_9409).Free < Size_9405)) goto LA11;
Listremove_9568(&(*A_9398).Freesmallchunks[(S_9408)-0], C_9409);
LA11: ;
goto LA1;
LA2: ;
Size_9405 = Roundup_8456((NI32)(Requestedsize_9399 + (NI32)(((NI)sizeof(TY8434)) - 8)), 4096);
C_9636 = 0;
C_9636 = Getbigchunk_9292(A_9398, Size_9405);
Result_9400 = ((void*) (&(*C_9636).Data));
LA1: ;
return Result_9400;
}
N_NOCONV(void*, Alloc_1950)(NI Size_1952) {
void* Result_10018;
Result_10018 = 0;
Result_10018 = Rawalloc_9395(&Allocator_8529, (NI32)(Size_1952 + ((NI)sizeof(TY8422))));
(*((TY8422*) (Result_10018))).Zerofield = 1;
Result_10018 = ((void*) ((NI32)((NU32)(((NI) (Result_10018))) + (NU32)(((NI)sizeof(TY8422))))));
return Result_10018;
}
N_NOCONV(void*, Alloc0_1953)(NI Size_1955) {
void* Result_10024;
Result_10024 = 0;
Result_10024 = Alloc_1950(Size_1955);
zeroMem(Result_10024, Size_1955);
return Result_10024;
}
N_NIMCALL(void, Init_10478)(TY10418* S_10481, NI Cap_10482) {
void* LOC1;
(*S_10481).Len = 0;
(*S_10481).Cap = Cap_10482;
LOC1 = Alloc0_1953((NI32)(Cap_10482 * 4));
(*S_10481).D = ((TY10402**) (LOC1));
}
N_NIMCALL(void, Initgc_3011)(void) {
Gch_10808.Stat.Stackscans = 0;
Gch_10808.Stat.Cyclecollections = 0;
Gch_10808.Stat.Maxthreshold = 0;
Gch_10808.Stat.Maxstacksize = 0;
Gch_10808.Stat.Maxstackcells = 0;
Gch_10808.Stat.Cycletablesize = 0;
Init_10478(&Gch_10808.Zct, 1024);
Init_10478(&Gch_10808.Tempstack, 1024);
Init_10488(&Gch_10808.Cycleroots);
Init_10478(&Gch_10808.Decstack, 1024);
asgnRefNoCycle((void**) &Goutofmem_7840, (TY442*) newObj(NTI7844, sizeof(TY442)));
(*Goutofmem_7840).Sup.Sup.Sup.Sup.m_type = NTI442;
}
N_NOCONV(void, signalHandler)(int Sig_5278) {
int S_5279;
S_5279 = 0;
S_5279 = Sig_5278;
Gcdisable_2663();
Buf_4801 = setLengthStr(Buf_4801, 0);
Rawwritestacktrace_4989(&Buf_4801);
if (!(S_5279 == SIGINT)) goto LA2;
Buf_4801 = resizeString(Buf_4801, 31);
appendString(Buf_4801, ((NimStringDesc*) &TMP20733));
goto LA1;
LA2: ;
if (!(S_5279 == SIGSEGV)) goto LA4;
Buf_4801 = resizeString(Buf_4801, 61);
appendString(Buf_4801, ((NimStringDesc*) &TMP20734));
goto LA1;
LA4: ;
if (!(S_5279 == SIGABRT)) goto LA6;
if (!Dbgaborting_5275) goto LA9;
goto BeforeRet;
LA9: ;
Buf_4801 = resizeString(Buf_4801, 31);
appendString(Buf_4801, ((NimStringDesc*) &TMP20735));
goto LA1;
LA6: ;
if (!(S_5279 == SIGFPE)) goto LA11;
Buf_4801 = resizeString(Buf_4801, 26);
appendString(Buf_4801, ((NimStringDesc*) &TMP20736));
goto LA1;
LA11: ;
if (!(S_5279 == SIGILL)) goto LA13;
Buf_4801 = resizeString(Buf_4801, 27);
appendString(Buf_4801, ((NimStringDesc*) &TMP20737));
goto LA1;
LA13: ;
if (!(S_5279 == SIGSEGV)) goto LA15;
Buf_4801 = resizeString(Buf_4801, 60);
appendString(Buf_4801, ((NimStringDesc*) &TMP20738));
goto LA1;
LA15: ;
Buf_4801 = resizeString(Buf_4801, 15);
appendString(Buf_4801, ((NimStringDesc*) &TMP20739));
LA1: ;
Writetostderr_4417(Buf_4801->data);
Dbgaborting_5275 = NIM_TRUE;
Gcenable_2665();
exit(1);
BeforeRet: ;
}
N_NIMCALL(void, registerSignalHandler)(void) {
signal(SIGINT, signalHandler);
signal(SIGSEGV, signalHandler);
signal(SIGABRT, signalHandler);
signal(SIGFPE, signalHandler);
signal(SIGILL, signalHandler);
signal(SIGSEGV, signalHandler);
}
N_NIMCALL(NI, getRefcount)(void* P_11237) {
NI Result_11238;
TY10402* LOC1;
Result_11238 = 0;
LOC1 = Usrtocell_11212(P_11237);
Result_11238 = (NI32)((NU32)(((NI) ((*LOC1).Refcount))) >> (NU32)(3));
return Result_11238;
}
N_NIMCALL(NimStringDesc*, mnewString)(NI Len_18295) {
NimStringDesc* Result_18296;
Result_18296 = 0;
Result_18296 = rawNewString(Len_18295);
(*Result_18296).Sup.len = Len_18295;
return Result_18296;
}
N_NIMCALL(NimStringDesc*, copyStrLast)(NimStringDesc* S_18343, NI Start_18344, NI Last_18345) {
NimStringDesc* Result_18346;
NI Start_18349;
NI Len_18352;
Result_18346 = 0;
Start_18349 = 0;
Start_18349 = ((Start_18344 >= 0) ? Start_18344 : 0);
Len_18352 = 0;
Len_18352 = (NI32)((NI32)(((Last_18345 <= (NI32)((*S_18343).Sup.len - 1)) ? Last_18345 : (NI32)((*S_18343).Sup.len - 1)) - Start_18349) + 1);
if (!(0 < Len_18352)) goto LA2;
Result_18346 = rawNewString(Len_18352);
(*Result_18346).Sup.len = Len_18352;
memcpy(((NCSTRING) ((*Result_18346).data)), ((NCSTRING) (&(*S_18343).data[(Start_18349)-0])), ((int) ((NI32)(Len_18352 * 1))));
(*Result_18346).data[(Len_18352)-0] = 0;
goto LA1;
LA2: ;
Result_18346 = mnewString(0);
LA1: ;
return Result_18346;
}
N_NIMCALL(NimStringDesc*, copyStr)(NimStringDesc* S_18358, NI Start_18359) {
NimStringDesc* Result_18360;
Result_18360 = 0;
Result_18360 = copyStrLast(S_18358, Start_18359, (NI32)((*S_18358).Sup.len - 1));
goto BeforeRet;
BeforeRet: ;
return Result_18360;
}
N_NOINLINE(void, raiseOverflow)(void) {
EOverflow* E_5652;
E_5652 = 0;
E_5652 = (EOverflow*) newObj(NTI5651, sizeof(EOverflow));
(*E_5652).Sup.Sup.Sup.Sup.m_type = NTI432;
asgnRefNoCycle((void**) &(*E_5652).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP38239)));
raiseException((E_Base*)E_5652, "EOverflow");
}
static N_INLINE(NI, addInt)(NI A_5803, NI B_5804) {
NI Result_5805;
NIM_BOOL LOC2;
Result_5805 = 0;
Result_5805 = (NI32)((NU32)(A_5803) + (NU32)(B_5804));
LOC2 = (0 <= (NI32)(Result_5805 ^ A_5803));
if (LOC2) goto LA3;
LOC2 = (0 <= (NI32)(Result_5805 ^ B_5804));
LA3: ;
if (!LOC2) goto LA4;
goto BeforeRet;
LA4: ;
raiseOverflow();
BeforeRet: ;
return Result_5805;
}
N_NIMCALL(NI, mulInt)(NI A_6803, NI B_6804) {
NI Result_6805;
NF Resasfloat_6806;
NF Floatprod_6807;
Result_6805 = 0;
Resasfloat_6806 = 0;
Floatprod_6807 = 0;
Result_6805 = (NI32)((NU32)(A_6803) * (NU32)(B_6804));
Floatprod_6807 = (((double) (A_6803)) * ((double) (B_6804)));
Resasfloat_6806 = ((double) (Result_6805));
if (!(Resasfloat_6806 == Floatprod_6807)) goto LA2;
goto BeforeRet;
LA2: ;
if (!((3.2000000000000000e+01 * ((Resasfloat_6806 - Floatprod_6807) > 0? ((Resasfloat_6806 - Floatprod_6807)) : -((Resasfloat_6806 - Floatprod_6807)))) <= (Floatprod_6807 > 0? (Floatprod_6807) : -(Floatprod_6807)))) goto LA5;
goto BeforeRet;
LA5: ;
raiseOverflow();
BeforeRet: ;
return Result_6805;
}
N_NIMCALL(void*, newSeq)(TNimType* Typ_14004, NI Len_14005) {
void* Result_14006;
NI LOC1;
NI LOC2;
Result_14006 = 0;
LOC1 = mulInt(Len_14005, (*(*Typ_14004).base).size);
LOC2 = addInt(LOC1, 8);
Result_14006 = newObj(Typ_14004, LOC2);
(*((TGenericSeq*) (Result_14006))).len = Len_14005;
(*((TGenericSeq*) (Result_14006))).space = Len_14005;
return Result_14006;
}
N_NIMCALL(NI, Cmp_1321)(NimStringDesc* X_1323, NimStringDesc* Y_1324) {
NI Result_3319;
int LOC1;
Result_3319 = 0;
LOC1 = strcmp(X_1323->data, Y_1324->data);
Result_3319 = ((NI) (LOC1));
goto BeforeRet;
BeforeRet: ;
return Result_3319;
}
N_NOINLINE(NIM_BOOL, Isonstack_11809)(void* P_11811) {
NIM_BOOL Result_16609;
void* volatile Stacktop_16610;
NI B_16611;
NI A_16613;
NI X_16614;
NIM_BOOL LOC1;
Result_16609 = 0;
Stacktop_16610 = 0;
B_16611 = 0;
B_16611 = ((NI) (Stackbottom_10807));
A_16613 = 0;
A_16613 = ((NI) (&Stacktop_16610));
X_16614 = 0;
X_16614 = ((NI) (P_11811));
LOC1 = ((NU32)(A_16613) <= (NU32)(X_16614));
if (!(LOC1)) goto LA2;
LOC1 = ((NU32)(X_16614) <= (NU32)(B_16611));
LA2: ;
Result_16609 = LOC1;
return Result_16609;
}
N_NIMCALL(void, unsureAsgnRef)(void** Dest_12826, void* Src_12827) {
NIM_BOOL LOC2;
TY10402* LOC8;
TY10402* LOC12;
LOC2 = Isonstack_11809(((void*) (Dest_12826)));
if (!!(LOC2)) goto LA3;
if (!!((Src_12827 == NIM_NIL))) goto LA6;
LOC8 = Usrtocell_11212(Src_12827);
Incref_12802(LOC8);
LA6: ;
if (!!(((*Dest_12826) == NIM_NIL))) goto LA10;
LOC12 = Usrtocell_11212((*Dest_12826));
Decref_12601(LOC12);
LA10: ;
LA3: ;
(*Dest_12826) = Src_12827;
}
N_NIMCALL(TNimType*, extGetCellType)(void* C_11233) {
TNimType* Result_11234;
TY10402* LOC1;
Result_11234 = 0;
LOC1 = Usrtocell_11212(C_11233);
Result_11234 = (*LOC1).Typ;
return Result_11234;
}
N_NIMCALL(TGenericSeq*, setLengthSeq)(TGenericSeq* Seq_18603, NI Elemsize_18604, NI Newlen_18605) {
TGenericSeq* Result_18606;
NI LOC4;
void* LOC5;
NI I_18620;
NI HEX3Atmp_20669;
NI Res_20671;
TNimType* LOC9;
Result_18606 = 0;
Result_18606 = Seq_18603;
if (!((*Result_18606).space < Newlen_18605)) goto LA2;
LOC4 = Resize_18201((*Result_18606).space);
(*Result_18606).space = ((LOC4 >= Newlen_18605) ? LOC4 : Newlen_18605);
LOC5 = Growobj_14007(((void*) (Result_18606)), (NI32)((NI32)(Elemsize_18604 * (*Result_18606).space) + 8));
Result_18606 = ((TGenericSeq*) (LOC5));
goto LA1;
LA2: ;
if (!(Newlen_18605 < (*Result_18606).len)) goto LA6;
I_18620 = 0;
HEX3Atmp_20669 = 0;
HEX3Atmp_20669 = (NI32)((*Result_18606).len - 1);
Res_20671 = 0;
Res_20671 = Newlen_18605;
while (1) {
if (!(Res_20671 <= HEX3Atmp_20669)) goto LA8;
I_18620 = Res_20671;
LOC9 = extGetCellType(((void*) (Result_18606)));
Forallchildrenaux_11820(((void*) ((NI32)((NU32)((NI32)((NU32)(((NI) (Result_18606))) + (NU32)(8))) + (NU32)((NI32)((NU32)(I_18620) * (NU32)(Elemsize_18604)))))), (*LOC9).base, ((NU8) 0));
Res_20671 += 1;
} LA8: ;
zeroMem(((void*) ((NI32)((NU32)((NI32)((NU32)(((NI) (Result_18606))) + (NU32)(8))) + (NU32)((NI32)((NU32)(Newlen_18605) * (NU32)(Elemsize_18604)))))), (NI32)((NU32)((NI32)((NU32)((*Result_18606).len) - (NU32)(Newlen_18605))) * (NU32)(Elemsize_18604)));
goto LA1;
LA6: ;
LA1: ;
(*Result_18606).len = Newlen_18605;
return Result_18606;
}
N_NIMCALL(void, Objectinitaux_19264)(void* Dest_19266, TNimNode* N_19268) {
NI D_19269;
NI I_19277;
NI HEX3Atmp_20690;
NI Res_20692;
TNimNode* M_19278;
D_19269 = 0;
D_19269 = ((NI) (Dest_19266));
switch ((*N_19268).kind) {
case ((NU8) 0):
break;
case ((NU8) 1):
objectInit(((void*) ((NI32)((NU32)(D_19269) + (NU32)((*N_19268).offset)))), (*N_19268).typ);
break;
case ((NU8) 2):
I_19277 = 0;
HEX3Atmp_20690 = 0;
HEX3Atmp_20690 = (NI32)((*N_19268).len - 1);
Res_20692 = 0;
Res_20692 = 0;
while (1) {
if (!(Res_20692 <= HEX3Atmp_20690)) goto LA1;
I_19277 = Res_20692;
Objectinitaux_19264(Dest_19266, (*N_19268).sons[(I_19277)-0]);
Res_20692 += 1;
} LA1: ;
break;
case ((NU8) 3):
M_19278 = 0;
M_19278 = Selectbranch_7263(Dest_19266, N_19268);
if (!!((M_19278 == NIM_NIL))) goto LA3;
Objectinitaux_19264(Dest_19266, M_19278);
LA3: ;
break;
}
}
N_NIMCALL(void, objectInit)(void* Dest_19262, TNimType* Typ_19263) {
NI D_19294;
TNimType** Pint_19296;
NI I_19304;
NI HEX3Atmp_20693;
NI Res_20695;
D_19294 = 0;
D_19294 = ((NI) (Dest_19262));
switch ((*Typ_19263).kind) {
case ((NU8) 17):
Pint_19296 = 0;
Pint_19296 = ((TNimType**) (Dest_19262));
(*Pint_19296) = Typ_19263;
Objectinitaux_19264(Dest_19262, (*Typ_19263).node);
break;
case ((NU8) 18):
case ((NU8) 40):
Objectinitaux_19264(Dest_19262, (*Typ_19263).node);
break;
case ((NU8) 16):
case ((NU8) 4):
I_19304 = 0;
HEX3Atmp_20693 = 0;
HEX3Atmp_20693 = (NI32)((NI32)((*Typ_19263).size / (*(*Typ_19263).base).size) - 1);
Res_20695 = 0;
Res_20695 = 0;
while (1) {
if (!(Res_20695 <= HEX3Atmp_20693)) goto LA1;
I_19304 = Res_20695;
objectInit(((void*) ((NI32)((NU32)(D_19294) + (NU32)((NI32)(I_19304 * (*(*Typ_19263).base).size))))), (*Typ_19263).base);
Res_20695 += 1;
} LA1: ;
break;
default:
break;
}
}
N_NIMCALL(NimStringDesc*, addChar)(NimStringDesc* S_1603, NIM_CHAR C_1604) {
NimStringDesc* Result_18365;
void* LOC4;
Result_18365 = 0;
Result_18365 = S_1603;
if (!((*Result_18365).Sup.space <= (*Result_18365).Sup.len)) goto LA2;
(*Result_18365).Sup.space = Resize_18201((*Result_18365).Sup.space);
LOC4 = Growobj_14007(((void*) (Result_18365)), (NI32)(((NI)sizeof(TGenericSeq)) + (NI32)((NI32)((*Result_18365).Sup.space + 1) * 1)));
Result_18365 = ((NimStringDesc*) (LOC4));
LA2: ;
(*Result_18365).data[((*Result_18365).Sup.len)-0] = C_1604;
(*Result_18365).data[((NI32)((*Result_18365).Sup.len + 1))-0] = 0;
(*Result_18365).Sup.len += 1;
return Result_18365;
}
N_NIMCALL(NimStringDesc*, nimIntToStr)(NI X_19003) {
NimStringDesc* Result_19004;
NI I_19005;
NI Y_19006;
NI D_19007;
NI J_19048;
NI HEX3Atmp_20672;
NI Res_20674;
NIM_CHAR LOC9;
Result_19004 = 0;
Result_19004 = mnewString(16);
I_19005 = 0;
I_19005 = 0;
Y_19006 = 0;
Y_19006 = X_19003;
while (1) {
D_19007 = 0;
D_19007 = (NI32)(Y_19006 / 10);
Result_19004->data[I_19005] = ((NIM_CHAR) (((NI) ((NI32)((NI32)abs(((NI) ((NI32)(Y_19006 - (NI32)(D_19007 * 10))))) + 48)))));
I_19005 += 1;
Y_19006 = D_19007;
if (!(Y_19006 == 0)) goto LA3;
goto LA1;
LA3: ;
} LA1: ;
if (!(X_19003 < 0)) goto LA6;
Result_19004->data[I_19005] = 45;
I_19005 += 1;
LA6: ;
Result_19004 = setLengthStr(Result_19004, I_19005);
J_19048 = 0;
HEX3Atmp_20672 = 0;
HEX3Atmp_20672 = (NI32)((NI32)(I_19005 / 2) - 1);
Res_20674 = 0;
Res_20674 = 0;
while (1) {
if (!(Res_20674 <= HEX3Atmp_20672)) goto LA8;
J_19048 = Res_20674;
LOC9 = Result_19004->data[J_19048];
Result_19004->data[J_19048] = Result_19004->data[(NI32)((NI32)(I_19005 - J_19048) - 1)];
Result_19004->data[(NI32)((NI32)(I_19005 - J_19048) - 1)] = LOC9;
Res_20674 += 1;
} LA8: ;
return Result_19004;
}
N_NIMCALL(NIM_BOOL, Open_3617)(FILE** F_3620, NimStringDesc* Filename_3621, NU8 Mode_3622, NI Bufsize_3623) {
NIM_BOOL Result_4112;
void* P_4113;
int LOC5;
TY442* E_4119;
int LOC11;
Result_4112 = 0;
P_4113 = 0;
P_4113 = fopen(Filename_3621->data, Formatopen_4101[(Mode_3622)-0]->data);
Result_4112 = !((P_4113 == NIM_NIL));
(*F_3620) = ((FILE*) (P_4113));
if (!(0 < Bufsize_3623)) goto LA2;
LOC5 = setvbuf((*F_3620), NIM_NIL, _IOFBF, ((int) (Bufsize_3623)));
if (!!((LOC5 == ((NI32) 0)))) goto LA6;
E_4119 = 0;
E_4119 = (TY442*) newObj(NTI7844, sizeof(TY442));
(*E_4119).Sup.Sup.Sup.Sup.m_type = NTI442;
asgnRefNoCycle((void**) &(*E_4119).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP20727)));
raiseException((E_Base*)E_4119, "EOutOfMemory");
LA6: ;
goto LA1;
LA2: ;
if (!(Bufsize_3623 == 0)) goto LA9;
LOC11 = setvbuf((*F_3620), NIM_NIL, _IONBF, ((NI32) 0));
goto LA1;
LA9: ;
LA1: ;
return Result_4112;
}
N_NIMCALL(NI, Readbuffer_3714)(FILE* F_3716, void* Buffer_3717, NI Len_3718) {
NI Result_4191;
Result_4191 = 0;
Result_4191 = fread(Buffer_3717, 1, Len_3718, F_3716);
return Result_4191;
}
N_NIMCALL(void, Rawreadline_3789)(FILE* F_3791, NimStringDesc** Result_3793) {
int C_3794;
(*Result_3793) = setLengthStr((*Result_3793), 0);
while (1) {
C_3794 = 0;
C_3794 = fgetc(F_3791);
if (!(C_3794 < ((NI32) 0))) goto LA3;
goto LA1;
LA3: ;
if (!(C_3794 == ((NI32) 10))) goto LA6;
goto LA1;
LA6: ;
if (!(C_3794 == ((NI32) 13))) goto LA9;
C_3794 = fgetc(F_3791);
if (!!((C_3794 == ((NI32) 10)))) goto LA12;
ungetc(C_3794, F_3791);
LA12: ;
goto LA1;
LA9: ;
(*Result_3793) = addChar((*Result_3793), ((NIM_CHAR) (((NI) (((NI) (C_3794)))))));
} LA1: ;
}
N_NIMCALL(NimStringDesc*, Readline_3679)(FILE* F_3681) {
NimStringDesc* Result_3806;
Result_3806 = 0;
Result_3806 = copyString(((NimStringDesc*) &TMP193644));
Rawreadline_3789(F_3681, &Result_3806);
return Result_3806;
}
N_NIMCALL(NI64, mulInt64)(NI64 A_5739, NI64 B_5740) {
NI64 Result_5741;
NF64 Resasfloat_5742;
NF64 Floatprod_5743;
Result_5741 = 0;
Resasfloat_5742 = 0;
Floatprod_5743 = 0;
Result_5741 = (NI64)((NU64)(A_5739) * (NU64)(B_5740));
Floatprod_5743 = ((double) (A_5739));
Floatprod_5743 = ((NF64) ((((NF) (Floatprod_5743)) * ((NF) (((double) (B_5740)))))));
Resasfloat_5742 = ((double) (Result_5741));
if (!(((NF) (Resasfloat_5742)) == ((NF) (Floatprod_5743)))) goto LA2;
goto BeforeRet;
LA2: ;
if (!((3.2000000000000000e+01 * ((((NF) (Resasfloat_5742)) - ((NF) (Floatprod_5743))) > 0? ((((NF) (Resasfloat_5742)) - ((NF) (Floatprod_5743)))) : -((((NF) (Resasfloat_5742)) - ((NF) (Floatprod_5743)))))) <= (((NF) (Floatprod_5743)) > 0? (((NF) (Floatprod_5743))) : -(((NF) (Floatprod_5743)))))) goto LA5;
goto BeforeRet;
LA5: ;
raiseOverflow();
BeforeRet: ;
return Result_5741;
}
N_NIMCALL(void, reraiseException)(void) {
TY452* E_5234;
if (!(Currexception_4632 == NIM_NIL)) goto LA2;
E_5234 = 0;
E_5234 = (TY452*) newObj(NTI5233, sizeof(TY452));
(*E_5234).Sup.Sup.Sup.m_type = NTI452;
asgnRefNoCycle((void**) &(*E_5234).Sup.Sup.message, copyString(((NimStringDesc*) &TMP193655)));
raiseException((E_Base*)E_5234, "ENoExceptionToReraise");
goto LA1;
LA2: ;
raiseException(Currexception_4632, (*Currexception_4632).name);
LA1: ;
}
N_NIMCALL(TGenericSeq*, incrSeq)(TGenericSeq* Seq_18435, NI Elemsize_18436) {
TGenericSeq* Result_18437;
void* LOC4;
Result_18437 = 0;
Result_18437 = Seq_18435;
if (!((*Result_18437).space <= (*Result_18437).len)) goto LA2;
(*Result_18437).space = Resize_18201((*Result_18437).space);
LOC4 = Growobj_14007(((void*) (Result_18437)), (NI32)((NI32)(Elemsize_18436 * (*Result_18437).space) + 8));
Result_18437 = ((TGenericSeq*) (LOC4));
LA2: ;
(*Result_18437).len += 1;
return Result_18437;
}
N_NIMCALL(NI, Ptrsize_10033)(void* P_10035) {
NI Result_10036;
void* X_10037;
TY8430* LOC1;
Result_10036 = 0;
X_10037 = 0;
X_10037 = ((void*) ((NI32)((NU32)(((NI) (P_10035))) - (NU32)(((NI)sizeof(TY8422))))));
LOC1 = Pageaddr_8685(X_10037);
Result_10036 = (NI32)((*LOC1).Size - ((NI)sizeof(TY8422)));
return Result_10036;
}
N_NOCONV(void*, Realloc_1956)(void* P_1958, NI Newsize_1959) {
void* Result_10042;
NI LOC7;
Result_10042 = 0;
if (!(0 < Newsize_1959)) goto LA2;
Result_10042 = Alloc_1950(Newsize_1959);
if (!!((P_1958 == NIM_NIL))) goto LA5;
LOC7 = Ptrsize_10033(P_1958);
memcpy(Result_10042, P_1958, LOC7);
Dealloc_1960(P_1958);
LA5: ;
goto LA1;
LA2: ;
if (!!((P_1958 == NIM_NIL))) goto LA8;
Dealloc_1960(P_1958);
goto LA1;
LA8: ;
LA1: ;
return Result_10042;
}
N_NIMCALL(NimStringDesc*, nimCharToStr)(NIM_CHAR X_19128) {
NimStringDesc* Result_19129;
Result_19129 = 0;
Result_19129 = mnewString(1);
Result_19129->data[0] = X_19128;
return Result_19129;
}
N_NIMCALL(NimStringDesc*, nimInt64ToStr)(NI64 X_19067) {
NimStringDesc* Result_19068;
NI I_19069;
NI64 Y_19070;
NI64 D_19071;
NI J_19112;
NI HEX3Atmp_20675;
NI Res_20677;
NIM_CHAR LOC9;
Result_19068 = 0;
Result_19068 = mnewString(32);
I_19069 = 0;
I_19069 = 0;
Y_19070 = 0;
Y_19070 = X_19067;
while (1) {
D_19071 = 0;
D_19071 = (NI64)(Y_19070 / 10);
Result_19068->data[I_19069] = ((NIM_CHAR) (((NI) ((NI32)((NI32)abs(((NI) ((NI64)(Y_19070 - (NI64)(D_19071 * 10))))) + 48)))));
I_19069 += 1;
Y_19070 = D_19071;
if (!(Y_19070 == 0)) goto LA3;
goto LA1;
LA3: ;
} LA1: ;
if (!(X_19067 < 0)) goto LA6;
Result_19068->data[I_19069] = 45;
I_19069 += 1;
LA6: ;
Result_19068 = setLengthStr(Result_19068, I_19069);
J_19112 = 0;
HEX3Atmp_20675 = 0;
HEX3Atmp_20675 = (NI32)((NI32)(I_19069 / 2) - 1);
Res_20677 = 0;
Res_20677 = 0;
while (1) {
if (!(Res_20677 <= HEX3Atmp_20675)) goto LA8;
J_19112 = Res_20677;
LOC9 = Result_19068->data[J_19112];
Result_19068->data[J_19112] = Result_19068->data[(NI32)((NI32)(I_19069 - J_19112) - 1)];
Result_19068->data[(NI32)((NI32)(I_19069 - J_19112) - 1)] = LOC9;
Res_20677 += 1;
} LA8: ;
return Result_19068;
}
N_NIMCALL(NimStringDesc*, nimFloatToStr)(NF X_19060) {
NimStringDesc* Result_19061;
TY19062 Buf_19064;
Result_19061 = 0;
memset((void*)&Buf_19064, 0, sizeof(Buf_19064));
sprintf(((NCSTRING) (Buf_19064)), "%#.16e", X_19060);
Result_19061 = cstrToNimstr(((NCSTRING) (Buf_19064)));
goto BeforeRet;
BeforeRet: ;
return Result_19061;
}
N_NIMCALL(NimStringDesc*, reprEnum)(NI E_19355, TNimType* Typ_19356) {
NimStringDesc* Result_19357;
NimStringDesc* LOC4;
NimStringDesc* LOC5;
Result_19357 = 0;
if (!((NU32)(E_19355) < (NU32)((*(*Typ_19356).node).len))) goto LA2;
Result_19357 = cstrToNimstr((*(*(*Typ_19356).node).sons[(E_19355)-0]).name);
goto LA1;
LA2: ;
LOC4 = 0;
LOC5 = 0;
LOC5 = nimIntToStr(E_19355);
LOC4 = rawNewString(LOC5->Sup.len + 16);
appendString(LOC4, LOC5);
appendString(LOC4, ((NimStringDesc*) &TMP193757));
Result_19357 = LOC4;
LA1: ;
return Result_19357;
}
N_NIMCALL(NIM_BOOL, Endoffile_3638)(FILE* F_3640) {
NIM_BOOL Result_4069;
int C_4070;
Result_4069 = 0;
C_4070 = 0;
C_4070 = fgetc(F_3640);
ungetc(C_4070, F_3640);
Result_4069 = (C_4070 == ((NI32) -1));
goto BeforeRet;
BeforeRet: ;
return Result_4069;
}
static N_INLINE(void, pushSafePoint)(TSafePoint* S_4635) {
(*S_4635).prev = excHandler;
excHandler = S_4635;
}
N_NIMCALL(NI64, Getfilepos_3742)(FILE* F_3744) {
NI64 Result_4297;
NI LOC1;
TY420* E_4301;
Result_4297 = 0;
LOC1 = ftell(F_3744);
Result_4297 = ((NI64) (LOC1));
if (!(Result_4297 < 0)) goto LA3;
E_4301 = 0;
E_4301 = (TY420*) newObj(NTI4254, sizeof(TY420));
(*E_4301).Sup.Sup.Sup.Sup.m_type = NTI420;
asgnRefNoCycle((void**) &(*E_4301).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP193861)));
raiseException((E_Base*)E_4301, "EIO");
LA3: ;
return Result_4297;
}
N_NIMCALL(void, Setfilepos_3738)(FILE* F_3740, NI64 Pos_3741) {
NI LOC2;
TY420* E_4278;
LOC2 = fseek(F_3740, ((NI) (Pos_3741)), 0);
if (!!((LOC2 == 0))) goto LA3;
E_4278 = 0;
E_4278 = (TY420*) newObj(NTI4254, sizeof(TY420));
(*E_4278).Sup.Sup.Sup.Sup.m_type = NTI420;
asgnRefNoCycle((void**) &(*E_4278).Sup.Sup.Sup.message, copyString(((NimStringDesc*) &TMP193862)));
raiseException((E_Base*)E_4278, "EIO");
LA3: ;
}
N_NIMCALL(NI64, Getfilesize_3695)(FILE* F_3697) {
NI64 Result_4320;
NI64 Oldpos_4321;
NI LOC1;
Result_4320 = 0;
Oldpos_4321 = 0;
Oldpos_4321 = Getfilepos_3742(F_3697);
LOC1 = fseek(F_3697, 0, 2);
Result_4320 = Getfilepos_3742(F_3697);
Setfilepos_3738(F_3697, Oldpos_4321);
return Result_4320;
}
static N_INLINE(void, popSafePoint)(void) {
excHandler = (*excHandler).prev;
}
static N_INLINE(E_Base*, getCurrentException)(void) {
E_Base* Result_20004;
Result_20004 = 0;
Result_20004 = Currexception_4632;
return Result_20004;
}
static N_INLINE(void, popCurrentException)(void) {
asgnRef((void**) &Currexception_4632, (*Currexception_4632).parent);
}
N_NIMCALL(NimStringDesc*, Readfile_3647)(NimStringDesc* Filename_3649) {
NimStringDesc* Result_4057;
FILE* F_4058;
TSafePoint TMP193860;
NIM_BOOL LOC2;
NI64 volatile Len_4060;
NI LOC9;
Result_4057 = 0;
F_4058 = 0;
pushSafePoint(&TMP193860);
TMP193860.status = setjmp(TMP193860.context);
if (TMP193860.status == 0) {
LOC2 = Open_3617(&F_4058, Filename_3649, ((NU8) 0), -1);
if (!LOC2) goto LA3;
Len_4060 = 0;
Len_4060 = Getfilesize_3695(F_4058);
if (!(Len_4060 < 2147483647)) goto LA6;
Result_4057 = mnewString(((NI) (Len_4060)));
LOC9 = Readbuffer_3714(F_4058, ((void*) (&Result_4057->data[0])), ((NI) (Len_4060)));
if (!!((((NI64) (LOC9)) == Len_4060))) goto LA10;
Result_4057 = copyString(NIM_NIL);
LA10: ;
LA6: ;
fclose(F_4058);
goto LA1;
LA3: ;
Result_4057 = copyString(NIM_NIL);
LA1: ;
popSafePoint();
} else {
popSafePoint();
if (getCurrentException()->Sup.m_type == NTI420) {
Result_4057 = copyString(NIM_NIL);
TMP193860.status = 0;popCurrentException();}
}
if (TMP193860.status != 0) reraiseException();
return Result_4057;
}
N_NIMCALL(void, Genericassignaux_19168)(void* Dest_19170, void* Src_19171, TNimNode* N_19173) {
NI D_19174;
NI S_19175;
NI I_19183;
NI HEX3Atmp_20678;
NI Res_20680;
TNimNode* M_19184;
D_19174 = 0;
D_19174 = ((NI) (Dest_19170));
S_19175 = 0;
S_19175 = ((NI) (Src_19171));
switch ((*N_19173).kind) {
case ((NU8) 0):
break;
case ((NU8) 1):
genericAssign(((void*) ((NI32)((NU32)(D_19174) + (NU32)((*N_19173).offset)))), ((void*) ((NI32)((NU32)(S_19175) + (NU32)((*N_19173).offset)))), (*N_19173).typ);
break;
case ((NU8) 2):
I_19183 = 0;
HEX3Atmp_20678 = 0;
HEX3Atmp_20678 = (NI32)((*N_19173).len - 1);
Res_20680 = 0;
Res_20680 = 0;
while (1) {
if (!(Res_20680 <= HEX3Atmp_20678)) goto LA1;
I_19183 = Res_20680;
Genericassignaux_19168(Dest_19170, Src_19171, (*N_19173).sons[(I_19183)-0]);
Res_20680 += 1;
} LA1: ;
break;
case ((NU8) 3):
memcpy(((void*) ((NI32)((NU32)(D_19174) + (NU32)((*N_19173).offset)))), ((void*) ((NI32)((NU32)(S_19175) + (NU32)((*N_19173).offset)))), (*(*N_19173).typ).size);
M_19184 = 0;
M_19184 = Selectbranch_7263(Src_19171, N_19173);
if (!!((M_19184 == NIM_NIL))) goto LA3;
Genericassignaux_19168(Dest_19170, Src_19171, M_19184);
LA3: ;
break;
}
}
N_NIMCALL(void, genericAssign)(void* Dest_19165, void* Src_19166, TNimType* Mt_19167) {
NI D_19201;
NI S_19202;
void* S2_19214;
TGenericSeq* Seq_19215;
void** X_19216;
void* LOC4;
NI Dst_19217;
NI I_19225;
NI HEX3Atmp_20681;
NI Res_20683;
TGenericSeq* Dstseq_19226;
NI I_19234;
NI HEX3Atmp_20684;
NI Res_20686;
void* S2_19235;
NimStringDesc* LOC10;
void** X_19236;
D_19201 = 0;
D_19201 = ((NI) (Dest_19165));
S_19202 = 0;
S_19202 = ((NI) (Src_19166));
switch ((*Mt_19167).kind) {
case ((NU8) 24):
S2_19214 = 0;
S2_19214 = (*((void**) (Src_19166)));
Seq_19215 = 0;
Seq_19215 = ((TGenericSeq*) (S2_19214));
if (!(S2_19214 == NIM_NIL)) goto LA2;
X_19216 = 0;
X_19216 = ((void**) (Dest_19165));
(*X_19216) = NIM_NIL;
goto BeforeRet;
LA2: ;
LOC4 = newObj(Mt_19167, (NI32)((NI32)((*Seq_19215).len * (*(*Mt_19167).base).size) + 8));
unsureAsgnRef(((void**) (Dest_19165)), LOC4);
Dst_19217 = 0;
Dst_19217 = ((NI) ((*((void**) (Dest_19165)))));
I_19225 = 0;
HEX3Atmp_20681 = 0;
HEX3Atmp_20681 = (NI32)((*Seq_19215).len - 1);
Res_20683 = 0;
Res_20683 = 0;
while (1) {
if (!(Res_20683 <= HEX3Atmp_20681)) goto LA5;
I_19225 = Res_20683;
genericAssign(((void*) ((NI32)((NU32)((NI32)((NU32)(Dst_19217) + (NU32)((NI32)((NU32)(I_19225) * (NU32)((*(*Mt_19167).base).size))))) + (NU32)(8)))), ((void*) ((NI32)((NU32)((NI32)((NU32)(((NI) (S2_19214))) + (NU32)((NI32)((NU32)(I_19225) * (NU32)((*(*Mt_19167).base).size))))) + (NU32)(8)))), (*Mt_19167).base);
Res_20683 += 1;
} LA5: ;
Dstseq_19226 = 0;
Dstseq_19226 = ((TGenericSeq*) (Dst_19217));
(*Dstseq_19226).len = (*Seq_19215).len;
(*Dstseq_19226).space = (*Seq_19215).len;
break;
case ((NU8) 17):
case ((NU8) 18):
case ((NU8) 40):
Genericassignaux_19168(Dest_19165, Src_19166, (*Mt_19167).node);
break;
case ((NU8) 16):
case ((NU8) 4):
I_19234 = 0;
HEX3Atmp_20684 = 0;
HEX3Atmp_20684 = (NI32)((NI32)((*Mt_19167).size / (*(*Mt_19167).base).size) - 1);
Res_20686 = 0;
Res_20686 = 0;
while (1) {
if (!(Res_20686 <= HEX3Atmp_20684)) goto LA6;
I_19234 = Res_20686;
genericAssign(((void*) ((NI32)((NU32)(D_19201) + (NU32)((NI32)((NU32)(I_19234) * (NU32)((*(*Mt_19167).base).size)))))), ((void*) ((NI32)((NU32)(S_19202) + (NU32)((NI32)((NU32)(I_19234) * (NU32)((*(*Mt_19167).base).size)))))), (*Mt_19167).base);
Res_20686 += 1;
} LA6: ;
break;
case ((NU8) 28):
S2_19235 = 0;
S2_19235 = (*((void**) (S_19202)));
if (!!((S2_19235 == NIM_NIL))) goto LA8;
LOC10 = copyString(((NimStringDesc*) (S2_19235)));
unsureAsgnRef(((void**) (Dest_19165)), ((void*) (LOC10)));
goto LA7;
LA8: ;
X_19236 = 0;
X_19236 = ((void**) (Dest_19165));
(*X_19236) = NIM_NIL;
goto BeforeRet;
LA7: ;
break;
case ((NU8) 22):
unsureAsgnRef(((void**) (Dest_19165)), (*((void**) (S_19202))));
break;
default:
memcpy(Dest_19165, Src_19166, (*Mt_19167).size);
break;
}
BeforeRet: ;
}
N_NIMCALL(void, genericSeqAssign)(void* Dest_19239, void* Src_19240, TNimType* Mt_19241) {
void* Src_19242;
Src_19242 = 0;
Src_19242 = Src_19240;
genericAssign(Dest_19239, ((void*) (&Src_19242)), Mt_19241);
}
N_NIMCALL(NimStringDesc*, Gcgetstatistics_2682)(void) {
NimStringDesc* Result_17624;
NimStringDesc* LOC1;
NI LOC2;
NimStringDesc* LOC3;
NI LOC4;
NimStringDesc* LOC5;
NimStringDesc* LOC6;
NimStringDesc* LOC7;
NimStringDesc* LOC8;
NimStringDesc* LOC9;
NimStringDesc* LOC10;
NimStringDesc* LOC11;
NimStringDesc* LOC12;
Result_17624 = 0;
Gcdisable_2663();
LOC1 = 0;
LOC2 = Gettotalmem_2021();
LOC3 = 0;
LOC3 = nimIntToStr(LOC2);
LOC4 = Getoccupiedmem_2017();
LOC5 = 0;
LOC5 = nimIntToStr(LOC4);
LOC6 = 0;
LOC6 = nimIntToStr(Gch_10808.Stat.Stackscans);
LOC7 = 0;
LOC7 = nimIntToStr(Gch_10808.Stat.Maxstackcells);
LOC8 = 0;
LOC8 = nimIntToStr(Gch_10808.Stat.Cyclecollections);
LOC9 = 0;
LOC9 = nimIntToStr(Gch_10808.Stat.Maxthreshold);
LOC10 = 0;
LOC10 = nimIntToStr(Gch_10808.Zct.Cap);
LOC11 = 0;
LOC11 = nimIntToStr(Gch_10808.Stat.Cycletablesize);
LOC12 = 0;
LOC12 = nimIntToStr(Gch_10808.Stat.Maxstacksize);
LOC1 = rawNewString(LOC3->Sup.len + LOC5->Sup.len + LOC6->Sup.len + LOC7->Sup.len + LOC8->Sup.len + LOC9->Sup.len + LOC10->Sup.len + LOC11->Sup.len + LOC12->Sup.len + 196);
appendString(LOC1, ((NimStringDesc*) &TMP195492));
appendString(LOC1, LOC3);
appendString(LOC1, ((NimStringDesc*) &TMP195493));
appendString(LOC1, LOC5);
appendString(LOC1, ((NimStringDesc*) &TMP195494));
appendString(LOC1, LOC6);
appendString(LOC1, ((NimStringDesc*) &TMP195495));
appendString(LOC1, LOC7);
appendString(LOC1, ((NimStringDesc*) &TMP195496));
appendString(LOC1, LOC8);
appendString(LOC1, ((NimStringDesc*) &TMP195497));
appendString(LOC1, LOC9);
appendString(LOC1, ((NimStringDesc*) &TMP195498));
appendString(LOC1, LOC10);
appendString(LOC1, ((NimStringDesc*) &TMP195499));
appendString(LOC1, LOC11);
appendString(LOC1, ((NimStringDesc*) &TMP195500));
appendString(LOC1, LOC12);
Result_17624 = LOC1;
Gcenable_2665();
return Result_17624;
}
N_NIMCALL(void, Listremove_8846)(TY8434** Head_8850, TY8434* C_8851) {
if (!(C_8851 == (*Head_8850))) goto LA2;
(*Head_8850) = (*C_8851).Next;
if (!!(((*Head_8850) == NIM_NIL))) goto LA5;
(*(*Head_8850)).Prev = NIM_NIL;
LA5: ;
goto LA1;
LA2: ;
(*(*C_8851).Prev).Next = (*C_8851).Next;
if (!!(((*C_8851).Next == NIM_NIL))) goto LA8;
(*(*C_8851).Next).Prev = (*C_8851).Prev;
LA8: ;
LA1: ;
(*C_8851).Next = NIM_NIL;
(*C_8851).Prev = NIM_NIL;
}
N_NIMCALL(void, Listadd_9426)(TY8432** Head_9430, TY8432* C_9431) {
(*C_9431).Next = (*Head_9430);
if (!!(((*Head_9430) == NIM_NIL))) goto LA2;
(*(*Head_9430)).Prev = C_9431;
LA2: ;
(*Head_9430) = C_9431;
}
N_NIMCALL(void, Listremove_9568)(TY8432** Head_9572, TY8432* C_9573) {
if (!(C_9573 == (*Head_9572))) goto LA2;
(*Head_9572) = (*C_9573).Next;
if (!!(((*Head_9572) == NIM_NIL))) goto LA5;
(*(*Head_9572)).Prev = NIM_NIL;
LA5: ;
goto LA1;
LA2: ;
(*(*C_9573).Prev).Next = (*C_9573).Next;
if (!!(((*C_9573).Next == NIM_NIL))) goto LA8;
(*(*C_9573).Next).Prev = (*C_9573).Prev;
LA8: ;
LA1: ;
(*C_9573).Next = NIM_NIL;
(*C_9573).Prev = NIM_NIL;
}
N_NIMCALL(void, Listadd_9207)(TY8434** Head_9211, TY8434* C_9212) {
(*C_9212).Next = (*Head_9211);
if (!!(((*Head_9211) == NIM_NIL))) goto LA2;
(*(*Head_9211)).Prev = C_9212;
LA2: ;
(*Head_9211) = C_9212;
}
N_NOINLINE(void, systemInit)(void) {
Dbglinehook_2722 = ((TY2719) (NIM_NIL));
Strdesc_3017.size = 4;
Strdesc_3017.kind = ((NU8) 28);
Strdesc_3017.flags = 2;
Initstackbottom_3013();
Initgc_3011();
asgnRefNoCycle((void**) &Stacktracenewline_4416, copyString(((NimStringDesc*) &TMP20725)));
excHandler = NIM_NIL;
registerSignalHandler();
asgnRefNoCycle((void**) &Gassertionfailed_5251, (EAssertionFailed*) newObj(NTI5250, sizeof(EAssertionFailed)));
(*Gassertionfailed_5251).Sup.Sup.Sup.m_type = NTI436;
asgnRefNoCycle((void**) &Buf_4801, mnewString(2048));
asgnRefNoCycle((void**) &Assertbuf_4802, mnewString(2048));
Buf_4801 = setLengthStr(Buf_4801, 0);
Assertbuf_4802 = setLengthStr(Assertbuf_4802, 0);
Lastsize_8691 = 4096;
Cyclethreshold_10809 = 4194304;
Recgclock_10810 = 0;
}

